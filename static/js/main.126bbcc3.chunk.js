(this["webpackJsonpccs-annotator-client"]=this["webpackJsonpccs-annotator-client"]||[]).push([[0],{204:function(e,t,n){},205:function(e,t,n){},230:function(e,t,n){"use strict";n.r(t);n(191);var r=n(0),i=n.n(r),a=n(71),o=n.n(a),l=n(108),c=n(6),s=n(9),u=n(21),d=n(14),f=n.n(d),b=n(262),j=n(52),v=n(261),h=n(12),p=n(173),x=n(231),O=n(1),g=function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i,a,o,l,c,u,d,b,j,v,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),i=t.getAllAnnotations(),a=[],o=Object(h.a)(i);try{for(o.s();!(l=o.n()).done;){c=l.value,u=c.annotations,d=r[c.unit_id],b=Object(h.a)(u);try{for(b.s();!(j=b.n()).done;)v=j.value,p=Object(s.a)(Object(s.a)({document_id:d.document_id,unit_id:d.unit_id},d.provenance),v),a.push(p)}catch(f){b.e(f)}finally{b.f()}}}catch(f){o.e(f)}finally{o.f()}n(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i,a,o,l,c,u,d,b,j,v,p,x,O,g,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),a=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),o=t.getAllAnnotations(),l=Object(h.a)(o);try{for(l.s();!(c=l.n()).done;){if(u=c.value,d=u.annotations,b=a[u.unit_id],j=Object(s.a)(Object(s.a)({document_id:b.document_id,unit_id:b.unit_id},b.provenance),{},{offset:d[0].offset,length:d[0].length,field:d[0].field},d[0].meta),b.meta)for(v=0,p=Object.keys(b.meta);v<p.length;v++)x=p[v],j["meta_"+x]=b.meta[x];O=Object(h.a)(i);try{for(m=function(){var e=g.value,t=d.find((function(t){return t.variable===e}));j[e]=null==t?null:t.value},O.s();!(g=O.n()).done;)m()}catch(f){O.e(f)}finally{O.f()}r.push(j)}}catch(f){l.e(f)}finally{l.f()}n(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(e){var t=e.jobServer,n=Object(r.useState)(null),i=Object(c.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":g(t,o);break;case"questions":m(t,o);break;default:return null}}),[t]),Object(O.jsx)(p.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:a,style:{cursor:"pointer"},children:Object(O.jsx)(x.a,{loading:null===a,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},k=n(260),w=n(247),S=n(254),C=function(e){var t=e.n,n=e.index,i=e.setIndex,a=e.canGoForward,o=void 0===a||a,l=e.canGoBack,s=void 0===l||l,u=Object(r.useRef)(0),d=Object(r.useRef)(!1),f=Object(r.useState)(!1),b=Object(c.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(1),p=Object(c.a)(h,2),x=p[0],g=p[1],m=Object(r.useState)(1),y=Object(c.a)(m,2),C=y[0],E=y[1];if(Object(r.useEffect)((function(){n<0||(null!==n&&g(Math.min(n+1,t+1)),null===n&&g(t+1))}),[n,t,g]),Object(r.useEffect)((function(){u.current=0,d.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;g(1),d.current=!0}),[t,g]),Object(r.useEffect)((function(){if(!t)return null;u.current=Math.max(x,u.current),i(x-1===t?null:x-1),E(x)}),[t,i,x]),Object(r.useEffect)((function(){if(!t)return null;if(x===C)return v(!1),null;v(!0);var e=setTimeout((function(){g(C),v(!1)}),500);return function(){return clearTimeout(e)}}),[x,C,t,v]),!t)return null;var R=100*Math.max(0,u.current-1)/t;return Object(O.jsxs)(k.a,{style:{display:"flex",border:"none",boxShadow:"none",padding:"0",marginTop:"5px",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(O.jsx)(w.a,{active:j,content:""}),Object(O.jsx)(S.a,{secondary:!0,activePage:C,pageItem:C<=t?"".concat(C," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:s?"back":"   ",nextItem:o||x<u.current?"next":"   ",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||x<u.current)&&Number(t.activePage)>x&&g(Number(t.activePage)),s&&Number(t.activePage)<x&&g(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),Object(O.jsx)("input",{style:{flex:"1 1 auto",background:"linear-gradient(to right, #7dd48d ".concat(R,"%, #fff ").concat(R,"% 100%, #fff 100%)")},min:1,max:t+1,onChange:function(e){Number(e.target.value)>C&&E(o?Number(e.target.value):Math.min(u.current,Number(e.target.value))),s&&Number(e.target.value)<C&&E(Number(e.target.value))},type:"range",value:C})]})},E=n(20),R=n(259),A=n(253),_=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,l=t-1;l>=0;l--){if(null==e[l].ref||null===e[l].ref.current)return l+1;var c=M(e[l].ref);if(null===c)return;if(null===a){if(T(i,c))continue;a=c}else if(!T(a,c))return l+1;var s=N(i,c);if(o>0&&s<o)return l+1;if(i.left>c.right)return l;o=s}return 0},L=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,l=t+1;l<e.length;l++){if(null==e[l].ref||null===e[l].ref.current)return l-1;var c=M(e[l].ref);if(null===c)return;if(null===a){if(T(i,c))continue;a=c}else if(!T(a,c))return l-1;var s=N(i,c);if(o>0&&s<o)return l-1;if(i.right<c.left)return l;o=s}return e.length-1},T=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},N=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),i=(r-n)/e.width,a=(r-n)/t.width;return Math.max(i,a)},M=function(e,t){if(null===e||void 0===e||!e.current)return null;var n=e.current.getBoundingClientRect();if(null!=t){var r=t.current.getBoundingClientRect();n.x=r.x,n.width=r.width}return n},I=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],H=i.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,a=Object(r.useRef)();return Object(O.jsx)(R.a,{innerRef:a,children:Object(O.jsx)(A.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!i},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(O.jsxs)(O.Fragment,{children:[e.code,Object(O.jsx)("br",{}),Object(O.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),P=i.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,o=Object(r.useState)(0),l=Object(c.a)(o,2),s=l[0],u=l[1],d=i.a.useCallback((function(e){var r=t.length;if(I.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&s<r-1&&u(s+1),"ArrowDown"===e.key&&u(L(t,s)),"ArrowLeft"===e.key&&s>0&&u(s-1),void("ArrowUp"===e.key&&u(_(t,s)));46===e.keyCode&&(n(null),u(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),s===t.length?n(null):n(t[s]),u(0))}),[s,n,t]);Object(r.useEffect)((function(){return a?window.removeEventListener("keydown",d):window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}}),[d,a]);return Object(O.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(R.a,{innerRef:e.ref,children:Object(O.jsx)(x.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===s?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return u(t)},onClick:function(e,t){n(t.value),u(0)},children:e.code},e.code)})})}))})})),z=i.a.memo((function(e){var t,n,a,o,l,c,s,u,d,f=e.swipeOptions,b=e.callback,v=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){v&&("right"===v&&b(f.right),"up"===v&&b(f.up),"left"===v&&b(f.left))}),[v,b,f]);var p=i.a.useCallback((function(e){I.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(f.right),"ArrowUp"===e.key&&b(f.up),"ArrowLeft"===e.key&&b(f.left))}),[b,f]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(O.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==f.up?null:Object(O.jsx)(x.a,{fluid:!0,disabled:null==f.up,onClick:function(e,t){return b(f.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=f.up)||void 0===t?void 0:t.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)(j.a,{name:null!==(n=f.up)&&void 0!==n&&n.code?"arrow up":null}),Object(O.jsx)("span",{children:(null===(a=f.up)||void 0===a?void 0:a.code)||""})]})}),Object(O.jsx)("div",{style:{flex:"1 1 auto"},children:Object(O.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(O.jsx)(x.a,{disabled:null==f.left,onClick:function(e,t){return b(f.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=f.left)||void 0===o?void 0:o.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)(j.a,{name:null!==(l=f.left)&&void 0!==l&&l.code?"arrow left":null}),Object(O.jsx)("span",{children:(null===(c=f.left)||void 0===c?void 0:c.code)||""})]})}),Object(O.jsx)(x.a,{disabled:null==f.right,onClick:function(e,t){return b(f.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(s=f.right)||void 0===s?void 0:s.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)("span",{children:(null===(u=f.right)||void 0===u?void 0:u.code)||""}),Object(O.jsx)(j.a,{name:null!==(d=f.right)&&void 0!==d&&d.code?"arrow right":null})]})})]})})]})})),U="lightgreen",D=function(e){var t,n=e.unit,i=e.tokens,a=e.questions,o=e.questionIndex,l=e.setQuestionIndex,s=e.setUnitIndex,u=e.swipe,d=e.blockEvents,f=Object(r.useState)(),b=Object(c.a)(f,2),j=b[0],h=b[1],p=Object(r.useRef)(!1),x=Object(r.useState)(null),g=Object(c.a)(x,2),m=g[0],y=g[1];if(Object(r.useEffect)((function(){a&&(F(n,i,a,y),p.current=!1)}),[n,i,y,a]),!a||!n||!m)return null;if(null===a||void 0===a||!a[o])return l(0),null;var k=K(n,a[o]);return Object(O.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(O.jsx)(q,{questions:a,questionIndex:o,annotations:m,setQuestionIndex:l}),Object(O.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",borderBottomLeftRadius:"30px",borderBottomRightRadius:"30px",backgroundColor:"#1B1C1D"},children:[Object(O.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(O.jsx)(v.a,{as:"h3",style:{color:"white"},children:k})}),Object(O.jsx)(W,{answerTransition:j,currentAnswer:null===m||void 0===m||null===(t=m[o])||void 0===t?void 0:t.value,questions:a,questionIndex:o,onSelect:function(e){if(p.current)return null;p.current=!0,m[o].value=e.code,m[o].makes_irrelevant=e.makes_irrelevant,n.annotations=J(m[o],n.annotations),B(n,a,m,o);for(var t=null,r=o+1;r<a.length;r++)if("IRRELEVANT"!==m[r].value){t=r;break}var i=null===t?"DONE":"IN_PROGRESS";n.jobServer.postAnnotations(n.unitId,n.annotations,i),h(e),setTimeout((function(){h(null),null===t?(s((function(e){return e+1})),l(0)):l(t),p.current=!1}),250)},swipe:u,blockEvents:d})]})]})},B=function(e,t,n,r){var i=new Set;for(var a in Object.keys(e.annotations)){var o=e.annotations[a].makes_irrelevant;if(null!=o&&null!==o){var l,c=Object(h.a)(o);try{var s=function(){var e=l.value;if("REMAINING"===e)for(var a=r+1;a<n.length;a++)i.add(a);var o=t.findIndex((function(t){return t.name===e}));o>=0&&i.add(o)};for(c.s();!(l=c.n()).done;)s()}catch(d){c.e(d)}finally{c.f()}}}for(var u=0;u<n.length;u++)i.has(u)?(n[u].value="IRRELEVANT",e.annotations=J(n[u],e.annotations)):"IRRELEVANT"===n[u].value&&(delete n[u].value,e.annotations=J(n[u],e.annotations))},F=function(e,t,n,r){if(0===t.length)return null;var i=[];e.annotations||(e.annotations=[]);for(var a=0;a<n.length;a++){var o=V(t,n[a],a);o.value=G(e.annotations,o),i.push(o)}r(i)},q=function(e){var t=e.questions,n=e.questionIndex,i=e.annotations,a=e.setQuestionIndex,o=Object(r.useState)(),l=Object(c.a)(o,2),s=l[0],u=l[1];Object(r.useEffect)((function(){var e=i.map((function(e){return null!==e.value}));e[0]=!0,u(e)}),[i,u]),Object(r.useEffect)((function(){u((function(e){var t=Object(E.a)(e);return t[n]=!0,t}))}),[n,u]);return Object(O.jsx)("div",{children:Object(O.jsx)(x.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return i[e]?"IRRELEVANT"===i[e].value?["black","red"]:s&&e>n&&!s[e]?["white","grey"]:i[e].value?["black",U]:0===e||s&&s[e]?[U,"#1B1C1D"]:[U,"grey"]:["black","red"]}(r),l=Object(c.a)(o,2),u=l[0],d=l[1];return Object(O.jsx)(x.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:d,textOverflow:"clip",overflow:"hidden",color:u},onClick:function(){s[r]&&a(r)},children:Object(O.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},W=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,i=e.questionIndex,a=e.onSelect,o=e.swipe,l=e.blockEvents;return t?Object(O.jsx)(k.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(O.jsx)(v.a,{as:"h1",children:t.code})}):Object(O.jsxs)(O.Fragment,{children:[Q(n||t),Object(O.jsxs)(k.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",margin:"0"},children:["search code"===r[i].type?Object(O.jsx)(H,{options:r[i].options,callback:a,blockEvents:l}):null,"select code"===r[i].type?Object(O.jsx)(P,{options:r[i].options,callback:a,blockEvents:l}):null,"annotinder"===r[i].type?Object(O.jsx)(z,{swipeOptions:r[i].swipeOptions,currentAnswer:n,callback:a,swipe:o,blockEvents:l}):null]})]})},V=function(e,t,n){if(0===e.length)return null;var r,i={},a=e[e.length-1],o=[0,a.offset+a.length],l=[0,e.length-1],c=!1,s=!1,u=0,d=Object(h.a)(e);try{for(d.s();!(r=d.n()).done;){var f=r.value;f.codingUnit&&!i[f.field]&&(i[f.field]=1),!c&&f.codingUnit&&(c=!0,o[0]=f.offset,l[0]=u),s||f.codingUnit||!c||(s=!0,o[1]=e[u-1].offset+e[u-1].length,l[1]=u-1),u++}}catch(j){d.e(j)}finally{d.f()}var b={length_tokens:1+l[1]-l[0],length_paragraphs:1+e[l[1]].paragraph-e[l[0]].paragraph,length_sentences:1+e[l[1]].sentence-e[l[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,field:Object.keys(i).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},Y=function(e,t){return e.variable===t.variable&&e.field===t.field&&e.offset===t.offset&&e.length===t.length},G=function(e,t){if(!e)return null;var n,r=Object(h.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(Y(i,t))return i.value}}catch(a){r.e(a)}finally{r.f()}return null},J=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(Y(t[n],e))return t[n]=e,t;return t.push(e),t},Q=function(e){return null==e?null:Object(O.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(O.jsx)(k.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:U,textAlign:"center"},children:Object(O.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(O.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},K=function(e,t){var n=t.question;if(e.variables){for(var r=0,i=Object.keys(e.variables);r<i.length;r++){var a=i[r];if(n.search("\\[".concat(a,"\\]"))>=0){var o=e.variables[a],l="{{lightyellow###".concat(o,"}}");n=n.replace("[".concat(a,"]"),l)}}return X(n)}},X=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(O.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),i=Object(c.a)(r,2),a=i[0],o=i[1];e.push(Object(O.jsx)("mark",{style:{backgroundColor:a},children:o},n+t))}return e}),[])})},Z=i.a.memo(D),$=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=n.top,a=n.height,o=r.top,l=o-i<50;o>i+.9*a&&(e.scrollTop=e.scrollTop+o-(.9*a+i)),l&&(e.scrollTop=e.scrollTop+o-(.1*a+i))},ee=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],te=function(e){var t=e.tokens,n=e.annotations,i=e.currentToken,a=e.setCurrentToken,o=e.tokenSelection,l=e.setTokenSelection,s=e.triggerCodePopup,u=e.editMode,d=e.eventsBlocked,f=Object(r.useState)(null),b=Object(c.a)(f,2),j=b[0],v=b[1],p=Object(r.useState)(!1),x=Object(c.a)(p,2),g=x[0],m=x[1],y=Object(r.useState)(null),k=Object(c.a)(y,2),w=k[0],S=k[1];return Object(r.useEffect)((function(){d&&(S(!1),m(!1))}),[S,m,d,l]),Object(r.useEffect)((function(){if(t){var e,n=Object(h.a)(t);try{var r=function(){var t=e.value;t.triggerCodePopup=function(e){var n,r;e||(e=[t.index,t.index]),null!==t&&void 0!==t&&null!==(n=t.containerRef)&&void 0!==n&&n.current&&null!==t&&void 0!==t&&null!==(r=t.ref)&&void 0!==r&&r.current&&(t.containerRef.current.style.scrollBehavior="smooth",$(t.containerRef.current,t.ref.current)),a({i:t.index}),l(e)}};for(n.s();!(e=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}}}),[t,a,l]),Object(r.useEffect)((function(){var e,r;if(j&&w&&null!==t&&void 0!==t&&null!==(e=t[0])&&void 0!==e&&null!==(r=e.containerRef)&&void 0!==r&&r.current){var i,o=ae(t,n,w,j,g,u,a,l);1===j.counter?(t[0].containerRef.current.style.scrollBehavior="smooth",i=150):(t[0].containerRef.current.style.scrollBehavior="auto",i=Math.max(5,100/Math.ceil(j.counter/5))),setTimeout((function(){v({position:o,startposition:j.startposition,ntokens:j.ntokens,counter:j.counter+1})}),i)}}),[t,j,w,g,a,u,n,l]),t&&0!==t.length?d?null:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(ne,{tokenSelection:o,currentToken:i,tokens:t,HoldSpace:g,setMover:v,setHoldSpace:m,setHoldArrow:S,triggerCodePopup:s,editMode:u}),Object(O.jsx)(re,{tokenSelection:o,tokens:t,setCurrentToken:a,setTokenSelection:l,triggerCodePopup:s,editMode:u})]}):null},ne=function(e){var t=e.tokenSelection,n=e.currentToken,i=e.tokens,a=e.HoldSpace,o=e.setMover,l=e.setHoldSpace,c=e.setHoldArrow,s=e.triggerCodePopup;e.editMode;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&a)return l(!1),void(t.length>0&&ie(i,t,s));ee.includes(e.key)&&(c(!1),o(null))},d=function(e){if(32!==e.keyCode){if(ee.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n.i,startposition:n.i,ntokens:i.length,counter:1}),c(e.key)}}else{if(e.preventDefault(),e.repeat)return;l(!0)}};return Object(O.jsx)(O.Fragment,{})},re=function(e){var t=e.tokenSelection,n=e.tokens,i=e.setCurrentToken,a=e.setTokenSelection,o=e.triggerCodePopup,l=e.editMode,c=Object(r.useRef)(!1),s=Object(r.useRef)(null),u=Object(r.useRef)(null),d=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",j),window.addEventListener("mousemove",v),window.addEventListener("mouseup",h),window.addEventListener("touchstart",f),window.addEventListener("touchend",b),window.addEventListener("contextmenu",p),function(){window.removeEventListener("mousedown",j),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",h),window.removeEventListener("touchstart",f),window.removeEventListener("touchend",b),window.removeEventListener("contextmenu",p)}}));var f=function(e){u.current={time:new Date,token:se(n,e)}},b=function(e){var r;if(null!==(r=u.current)&&void 0!==r&&r.time&&!(new Date-u.current.time>150)){var c=u.current.token;if(null===(null===c||void 0===c?void 0:c.index))return de(n,s.current),s.current=null,void a((function(e){return 0===e.length?e:[]}));if(l)ie(n,[c.index,c.index],o);else{if(t.length>0&&t[0]===s.current){var d=x(c);return a((function(e){return ve(e,n,d,!0)})),null!==c&&void 0!==c&&c.annotated&&d===t[0]?ie(n,[d,d],o):ie(n,[t[0],d],o),de(n,s.current),s.current=null,void i({i:null})}s.current!==c.index?(de(n,s.current),ue(n,c.index),s.current=c.index,i({i:c.index}),a((function(e){return 0===e.length?e:[]}))):(de(s.current),a((function(e){return ve(e,n,c.index,!0)})))}}},j=function(e){d.current||1===e.which&&(c.current=!0,a((function(e){return 0===e.length?e:[]})))},v=function(e){if(!d.current)if(!l&&c.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),x(se(n,e))}else{var t=se(n,e);null!==t.index?(i((function(e){return e.i===t.index?e:{i:t.index}})),a((function(e){return ve(e,n,t.index,!1)}))):i((function(e){return e.i===t.index||null===t.index?e:{i:t.index}}))}},h=function(e){if(!d.current){if(1!==e.which&&0!==e.which)return null;e.preventDefault(),e.stopPropagation();var r=x(se(n,e));window.getSelection().empty(),c.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?ie(n,t,o):null!==r&&ie(n,[r,r],o)}},p=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},x=function(e){return i((function(t){return t.i===e.index?t:{i:e.index}})),a((function(t){return ve(t,n,e.index,!0)})),e.index};return Object(O.jsx)(O.Fragment,{})},ie=function(e,t,n){var r=Object(c.a)(t,2),i=r[0],a=r[1];if(i>a){var o=[a,i];i=o[0],a=o[1]}n(e[a].index,[e[i].index,e[a].index])},ae=function(e,t,n,r,i,a,o,l){var c;if(c=a?le(e,t,n,r):oe(e,n,i,r),r.position!==c){o((function(e){return{i:e===c?e:c}})),l((function(t){return ve(t,e,c,!a&&i)}));var s=e[c].containerRef.current,u=e[c].ref.current;$(s,u)}return c},oe=function(e,t,n,r){var i,a=r.position;if("ArrowRight"===t&&a++,"ArrowLeft"===t&&a--,"ArrowUp"===t&&(a=ce(e,r,"up")),"ArrowDown"===t&&(a=ce(e,r,"down")),a>r.ntokens&&(a=r.ntokens),a<0&&(a=0),null==(null===(i=e[a])||void 0===i?void 0:i.ref)){if("ArrowLeft"===t||"ArrowUp"===t){var o=e.findIndex((function(e){return e.codingUnit}));if(o<0)return r.position;a=o}if("ArrowRight"===t||"ArrowDown"===t){var l=e.map((function(e){return e.codingUnit})).lastIndexOf(!0);if(l<0)return r.position;a=l-1}}if(n&&e[r.position].field!==e[a].field)if(a>r.position){for(var c=a;c>=r.position;c--)if(e[c].field===e[r.position].field){a=c;break}}else for(var s=a;s<=r.position;s++)if(e[s].field===e[r.position].field){a=s;break}return a},le=function(e,t,n,r){var i=r.position;if("ArrowRight"===n||"ArrowDown"===n){var a=e.findIndex((function(e,t){var n,r,a;return t>i&&(null===e||void 0===e||null===(n=e.ref)||void 0===n?void 0:n.current.classList.contains("annotated"))&&((null===e||void 0===e||null===(r=e.ref)||void 0===r?void 0:r.current.classList.contains("allLeft"))||(null===e||void 0===e||null===(a=e.ref)||void 0===a?void 0:a.current.classList.contains("anyLeft")))}));if(a<0)return r.position;i=a}if("ArrowLeft"===n||"ArrowUp"===n){for(var o=-1,l=i-1;l>=-1;l--){var c,s,u,d,f,b;if(null===(c=e[l])||void 0===c||null===(s=c.ref)||void 0===s?void 0:s.current.classList.contains("annotated")){var j=null===(u=e[l])||void 0===u||null===(d=u.ref)||void 0===d?void 0:d.current.classList.contains("allLeft"),v=null===(f=e[l])||void 0===f||null===(b=f.ref)||void 0===b?void 0:b.current.classList.contains("anyLeft");if(j||v){o=l;break}}}if(o<0)return r.position;i=o}return i},ce=function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var a=e.findIndex((function(e){return e.codingUnit}));return a<0?0:a}return"up"===i?_(e,t.position,t.startposition):"down"===i?L(e,t.position,t.startposition):void 0},se=function(e,t){var n=fe(e,t),r=Object(c.a)(n,2),i=r[0],a=r[1];return null===i?{index:null,annotated:!1}:{index:be(e,i),annotated:a}},ue=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.add("tapped")},de=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.remove("tapped")},fe=function(e,t){try{var n,r,i;if("mousemove"!==t.type&&"mouseup"!==t.type||(i=t.originalTarget||t.path[0]),"touchmove"===t.type||"touchstart"===t.type){var a=t.touches[0];i=document.elementFromPoint(a.clientX,a.clientY)}if("item"===(null===(n=i)||void 0===n||null===(r=n.parentNode)||void 0===r?void 0:r.className))return[null,!1];if(i){if(i.className.includes("token"))return[i,!1];if(i.parentNode&&i.parentNode.className.includes("token"))return[i.parentNode,!0]}return[null,!1]}catch(t){return[null,!1]}},be=function(e,t){return parseInt(t.getAttribute("tokenindex"))},je=function(e,t){return t.length>0&&e[0]===t[0]&&e[1]===t[1]?e:t},ve=function(e,t,n,r){if(null===n)return e;var i=Object(E.a)(e);if(!r||0===i.length)return je(e,[n,n]);if(null===n)return je(e,[i[0],null]);if(t[i[0]].field===t[n].field)i=[i[0],n];else if(n>i[0])for(var a=n;a>=i[0];a--)t[i[0]].field===t[a].field&&(i=[i[0],a]);else for(var o=n;o<=i[0];o++)t[i[0]].field===t[o].field&&(i=[i[0],o]);return je(e,i)},he=n(265),pe=n(252),xe=function(e,t){if(t[e]){var n,r=t[e].foldToParent;return r&&t[r]&&(n=t[r].color),n=t[e].color,ge(n)+"50"}return"EMPTY"===e?"lightgrey":"#ffffff50"},Oe=function(e){if(0===e.length)return"white";if(1===e.length)return e[0];var t=Math.floor(100/e.length),n=e.reduce((function(n,r,i){return 0===i&&n.push(r+" ".concat(t,"%")),i===e.length-1&&n.push(r+" ".concat(100-t,"%")),i>0&&i<e.length-1&&(n.push(r+" ".concat(t*i,"%")),n.push(r+" ".concat(t*(i+1),"%"))),n}),[]);return"linear-gradient(to bottom, ".concat(n.join(", "),")")},ge=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},me=function(e,t,n,r){for(var i=0;i<e.length;i++){var a,o=e[i];if(null!==(a=o.ref)&&void 0!==a&&a.current){var l=ye(null===t||void 0===t?void 0:t[o.index],n);l&&0!==Object.keys(l).length?(ke(o,l,n),r&&(o.ref.current.style.cursor="pointer")):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),o.ref.current.style.cursor="default",we(o,null,null,null))}}},ye=function(e,t){if(!e)return null;if(e&&t){e=Object(s.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],a=e[i].variable;if(t[a]){var o=t[a].codeMap,l=e[i].value;o[l]&&o[l].active&&o[l].activeParent||"EMPTY"===!l&&delete e[i]}else delete e[i]}}return e},ke=function(e,t,n){for(var r=0,i=0,a={pre:[],text:[],post:[]},o=Object.keys(t).length,l=0,c=Object.keys(t);l<c.length;l++){var s=t[c[l]],u=n[s.variable].codeMap,d=xe(s.value,u);a.text.push(d),s.span[0]===s.index?r++:a.pre.push(d),s.span[1]===s.index?i++:a.post.push(d)}var f=r===o,b=i===o,j=r>0,v=i>0,h=e.ref.current.classList;h.add("annotated"),f?h.add("allLeft"):h.remove("allLeft"),j&!f?h.add("anyLeft"):h.remove("anyLeft"),b?h.add("allRight"):h.remove("allRight"),v&!b?h.add("anyRight"):h.remove("anyRight");var p=Oe(a.text),x=f?"white":Oe(a.pre),O=b?"white":Oe(a.post);we(e,x,p,O)},we=function(e,t,n,r){var i=e.ref.current.children;i[0].style.background=t,i[1].style.background=n,i[2].style.background=r},Se=function(e,t){var n,r=Object(h.a)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value;if(null!==(i=a.ref)&&void 0!==i&&i.current)if(a.ref.current.classList.remove("tapped"),0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(c.a)(t,2),l=o[0],s=o[1];if(l>s){var u=[l,s];s=u[0],l=u[1]}var d=a.arrayIndex>=l&&a.arrayIndex<=s,f=a.ref.current.classList;if(d&&a.codingUnit){var b=l===a.arrayIndex,j=s===a.arrayIndex;f.add("selected"),b?f.add("start"):f.remove("start"),j?f.add("end"):f.remove("end")}else f.remove("selected")}else a.ref.current.classList.remove("selected")}}catch(v){r.e(v)}finally{r.f()}},Ce=i.a.memo((function(e){var t,n=e.tokens,i=e.currentToken,a=e.setCurrentToken,o=e.annotations,l=e.variableMap,s=e.fullScreenNode,u=e.onlyFirst,d=Object(r.useState)(null),f=Object(c.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)(0),h=Object(c.a)(v,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){var e;if(null===n||void 0===n||null===(e=n[i.i])||void 0===e||!e.ref||null===o||void 0===o||!o[n[i.i].index]||!l)return j(null),x(0),null;var t=o[n[i.i].index],r=Object.keys(t).reduce((function(e,n,r){var o=t[n].variable,c=t[n].value;if(u&&i.i!==t[n].span[0])return e;if(!l[o])return e;var s=l[o].codeMap;return s[c]?(e.push(Object(O.jsxs)(he.a.Item,{style:{backgroundColor:xe(c,s),padding:"0.3em"},onMouseOver:function(){return a({i:null})},children:[Object(O.jsx)("b",{children:o}),": "+c]},r)),e):e}),[]);j(Object(O.jsx)(he.a,{children:r})),x(0)}),[n,i,a,o,u,l,x]),Object(r.useEffect)((function(){if(b){var e=setTimeout((function(){x(p+1)}),200);return function(){return clearTimeout(e)}}}),[p,b]),Object(O.jsx)(pe.a,{mountNode:s||void 0,context:null===n||void 0===n||null===(t=n[i.i])||void 0===t?void 0:t.ref,basic:!0,hoverable:!1,position:"top left",open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:b})})),Ee=function(e){var t=e.tokens,n=e.variableMap,i=e.annotations,a=e.disableAnnotations,o=e.editMode,l=e.triggerCodeSelector,s=e.eventsBlocked,u=e.fullScreenNode,d=Object(r.useState)({i:null}),f=Object(c.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)([]),h=Object(c.a)(v,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){if(!n)return null;me(t,i,n,o)}),[t,i,n,o]),Object(r.useEffect)((function(){Se(t,p)}),[t,p]),Object(r.useEffect)((function(){j({i:null}),x([])}),[t]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Ce,{tokens:t,currentToken:b,setCurrentToken:j,annotations:i,variableMap:n,fullScreenNode:u,onlyFirst:!1}),a?null:Object(O.jsx)(te,{tokens:t,annotations:i,currentToken:b,setCurrentToken:j,tokenSelection:p,setTokenSelection:x,triggerCodePopup:l,editMode:o,eventsBlocked:s})]})},Re=n(257),Ae=function(e){return Date.parse(e)?e.replace("T"," "):e},_e=function(e){var t=e.meta_fields.filter((function(e){return e.visible})),n=function(e){var t={borderTop:"none"};return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),t};return 0===t.length?null:Object(O.jsx)(Re.a,{basic:"very",compact:!0,style:{lineHeight:"0.8",padding:"10px",paddingLeft:"10px",border:"1px solid grey",boxShadow:"5px 3px 3px #e0f2ff",background:"#e1f2ff",color:"black"},children:t.map((function(e){return Object(O.jsxs)(Re.a.Row,{style:{fontSize:"".concat(null!=e.size?e.size:1,"em")},children:[Object(O.jsx)(Re.a.Cell,{width:1,style:{borderTop:"none"},children:Object(O.jsx)("b",{children:e.label||e.name})}),Object(O.jsx)(Re.a.Cell,{style:n(e),children:Ae(e.value)})]})}))})},Le=function(e){var t=e.tokens,n=e.text_fields,i=e.meta_fields,a=e.setReady,o=e.maxHeight,l=Object(r.useState)({}),s=Object(c.a)(l,2),u=s[0],d=s[1],f=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));t.some((function(e){return!e.codingUnit}))?null!==n&&void 0!==n&&null!==(e=n.ref)&&void 0!==e&&e.current&&f.current&&function(e,t,n){var r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),a=r.top,o=r.height,l=i.top,c=o/(1/n);e.scrollTop=e.scrollTop+l-(c+a)}(f.current,n.ref.current,1/3):f.current.scrollTop=0})),Object(r.useEffect)((function(){if(!t)return null;d(Te(t,n,f)),a&&a((function(e){return e+1}))}),[t,n,a]),null===t?null:Object(O.jsx)(R.a,{innerRef:f,children:Object(O.jsx)("div",{style:{flex:"1",display:"flex",alignItems:null,overflow:"auto",maxHeight:o},children:Object(O.jsxs)("div",{className:"TokensContainer",style:{flex:"1 97%",width:"100%"},children:[Object(O.jsx)("div",{style:{width:"100%",textAlign:"right",padding:"10px 30px"},children:Object(O.jsx)(_e,{meta_fields:i})},"meta"),Object(O.jsx)("div",{style:{padding:"20px"},children:u.text},"text"),Object(O.jsx)("div",{style:{height:"25px"}},"empty_space")]})},"tokens")})},Te=function(e,t,n){var r={text:[]};if(0===e.length)return r;for(var a=[],o=[],l=[],c=e[0].codingUnit,s=e[0].field,u=e[0].paragraph,d=e[0].sentence,f=function(e){return t.find((function(t){return t.name===e}))},b=f(s),j=0;j<e.length;j++)e[j].arrayIndex=j,e[j].sentence!==d&&(l.length>0&&o.push(Ie(j,d,l)),l=[]),e[j].paragraph!==u&&(o.length>0&&a.push(Me(f(s),u,o,e[j].paragraph!==u)),o=[]),e[j].field!==s&&(a.length>0&&r.text.push(Ne(f(s),j+"_"+s,a,s)),a=[]),u=e[j].paragraph,d=e[j].sentence,s=e[j].field,c=e[j].codingUnit,e[j].containerRef=n,c&&(e[j].ref=i.a.createRef()),l.push(He(e[j],c));return b=f(s),l.length>0&&o.push(Ie("last",d,l)),o.length>0&&a.push(Me(b,u,o,!1)),a.length>0&&r.text.push(Ne(b,"last_"+s,a,s)),r},Ne=function(e,t,n,r){return Object(O.jsx)("span",{className:"field",children:function(n){return e?Object(O.jsxs)(O.Fragment,{children:[e.label?Object(O.jsx)("span",{style:{color:"grey",fontWeight:"bold",textAlign:"center"},children:e.label},r+t+"label"):null,Object(O.jsx)("span",{className:"noselect",style:{fontSize:"".concat(null!=e.size?e.size:1,"em"),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:null==e.justify||e.justify?"justify":"left"},children:n},r+t)]}):n}(n)},"field"+r)},Me=function(e,t,n,r){return null==(null===e||void 0===e?void 0:e.paragraphs)||null!==e&&void 0!==e&&e.paragraphs?Object(O.jsx)("div",{style:{display:"flex"},children:Object(O.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)},"pardiv"+t):Object(O.jsx)("span",{children:Object(O.jsx)("span",{children:n})},"par"+t)},Ie=function(e,t,n){return Object(O.jsx)("span",{className:"sentence",children:n},e+"_"+t)},He=function(e,t){return Object(O.jsxs)("span",{ref:e.ref,className:t?"token codingUnit":"token",tokenindex:e.arrayIndex,children:[Object(O.jsx)("span",{className:"pre",children:e.pre},"pre"+e.index),Object(O.jsx)("span",{className:"text",children:e.text},"text"+e.index),Object(O.jsx)("span",{className:"post",children:e.post},"post"+e.index)]},"token"+e.index)},Pe=i.a.memo(Le),ze=n(102),Ue=function(e){return e.variable+"|"+e.value},De=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(s.a)({},n);var r,i=Fe(e),a={},o=[],l=Object(h.a)(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;qe(c,i,a,o)}}catch(S){l.e(S)}finally{l.f()}for(var u={},d=[],f=0,b=o;f<b.length;f++){var j=b[f];u[j.id]||(u[j.id]=0),u[j.id]++,d.push(j)}for(var v=[],p=0,x=d;p<x.length;p++)for(var O=x[p],g=O.span[0];g<=O.span[1];g++){var m=Object(s.a)({},O);m.index=g,v.push(m)}for(var y=0,k=d;y<k.length;y++){var w=k[y];n=Be(n,w,!1,!1)}return n},Be=function(e,t,n,r){for(var i=Ue(t),a=t.span[0];a<=t.span[1];a++)e[a]&&e[a][i]&&function(){for(var t=e[a][i],n=t.span,o=n[0];o<=n[1];o++)e[o]&&e[o][i]&&(r&&1===Object.values(e[o]).filter((function(e){return e.variable===t.variable})).length&&(e[o][Ue(Object(s.a)(Object(s.a)({},t),{},{value:"EMPTY"}))]=Object(s.a)(Object(s.a)({},e[o][i]),{},{value:"EMPTY"})),delete e[o][i],0===Object.keys(e[o]).length&&delete e[o])}(),n||(e[a]||(e[a]={}),delete e[a][Ue(Object(s.a)(Object(s.a)({},t),{},{value:"EMPTY"}))],e[a][i]={index:a,variable:t.variable,span:[t.span[0],t.span[1]],length:t.length,value:t.value,field:t.field,offset:t.offset});return e},Fe=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.field]||(e[t.field]={}),e[t.field][t.offset]||(e[t.field][t.offset]={start:[],end:[]}),e[t.field][t.offset+t.length-1]||(e[t.field][t.offset+t.length-1]={start:[],end:[]}),e[t.field][t.offset].start.push(t),e[t.field][t.offset+t.length-1].end.push(Ue(t)),e}),{}):{}},qe=function(e,t,n,r){var i=e.offset,a=e.offset+e.length-1;if(t[e.field])for(var o=t[e.field],l=i;l<=a;l++)if(o[l]){var c,u=Object(h.a)(o[l].start);try{for(u.s();!(c=u.n()).done;){var d=c.value,f=Ue(d);n[f]=Object(s.a)(Object(s.a)({},e),{},{id:f,variable:d.variable,value:d.value,offset:d.offset,length:null,span:[e.index]})}}catch(p){u.e(p)}finally{u.f()}var b,j=Object(h.a)(o[l].end);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v]&&(n[v].span.push(e.index),n[v].length=e.offset+e.length-n[v].offset,r.push(n[v]),delete n[v])}}catch(p){j.e(p)}finally{j.f()}}},We=n(148),Ve=n.n(We),Ye=function(e){for(var t=function(e){return e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.required_for&&(e.required_for=[]),"object"!==typeof e.required_for&&(e.required_for=[e.required_for]),null==e.color&&(e.color=Ve()({seed:e.code,luminosity:"light"})),e}))}(e),n=t.reduce((function(e,t){return e[t.code]=Object(s.a)(Object(s.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];""===n[a].parent||n[n[a].parent]||(n[n[a].parent]={code:n[a].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var o=0,l=Object.keys(n);o<l.length;o++){var u=l[o],d=Je(n,u),f=Object(c.a)(d,3);n[u].tree=f[0],n[u].activeParent=f[1],n[u].foldToParent=f[2],n[u].parent&&n[n[u].parent].children.push(u);var b,j=Object(h.a)(n[u].tree);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v].totalChildren++,n[u].active&&n[u].activeParent&&n[v].totalActiveChildren++}}catch(p){j.e(p)}finally{j.f()}}return n},Ge=function e(t,n,r,i,a){var o,l=Object(h.a)(n);try{for(l.s();!(o=l.n()).done;){var c=o.value,u=Object(E.a)(i);u.push(c),r.push(Object(s.a)(Object(s.a)({},t[c]),{},{code:c,codeTrail:i,level:i.length,color:t[c].color?t[c].color:Ve()({seed:c,luminosity:"light"})})),t[c].children&&e(t,t[c].children,r,u,a)}}catch(d){l.e(d)}finally{l.f()}},Je=function(e,t){for(var n=[],r=!0,i="",a=e[t].parent;a;)n.push(a),null!=e[a].folded&&e[a].folded&&(i=a,null==e[a].active||e[a].active||(r=!1)),a=e[a].parent;return[n.reverse(),r,i]},Qe=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Ke=function(e){var t=e.id,n=e.active,a=e.options,o=e.onSelect,l=Object(r.useState)(0),s=Object(c.a)(l,2),u=s[0],d=s[1],f=Object(r.useState)([]),b=Object(c.a)(f,2),v=b[0],p=b[1],g=Object(r.useRef)({});Object(r.useEffect)((function(){var e,t=[].concat(Object(E.a)(a),[{cancel:!0,label:"CLOSE",color:"grey",value:"CANCEL",textColor:"white"}]),n=Object(h.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.ref=i.a.createRef()}}catch(r){n.e(r)}finally{n.f()}p(t)}),[a,p]);var m=i.a.useCallback((function(e){var t=v.length;if(Qe.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(L(v,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(_(v,u)));if(32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=v[u].value;o(n,e.ctrlKey)}}),[u,v,o]);Object(r.useEffect)((function(){return n?window.addEventListener("keydown",m):window.removeEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[n,m]);var y=function(e,t){var n=e.value.delete?"#682c2c":"black",r=e.value.delete?e.value:"white",i=e.color.slice(0,7),a=e.value.delete?"darkred":"black",l=e.color;return Object(O.jsx)(R.a,{innerRef:e.ref,children:Object(O.jsxs)(x.a,{style:{flex:"1 1 auto",padding:"4px 2px",background:l,color:n,border:"3px solid",borderColor:t===u?a:"white",margin:"1px"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){return o(t.value,e.ctrlKey)},children:[e.tag?Object(O.jsx)("span",{style:{display:"inline-block",float:"left",background:r,color:"black",borderRadius:"0px",border:"2px solid ".concat(i),padding:"2px",margin:"-4px 4px -4px -2px"},children:"".concat(e.tag," ")}):null,Object(O.jsx)("span",{children:e.label})]},e.label+"_"+t)})};return Object(O.jsx)("div",{children:function(){var e,n,r=0,i=[],a=[],o=Object(h.a)(v);try{for(o.s();!(n=o.n()).done;){var l=n.value;g.current[l.value]||("CANCEL"===l.value?e=y(l,r):l.value.delete?a.push(y(l,r)):i.push(y(l,r)),r++)}}catch(c){o.e(c)}finally{o.f()}return Object(O.jsxs)("div",{children:[Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"10px"},children:i},t+"_1"),a.length>0?Object(O.jsxs)("b",{children:[Object(O.jsx)(j.a,{name:"trash alternate"})," Delete codes"]}):null,Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:a},t+"_2"),Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:e},t+"_3")]},t+"_buttons")}()},t)},Xe=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Ze=i.a.memo((function(e){e.variable;var t=e.children,n=e.fullScreenNode,r=e.open,i=e.setOpen,a=e.tokenRef,o="5px",l="top left",c="100vh";if(null!==a&&void 0!==a&&a.current){var s=a.current.getBoundingClientRect(),u=s.top/window.innerHeight,d=(window.innerHeight-s.bottom)/window.innerHeight;u>d?(l="top",c="calc(".concat(100*u,"vh - ").concat(o,")")):(l="bottom",c="calc(".concat(100*d,"vh - ").concat(o,")"));var f=s.left/window.innerWidth;l=(window.innerWidth-s.right)/window.innerWidth>f?l+" left":l+" right"}var b=!1;return Object(O.jsx)(pe.a,{mountNode:n||void 0,context:a,basic:!0,wide:!0,position:l,hoverable:!0,open:r,mouseLeaveDelay:1e7,onClose:function(e,t){b&&i(!1),b=!0},style:{margin:o,padding:"0px",background:"#dfeffb",border:"1px solid #136bae",minWidth:"15em",maxHeight:c,overflow:"auto"},children:Object(O.jsx)("div",{style:{margin:"5px",border:"0px"},children:t})})})),$e=function(e){var t=e.variable,n=e.setVariable,i=e.annotations,a=e.span,o=e.setOpen,l=e.variableMap,c=function(){for(var e=Object.keys(l),t={},n=0,r=e;n<r.length;n++){for(var o=r[n],c={},s=a[0];s<=a[1];s++)if(i[s])for(var u=0,d=Object.keys(i[s]);u<d.length;u++){var f,b=d[u],j=i[s][b];j.variable===o&&(c[j.value]=xe(j.value,null===l||void 0===l||null===(f=l[o])||void 0===f?void 0:f.codeMap))}t[o]=Oe(Object.values(c))}return e.map((function(e){return{color:t[e],label:e,value:e}}))}();return Object(r.useEffect)((function(){1===c.length&&n(c[0].value)}),[c,n]),t||!a?null:Object(O.jsxs)("div",{children:[Object(O.jsx)(pe.a.Header,{style:{textAlign:"center"},children:"Select variable"}),Object(O.jsx)(Ke,{id:"currentCodePageButtons",active:!0,options:c,setOpen:o,onSelect:function(e,t){"CANCEL"!==e?n(e):o(!1)}})]})},et=function(e){var t=e.tokens,n=e.variable,r=e.setVariable,i=e.annotations,a=e.span,o=e.setSpan,l=e.setOpen,c=e.variableMap,u=function(e,t){"CANCEL"!==e?(o(e.span),r(e.variable)):l(!1)};if(n||!a)return null;var d=function(){for(var e={},n=a[0];n<=a[1];n++)if(i[n])for(var r=0,o=Object.keys(i[n]);r<o.length;r++){var l,u=o[r],d=i[n][u],f=null===c||void 0===c||null===(l=c[d.variable])||void 0===l?void 0:l.codeMap;if(c[d.variable]&&(null!==f&&void 0!==f&&f[d.value]||"EMPTY"===d.value)){var b=d.span,j=d.variable+":"+b[0]+"-"+b[1],v='"'+nt(t,b)+'"',h=xe(d.value,f);e[j]?e[j].colors.push(h):e[j]={tag:d.variable,label:v,colors:[h],value:{variable:d.variable,span:d.span}}}}return Object.keys(e).map((function(t){return Object(s.a)(Object(s.a)({},e[t]),{},{color:Oe(e[t].colors)})}))}();return 0===d.length&&l(!1),1===d.length&&u(d[0].value),Object(O.jsxs)("div",{children:[Object(O.jsx)(pe.a.Header,{style:{textAlign:"center"},children:"Select annotation"}),Object(O.jsx)(Ke,{id:"currentCodePageButtons",active:!0,options:d,setOpen:l,onSelect:u})]})},tt=function(e){var t=e.tokens,n=e.variable,a=e.variableMap,o=e.codeHistory,l=e.settings,u=e.annotations,d=e.tokenAnnotations,f=e.setAnnotations,b=e.editMode,j=e.span,v=e.setOpen,p=e.setCodeHistory,x=Object(r.useRef)(null),g=Object(r.useState)(!0),m=Object(c.a)(g,2),y=m[0],k=m[1],w=i.a.useCallback((function(e){var t;return l&&!l.searchBox&&"recent"===!l.buttonMode?null:((null===x||void 0===x||null===(t=x.current)||void 0===t?void 0:t.children[0])===document.activeElement||k(!0),27===e.keyCode&&v(!1),Xe.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(x.current&&x.current.click(),void k(!1)))}),[x,v,l]);Object(r.useEffect)((function(){return window.addEventListener("keydown",w),function(){window.removeEventListener("keydown",w)}}));var S=function(e,r){var i;"CANCEL"!==e?(rt(t,e,f,o,p,b),null!==a&&void 0!==a&&null!==(i=a[n])&&void 0!==i&&i.multiple||r||v(!1)):v(!1)};if(!n)return null;var C,E=function(){var e,r=function(e){for(var t={},n=j[0];n<=j[1];n++)if(null!==u&&void 0!==u&&u[n])for(var r=0,i=Object.keys(u[n]);r<i.length;r++){var a=i[r],o=u[n][a];o.variable===e&&(t[o.span[0]+"_"+a]=Object(s.a)({id:a},u[n][a]))}return Object.keys(t).length>0?Object.values(t):[]}(n),i=[],c=[],f=null===a||void 0===a||null===(e=a[n])||void 0===e?void 0:e.codeMap;!function(e,t){var r=Object.keys(e);if(1!==r.length)return null;var i=r[0],a=t.filter((function(e){return"EMPTY"!==e.value}));0===a.length&&(setTimeout((function(){return S({variable:n,span:j,value:i,delete:!1})}),0),v(!1)),b&&1===a.length&&i===a[0].value&&(setTimeout((function(){return S({variable:n,span:j,value:i,delete:!0})}),0),v(!1))}(f,r);for(var p=0,x=Object.keys(f);p<x.length;p++){var g=x[p];if(!(null===j||j[0]===j[1])||!d[g]){l&&"all"===l.buttonMode&&i.push({key:g,label:g,value:{variable:n,value:g,span:j,delete:!1},color:xe(g,f)});var m=f[g].tree.join(" - ");c.push({key:g,value:{variable:n,value:g,span:j,delete:!1},text:g+" test"+m,content:Object(O.jsxs)(O.Fragment,{children:[g,Object(O.jsx)("br",{}),Object(O.jsx)("span",{style:{color:"grey"},children:m})]})})}}if(!l||"recent"===l.buttonMode){var y,k=9,w=Object(h.a)(o);try{for(w.s();!(y=w.n()).done;){var C=y.value;if(k<0)break;f[C]&&(i.push({key:C,label:C,value:{variable:n,value:C,span:j,delete:!1},color:xe(C,f)}),k--)}}catch(_){w.e(_)}finally{w.f()}}if(r&&r.length>0){var E,R=Object(h.a)(r);try{for(R.s();!(E=R.n()).done;){var A=E.value;f[A.value]&&i.push({tag:A.value,label:'"'+nt(t,A.span)+'"',color:xe(A.value,f),value:Object(s.a)(Object(s.a)({},A),{},{delete:!0}),textColor:"darkred"})}}catch(_){R.e(_)}finally{R.f()}}return[i,c]}(),_=Object(c.a)(E,2),L=_[0],T=_[1];return Object(O.jsxs)(O.Fragment,{children:[(C=T,0===C.length?null:l&&!l.searchBox&&"recent"!==l.buttonMode?Object(O.jsx)("div",{style:{height:"25px"}}):Object(O.jsx)(R.a,{innerRef:x,children:Object(O.jsx)(A.a,{fluid:!0,placeholder:"<type to search>",style:{textAlign:"center",color:"black",width:"100%",height:"20px",marginBottom:"5px",overflow:"visible",position:"relative"},options:C,open:!y,search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return k(!1)},onSearchChange:function(e,t){""===t.searchQuery&&k(!0)},onClose:function(){return k(!0)},onChange:function(e,t){S(t.value,e.ctrlKey)}})})),function(e){return Object(O.jsxs)(O.Fragment,{children:["recent"===l.buttonMode&&o.length>0?Object(O.jsx)("b",{children:"Recent codes"}):null,Object(O.jsx)(Ke,{id:"newCodePageButtons",active:y,setAnnotations:f,options:e,setOpen:v,onSelect:S})]})}(L)]})},nt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=e.slice(t[0],t[1]+1).map((function(e){return e.pre+e.text+e.post}));return r.length>n&&(r=[r.slice(0,Math.floor(n/2)).join("")," ... ",r.slice(-Math.floor(n/2)).join("")]),r.join("")},rt=function(e,t,n,r,i,a){var o=Object(c.a)(t.span,2),l=o[0],u=o[1];t.index=e[l].index,t.length=e[u].length+e[u].offset-e[l].offset,t.span=[e[l].index,e[u].index],t.field=e[l].field,t.offset=e[l].offset,n((function(e){return Be(Object(s.a)({},e),t,t.delete,a)})),i((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(ze.a)({},t.variable,[t.value].concat(Object(E.a)(r.filter((function(e){return e!==t.value}))))))}))},it=function(e,t,n,a,o,l,u,d){var f=Object(r.useState)(!1),b=Object(c.a)(f,2),j=b[0],v=b[1],p=Object(r.useState)(null),x=Object(c.a)(p,2),g=x[0],m=x[1],y=Object(r.useState)(null),k=Object(c.a)(y,2),w=k[0],S=k[1],C=Object(r.useState)(null),E=Object(c.a)(C,2),R=E[0],A=E[1],_=Object(r.useState)({}),L=Object(c.a)(_,2),T=L[0],N=L[1],M=Object(r.useState)(!1),I=Object(c.a)(M,2),H=I[0],P=I[1],z=Object(r.useState)(l),U=Object(c.a)(z,2),D=U[0],B=U[1],F=Object(r.useState)(null),q=Object(c.a)(F,2),W=q[0],V=q[1],Y=Object(r.useState)(null),G=Object(c.a)(Y,2),J=G[0],Q=G[1];Object(r.useEffect)((function(){if(!t||0===t.length)return V(null),null;var e,n={},r=Object(h.a)(t);try{var i=function(){var t=e.value,r=Ye(t.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[t.name]=Object(s.a)(Object(s.a)({},t),{},{codeMap:r})};for(r.s();!(e=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}V(n)}),[t,V]),Object(r.useEffect)((function(){var e,t,r;null!==W?(S(null),r=null===n||"EDIT ALL"===n?W:Object(ze.a)({},n,W[n]),Q(r),P((null===(e=r)||void 0===e||null===(t=e[n])||void 0===t?void 0:t.editMode)||"EDIT ALL"===n)):Q(null)}),[W,n,S,Q,P]),Object(r.useEffect)((function(){j||u(D)}),[D,j,u]);var K,X=i.a.useCallback((function(t,n){e[t].ref&&(A(e[t].ref),N(a[t]||{}),m(n||[t,t]),v(!0))}),[a,e]);if(Object(r.useEffect)((function(){v(!1)}),[e]),Object(r.useEffect)((function(){j||S(null)}),[j]),!t)return[null,null,null,!0];K=H?Object(O.jsx)(et,{tokens:e,variable:w,setVariable:S,variableMap:J,annotations:a,span:g,setSpan:m,setOpen:v}):Object(O.jsx)($e,{variable:w,setVariable:S,variableMap:J,annotations:a,span:g,setOpen:v});var Z=Object(O.jsx)(tt,{tokens:e,variable:w,variableMap:J,settings:null===J||void 0===J?void 0:J[w],codeHistory:l[w]||[],annotations:a,tokenAnnotations:T,setAnnotations:o,span:g,editMode:H,setOpen:v,setCodeHistory:B}),$=Object(O.jsxs)(Ze,{variable:w,fullScreenNode:d,open:j,setOpen:v,tokenRef:R,children:[K,Z]});return J&&e||($=null),[$,X,J,j,H]},at=n(152),ot=n(177);at.a.extend(ot.a);var lt=function(e){var t,n=[],r=null,i=0,a=0,o=0,l=null,c=null,s=!1,u=Object(h.a)(e);try{for(u.s();!(t=u.n()).done;){var d=t.value;null==d.unit_start&&null==d.context_before||(s=!0)}}catch(S){u.e(S)}finally{u.f()}var f,b=!s,j=!1,v=Object(h.a)(e);try{for(v.s();!(f=v.n()).done;){var p=f.value,x=p.name||"text",O=p.offset||0;c=p.value,null!=p.context_before&&(c=p.context_before+c,p.unit_start=p.context_before.length),null!=p.context_after&&(p.unit_end=c.length,c+=p.context_after),l=at.a.tokenize(c).paragraphs().json({offset:!0});for(var g=0;g<l.length;g++){for(var m=0;m<l[g].sentences.length;m++){for(var y=0;y<l[g].sentences[m].length;y++)for(var k=0;k<l[g].sentences[m][y].terms.length;k++){r=l[g].sentences[m][y].terms[k],null!=p.unit_start&&r.offset.start+O>=p.unit_start&&(b=!0),null!=p.unit_end&&r.offset.start+O>p.unit_end&&(j=!0);var w={field:x,offset:r.offset.start+O,length:r.offset.length,paragraph:i,sentence:a,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:b&!j};n.push(w),o++}a++}i++}}}catch(S){v.e(S)}finally{v.f()}return n},ct=function(e){for(var t=0,n=(e=ut(e))[0].paragraph,r=0,i=e[0].sentence,a=0,o=0,l=0;l<e.length;l++){var c;if(null==e[l].text){if(null==e[l].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[l].text=e[l].token}if(null==e[l].offset&&null!=e[l].start&&(e[l].offset=e[l].start),null==e[l].length&&(e[l].length=e[l].text.length),null==e[l].pre&&(e[l].pre=""),null==e[l].post&&null!=e[l].space&&(e[l].post=e[l].space),null==e[l].post&&(null!=e[l].offset&&null!=e[l].length?e[l].post=l<e[l].length-1?" ".repeat(Math.max(0,e[l+1].offset-e[l].offset-e[l].length)):"":e[l].post=" "),o=e[l].length+e[l].post.length,l<e.length-1&&(o+=(null===(c=e[l+1].pre)||void 0===c?void 0:c.length)||0),null==e[l].offset&&(e[l].offset=a,a+=o),l<e.length-1&&(!e[l].field||e[l].field===e[l+1].field)&&(null==e[l+1].offset&&null!=e[l+1].start&&(e[l+1].offset=e[l+1].start),e[l+1].offset&&e[l+1].offset<e[l].offset+o))return alert('Invalid token position data. The length of "'.concat(e[l].pre+e[l].text+e[l].post,'" on position ').concat(e[l].offset," exeeds the offset/start position of the next token")),null;null==e[l].sentence?(e[l].sentence=r,(e[l].text.includes("\n")||e[l].post.includes("\n"))&&r++):(e[l].paragraph===n&&e[l].sentence===i||(i=e[l].sentence,r++),e[l].sentence=r),null==e[l].paragraph?(e[l].paragraph=t,(e[l].text.includes("\n")||e[l].post.includes("\n"))&&t++):(e[l].paragraph!==n&&(n=e[l].paragraph,t++),e[l].paragraph=t),null==e[l].field&&(e[l].field="text"),e[l].index=l}return e},st=function(e,t){if(0===e.length)return[];for(var n=[],r={},i=e[0].field,a=0;a<e.length;a++)if(e[a].annotations){var o,l={},c=Object(h.a)(e[a].annotations);try{for(c.s();!(o=c.n()).done;){var s=o.value;if(""!==s.value){t[s.name]||(t[s.name]=new Set),t[s.name].add(s.value),l[s.name]=s.value;var u=a>0?e[a-1].post:"";null==r[s.name]&&(r[s.name]={index:a,variable:s.name,value:s.value,offset:e[a].offset,text:e[a].text,field:e[a].field,length:e[a].length}),r[s.name].value===s.value&&(r[s.name].length=e[a].offset+e[a].length-r[s.name].offset,r[s.name].text+=u+e[a].pre+e[a].post)}}}catch(w){c.e(w)}finally{c.f()}for(var d=0,f=Object.keys(r);d<f.length;d++){var b=f[d];null!=l[b]?l[b]!==r[b].value&&(n.push(r[b]),r[b]={index:a,variable:b,value:l[b],offset:e[a].offset,text:e[a].text,field:e[a].field,length:e[a].length}):(n.push(r[b]),delete r[b])}if(a<e.length-1&&e[a+1].field!==i){for(var j=0,v=Object.values(r);j<v.length;j++){var p=v[j];n.push(p)}r={},i=e[a].field}else;}else{for(var x=0,O=Object.values(r);x<O.length;x++){var g=O[x];n.push(g)}r={}}for(var m=0,y=Object.values(r);m<y.length;m++){var k=y[m];n.push(k)}return n},ut=function(e){if(Array.isArray(e))return e;for(var t=Object.keys(e),n=e[t[0]].length,r=[],i=function(n){var i=t.reduce((function(t,r){return t[r]=e[r][n],t}),{});r.push(i)},a=0;a<n;a++)i(a);return r},dt=function(e,t){var n,r={},i=Object(h.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.variable]||(r[a.variable]=new Set),r[a.variable].add(a.value)}}catch(s){i.e(s)}finally{i.f()}for(var o=0,l=Object.keys(r);o<l.length;o++){var c=l[o];r[c]=Object(E.a)(r[c])}t(r)},ft=function(e,t,n,i){var a=Object(r.useState)({}),o=Object(c.a)(a,2),l=o[0],u=o[1],d=Object(r.useState)(),f=Object(c.a)(d,2),b=f[0],j=f[1];return Object(r.useEffect)((function(){if((null===e||void 0===e||!e.text)&&!e.text_fields&&!e.tokens)return null;e.annotations||(e.annotations=[]),e.importedAnnotations&&!e.status&&(e.annotations=e.annotations.concat(e.importedAnnotations)),dt(e.annotations,i);var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(s.a)({},e);n.tokens?(n.importedTokens=!0,n.tokens=ct(e.tokens)):(n.importedTokens=!1,!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=lt(Object(E.a)(n.text_fields))),n.meta_fields=e.meta_fields||[],n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=De(Object(E.a)(n.annotations),n.tokens):n.annotations={};var r=st(n.tokens,t);return r.length>0&&(n.annotations=De(r,n.tokens,n.annotations)),n}(e);t.current={tokens:r.tokens},u({tokens:r.tokens,text_fields:r.text_fields,meta_fields:r.meta_fields}),j(r.annotations),n&&n(r.tokens)}),[e,n,t,i]),[l,b,j]},bt=function(e){var t=e.variable,n=e.setVariable,i=e.variables,a=e.variableNames,o=e.minHeight;return Object(r.useEffect)((function(){return i?1===i.length?(n(i[0].name),null):void(a.includes(t)||n(a[0])):null}),[i,n,a,t]),Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(x.a.Group,{attached:"bottom",fluid:!0,style:{minHeight:"".concat(o/2,"px")},children:a.map((function(e){return Object(O.jsx)(x.a,{primary:!0,active:e===t,style:{padding:"0",border:"1px solid",color:e===t?"black":"white"},onClick:function(){return n(e)},children:e},e)}))})})},jt=function(e){var t=e.variables,n=e.variable,i=e.setVariable,a=e.minHeight,o=e.editAll,l=Object(r.useMemo)((function(){var e=[];return null!=t&&(null===t||void 0===t?void 0:t.length)>0&&(e=t.map((function(e){return e.name})),o&&e.push("EDIT ALL")),e}),[t,o]),c=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=l.findIndex((function(e){return e===n}))+t;r>l.length-1&&(r=0),r<0&&(r=l.length-1),i(l[r])};Object(r.useEffect)((function(){return window.addEventListener("keydown",c),function(){window.removeEventListener("keydown",c)}})),Object(r.useEffect)((function(){if(null===n&&i(l[0]),!t||0===t.length)return i(null),null}),[n,t,i,l]);var s=null;if(t){var u=t.find((function(e){return e.name===n}));s=null===u||void 0===u?void 0:u.instruction}return"EDIT ALL"===n&&(s="Show and edit all variables"),Object(O.jsxs)("div",{style:{background:"#1277c469",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",borderTop:"2px solid #2185d0",textAlign:"center"},children:[Object(O.jsx)(bt,{variable:n,setVariable:i,variables:t,variableNames:l,minHeight:a}),Object(O.jsx)("p",{style:{margin:"0",padding:"2px",minHeight:"24px"},children:s})]})},vt=(n(204),function(e){var t=e.unit,n=e.variables,i=e.settings,a=e.onChangeAnnotations,o=e.returnTokens,l=e.returnVariableMap,u=e.setReady,d=e.blockEvents,f=e.fullScreenNode,b=Object(r.useRef)(null),j=Object(r.useState)(null),v=Object(c.a)(j,2),h=v[0],p=v[1],x=Object(r.useState)({}),g=Object(c.a)(x,2),m=g[0],y=g[1],k=Object(r.useState)(0),w=Object(c.a)(k,2),S=w[0],C=w[1],E=ft(t,b,o,y),R=Object(c.a)(E,3),A=R[0],_=R[1],L=R[2],T=it(A.tokens,n,h,_,L,m,y,f),N=Object(c.a)(T,5),M=N[0],I=N[1],H=N[2],P=N[3],z=N[4];return Object(r.useEffect)((function(){_&&a&&b.current.tokens===A.tokens&&a(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===Object.keys(e).length?[]:Object.keys(e).reduce((function(r,i){for(var a=e[i],o=0,l=Object.keys(a);o<l.length;o++){var c=l[o];if("unit"===i||a[c].index===a[c].span[0]){var s={variable:a[c].variable,value:a[c].value,field:a[c].field,offset:a[c].offset,length:a[c].length};n&&function(){var e=a[c].span,n=t.slice(e[0],e[1]+1).map((function(t,n){var r=t.text;return n>0&&(r=t.pre+r),n<e[1]-e[0]&&(r+=t.post),r})).join("");s.text=n,s.token_span=e}(),r.push(s)}}return r}),[])}(_,A.tokens,!0))}),[A.tokens,_,a]),Object(r.useEffect)((function(){l&&l(H)}),[H,l]),Object(r.useEffect)((function(){u&&u((function(e){return e+1})),L((function(e){return Object(s.a)({},e)}))}),[S,L,u]),A.tokens?Object(O.jsxs)("div",{style:{display:"flex",height:"100%",maxHeight:"100%",flexDirection:"column"},children:[Object(O.jsx)(Pe,{tokens:A.tokens,text_fields:A.text_fields,meta_fields:A.meta_fields,setReady:C,maxHeight:n&&n.length>1?"calc(100% - 60px)":"calc(100% - 30px)",editMode:z}),Object(O.jsx)(jt,{variables:n,variable:h,setVariable:p,editAll:null===i||void 0===i?void 0:i.editAll,minHeight:n&&n.length>1?60:30}),Object(O.jsx)(Ee,{tokens:A.tokens,variableMap:H,annotations:_,disableAnnotations:!a||!H,editMode:z||"EDIT ALL"===h,triggerCodeSelector:I,eventsBlocked:P||d,fullScreenNode:f}),M||null]}):null}),ht=i.a.memo(vt),pt=n(149),xt=n(255),Ot=n(248),gt=n(263),mt={centerVertical:!0},yt=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,l=Object(r.useState)([]),u=Object(c.a)(l,2),d=u[0],f=u[1],b=Object(r.useState)(0),j=Object(c.a)(b,2),v=j[0],h=j[1],p=Object(r.useState)(null),x=Object(c.a)(p,2),g=x[0],m=x[1],y={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},k=Object(r.useState)(0),w=Object(c.a)(k,2),S=w[0],C=w[1],E=Object(gt.a)(["questionTaskSettings"]),R=Object(c.a)(E,2),A=R[0],_=R[1],L=Object(r.useState)(A.questionTaskSettings||{splitHeight:60,textSize:1}),T=Object(c.a)(L,2),N=T[0],M=T[1],I=Object(r.useRef)(null);Object(r.useEffect)((function(){_("questionTaskSettings",JSON.stringify(N),{path:"/"})}),[N,_]),Object(r.useEffect)((function(){null!==n&&void 0!==n&&n.questions&&m(wt(n))}),[n]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.backgroundColor="white",y.text.current.style.transition="",y.box.current.style.transition="",y.box.current.style.opacity=0,y.text.current.style.transform="translateX(0%) translateY(0%)"}),[y.text,y.box,t,v]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.transition="opacity 200ms ease-out",y.box.current.style.opacity=1}),[S,y.text,y.box,v]);var H=Object(r.useState)(null),P=Object(c.a)(H,2),z=P[0],U=P[1],D=Object(pt.useSwipeable)(Et(null===g||void 0===g?void 0:g[v],y,U,!1)),B=Object(pt.useSwipeable)(Et(null===g||void 0===g?void 0:g[v],y,U,!0));return t?Object(O.jsxs)("div",{ref:I,style:{height:"100%"},children:[Object(O.jsxs)("div",Object(s.a)(Object(s.a)({},D),{},{style:{position:"relative",border:"1px solid",height:"".concat(N.splitHeight,"%")},children:[Object(O.jsxs)("div",{ref:y.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(O.jsx)("div",{ref:y.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(O.jsx)("div",{ref:y.text,style:{border:"1px solid",height:"100%",width:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(N.textSize,"em")},children:Object(O.jsx)(ht,{unit:t,settings:mt,setReady:C,returnTokens:f,fullScreenNode:o})})]}),Object(O.jsx)(kt,{settings:N,setSettings:M,fullScreenNode:o})]})),Object(O.jsx)("div",Object(s.a)(Object(s.a)({},B),{},{style:{height:"".concat(100-N.splitHeight,"%")},children:Object(O.jsx)(Z,{unit:t,tokens:d,questions:g,questionIndex:v,setQuestionIndex:h,setUnitIndex:i,swipe:z,blockEvents:a})}))]}):null},kt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(O.jsx)(pe.a,{on:"click",mountNode:r||void 0,trigger:Object(O.jsx)(j.a,{size:"large",name:"setting",style:{position:"absolute",cursor:"pointer",top:"1px",left:"-1px",color:"#1b1c1d",padding:"5px 0px",height:"30px"}}),children:Object(O.jsx)(xt.a,{children:Object(O.jsxs)(xt.a.Group,{grouped:!0,children:[Object(O.jsxs)(xt.a.Field,{children:[Object(O.jsxs)("label",{children:["text window size ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(O.jsx)(Ot.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(O.jsxs)(xt.a.Field,{children:[Object(O.jsxs)("label",{children:["text size scaling ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(O.jsx)(Ot.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{textSize:t.value})}))}})]})]})})})},wt=function(e){return e.questions.map((function(e){var t=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return Ge(e,n,r,[],t),r.map((function(e,t){return Object(s.a)(Object(s.a)({},e),{},{i:t})}))}(Ye(e.codes));t=St(Object(E.a)(t));var n=Ct(t),r=Object(c.a)(n,2),i=r[0],a=r[1];return Object(s.a)(Object(s.a)({},e),{},{options:i,swipeOptions:a})}))},St=function(e){var t,n=e.reduce((function(e,t){if(!t.required_for)return e;if("object"!==typeof t.required_for)e.add(t.required_for);else{var n,r=Object(h.a)(t.required_for);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.add(i)}}catch(a){r.e(a)}finally{r.f()}}return e}),new Set),r=Object(h.a)(e);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=Object(h.a)(n);try{for(o.s();!(i=o.n()).done;){var l=i.value;a.required_for&&(a.required_for===l||a.required_for.includes(l))||a.makes_irrelevant.includes(l)||(a.makes_irrelevant=[].concat(Object(E.a)(a.makes_irrelevant),[l]))}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}return e},Ct=function(e){var t,n=[],r={},i=Object(h.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.active&&a.activeParent){var o=a.tree.join(" - "),l={code:a.code,tree:o,makes_irrelevant:a.makes_irrelevant,color:a.color};a.swipe&&(r[a.swipe]=l),n.push(l)}}}catch(c){i.e(c)}finally{i.f()}return[n,r]},Et=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var a=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},l=function(e){var n=e.deltaX,i=e.deltaY;if(Math.abs(n)>Math.abs(i)+10&&(i=0),Math.abs(n)<Math.abs(i)+10&&(n=0),!r){var a=t.text.current.getElementsByClassName("TokensContainer")[0];a.scrollHeight-Math.ceil(a.scrollTop)===a.clientHeight||(i=0)}return[n,i]};return Object(s.a)({onSwiping:function(n){var r,i,a=l(n),o=Object(c.a)(a,2),s=o[0],u=o[1];if((!(s>0)||e.swipeOptions.right)&&(!(s<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(s,"px) translateY(").concat(u,"px)");var d,f,b,j,v=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,h=null===(i=e.swipeOptions.up)||void 0===i?void 0:i.code,p="0%",x="center";if(s>0)v=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.color,h=null===(f=e.swipeOptions.right)||void 0===f?void 0:f.code,p="40%",x="left";if(s<0)v=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.color,h=null===(j=e.swipeOptions.left)||void 0===j?void 0:j.code,p="40%",x="right";t.box.current.style.backgroundColor=v,t.code.current.innerText=h,t.code.current.style.bottom=p,t.code.current.style.textAlign=x}},onSwiped:function(r){var o=l(r),s=Object(c.a)(o,2),u=s[0],d=s[1];if((!(u>0)||e.swipeOptions.right)&&(!(u<0)||e.swipeOptions.left)&&(!(d<0)||e.swipeOptions.up)&&!(0!==d&&d>0))if(t.text.current.style.transition="transform ".concat(a,"ms ease-out, opacity ").concat(a,"ms ease-out"),Math.abs(u)<i&&Math.abs(d)<i)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(u>0?100:u<0?-100:0,"%) translateY(").concat(d>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(a,"ms ease-out"),t.box.current.style.opacity=0;n(u>0?"right":"left"),n(null)}}},o)},Rt=i.a.memo(yt),At=n(258),_t=n(249),Lt=n(147),Tt=[4,4,2,2],Nt=function(e,t,n){var r,i=[],a=0,o=function(t){if(t){var n=null===e||void 0===e?void 0:e[t[0]];null!==n&&void 0!==n&&n.triggerCodePopup&&n.triggerCodePopup(t)}},l=Object(h.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value,s=c.text||"",u=Object(O.jsx)(Mt,{variable:c.variable,variableMap:t,annotation:c,onClick:o,text:s},a);null!==u&&i.push(u),a++}}catch(d){l.e(d)}finally{l.f()}return i},Mt=function(e){var t,n,r=e.variable,i=e.variableMap,a=e.annotation,o=e.onClick,l=e.text;if(null===i||void 0===i||null===(t=i[a.variable])||void 0===t||!t.codeMap)return null;var c=i[r].codeMap;if(null===c||void 0===c||!c[a.value]||!c[a.value].active)return null;var s=xe(a.value,c),u=null!==(n=c[a.value])&&void 0!==n&&n.foldToParent?"".concat(c[a.value].foldToParent," - ").concat(a.value):a.value,d="".concat(a.offset,"-").concat(a.offset+a.length);return Object(O.jsxs)(Re.a.Row,{className:"annotations-tr",onClick:function(){return o(a.token_span)},style:{cursor:"pointer"},children:[Object(O.jsx)(Re.a.Cell,{width:Tt[0],children:Object(O.jsx)("span",{title:r,children:r})}),Object(O.jsx)(Re.a.Cell,{title:u,width:Tt[1],style:s?{background:s}:null,children:Object(O.jsx)("span",{title:u,children:u})}),Object(O.jsx)(Re.a.Cell,{title:a.field,width:Tt[2],children:a.field}),Object(O.jsx)(Re.a.Cell,{title:d,width:Tt[3],children:d}),Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("span",{title:l,children:l})})]})},It=function(e){var t=e.tokens,n=e.variableMap,r=e.annotations;return n&&0!==Object.keys(n).length?Object(O.jsxs)(Re.a,{style:{fontSize:"10px",maxHeight:"100%",borderRadius:"0px"},fixed:!0,role:"grid","arioa-labelledby":"header",unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(O.jsx)(Re.a.Header,{className:"annotations-thead",style:{height:"40px"},children:Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.HeaderCell,{title:"Variable",width:Tt[0],children:"Variable"}),Object(O.jsx)(Re.a.HeaderCell,{title:"Vale",width:Tt[1],children:"Value"}),Object(O.jsx)(Re.a.HeaderCell,{title:"Field",width:Tt[2],children:"Field"}),Object(O.jsx)(Re.a.HeaderCell,{title:"Position",width:Tt[3],children:"Position"}),Object(O.jsx)(Re.a.HeaderCell,{title:"Text",children:"Text"})]})}),Object(O.jsx)(Re.a.Body,{className:"annotations-tbody",style:{overflow:"auto",height:"calc(100% - 40px)"},children:Nt(t,n,r)})]}):null},Ht=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,l=Pt(t),s=Object(c.a)(l,2),u=s[0],d=s[1],f=Object(r.useState)(null),j=Object(c.a)(f,2),v=j[0],h=j[1],p=Object(gt.a)(["annotateTaskSettings"]),g=Object(c.a)(p,2),m=g[0],y=g[1],k=Object(r.useState)(m.annotateTaskSettings||{textSize:1}),w=Object(c.a)(k,2),S=w[0],C=w[1],E=Object(r.useState)(null),R=Object(c.a)(E,2),A=R[0],_=R[1];return Object(r.useEffect)((function(){y("annotateTaskSettings",JSON.stringify(S),{path:"/"})}),[S,y]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(O.jsxs)(b.a,{centered:!0,stackable:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(O.jsxs)(b.a.Column,{width:10,style:{paddingRight:"0em",paddingTop:"0",height:"100%"},children:[Object(O.jsxs)(x.a.Group,{fluid:!0,style:{padding:"0",height:"40px"},children:[Object(O.jsx)(Ft,{settings:S,setSettings:C,fullScreenNode:o}),Object(O.jsx)(Bt,{fullScreenNode:o}),Object(O.jsx)(Dt,{unit:t,annotations:u,setUnitIndex:i})]}),Object(O.jsx)("div",{style:{height:"calc(100% - 20px",fontSize:"".concat(S.textSize,"em")},children:Object(O.jsx)(ht,{unit:t,settings:null===n||void 0===n?void 0:n.settings,variables:null===n||void 0===n?void 0:n.variables,onChangeAnnotations:d,returnTokens:_,returnVariableMap:h,blockEvents:a,fullScreenNode:o})})]}),Object(O.jsx)(b.a.Column,{width:6,style:{paddingRight:"0em",padding:"0",height:"100%",paddingLeft:"10px"},children:Object(O.jsx)("div",{style:{borderBottom:"1px solid",height:"calc(100%)",overflow:"auto"},children:Object(O.jsx)(It,{tokens:A,variableMap:v,annotations:u})})})]}):null},Pt=function(e){var t=Object(r.useState)([]),n=Object(c.a)(t,2),a=n[0],o=n[1],l=Object(r.useRef)(null);return Object(r.useEffect)((function(){e?(l.current=e.unitId,o(e.annotations||[])):o([])}),[e,o]),[a,i.a.useCallback((function(t){if(e.unitId===l.current){o(t);var n=Ut(t);zt(e.annotations,n)&&e.jobServer.postAnnotations(e.unitId,n,"IN_PROGRESS")}}),[e])]},zt=function(e,t){if(e.length!==t.length)return!0;for(var n=["variable","value","field","offset","length"],r=0;r<e.length;r++){var i,a=Object(h.a)(n);try{for(a.s();!(i=a.n()).done;){var o,l,c=i.value;if((null===(o=e[r])||void 0===o?void 0:o[c])!==(null===(l=t[r])||void 0===l?void 0:l[c]))return!0}}catch(s){a.e(s)}finally{a.f()}}return!1},Ut=function(e){return e.map((function(e){return{variable:e.variable,value:e.value,field:e.field,offset:e.offset,length:e.length}}))},Dt=function(e){var t=e.unit,n=e.annotations,i=e.setUnitIndex,a=Object(r.useState)(!1),o=Object(c.a)(a,2),l=o[0],s=o[1],u=function(){l||(t.jobServer.postAnnotations(t.unitId,Ut(n),"DONE"),s(!0),i((function(e){return e+1})),setTimeout((function(){s(!1)}),1e3))},d=function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),u())};return Object(r.useEffect)((function(){return window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}})),Object(O.jsx)(x.a,{disabled:l,loading:l,primary:!0,size:"tiny",onClick:u,children:"Next Unit"})},Bt=function(e){var t=e.fullScreenNode,n=Object(r.useState)(!1),i=Object(c.a)(n,2),a=i[0],o=i[1];return Object(O.jsxs)(At.a,{mountNode:t||void 0,flowing:!0,open:a,onClose:function(){return o(!1)},position:"bottom left",trigger:Object(O.jsx)(x.a,{secondary:!0,size:"tiny",onClick:function(){return o(!a)},children:"Controls"}),children:[Object(O.jsx)(At.a.Header,{children:"Controls"}),Object(O.jsx)(At.a.Content,{children:Object(O.jsx)(_t.a,{style:{overflow:"auto",paddingTop:"2em",width:"100%",maxWidth:"700px"},children:Object(O.jsxs)(Re.a,{structured:!0,compact:!0,basic:"very",unstackable:!0,children:[Object(O.jsx)(Re.a.Header,{children:Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.HeaderCell,{width:3}),Object(O.jsx)(Re.a.HeaderCell,{children:"Keyboard"}),Object(O.jsx)(Re.a.HeaderCell,{children:"Mouse"}),Object(O.jsx)(Re.a.HeaderCell,{children:"Touchpad"})]})}),Object(O.jsxs)(Re.a.Body,{children:[Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("strong",{children:"Navigate"})}),Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("i",{children:"Arrow keys"})}),Object(O.jsx)(Re.a.Cell,{}),Object(O.jsx)(Re.a.Cell,{})]}),Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("strong",{children:"Select words"})}),Object(O.jsxs)(Re.a.Cell,{children:[Object(O.jsx)("i",{children:"spacebar"}),Object(O.jsx)("br",{}),"Hold to select mutiple"]}),Object(O.jsxs)(Re.a.Cell,{children:[Object(O.jsx)("i",{children:"Left-click"}),Object(O.jsx)("br",{}),"Hold to select multiple"]}),Object(O.jsxs)(Re.a.Cell,{children:[Object(O.jsx)("i",{children:"tab"})," twice to begin, then once to close"]})]}),Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("strong",{children:"Edit/remove code"})}),Object(O.jsx)(Re.a.Cell,{colSpan:"3",children:"Select annotated words to overwrite or delete the code"})]}),Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.Cell,{children:Object(O.jsxs)("strong",{children:["Select variable",Object(O.jsx)("br",{}),"(if multiple)"]})}),Object(O.jsxs)(Re.a.Cell,{children:["Next with ",Object(O.jsx)("i",{children:"tab"}),", previous with ",Object(O.jsx)("i",{children:"shift+tab"})]}),Object(O.jsx)(Re.a.Cell,{colSpan:"2",children:"Use the buttons"})]}),Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("strong",{children:"Next unit"})}),Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("i",{children:"ctrl+Enter"})}),Object(O.jsx)(Re.a.Cell,{colSpan:"2",children:"Use the next unit button"})]})]}),Object(O.jsx)(Re.a.Footer,{children:Object(O.jsxs)(Re.a.Row,{children:[Object(O.jsxs)(Re.a.HeaderCell,{children:[Object(O.jsx)("strong",{children:"Quick keys"})," ",Object(O.jsx)("br",{}),"in popup"]}),Object(O.jsx)(Re.a.HeaderCell,{colSpan:"3",children:Object(O.jsxs)(he.a,{as:"ul",children:[Object(O.jsxs)(Lt.a,{as:"li",children:[Object(O.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(O.jsxs)(Lt.a,{as:"li",children:["navigate buttons with ",Object(O.jsx)("i",{children:"arrow keys"}),", select with ",Object(O.jsx)("i",{children:"spacebar"})]}),Object(O.jsxs)(Lt.a,{as:"li",children:["use ",Object(O.jsx)("i",{children:"escape"})," to close popup and ",Object(O.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})})}),Object(O.jsx)(At.a.Actions,{children:Object(O.jsx)(x.a,{content:"Close",onClick:function(){return o(!1)},positive:!0})})]})},Ft=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(O.jsx)(pe.a,{on:"click",mountNode:r||void 0,trigger:Object(O.jsx)(x.a,{secondary:!0,width:1,size:"large",icon:"setting",style:{color:"white",maxWidth:"50px"}}),children:Object(O.jsx)(xt.a,{children:Object(O.jsx)(xt.a.Group,{grouped:!0,children:Object(O.jsxs)(xt.a.Field,{children:[Object(O.jsxs)("label",{children:["text size scaling ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(O.jsx)(Ot.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{textSize:t.value})}))}})]})})})})},qt=i.a.memo(Ht),Wt=function(e){var t,n=e.unit,r=e.setUnitIndex,i=e.fullScreenNode,a=null===n||void 0===n||null===(t=n.jobServer)||void 0===t?void 0:t.codebook;if(console.log(a),!a||!n)return null;return null!==a&&void 0!==a&&a.type?function(e){switch(e){case"questions":return Object(O.jsx)(Rt,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});case"annotate":return Object(O.jsx)(qt,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});default:return null}}(a.type):null},Vt=n(154),Yt=function(e){var t=e.children,n=Object(r.useState)(null),i=Object(c.a)(n,2),a=i[0],o=i[1];return Object(O.jsx)("div",{className:"dom-node-provider",ref:o,children:t(a)})},Gt=function(e){var t=e.handle,n=Object(r.useState)(!0),i=Object(c.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){o(!0)}),[o,t]),Object(O.jsxs)(At.a,{open:a,children:[Object(O.jsx)(At.a.Header,{children:"Fullscreen mode"}),Object(O.jsxs)(At.a.Content,{children:[Object(O.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-right corner. For some devices fullscreen might not work."}),Object(O.jsxs)("div",{style:{display:"flex",height:"30%"},children:[Object(O.jsx)(x.a,{primary:!0,size:"massive",onClick:function(){t.active||t.enter(),o(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(O.jsx)(x.a,{secondary:!0,size:"massive",onClick:function(){t.active&&t.exit(),o(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},Jt=function(e){var t=e.handle;return Object(O.jsx)(j.a.Group,{size:"big",style:{paddingRight:"10px",position:"absolute",top:"0px",right:0},children:Object(O.jsx)(j.a,{link:!0,name:t.active?"compress":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},Qt=function(e){var t=e.children,n=Object(Vt.b)(),r=Object(O.jsx)(Jt,{handle:n});return Object(O.jsx)(Vt.a,{handle:n,children:Object(O.jsx)(Yt,{style:{height:"100%"},children:function(e){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Gt,{handle:n}),t(e,r)]})}})})},Kt=(n(205),function(){var e=Object(u.a)(f.a.mark((function e(t,n,r,i){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.getUnit(n);case 5:a=e.sent,r(Object(s.a)(Object(s.a)({jobServer:t,unitId:a.id},a.unit),{},{annotations:a.annotation,status:a.status})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),404===(null===(o=e.t0.response)||void 0===o?void 0:o.status)&&i(null),r(null),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),Xt=function(e){var t;switch(null===e||void 0===e||null===(t=e.codebook)||void 0===t?void 0:t.type){case"questions":return["800px","1000px"];case"annotate":return["2000px","2000px"];default:return["100%","100%"]}},Zt=function(e){var t=e.jobServer;return t?t.getAllAnnotations?Object(O.jsx)(b.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(O.jsxs)(b.a.Row,{style:{marginTop:"40%"},children:[Object(O.jsx)(b.a.Column,{width:4,children:Object(O.jsx)(j.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(O.jsxs)(b.a.Column,{width:8,children:[Object(O.jsx)(v.a,{children:"You finished the codingjob!"}),Object(O.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(O.jsx)(y,{jobServer:t})]})]})}):Object(O.jsx)(b.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(O.jsx)(b.a.Row,{style:{marginTop:"40%"},children:Object(O.jsx)("div",{children:Object(O.jsx)(j.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):null},$t=function(e){var t=e.jobServer,n=Object(r.useState)(-1),i=Object(c.a)(n,2),a=i[0],o=i[1],l=Object(r.useState)(null),s=Object(c.a)(l,2),u=s[0],d=s[1];Object(r.useEffect)((function(){o(t.progress.n_coded)}),[t,o]),Object(r.useEffect)((function(){t&&null!==a&&Kt(t,a,d,o)}),[a,t,o,d]);var f=function(e){return a<0?null:null===a?Object(O.jsx)(Zt,{jobServer:t}):Object(O.jsx)(Wt,{unit:u,setUnitIndex:o,fullScreenNode:e})},b=Xt(t),j=Object(c.a)(b,2),v=j[0],h=j[1];return Object(O.jsx)(Qt,{children:function(e,n){return Object(O.jsxs)("div",{style:{maxWidth:h,maxHeight:v,background:"white",margin:"0 auto",padding:"0",height:"100%",border:"1px solid white"},children:[Object(O.jsxs)("div",{style:{height:"45px",padding:"0",position:"relative"},children:[Object(O.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(O.jsx)(C,{n:null===t||void 0===t?void 0:t.progress.n_total,index:a,setIndex:o,canGoBack:null===t||void 0===t?void 0:t.progress.seek_backwards,canGoForward:null===t||void 0===t?void 0:t.progress.seek_forwards})}),Object(O.jsx)("div",{children:n})]}),Object(O.jsx)("div",{style:{height:"calc(100% - 45px)",padding:"0"},children:f(e)})]})}})},en=n(22),tn=n(17),nn=n(150),rn=n.n(nn);function an(e,t,n){return on.apply(this,arguments)}function on(){return(on=Object(u.a)(f.a.mark((function e(t,n,r){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rn.a.get("".concat(t,"/token"),{auth:{username:n,password:r}});case 2:return i=e.sent,e.abrupt("return",i.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ln=function(){function e(t,n,r){Object(en.a)(this,e),this.host=t,this.email=n,this.token=r,this.api=rn.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(r)}})}return Object(tn.a)(e,[{key:"init",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getToken();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"getJobs",value:function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjobs");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/token");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodebook",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/codebook"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProgress",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/progress"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/codingjob/".concat(t,"/unit"),null!==n&&(r+="?index=".concat(n)),e.next=4,this.api.get(r);case 4:return i=e.sent,e.abrupt("return",i.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}},{key:"postAnnotation",value:function(e,t,n,r){var i={annotation:n,status:r};this.api.post("/codingjob/".concat(e,"/unit/").concat(t,"/annotation"),i)}}]),e}(),cn=ln,sn=n(250),un=function(){var e=Object(u.a)(f.a.mark((function e(t,n,r){var i,a,o,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=new cn(null===t||void 0===t||null===(i=t.backend)||void 0===i?void 0:i.host,null===t||void 0===t||null===(a=t.backend)||void 0===a?void 0:a.email,null===t||void 0===t||null===(o=t.backend)||void 0===o?void 0:o.token),e.prev=1,e.next=4,l.init();case 4:r(l),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),r(null),n("backend",JSON.stringify(Object(s.a)(Object(s.a)({},l),{},{token:null})),{path:"/"});case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),dn=function(e){var t=e.host,n=void 0===t?null:t,r=Object(gt.a)(["backend"]),i=Object(c.a)(r,2),a=i[0],o=i[1],l=a.backend||{host:"http://localhost:5000",email:"test@user.com",token:null};n&&(l.host=n);return l.token?Object(O.jsx)(fn,{backend:l,setLogout:function(){o("backend",JSON.stringify(Object(s.a)(Object(s.a)({},l),{},{token:null})),{path:"/"})}}):Object(O.jsx)(bn,{backend:l,setLogin:function(e){o("backend",JSON.stringify(e),{path:"/"})}})},fn=function(e){var t=e.backend,n=e.setLogout;return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(b.a,{textAlign:"center",children:Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(x.a,{secondary:!0,onClick:n,children:["Sign out from ",Object(O.jsx)("span",{style:{color:"lightblue"},children:t.email})]})})})})},bn=function(e){var t=e.backend,n=e.setLogin,i=Object(r.useState)(""),a=Object(c.a)(i,2),o=a[0],l=a[1],s=Object(r.useState)(""),d=Object(c.a)(s,2),j=d[0],h=d[1],p=Object(r.useState)(""),g=Object(c.a)(p,2),m=g[0],y=g[1],w=Object(r.useState)(!1),S=Object(c.a)(w,2),C=S[0],E=S[1],R=function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(""),e.prev=1,e.next=4,an(o,j,m);case 4:t=e.sent,n({host:o,email:j,token:t}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),E(!0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),A=!j.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return Object(r.useEffect)((function(){null!==t&&void 0!==t&&t.email&&h(t.email),null!==t&&void 0!==t&&t.host&&l(t.host)}),[t]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(v.a,{icon:"user",content:"Register or sign in"}),Object(O.jsxs)(k.a,{placeholder:!0,attached:"bottom",children:[Object(O.jsx)(b.a,{stackable:!0,textAlign:"center",children:Object(O.jsx)(b.a.Row,{children:Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(xt.a,{children:[Object(O.jsx)(xt.a.Input,{placeholder:"Host",name:"host",label:"Host",value:o,onChange:function(e,t){t.value.length<100&&l(t.value)},icon:"home",iconPosition:"left",autoFocus:!0}),Object(O.jsx)(xt.a.Input,{placeholder:"email adress",error:!!A&&"Please enter a valid email adress",name:"email",label:"Email",icon:"mail",iconPosition:"left",value:j,onChange:function(e,t){t.value.length<100&&h(t.value)}})]})})})}),Object(O.jsx)(sn.a,{}),Object(O.jsx)(b.a,{columns:2,textAlign:"center",children:Object(O.jsxs)(b.a.Row,{verticalAlign:"middle",children:[Object(O.jsx)(b.a.Column,{children:Object(O.jsx)(xt.a,{children:Object(O.jsx)(x.a,{circular:!0,primary:!0,fluid:!0,style:{width:"7em",height:"7em"},children:"Login by email (not yet functional)"})})}),Object(O.jsx)(sn.a,{vertical:!0,children:"Or"}),Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(xt.a,{children:[Object(O.jsx)(xt.a.Input,{placeholder:"password",name:"password",error:!!C&&"Invalid password for this host & email",label:"Password",type:"password",icon:"lock",iconPosition:"left",value:m,onChange:function(e,t){E(!1),y(t.value)}}),Object(O.jsx)(x.a,{disabled:0===m.length,primary:!0,fluid:!0,onClick:R,children:"Sign in"})]})})]})})]})]})},jn=function(e){var t,n=Object(gt.a)(["backend"]),i=Object(c.a)(n,2),a=i[0],o=i[1],l=Object(r.useState)(null),s=Object(c.a)(l,2),u=s[0],d=s[1];return Object(r.useEffect)((function(){var t,n,r,i=e||(null===a||void 0===a||null===(t=a.backend)||void 0===t?void 0:t.host)||null;console.log(i),console.log(null===u||void 0===u?void 0:u.host),i&&null!==u&&void 0!==u&&u.host&&i!==(null===u||void 0===u?void 0:u.host)?d(null):null!==a&&void 0!==a&&null!==(n=a.backend)&&void 0!==n&&n.token?!u&&i&&null!==a&&void 0!==a&&null!==(r=a.backend)&&void 0!==r&&r.token&&un(a,o,d):d(null)}),[a,u,e,o,d]),[u,Object(O.jsx)(dn,{host:e||(null===a||void 0===a||null===(t=a.backend)||void 0===t?void 0:t.host)||null})]},vn=function(){function e(t,n){Object(en.a)(this,e),this.backend=t,this.job_id=n,this.where="remote"}return Object(tn.a)(e,[{key:"init",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.backend.getCodebook(this.job_id);case 3:return this.codebook=e.sent,e.next=6,this.backend.getProgress(this.job_id);case 6:this.progress=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),this.success=!1,e.abrupt("return");case 14:this.success=!0;case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t>=this.progress.n_coded&&!this.progress.seek_forwards,this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,this.backend.getUnit(this.job_id,n?null:t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t,n){this.backend.postAnnotation(this.job_id,e,t,n)}}]),e}(),hn=vn,pn=n(18),xn=[{name:"title"},{name:"progress",f:function(e){return"".concat(e.n_coded||0," / ").concat(e.n_total)}},{name:"modified"}],On=function(e){var t=e.fullData,n=e.columns,i=e.onClick,a=Object(r.useState)([]),o=Object(c.a)(a,2),l=o[0],s=o[1],u=Object(r.useState)(1),d=Object(c.a)(u,2),f=d[0],b=d[1];if(Object(r.useEffect)((function(){if(!t)return s([]),null;var e=t.length;b(Math.ceil(e/10));var n=[];e>0&&(n=t.slice(0,10)),s(n)}),[t]),l)return Object(O.jsx)(gn,{data:l,pages:f,columns:n,pageChange:function(e){var n=10*(e-1),r=t.slice(n,n+10);s(r)},onClick:i})},gn=function(e){var t=e.data,n=e.columns,r=e.pages,i=e.pageChange,a=e.onClick,o=function(e){return n.map((function(t,n){return t.hide?null:((r=t.f?t.f(e):e?e[t.name]:null)instanceof Date&&(r=r.toISOString().slice(0,19).replace(/T/g," ")),Object(O.jsx)(Re.a.Cell,{children:Object(O.jsx)("span",{title:r,children:r})},n));var r}))};return t.length<1?null:Object(O.jsx)(_t.a,{children:Object(O.jsxs)(Re.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(O.jsx)(Re.a.Header,{children:Object(O.jsx)(Re.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(O.jsx)(Re.a.HeaderCell,{width:e.width||null,children:Object(O.jsx)("span",{title:e.name,children:e.name})},t)}))}(0,n)})}),Object(O.jsx)(Re.a.Body,{children:function(e){return e.map((function(e,t){return Object(O.jsx)(Re.a.Row,{style:{cursor:"pointer"},onClick:function(){return a(e)},children:o(e)},t)}))}(t)}),Object(O.jsx)(Re.a.Footer,{children:Object(O.jsx)(Re.a.Row,{children:Object(O.jsx)(Re.a.HeaderCell,{colSpan:n.length,children:r>1?Object(O.jsx)(S.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(O.jsx)(j.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(O.jsx)(j.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(O.jsx)(j.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(O.jsx)(j.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(O.jsx)(j.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:r,onPageChange:function(e,t){return i(t.activePage)}}):null})})})]})})},mn=function(e){var t=e.backend,n=e.setJobId,i=Object(r.useState)(null),a=Object(c.a)(i,2),o=a[0],l=a[1],s=Object(pn.d)();Object(r.useEffect)((function(){var e=!0;return t?t.getJobs().then((function(t){e&&l(t.jobs)})):l(null),function(){return e=!1}}),[t]);var u=o?o.filter((function(e){return"NEW"!==e.modified})):[],d=o?o.filter((function(e){return"NEW"===e.modified})):[];return Object(O.jsx)(On,{fullData:[].concat(Object(E.a)(u),Object(E.a)(d)),columns:xn,onClick:function(e){s.push("?url="+t.host+"/codingjob/".concat(e.id)),n(e.id)}})},yn=function(e){var t=e.backend,n=e.setJobId,r=e.loginForm;return Object(O.jsx)(b.a,{inverted:!0,textAlign:"center",style:{height:"100vh",maxHeight:"800px",width:"100vw"},verticalAlign:"middle",children:Object(O.jsxs)(b.a.Column,{width:"16",style:{maxWidth:"500px"},children:[Object(O.jsxs)(b.a.Row,{children:[Object(O.jsxs)(v.a,{children:[Object(O.jsx)(j.a,{name:"home"}),t.host]}),r]}),Object(O.jsx)("br",{}),Object(O.jsx)(b.a.Row,{children:Object(O.jsx)(mn,{backend:t,setJobId:n})})]})})},kn=function(e,t){var n=Object(r.useState)(null),i=Object(c.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){if(e&&t){o(null);var n=new hn(e,t);n.init().then((function(){return o(n)}))}else o(null)}),[e,t]),a},wn=function(e){var t=Object(r.useState)(),n=Object(c.a)(t,2),i=n[0],a=n[1],o=Object(r.useState)(),l=Object(c.a)(o,2),s=l[0],u=l[1];return Object(r.useEffect)((function(){var t;if(!e.search)return a(null),void u(null);var n=null===(t=e.search.replace("%colon%",":").split("?"))||void 0===t?void 0:t[1];if(!n)return[null,null];var r=n.split("&").reduce((function(e,t){var n=t.split("="),r=Object(c.a)(n,2),i=r[0],a=r[1];return e[decodeURIComponent(i)]=decodeURIComponent(a),e}),{});if(!r.url)return[null,null];var i=new URL(r.url);a(i.origin),u(i.pathname.split("/").slice(-1)[0])}),[a,u,e]),[i,s]},Sn=function(){var e=Object(pn.e)(),t=wn(e),n=Object(c.a)(t,3),r=n[0],i=n[1],a=n[2],o=jn(r),l=Object(c.a)(o,2),s=l[0],u=l[1],d=kn(s,i);return s?d?d.job_id!==i?null:Object(O.jsx)($t,{jobServer:d}):Object(O.jsx)(yn,{backend:s,setJobId:a,loginForm:u}):Object(O.jsx)(b.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(O.jsx)(b.a.Column,{style:{maxWidth:"500px"},children:u})})},Cn=function(){return Object(O.jsx)(l.a,{basename:"/",children:Object(O.jsx)("div",{style:{height:"100vh",width:"100vw"},children:Object(O.jsx)(Sn,{})})})},En=n(251);o.a.render(Object(O.jsx)(i.a.StrictMode,{children:Object(O.jsx)(En.a,{children:Object(O.jsx)(Cn,{})})}),document.querySelector("#root"))}},[[230,1,2]]]);
//# sourceMappingURL=main.126bbcc3.chunk.js.map