(this["webpackJsonpccs-annotator-client"]=this["webpackJsonpccs-annotator-client"]||[]).push([[0],{198:function(e,t,n){},199:function(e,t,n){},219:function(e,t,n){"use strict";n.r(t);n(184);var r=n(0),i=n.n(r),a=n(70),o=n.n(a),l=n(88),c=n(12),s=n(6),u=n(8),d=n(21),f=n(15),b=n.n(f),j=n(250),v=n(50),h=n(249),p=n(11),x=n(168),O=n(220),g=n(1),m=function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,i,a,o,l,c,s,d,f,j,v,h;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),i=t.getAllAnnotations(),a=[],o=Object(p.a)(i);try{for(o.s();!(l=o.n()).done;){c=l.value,s=c.annotations,d=r[c.unit_id],f=Object(p.a)(s);try{for(f.s();!(j=f.n()).done;)v=j.value,h=Object(u.a)(Object(u.a)({document_id:d.document_id,unit_id:d.unit_id},d.provenance),v),a.push(h)}catch(b){f.e(b)}finally{f.f()}}}catch(b){o.e(b)}finally{o.f()}n(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,i,a,o,l,c,s,d,f,j,v,h,x,O,g,m;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),a=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),o=t.getAllAnnotations(),l=Object(p.a)(o);try{for(l.s();!(c=l.n()).done;){if(s=c.value,d=s.annotations,f=a[s.unit_id],j=Object(u.a)(Object(u.a)({document_id:f.document_id,unit_id:f.unit_id},f.provenance),{},{offset:d[0].offset,length:d[0].length,field:d[0].field},d[0].meta),f.meta)for(v=0,h=Object.keys(f.meta);v<h.length;v++)x=h[v],j["meta_"+x]=f.meta[x];O=Object(p.a)(i);try{for(m=function(){var e=g.value,t=d.find((function(t){return t.variable===e}));j[e]=null==t?null:t.value},O.s();!(g=O.n()).done;)m()}catch(b){O.e(b)}finally{O.f()}r.push(j)}}catch(b){l.e(b)}finally{l.f()}n(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(e){var t=e.jobServer,n=Object(r.useState)(null),i=Object(s.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":m(t,o);break;case"questions":y(t,o);break;default:return null}}),[t]),Object(g.jsx)(x.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:a,style:{cursor:"pointer"},children:Object(g.jsx)(O.a,{loading:null===a,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},w=n(248),S=n(236),C=n(242),_=function(e){var t=e.n,n=e.index,i=e.setIndex,a=e.canGoForward,o=void 0===a||a,l=e.canGoBack,c=void 0===l||l,u=Object(r.useRef)(0),d=Object(r.useRef)(!1),f=Object(r.useState)(!1),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(1),p=Object(s.a)(h,2),x=p[0],O=p[1],m=Object(r.useState)(1),y=Object(s.a)(m,2),k=y[0],_=y[1];if(Object(r.useEffect)((function(){n<0||(null!==n&&O(Math.min(n+1,t+1)),null===n&&O(t+1))}),[n,t,O]),Object(r.useEffect)((function(){u.current=0,d.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;O(1),d.current=!0}),[t,O]),Object(r.useEffect)((function(){if(!t)return null;u.current=Math.max(x,u.current),i(x-1===t?null:x-1),_(x)}),[t,i,x]),Object(r.useEffect)((function(){if(!t)return null;if(x===k)return v(!1),null;v(!0);var e=setTimeout((function(){O(k),v(!1)}),500);return function(){return clearTimeout(e)}}),[x,k,t,v]),!t)return null;var E=100*Math.max(0,u.current-1)/t;return Object(g.jsxs)(w.a,{style:{display:"flex",border:"none",boxShadow:"none",padding:"0",marginTop:"5px",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(g.jsx)(S.a,{active:j,content:""}),Object(g.jsx)(C.a,{secondary:!0,activePage:k,pageItem:k<=t?"".concat(k," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:c?"back":"   ",nextItem:o||x<u.current?"next":"   ",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||x<u.current)&&Number(t.activePage)>x&&O(Number(t.activePage)),c&&Number(t.activePage)<x&&O(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),Object(g.jsx)("input",{style:{flex:"1 1 auto",background:"linear-gradient(to right, #7dd48d ".concat(E,"%, #fff ").concat(E,"% 100%, #fff 100%)")},min:1,max:t+1,onChange:function(e){Number(e.target.value)>k&&_(o?Number(e.target.value):Math.min(u.current,Number(e.target.value))),c&&Number(e.target.value)<k&&_(Number(e.target.value))},type:"range",value:k})]})},E=n(20),A=n(247),R=n(241),L=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,l=t-1;l>=0;l--){if(null==e[l].ref||null===e[l].ref.current)return l+1;var c=M(e[l].ref);if(null===c)return;if(null===a){if(N(i,c))continue;a=c}else if(!N(a,c))return l+1;var s=I(i,c);if(o>0&&s<o)return l+1;if(i.left>c.right)return l;o=s}return 0},T=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,l=t+1;l<e.length;l++){if(null==e[l].ref||null===e[l].ref.current)return l-1;var c=M(e[l].ref);if(null===c)return;if(null===a){if(N(i,c))continue;a=c}else if(!N(a,c))return l-1;var s=I(i,c);if(o>0&&s<o)return l-1;if(i.right<c.left)return l;o=s}return e.length-1},N=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},I=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),i=(r-n)/e.width,a=(r-n)/t.width;return Math.max(i,a)},M=function(e,t){if(null===e||void 0===e||!e.current)return null;var n=e.current.getBoundingClientRect();if(null!=t){var r=t.current.getBoundingClientRect();n.x=r.x,n.width=r.width}return n},H=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],P=i.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,a=Object(r.useRef)();return Object(g.jsx)(A.a,{innerRef:a,children:Object(g.jsx)(R.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!i},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(g.jsxs)(g.Fragment,{children:[e.code,Object(g.jsx)("br",{}),Object(g.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),z=i.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,o=Object(r.useState)(0),l=Object(s.a)(o,2),c=l[0],u=l[1],d=i.a.useCallback((function(e){var r=t.length;if(H.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&c<r-1&&u(c+1),"ArrowDown"===e.key&&u(T(t,c)),"ArrowLeft"===e.key&&c>0&&u(c-1),void("ArrowUp"===e.key&&u(L(t,c)));46===e.keyCode&&(n(null),u(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),c===t.length?n(null):n(t[c]),u(0))}),[c,n,t]);Object(r.useEffect)((function(){return a?window.removeEventListener("keydown",d):window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}}),[d,a]);return Object(g.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(A.a,{innerRef:e.ref,children:Object(g.jsx)(O.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===c?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return u(t)},onClick:function(e,t){n(t.value),u(0)},children:e.code},e.code)})})}))})})),D=i.a.memo((function(e){var t,n,a,o,l,c,s,u,d,f=e.swipeOptions,b=e.callback,j=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){j&&("right"===j&&b(f.right),"up"===j&&b(f.up),"left"===j&&b(f.left))}),[j,b,f]);var p=i.a.useCallback((function(e){H.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(f.right),"ArrowUp"===e.key&&b(f.up),"ArrowLeft"===e.key&&b(f.left))}),[b,f]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(g.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==f.up?null:Object(g.jsx)(O.a,{fluid:!0,disabled:null==f.up,onClick:function(e,t){return b(f.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=f.up)||void 0===t?void 0:t.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)(v.a,{name:null!==(n=f.up)&&void 0!==n&&n.code?"arrow up":null}),Object(g.jsx)("span",{children:(null===(a=f.up)||void 0===a?void 0:a.code)||""})]})}),Object(g.jsx)("div",{style:{flex:"1 1 auto"},children:Object(g.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(g.jsx)(O.a,{disabled:null==f.left,onClick:function(e,t){return b(f.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=f.left)||void 0===o?void 0:o.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)(v.a,{name:null!==(l=f.left)&&void 0!==l&&l.code?"arrow left":null}),Object(g.jsx)("span",{children:(null===(c=f.left)||void 0===c?void 0:c.code)||""})]})}),Object(g.jsx)(O.a,{disabled:null==f.right,onClick:function(e,t){return b(f.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(s=f.right)||void 0===s?void 0:s.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)("span",{children:(null===(u=f.right)||void 0===u?void 0:u.code)||""}),Object(g.jsx)(v.a,{name:null!==(d=f.right)&&void 0!==d&&d.code?"arrow right":null})]})})]})})]})})),B="lightgreen",F=function(e){var t,n=e.unit,i=e.tokens,a=e.questions,o=e.questionIndex,l=e.setQuestionIndex,c=e.setUnitIndex,u=e.swipe,d=e.blockEvents,f=Object(r.useState)(),b=Object(s.a)(f,2),j=b[0],v=b[1],p=Object(r.useRef)(!1),x=Object(r.useState)(null),O=Object(s.a)(x,2),m=O[0],y=O[1];if(Object(r.useEffect)((function(){a&&(q(n,i,a,y),p.current=!1)}),[n,i,y,a]),!a||!n||!m)return null;if(null===a||void 0===a||!a[o])return l(0),null;var k=J(n,a[o]);return Object(g.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(g.jsx)(W,{questions:a,questionIndex:o,annotations:m,setQuestionIndex:l}),Object(g.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",borderBottomLeftRadius:"30px",borderBottomRightRadius:"30px",backgroundColor:"#1B1C1D"},children:[Object(g.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(g.jsx)(h.a,{as:"h3",style:{color:"white"},children:k})}),Object(g.jsx)(V,{answerTransition:j,currentAnswer:null===m||void 0===m||null===(t=m[o])||void 0===t?void 0:t.value,questions:a,questionIndex:o,onSelect:function(e){if(p.current)return null;p.current=!0,m[o].value=e.code,m[o].makes_irrelevant=e.makes_irrelevant,n.annotations=K(m[o],n.annotations),U(n,a,m,o);for(var t=null,r=o+1;r<a.length;r++)if("IRRELEVANT"!==m[r].value){t=r;break}var i=null===t?"DONE":"IN_PROGRESS";n.jobServer.postAnnotations(n.unitId,n.annotations,i),v(e),setTimeout((function(){v(null),null===t?(c((function(e){return e+1})),l(0)):l(t),p.current=!1}),250)},swipe:u,blockEvents:d})]})]})},U=function(e,t,n,r){var i=new Set;for(var a in Object.keys(e.annotations)){var o=e.annotations[a].makes_irrelevant;if(null!=o&&null!==o){var l,c=Object(p.a)(o);try{var s=function(){var e=l.value;if("REMAINING"===e)for(var a=r+1;a<n.length;a++)i.add(a);var o=t.findIndex((function(t){return t.name===e}));o>=0&&i.add(o)};for(c.s();!(l=c.n()).done;)s()}catch(d){c.e(d)}finally{c.f()}}}for(var u=0;u<n.length;u++)i.has(u)?(n[u].value="IRRELEVANT",e.annotations=K(n[u],e.annotations)):"IRRELEVANT"===n[u].value&&(delete n[u].value,e.annotations=K(n[u],e.annotations))},q=function(e,t,n,r){if(0===t.length)return null;var i=[];e.annotations||(e.annotations=[]);for(var a=0;a<n.length;a++){var o=Y(t,n[a],a);o.value=Q(e.annotations,o),i.push(o)}r(i)},W=function(e){var t=e.questions,n=e.questionIndex,i=e.annotations,a=e.setQuestionIndex,o=Object(r.useState)(),l=Object(s.a)(o,2),c=l[0],u=l[1];Object(r.useEffect)((function(){var e=i.map((function(e){return null!==e.value}));e[0]=!0,u(e)}),[i,u]),Object(r.useEffect)((function(){u((function(e){var t=Object(E.a)(e);return t[n]=!0,t}))}),[n,u]);return Object(g.jsx)("div",{children:Object(g.jsx)(O.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return i[e]?"IRRELEVANT"===i[e].value?["black","red"]:c&&e>n&&!c[e]?["white","grey"]:i[e].value?["black",B]:0===e||c&&c[e]?[B,"#1B1C1D"]:[B,"grey"]:["black","red"]}(r),l=Object(s.a)(o,2),u=l[0],d=l[1];return Object(g.jsx)(O.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:d,textOverflow:"clip",overflow:"hidden",color:u},onClick:function(){c[r]&&a(r)},children:Object(g.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},V=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,i=e.questionIndex,a=e.onSelect,o=e.swipe,l=e.blockEvents;return t?Object(g.jsx)(w.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(g.jsx)(h.a,{as:"h1",children:t.code})}):Object(g.jsxs)(g.Fragment,{children:[X(n||t),Object(g.jsxs)(w.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",margin:"0"},children:["search code"===r[i].type?Object(g.jsx)(P,{options:r[i].options,callback:a,blockEvents:l}):null,"select code"===r[i].type?Object(g.jsx)(z,{options:r[i].options,callback:a,blockEvents:l}):null,"annotinder"===r[i].type?Object(g.jsx)(D,{swipeOptions:r[i].swipeOptions,currentAnswer:n,callback:a,swipe:o,blockEvents:l}):null]})]})},Y=function(e,t,n){if(0===e.length)return null;var r,i={},a=e[e.length-1],o=[0,a.offset+a.length],l=[0,e.length-1],c=!1,s=!1,u=0,d=Object(p.a)(e);try{for(d.s();!(r=d.n()).done;){var f=r.value;f.codingUnit&&!i[f.field]&&(i[f.field]=1),!c&&f.codingUnit&&(c=!0,o[0]=f.offset,l[0]=u),s||f.codingUnit||!c||(s=!0,o[1]=e[u-1].offset+e[u-1].length,l[1]=u-1),u++}}catch(j){d.e(j)}finally{d.f()}var b={length_tokens:1+l[1]-l[0],length_paragraphs:1+e[l[1]].paragraph-e[l[0]].paragraph,length_sentences:1+e[l[1]].sentence-e[l[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,field:Object.keys(i).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},G=function(e,t){return e.variable===t.variable&&e.field===t.field&&e.offset===t.offset&&e.length===t.length},Q=function(e,t){if(!e)return null;var n,r=Object(p.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(G(i,t))return i.value}}catch(a){r.e(a)}finally{r.f()}return null},K=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(G(t[n],e))return t[n]=e,t;return t.push(e),t},X=function(e){return null==e?null:Object(g.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(g.jsx)(w.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:B,textAlign:"center"},children:Object(g.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(g.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},J=function(e,t){var n=t.question;if(e.variables){for(var r=0,i=Object.keys(e.variables);r<i.length;r++){var a=i[r];if(n.search("\\[".concat(a,"\\]"))>=0){var o=e.variables[a],l="{{lightyellow###".concat(o,"}}");n=n.replace("[".concat(a,"]"),l)}}return Z(n)}},Z=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(g.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),i=Object(s.a)(r,2),a=i[0],o=i[1];e.push(Object(g.jsx)("mark",{style:{backgroundColor:a},children:o},n+t))}return e}),[])})},$=i.a.memo(F),ee=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=n.top,a=n.height,o=r.top,l=o-i<50;o>i+.9*a&&(e.scrollTop=e.scrollTop+o-(.9*a+i)),l&&(e.scrollTop=e.scrollTop+o-(.1*a+i))},te=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],ne=function(e){var t=e.tokens,n=e.annotations,i=e.currentToken,a=e.setCurrentToken,o=e.tokenSelection,l=e.setTokenSelection,c=e.triggerCodePopup,u=e.editMode,d=e.eventsBlocked,f=Object(r.useState)(null),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(!1),x=Object(s.a)(h,2),O=x[0],m=x[1],y=Object(r.useState)(null),k=Object(s.a)(y,2),w=k[0],S=k[1];return Object(r.useEffect)((function(){d&&(S(!1),m(!1))}),[S,m,d,l]),Object(r.useEffect)((function(){if(t){var e,n=Object(p.a)(t);try{var r=function(){var t=e.value;t.triggerCodePopup=function(e){var n,r;e||(e=[t.index,t.index]),null!==t&&void 0!==t&&null!==(n=t.containerRef)&&void 0!==n&&n.current&&null!==t&&void 0!==t&&null!==(r=t.ref)&&void 0!==r&&r.current&&(t.containerRef.current.style.scrollBehavior="smooth",ee(t.containerRef.current,t.ref.current)),a({i:t.index}),l(e)}};for(n.s();!(e=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}}}),[t,a,l]),Object(r.useEffect)((function(){var e,r;if(j&&w&&null!==t&&void 0!==t&&null!==(e=t[0])&&void 0!==e&&null!==(r=e.containerRef)&&void 0!==r&&r.current){var i,o=oe(t,n,w,j,O,u,a,l);1===j.counter?(t[0].containerRef.current.style.scrollBehavior="smooth",i=150):(t[0].containerRef.current.style.scrollBehavior="auto",i=Math.max(5,100/Math.ceil(j.counter/5))),setTimeout((function(){v({position:o,startposition:j.startposition,ntokens:j.ntokens,counter:j.counter+1})}),i)}}),[t,j,w,O,a,u,n,l]),t&&0!==t.length?d?null:Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(re,{tokenSelection:o,currentToken:i,tokens:t,HoldSpace:O,setMover:v,setHoldSpace:m,setHoldArrow:S,triggerCodePopup:c,editMode:u}),Object(g.jsx)(ie,{tokenSelection:o,tokens:t,setCurrentToken:a,setTokenSelection:l,triggerCodePopup:c,editMode:u})]}):null},re=function(e){var t=e.tokenSelection,n=e.currentToken,i=e.tokens,a=e.HoldSpace,o=e.setMover,l=e.setHoldSpace,c=e.setHoldArrow,s=e.triggerCodePopup;e.editMode;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&a)return l(!1),void(t.length>0&&ae(i,t,s));te.includes(e.key)&&(c(!1),o(null))},d=function(e){if(32!==e.keyCode){if(te.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n.i,startposition:n.i,ntokens:i.length,counter:1}),c(e.key)}}else{if(e.preventDefault(),e.repeat)return;l(!0)}};return Object(g.jsx)(g.Fragment,{})},ie=function(e){var t=e.tokenSelection,n=e.tokens,i=e.setCurrentToken,a=e.setTokenSelection,o=e.triggerCodePopup,l=e.editMode,c=Object(r.useRef)(!1),s=Object(r.useRef)(null),u=Object(r.useRef)(null),d=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",j),window.addEventListener("mousemove",v),window.addEventListener("mouseup",h),window.addEventListener("touchstart",f),window.addEventListener("touchend",b),window.addEventListener("contextmenu",p),function(){window.removeEventListener("mousedown",j),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",h),window.removeEventListener("touchstart",f),window.removeEventListener("touchend",b),window.removeEventListener("contextmenu",p)}}));var f=function(e){u.current={time:new Date,token:ue(n,e)}},b=function(e){var r;if(null!==(r=u.current)&&void 0!==r&&r.time&&!(new Date-u.current.time>150)){var c=u.current.token;if(null===(null===c||void 0===c?void 0:c.index))return fe(n,s.current),s.current=null,void a((function(e){return 0===e.length?e:[]}));if(l)ae(n,[c.index,c.index],o);else{if(t.length>0&&t[0]===s.current){var d=x(c);return a((function(e){return he(e,n,d,!0)})),null!==c&&void 0!==c&&c.annotated&&d===t[0]?ae(n,[d,d],o):ae(n,[t[0],d],o),fe(n,s.current),s.current=null,void i({i:null})}s.current!==c.index?(fe(n,s.current),de(n,c.index),s.current=c.index,i({i:c.index}),a((function(e){return 0===e.length?e:[]}))):(fe(s.current),a((function(e){return he(e,n,c.index,!0)})))}}},j=function(e){d.current||1===e.which&&(c.current=!0,a((function(e){return 0===e.length?e:[]})))},v=function(e){if(!d.current)if(!l&&c.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),x(ue(n,e))}else{var t=ue(n,e);null!==t.index?(i((function(e){return e.i===t.index?e:{i:t.index}})),a((function(e){return he(e,n,t.index,!1)}))):i((function(e){return e.i===t.index||null===t.index?e:{i:t.index}}))}},h=function(e){if(!d.current){if(1!==e.which&&0!==e.which)return null;e.preventDefault(),e.stopPropagation();var r=x(ue(n,e));window.getSelection().empty(),c.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?ae(n,t,o):null!==r&&ae(n,[r,r],o)}},p=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},x=function(e){return i((function(t){return t.i===e.index?t:{i:e.index}})),a((function(t){return he(t,n,e.index,!0)})),e.index};return Object(g.jsx)(g.Fragment,{})},ae=function(e,t,n){var r=Object(s.a)(t,2),i=r[0],a=r[1];if(i>a){var o=[a,i];i=o[0],a=o[1]}n(e[a].index,[e[i].index,e[a].index])},oe=function(e,t,n,r,i,a,o,l){var c;if(c=a?ce(e,t,n,r):le(e,n,i,r),r.position!==c){o((function(e){return{i:e===c?e:c}})),l((function(t){return he(t,e,c,!a&&i)}));var s=e[c].containerRef.current,u=e[c].ref.current;ee(s,u)}return c},le=function(e,t,n,r){var i,a=r.position;if("ArrowRight"===t&&a++,"ArrowLeft"===t&&a--,"ArrowUp"===t&&(a=se(e,r,"up")),"ArrowDown"===t&&(a=se(e,r,"down")),a>r.ntokens&&(a=r.ntokens),a<0&&(a=0),null==(null===(i=e[a])||void 0===i?void 0:i.ref)){if("ArrowLeft"===t||"ArrowUp"===t){var o=e.findIndex((function(e){return e.codingUnit}));if(o<0)return r.position;a=o}if("ArrowRight"===t||"ArrowDown"===t){var l=e.map((function(e){return e.codingUnit})).lastIndexOf(!0);if(l<0)return r.position;a=l-1}}if(n&&e[r.position].field!==e[a].field)if(a>r.position){for(var c=a;c>=r.position;c--)if(e[c].field===e[r.position].field){a=c;break}}else for(var s=a;s<=r.position;s++)if(e[s].field===e[r.position].field){a=s;break}return a},ce=function(e,t,n,r){var i=r.position;if("ArrowRight"===n||"ArrowDown"===n){var a=e.findIndex((function(e,t){var n,r,a;return t>i&&(null===e||void 0===e||null===(n=e.ref)||void 0===n?void 0:n.current.classList.contains("annotated"))&&((null===e||void 0===e||null===(r=e.ref)||void 0===r?void 0:r.current.classList.contains("allLeft"))||(null===e||void 0===e||null===(a=e.ref)||void 0===a?void 0:a.current.classList.contains("anyLeft")))}));if(a<0)return r.position;i=a}if("ArrowLeft"===n||"ArrowUp"===n){for(var o=-1,l=i-1;l>=-1;l--){var c,s,u,d,f,b;if(null===(c=e[l])||void 0===c||null===(s=c.ref)||void 0===s?void 0:s.current.classList.contains("annotated")){var j=null===(u=e[l])||void 0===u||null===(d=u.ref)||void 0===d?void 0:d.current.classList.contains("allLeft"),v=null===(f=e[l])||void 0===f||null===(b=f.ref)||void 0===b?void 0:b.current.classList.contains("anyLeft");if(j||v){o=l;break}}}if(o<0)return r.position;i=o}return i},se=function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var a=e.findIndex((function(e){return e.codingUnit}));return a<0?0:a}return"up"===i?L(e,t.position,t.startposition):"down"===i?T(e,t.position,t.startposition):void 0},ue=function(e,t){var n=be(e,t),r=Object(s.a)(n,2),i=r[0],a=r[1];return null===i?{index:null,annotated:!1}:{index:je(e,i),annotated:a}},de=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.add("tapped")},fe=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.remove("tapped")},be=function(e,t){try{var n,r,i;if("mousemove"!==t.type&&"mouseup"!==t.type||(i=t.originalTarget||t.path[0]),"touchmove"===t.type||"touchstart"===t.type){var a=t.touches[0];i=document.elementFromPoint(a.clientX,a.clientY)}if("item"===(null===(n=i)||void 0===n||null===(r=n.parentNode)||void 0===r?void 0:r.className))return[null,!1];if(i){if(i.className.includes("token"))return[i,!1];if(i.parentNode&&i.parentNode.className.includes("token"))return[i.parentNode,!0]}return[null,!1]}catch(t){return[null,!1]}},je=function(e,t){return parseInt(t.getAttribute("tokenindex"))},ve=function(e,t){return t.length>0&&e[0]===t[0]&&e[1]===t[1]?e:t},he=function(e,t,n,r){if(null===n)return e;var i=Object(E.a)(e);if(!r||0===i.length)return ve(e,[n,n]);if(null===n)return ve(e,[i[0],null]);if(t[i[0]].field===t[n].field)i=[i[0],n];else if(n>i[0])for(var a=n;a>=i[0];a--)t[i[0]].field===t[a].field&&(i=[i[0],a]);else for(var o=n;o<=i[0];o++)t[i[0]].field===t[o].field&&(i=[i[0],o]);return ve(e,i)},pe=n(253),xe=n(240),Oe=function(e,t){if(t[e]){var n,r=t[e].foldToParent;return r&&t[r]&&(n=t[r].color),n=t[e].color,me(n)+"50"}return"EMPTY"===e?"lightgrey":"#ffffff50"},ge=function(e){if(0===e.length)return"white";if(1===e.length)return e[0];var t=Math.floor(100/e.length),n=e.reduce((function(n,r,i){return 0===i&&n.push(r+" ".concat(t,"%")),i===e.length-1&&n.push(r+" ".concat(100-t,"%")),i>0&&i<e.length-1&&(n.push(r+" ".concat(t*i,"%")),n.push(r+" ".concat(t*(i+1),"%"))),n}),[]);return"linear-gradient(to bottom, ".concat(n.join(", "),")")},me=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},ye=function(e,t,n,r){for(var i=0;i<e.length;i++){var a,o=e[i];if(null!==(a=o.ref)&&void 0!==a&&a.current){var l=ke(null===t||void 0===t?void 0:t[o.index],n);l&&0!==Object.keys(l).length?(we(o,l,n),r&&(o.ref.current.style.cursor="pointer")):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),o.ref.current.style.cursor="default",Se(o,null,null,null))}}},ke=function(e,t){if(!e)return null;if(e&&t){e=Object(u.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],a=e[i].variable;if(t[a]){var o=t[a].codeMap,l=e[i].value;o[l]&&o[l].active&&o[l].activeParent||"EMPTY"===!l&&delete e[i]}else delete e[i]}}return e},we=function(e,t,n){for(var r=0,i=0,a={pre:[],text:[],post:[]},o=Object.keys(t).length,l=0,c=Object.keys(t);l<c.length;l++){var s=t[c[l]],u=n[s.variable].codeMap,d=Oe(s.value,u);a.text.push(d),s.span[0]===s.index?r++:a.pre.push(d),s.span[1]===s.index?i++:a.post.push(d)}var f=r===o,b=i===o,j=r>0,v=i>0,h=e.ref.current.classList;h.add("annotated"),f?h.add("allLeft"):h.remove("allLeft"),j&!f?h.add("anyLeft"):h.remove("anyLeft"),b?h.add("allRight"):h.remove("allRight"),v&!b?h.add("anyRight"):h.remove("anyRight");var p=ge(a.text),x=f?"white":ge(a.pre),O=b?"white":ge(a.post);Se(e,x,p,O)},Se=function(e,t,n,r){var i=e.ref.current.children;i[0].style.background=t,i[1].style.background=n,i[2].style.background=r},Ce=function(e,t){var n,r=Object(p.a)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value;if(null!==(i=a.ref)&&void 0!==i&&i.current)if(a.ref.current.classList.remove("tapped"),0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(s.a)(t,2),l=o[0],c=o[1];if(l>c){var u=[l,c];c=u[0],l=u[1]}var d=a.arrayIndex>=l&&a.arrayIndex<=c,f=a.ref.current.classList;if(d&&a.codingUnit){var b=l===a.arrayIndex,j=c===a.arrayIndex;f.add("selected"),b?f.add("start"):f.remove("start"),j?f.add("end"):f.remove("end")}else f.remove("selected")}else a.ref.current.classList.remove("selected")}}catch(v){r.e(v)}finally{r.f()}},_e=i.a.memo((function(e){var t,n=e.tokens,i=e.currentToken,a=e.setCurrentToken,o=e.annotations,l=e.variableMap,c=e.fullScreenNode,u=e.onlyFirst,d=Object(r.useState)(null),f=Object(s.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)(0),h=Object(s.a)(v,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){var e;if(null===n||void 0===n||null===(e=n[i.i])||void 0===e||!e.ref||null===o||void 0===o||!o[n[i.i].index]||!l)return j(null),x(0),null;var t=o[n[i.i].index],r=Object.keys(t).reduce((function(e,n,r){var o=t[n].variable,c=t[n].value;if(u&&i.i!==t[n].span[0])return e;if(!l[o])return e;var s=l[o].codeMap;return s[c]?(e.push(Object(g.jsxs)(pe.a.Item,{style:{backgroundColor:Oe(c,s),padding:"0.3em"},onMouseOver:function(){return a({i:null})},children:[Object(g.jsx)("b",{children:o}),": "+c]},r)),e):e}),[]);j(Object(g.jsx)(pe.a,{children:r})),x(0)}),[n,i,a,o,u,l,x]),Object(r.useEffect)((function(){if(b){var e=setTimeout((function(){x(p+1)}),200);return function(){return clearTimeout(e)}}}),[p,b]),Object(g.jsx)(xe.a,{mountNode:c||void 0,context:null===n||void 0===n||null===(t=n[i.i])||void 0===t?void 0:t.ref,basic:!0,hoverable:!1,position:"top left",open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:b})})),Ee=function(e){var t=e.tokens,n=e.variableMap,i=e.annotations,a=e.disableAnnotations,o=e.editMode,l=e.triggerCodeSelector,c=e.eventsBlocked,u=e.fullScreenNode,d=Object(r.useState)({i:null}),f=Object(s.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)([]),h=Object(s.a)(v,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){if(!n)return null;ye(t,i,n,o)}),[t,i,n,o]),Object(r.useEffect)((function(){Ce(t,p)}),[t,p]),Object(r.useEffect)((function(){j({i:null}),x([])}),[t]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(_e,{tokens:t,currentToken:b,setCurrentToken:j,annotations:i,variableMap:n,fullScreenNode:u,onlyFirst:!1}),a?null:Object(g.jsx)(ne,{tokens:t,annotations:i,currentToken:b,setCurrentToken:j,tokenSelection:p,setTokenSelection:x,triggerCodePopup:l,editMode:o,eventsBlocked:c})]})},Ae=n(245),Re=function(e){return Date.parse(e)?e.replace("T"," "):e},Le=function(e){var t=e.meta_fields.filter((function(e){return e.visible})),n=function(e){var t={borderTop:"none"};return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),t};return 0===t.length?null:Object(g.jsx)(Ae.a,{basic:"very",compact:!0,style:{lineHeight:"0.8",padding:"10px",paddingLeft:"10px",border:"1px solid grey",boxShadow:"5px 3px 3px #e0f2ff",background:"#e1f2ff",color:"black"},children:t.map((function(e){return Object(g.jsxs)(Ae.a.Row,{style:{fontSize:"".concat(null!=e.size?e.size:1,"em")},children:[Object(g.jsx)(Ae.a.Cell,{width:1,style:{borderTop:"none"},children:Object(g.jsx)("b",{children:e.label||e.name})}),Object(g.jsx)(Ae.a.Cell,{style:n(e),children:Re(e.value)})]})}))})},Te=function(e){var t=e.tokens,n=e.text_fields,i=e.meta_fields,a=e.setReady,o=e.maxHeight,l=Object(r.useState)({}),c=Object(s.a)(l,2),u=c[0],d=c[1],f=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));t.some((function(e){return!e.codingUnit}))?null!==n&&void 0!==n&&null!==(e=n.ref)&&void 0!==e&&e.current&&f.current&&function(e,t,n){var r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),a=r.top,o=r.height,l=i.top,c=o/(1/n);e.scrollTop=e.scrollTop+l-(c+a)}(f.current,n.ref.current,1/3):f.current.scrollTop=0})),Object(r.useEffect)((function(){if(!t)return null;d(Ne(t,n,f)),a&&a((function(e){return e+1}))}),[t,n,a]),null===t?null:Object(g.jsx)(A.a,{innerRef:f,children:Object(g.jsx)("div",{style:{flex:"1",display:"flex",alignItems:null,overflow:"auto",maxHeight:o},children:Object(g.jsxs)("div",{className:"TokensContainer",style:{flex:"1 97%",width:"100%"},children:[Object(g.jsx)("div",{style:{width:"100%",textAlign:"right",padding:"10px 30px"},children:Object(g.jsx)(Le,{meta_fields:i})},"meta"),Object(g.jsx)("div",{style:{padding:"20px"},children:u.text},"text"),Object(g.jsx)("div",{style:{height:"25px"}},"empty_space")]})},"tokens")})},Ne=function(e,t,n){var r={text:[]};if(0===e.length)return r;for(var a=[],o=[],l=[],c=e[0].codingUnit,s=e[0].field,u=e[0].paragraph,d=e[0].sentence,f=function(e){return t.find((function(t){return t.name===e}))},b=f(s),j=0;j<e.length;j++)e[j].arrayIndex=j,e[j].sentence!==d&&(l.length>0&&o.push(He(j,d,l)),l=[]),e[j].paragraph!==u&&(o.length>0&&a.push(Me(f(s),u,o,e[j].paragraph!==u)),o=[]),e[j].field!==s&&(a.length>0&&r.text.push(Ie(f(s),j+"_"+s,a,s)),a=[]),u=e[j].paragraph,d=e[j].sentence,s=e[j].field,c=e[j].codingUnit,e[j].containerRef=n,c&&(e[j].ref=i.a.createRef()),l.push(Pe(e[j],c));return b=f(s),l.length>0&&o.push(He("last",d,l)),o.length>0&&a.push(Me(b,u,o,!1)),a.length>0&&r.text.push(Ie(b,"last_"+s,a,s)),r},Ie=function(e,t,n,r){return Object(g.jsx)("span",{className:"field",children:function(n){return e?Object(g.jsxs)(g.Fragment,{children:[e.label?Object(g.jsx)("span",{style:{color:"grey",fontWeight:"bold",textAlign:"center"},children:e.label},r+t+"label"):null,Object(g.jsx)("span",{className:"noselect",style:{fontSize:"".concat(null!=e.size?e.size:1,"em"),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:null==e.justify||e.justify?"justify":"left"},children:n},r+t)]}):n}(n)},"field"+r)},Me=function(e,t,n,r){return null==(null===e||void 0===e?void 0:e.paragraphs)||null!==e&&void 0!==e&&e.paragraphs?Object(g.jsx)("div",{style:{display:"flex"},children:Object(g.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)},"pardiv"+t):Object(g.jsx)("span",{children:Object(g.jsx)("span",{children:n})},"par"+t)},He=function(e,t,n){return Object(g.jsx)("span",{className:"sentence",children:n},e+"_"+t)},Pe=function(e,t){return Object(g.jsxs)("span",{ref:e.ref,className:t?"token codingUnit":"token",tokenindex:e.arrayIndex,children:[Object(g.jsx)("span",{className:"pre",children:e.pre},"pre"+e.index),Object(g.jsx)("span",{className:"text",children:e.text},"text"+e.index),Object(g.jsx)("span",{className:"post",children:e.post},"post"+e.index)]},"token"+e.index)},ze=i.a.memo(Te),De=n(46),Be=function(e){return e.variable+"|"+e.value},Fe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(u.a)({},n);var r,i=qe(e),a={},o=[],l=Object(p.a)(t);try{for(l.s();!(r=l.n()).done;){var c=r.value;We(c,i,a,o)}}catch(S){l.e(S)}finally{l.f()}for(var s={},d=[],f=0,b=o;f<b.length;f++){var j=b[f];s[j.id]||(s[j.id]=0),s[j.id]++,d.push(j)}for(var v=[],h=0,x=d;h<x.length;h++)for(var O=x[h],g=O.span[0];g<=O.span[1];g++){var m=Object(u.a)({},O);m.index=g,v.push(m)}for(var y=0,k=d;y<k.length;y++){var w=k[y];n=Ue(n,w,!1,!1)}return n},Ue=function(e,t,n,r){for(var i=Be(t),a=t.span[0];a<=t.span[1];a++)e[a]&&e[a][i]&&function(){for(var t=e[a][i],n=t.span,o=n[0];o<=n[1];o++)e[o]&&e[o][i]&&(r&&1===Object.values(e[o]).filter((function(e){return e.variable===t.variable})).length&&(e[o][Be(Object(u.a)(Object(u.a)({},t),{},{value:"EMPTY"}))]=Object(u.a)(Object(u.a)({},e[o][i]),{},{value:"EMPTY"})),delete e[o][i],0===Object.keys(e[o]).length&&delete e[o])}(),n||(e[a]||(e[a]={}),delete e[a][Be(Object(u.a)(Object(u.a)({},t),{},{value:"EMPTY"}))],e[a][i]={index:a,variable:t.variable,span:[t.span[0],t.span[1]],length:t.length,value:t.value,field:t.field,offset:t.offset});return e},qe=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.field]||(e[t.field]={}),e[t.field][t.offset]||(e[t.field][t.offset]={start:[],end:[]}),e[t.field][t.offset+t.length-1]||(e[t.field][t.offset+t.length-1]={start:[],end:[]}),e[t.field][t.offset].start.push(t),e[t.field][t.offset+t.length-1].end.push(Be(t)),e}),{}):{}},We=function(e,t,n,r){var i=e.offset,a=e.offset+e.length-1;if(t[e.field])for(var o=t[e.field],l=i;l<=a;l++)if(o[l]){var c,s=Object(p.a)(o[l].start);try{for(s.s();!(c=s.n()).done;){var d=c.value,f=Be(d);n[f]=Object(u.a)(Object(u.a)({},e),{},{id:f,variable:d.variable,value:d.value,offset:d.offset,length:null,span:[e.index]})}}catch(h){s.e(h)}finally{s.f()}var b,j=Object(p.a)(o[l].end);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v]&&(n[v].span.push(e.index),n[v].length=e.offset+e.length-n[v].offset,r.push(n[v]),delete n[v])}}catch(h){j.e(h)}finally{j.f()}}},Ve=n(145),Ye=n.n(Ve),Ge=function(e){for(var t=function(e){return console.log(e),e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.required_for&&(e.required_for=[]),"object"!==typeof e.required_for&&(e.required_for=[e.required_for]),null==e.color&&(e.color=Ye()({seed:e.code,luminosity:"light"})),e}))}(e),n=t.reduce((function(e,t){return e[t.code]=Object(u.a)(Object(u.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];""===n[a].parent||n[n[a].parent]||(n[n[a].parent]={code:n[a].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var o=0,l=Object.keys(n);o<l.length;o++){var c=l[o],d=Ke(n,c),f=Object(s.a)(d,3);n[c].tree=f[0],n[c].activeParent=f[1],n[c].foldToParent=f[2],n[c].parent&&n[n[c].parent].children.push(c);var b,j=Object(p.a)(n[c].tree);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v].totalChildren++,n[c].active&&n[c].activeParent&&n[v].totalActiveChildren++}}catch(h){j.e(h)}finally{j.f()}}return n},Qe=function e(t,n,r,i,a){var o,l=Object(p.a)(n);try{for(l.s();!(o=l.n()).done;){var c=o.value,s=Object(E.a)(i);s.push(c),r.push(Object(u.a)(Object(u.a)({},t[c]),{},{code:c,codeTrail:i,level:i.length,color:t[c].color?t[c].color:Ye()({seed:c,luminosity:"light"})})),t[c].children&&e(t,t[c].children,r,s,a)}}catch(d){l.e(d)}finally{l.f()}},Ke=function(e,t){for(var n=[],r=!0,i="",a=e[t].parent;a;)n.push(a),null!=e[a].folded&&e[a].folded&&(i=a,null==e[a].active||e[a].active||(r=!1)),a=e[a].parent;return[n.reverse(),r,i]},Xe=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Je=function(e){var t=e.id,n=e.active,a=e.options,o=e.onSelect,l=Object(r.useState)(0),c=Object(s.a)(l,2),u=c[0],d=c[1],f=Object(r.useState)([]),b=Object(s.a)(f,2),j=b[0],h=b[1],x=Object(r.useRef)({});Object(r.useEffect)((function(){var e,t=[].concat(Object(E.a)(a),[{cancel:!0,label:"CLOSE",color:"grey",value:"CANCEL",textColor:"white"}]),n=Object(p.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.ref=i.a.createRef()}}catch(r){n.e(r)}finally{n.f()}h(t)}),[a,h]);var m=i.a.useCallback((function(e){var t=j.length;if(Xe.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(T(j,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(L(j,u)));if(32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=j[u].value;o(n,e.ctrlKey)}}),[u,j,o]);Object(r.useEffect)((function(){return n?window.addEventListener("keydown",m):window.removeEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[n,m]);var y=function(e,t){var n=e.value.delete?"#682c2c":"black",r=e.value.delete?e.value:"white",i=e.color.slice(0,7),a=e.value.delete?"darkred":"black",l=e.color;return Object(g.jsx)(A.a,{innerRef:e.ref,children:Object(g.jsxs)(O.a,{style:{flex:"1 1 auto",padding:"4px 2px",background:l,color:n,border:"3px solid",borderColor:t===u?a:"white",margin:"1px"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){return o(t.value,e.ctrlKey)},children:[e.tag?Object(g.jsx)("span",{style:{display:"inline-block",float:"left",background:r,color:"black",borderRadius:"0px",border:"2px solid ".concat(i),padding:"2px",margin:"-4px 4px -4px -2px"},children:"".concat(e.tag," ")}):null,Object(g.jsx)("span",{children:e.label})]},e.label+"_"+t)})};return Object(g.jsx)("div",{children:function(){var e,n,r=0,i=[],a=[],o=Object(p.a)(j);try{for(o.s();!(n=o.n()).done;){var l=n.value;x.current[l.value]||("CANCEL"===l.value?e=y(l,r):l.value.delete?a.push(y(l,r)):i.push(y(l,r)),r++)}}catch(c){o.e(c)}finally{o.f()}return Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"10px"},children:i},t+"_1"),a.length>0?Object(g.jsxs)("b",{children:[Object(g.jsx)(v.a,{name:"trash alternate"})," Delete codes"]}):null,Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:a},t+"_2"),Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:e},t+"_3")]},t+"_buttons")}()},t)},Ze=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],$e=i.a.memo((function(e){e.variable;var t=e.children,n=e.fullScreenNode,r=e.open,i=e.setOpen,a=e.tokenRef,o="5px",l="top left",c="100vh";if(null!==a&&void 0!==a&&a.current){var s=a.current.getBoundingClientRect(),u=s.top/window.innerHeight,d=(window.innerHeight-s.bottom)/window.innerHeight;u>d?(l="top",c="calc(".concat(100*u,"vh - ").concat(o,")")):(l="bottom",c="calc(".concat(100*d,"vh - ").concat(o,")"));var f=s.left/window.innerWidth;l=(window.innerWidth-s.right)/window.innerWidth>f?l+" left":l+" right"}var b=!1;return Object(g.jsx)(xe.a,{mountNode:n||void 0,context:a,basic:!0,wide:!0,position:l,hoverable:!0,open:r,mouseLeaveDelay:1e7,onClose:function(e,t){b&&i(!1),b=!0},style:{margin:o,padding:"0px",background:"#dfeffb",border:"1px solid #136bae",minWidth:"15em",maxHeight:c,overflow:"auto"},children:Object(g.jsx)("div",{style:{margin:"5px",border:"0px"},children:t})})})),et=function(e){var t=e.variable,n=e.setVariable,i=e.annotations,a=e.span,o=e.setOpen,l=e.variableMap,c=function(){for(var e=Object.keys(l),t={},n=0,r=e;n<r.length;n++){for(var o=r[n],c={},s=a[0];s<=a[1];s++)if(i[s])for(var u=0,d=Object.keys(i[s]);u<d.length;u++){var f,b=d[u],j=i[s][b];j.variable===o&&(c[j.value]=Oe(j.value,null===l||void 0===l||null===(f=l[o])||void 0===f?void 0:f.codeMap))}t[o]=ge(Object.values(c))}return e.map((function(e){return{color:t[e],label:e,value:e}}))}();return Object(r.useEffect)((function(){1===c.length&&n(c[0].value)}),[c,n]),t||!a?null:Object(g.jsxs)("div",{children:[Object(g.jsx)(xe.a.Header,{style:{textAlign:"center"},children:"Select variable"}),Object(g.jsx)(Je,{id:"currentCodePageButtons",active:!0,options:c,setOpen:o,onSelect:function(e,t){"CANCEL"!==e?n(e):o(!1)}})]})},tt=function(e){var t=e.tokens,n=e.variable,r=e.setVariable,i=e.annotations,a=e.span,o=e.setSpan,l=e.setOpen,c=e.variableMap,s=function(e,t){"CANCEL"!==e?(o(e.span),r(e.variable)):l(!1)};if(n||!a)return null;var d=function(){for(var e={},n=a[0];n<=a[1];n++)if(i[n])for(var r=0,o=Object.keys(i[n]);r<o.length;r++){var l,s=o[r],d=i[n][s],f=null===c||void 0===c||null===(l=c[d.variable])||void 0===l?void 0:l.codeMap;if(c[d.variable]&&(null!==f&&void 0!==f&&f[d.value]||"EMPTY"===d.value)){var b=d.span,j=d.variable+":"+b[0]+"-"+b[1],v='"'+rt(t,b)+'"',h=Oe(d.value,f);e[j]?e[j].colors.push(h):e[j]={tag:d.variable,label:v,colors:[h],value:{variable:d.variable,span:d.span}}}}return Object.keys(e).map((function(t){return Object(u.a)(Object(u.a)({},e[t]),{},{color:ge(e[t].colors)})}))}();return 0===d.length&&l(!1),1===d.length&&s(d[0].value),Object(g.jsxs)("div",{children:[Object(g.jsx)(xe.a.Header,{style:{textAlign:"center"},children:"Select annotation"}),Object(g.jsx)(Je,{id:"currentCodePageButtons",active:!0,options:d,setOpen:l,onSelect:s})]})},nt=function(e){var t=e.tokens,n=e.variable,a=e.variableMap,o=e.codeHistory,l=e.settings,c=e.annotations,d=e.tokenAnnotations,f=e.setAnnotations,b=e.editMode,j=e.span,v=e.setOpen,h=e.setCodeHistory,x=Object(r.useRef)(null),O=Object(r.useState)(!0),m=Object(s.a)(O,2),y=m[0],k=m[1],w=i.a.useCallback((function(e){var t;return l&&!l.searchBox&&"recent"===!l.buttonMode?null:((null===x||void 0===x||null===(t=x.current)||void 0===t?void 0:t.children[0])===document.activeElement||k(!0),27===e.keyCode&&v(!1),Ze.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(x.current&&x.current.click(),void k(!1)))}),[x,v,l]);Object(r.useEffect)((function(){return window.addEventListener("keydown",w),function(){window.removeEventListener("keydown",w)}}));var S=function(e,r){var i;"CANCEL"!==e?(it(t,e,f,o,h,b),null!==a&&void 0!==a&&null!==(i=a[n])&&void 0!==i&&i.multiple||r||v(!1)):v(!1)};if(!n)return null;var C,_=function(){var e,r=function(e){for(var t={},n=j[0];n<=j[1];n++)if(null!==c&&void 0!==c&&c[n])for(var r=0,i=Object.keys(c[n]);r<i.length;r++){var a=i[r],o=c[n][a];o.variable===e&&(t[o.span[0]+"_"+a]=Object(u.a)({id:a},c[n][a]))}return Object.keys(t).length>0?Object.values(t):[]}(n),i=[],s=[],f=null===a||void 0===a||null===(e=a[n])||void 0===e?void 0:e.codeMap;!function(e,t){var r=Object.keys(e);if(1!==r.length)return null;var i=r[0],a=t.filter((function(e){return"EMPTY"!==e.value}));0===a.length&&(setTimeout((function(){return S({variable:n,span:j,value:i,delete:!1})}),0),v(!1)),b&&1===a.length&&i===a[0].value&&(setTimeout((function(){return S({variable:n,span:j,value:i,delete:!0})}),0),v(!1))}(f,r);for(var h=0,x=Object.keys(f);h<x.length;h++){var O=x[h];if(!(null===j||j[0]===j[1])||!d[O]){l&&"all"===l.buttonMode&&i.push({key:O,label:O,value:{variable:n,value:O,span:j,delete:!1},color:Oe(O,f)});var m=f[O].tree.join(" - ");s.push({key:O,value:{variable:n,value:O,span:j,delete:!1},text:O+" test"+m,content:Object(g.jsxs)(g.Fragment,{children:[O,Object(g.jsx)("br",{}),Object(g.jsx)("span",{style:{color:"grey"},children:m})]})})}}if(!l||"recent"===l.buttonMode){var y,k=9,w=Object(p.a)(o);try{for(w.s();!(y=w.n()).done;){var C=y.value;if(k<0)break;f[C]&&(i.push({key:C,label:C,value:{variable:n,value:C,span:j,delete:!1},color:Oe(C,f)}),k--)}}catch(R){w.e(R)}finally{w.f()}}if(r&&r.length>0){var _,E=Object(p.a)(r);try{for(E.s();!(_=E.n()).done;){var A=_.value;f[A.value]&&i.push({tag:A.value,label:'"'+rt(t,A.span)+'"',color:Oe(A.value,f),value:Object(u.a)(Object(u.a)({},A),{},{delete:!0}),textColor:"darkred"})}}catch(R){E.e(R)}finally{E.f()}}return[i,s]}(),E=Object(s.a)(_,2),L=E[0],T=E[1];return Object(g.jsxs)(g.Fragment,{children:[(C=T,0===C.length?null:l&&!l.searchBox&&"recent"!==l.buttonMode?Object(g.jsx)("div",{style:{height:"25px"}}):Object(g.jsx)(A.a,{innerRef:x,children:Object(g.jsx)(R.a,{fluid:!0,placeholder:"<type to search>",style:{textAlign:"center",color:"black",width:"100%",height:"20px",marginBottom:"5px",overflow:"visible",position:"relative"},options:C,open:!y,search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return k(!1)},onSearchChange:function(e,t){""===t.searchQuery&&k(!0)},onClose:function(){return k(!0)},onChange:function(e,t){S(t.value,e.ctrlKey)}})})),function(e){return Object(g.jsxs)(g.Fragment,{children:["recent"===l.buttonMode&&o.length>0?Object(g.jsx)("b",{children:"Recent codes"}):null,Object(g.jsx)(Je,{id:"newCodePageButtons",active:y,setAnnotations:f,options:e,setOpen:v,onSelect:S})]})}(L)]})},rt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=e.slice(t[0],t[1]+1).map((function(e){return e.pre+e.text+e.post}));return r.length>n&&(r=[r.slice(0,Math.floor(n/2)).join("")," ... ",r.slice(-Math.floor(n/2)).join("")]),r.join("")},it=function(e,t,n,r,i,a){var o=Object(s.a)(t.span,2),l=o[0],c=o[1];t.index=e[l].index,t.length=e[c].length+e[c].offset-e[l].offset,t.span=[e[l].index,e[c].index],t.field=e[l].field,t.offset=e[l].offset,n((function(e){return Ue(Object(u.a)({},e),t,t.delete,a)})),i((function(e){return Object(u.a)(Object(u.a)({},e),{},Object(De.a)({},t.variable,[t.value].concat(Object(E.a)(r.filter((function(e){return e!==t.value}))))))}))},at=function(e,t,n,a,o,l,c,d){var f=Object(r.useState)(!1),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(null),x=Object(s.a)(h,2),O=x[0],m=x[1],y=Object(r.useState)(null),k=Object(s.a)(y,2),w=k[0],S=k[1],C=Object(r.useState)(null),_=Object(s.a)(C,2),E=_[0],A=_[1],R=Object(r.useState)({}),L=Object(s.a)(R,2),T=L[0],N=L[1],I=Object(r.useState)(!1),M=Object(s.a)(I,2),H=M[0],P=M[1],z=Object(r.useState)(l),D=Object(s.a)(z,2),B=D[0],F=D[1],U=Object(r.useState)(null),q=Object(s.a)(U,2),W=q[0],V=q[1],Y=Object(r.useState)(null),G=Object(s.a)(Y,2),Q=G[0],K=G[1];Object(r.useEffect)((function(){if(!t||0===t.length)return V(null),null;var e,n={},r=Object(p.a)(t);try{var i=function(){var t=e.value,r=Ge(t.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[t.name]=Object(u.a)(Object(u.a)({},t),{},{codeMap:r})};for(r.s();!(e=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}V(n)}),[t,V]),Object(r.useEffect)((function(){var e,t,r;null!==W?(S(null),r=null===n||"EDIT ALL"===n?W:Object(De.a)({},n,W[n]),K(r),P((null===(e=r)||void 0===e||null===(t=e[n])||void 0===t?void 0:t.editMode)||"EDIT ALL"===n)):K(null)}),[W,n,S,K,P]),Object(r.useEffect)((function(){j||c(B)}),[B,j,c]);var X,J=i.a.useCallback((function(t,n){e[t].ref&&(A(e[t].ref),N(a[t]||{}),m(n||[t,t]),v(!0))}),[a,e]);if(Object(r.useEffect)((function(){v(!1)}),[e]),Object(r.useEffect)((function(){j||S(null)}),[j]),!t)return[null,null,null,!0];X=H?Object(g.jsx)(tt,{tokens:e,variable:w,setVariable:S,variableMap:Q,annotations:a,span:O,setSpan:m,setOpen:v}):Object(g.jsx)(et,{variable:w,setVariable:S,variableMap:Q,annotations:a,span:O,setOpen:v});var Z=Object(g.jsx)(nt,{tokens:e,variable:w,variableMap:Q,settings:null===Q||void 0===Q?void 0:Q[w],codeHistory:l[w]||[],annotations:a,tokenAnnotations:T,setAnnotations:o,span:O,editMode:H,setOpen:v,setCodeHistory:F}),$=Object(g.jsxs)($e,{variable:w,fullScreenNode:d,open:j,setOpen:v,tokenRef:E,children:[X,Z]});return Q&&e||($=null),[$,J,Q,j,H]},ot=n(148),lt=n(172);ot.a.extend(lt.a);var ct=function(e){var t,n=[],r=null,i=0,a=0,o=0,l=null,c=null,s=!1,u=Object(p.a)(e);try{for(u.s();!(t=u.n()).done;){var d=t.value;null==d.unit_start&&null==d.context_before||(s=!0)}}catch(S){u.e(S)}finally{u.f()}var f,b=!s,j=!1,v=Object(p.a)(e);try{for(v.s();!(f=v.n()).done;){var h=f.value,x=h.name||"text",O=h.offset||0;c=h.value,null!=h.context_before&&(c=h.context_before+c,h.unit_start=h.context_before.length),null!=h.context_after&&(h.unit_end=c.length,c+=h.context_after),l=ot.a.tokenize(c).paragraphs().json({offset:!0});for(var g=0;g<l.length;g++){for(var m=0;m<l[g].sentences.length;m++){for(var y=0;y<l[g].sentences[m].length;y++)for(var k=0;k<l[g].sentences[m][y].terms.length;k++){r=l[g].sentences[m][y].terms[k],null!=h.unit_start&&r.offset.start+O>=h.unit_start&&(b=!0),null!=h.unit_end&&r.offset.start+O>h.unit_end&&(j=!0);var w={field:x,offset:r.offset.start+O,length:r.offset.length,paragraph:i,sentence:a,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:b&!j};n.push(w),o++}a++}i++}}}catch(S){v.e(S)}finally{v.f()}return n},st=function(e){for(var t=0,n=(e=dt(e))[0].paragraph,r=0,i=e[0].sentence,a=0,o=0,l=0;l<e.length;l++){var c;if(null==e[l].text){if(null==e[l].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[l].text=e[l].token}if(null==e[l].offset&&null!=e[l].start&&(e[l].offset=e[l].start),null==e[l].length&&(e[l].length=e[l].text.length),null==e[l].pre&&(e[l].pre=""),null==e[l].post&&null!=e[l].space&&(e[l].post=e[l].space),null==e[l].post&&(null!=e[l].offset&&null!=e[l].length?e[l].post=l<e[l].length-1?" ".repeat(Math.max(0,e[l+1].offset-e[l].offset-e[l].length)):"":e[l].post=" "),o=e[l].length+e[l].post.length,l<e.length-1&&(o+=(null===(c=e[l+1].pre)||void 0===c?void 0:c.length)||0),null==e[l].offset&&(e[l].offset=a,a+=o),l<e.length-1&&(!e[l].field||e[l].field===e[l+1].field)&&(null==e[l+1].offset&&null!=e[l+1].start&&(e[l+1].offset=e[l+1].start),e[l+1].offset&&e[l+1].offset<e[l].offset+o))return alert('Invalid token position data. The length of "'.concat(e[l].pre+e[l].text+e[l].post,'" on position ').concat(e[l].offset," exeeds the offset/start position of the next token")),null;null==e[l].sentence?(e[l].sentence=r,(e[l].text.includes("\n")||e[l].post.includes("\n"))&&r++):(e[l].paragraph===n&&e[l].sentence===i||(i=e[l].sentence,r++),e[l].sentence=r),null==e[l].paragraph?(e[l].paragraph=t,(e[l].text.includes("\n")||e[l].post.includes("\n"))&&t++):(e[l].paragraph!==n&&(n=e[l].paragraph,t++),e[l].paragraph=t),null==e[l].field&&(e[l].field="text"),e[l].index=l}return e},ut=function(e,t){if(0===e.length)return[];for(var n=[],r={},i=e[0].field,a=0;a<e.length;a++)if(e[a].annotations){var o,l={},c=Object(p.a)(e[a].annotations);try{for(c.s();!(o=c.n()).done;){var s=o.value;if(""!==s.value){t[s.name]||(t[s.name]=new Set),t[s.name].add(s.value),l[s.name]=s.value;var u=a>0?e[a-1].post:"";null==r[s.name]&&(r[s.name]={index:a,variable:s.name,value:s.value,offset:e[a].offset,text:e[a].text,field:e[a].field,length:e[a].length}),r[s.name].value===s.value&&(r[s.name].length=e[a].offset+e[a].length-r[s.name].offset,r[s.name].text+=u+e[a].pre+e[a].post)}}}catch(w){c.e(w)}finally{c.f()}for(var d=0,f=Object.keys(r);d<f.length;d++){var b=f[d];null!=l[b]?l[b]!==r[b].value&&(n.push(r[b]),r[b]={index:a,variable:b,value:l[b],offset:e[a].offset,text:e[a].text,field:e[a].field,length:e[a].length}):(n.push(r[b]),delete r[b])}if(a<e.length-1&&e[a+1].field!==i){for(var j=0,v=Object.values(r);j<v.length;j++){var h=v[j];n.push(h)}r={},i=e[a].field}else;}else{for(var x=0,O=Object.values(r);x<O.length;x++){var g=O[x];n.push(g)}r={}}for(var m=0,y=Object.values(r);m<y.length;m++){var k=y[m];n.push(k)}return n},dt=function(e){if(Array.isArray(e))return e;for(var t=Object.keys(e),n=e[t[0]].length,r=[],i=function(n){var i=t.reduce((function(t,r){return t[r]=e[r][n],t}),{});r.push(i)},a=0;a<n;a++)i(a);return r},ft=function(e,t){var n,r={},i=Object(p.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.variable]||(r[a.variable]=new Set),r[a.variable].add(a.value)}}catch(s){i.e(s)}finally{i.f()}for(var o=0,l=Object.keys(r);o<l.length;o++){var c=l[o];r[c]=Object(E.a)(r[c])}t(r)},bt=function(e,t,n,i){var a=Object(r.useState)({}),o=Object(s.a)(a,2),l=o[0],c=o[1],d=Object(r.useState)(),f=Object(s.a)(d,2),b=f[0],j=f[1];return Object(r.useEffect)((function(){if((null===e||void 0===e||!e.text)&&!e.text_fields&&!e.tokens)return null;e.annotations||(e.annotations=[]),e.importedAnnotations&&!e.status&&(e.annotations=e.annotations.concat(e.importedAnnotations)),ft(e.annotations,i);var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(u.a)({},e);n.tokens?(n.importedTokens=!0,n.tokens=st(e.tokens)):(n.importedTokens=!1,!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=ct(Object(E.a)(n.text_fields))),n.meta_fields=e.meta_fields||[],n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=Fe(Object(E.a)(n.annotations),n.tokens):n.annotations={};var r=ut(n.tokens,t);return r.length>0&&(n.annotations=Fe(r,n.tokens,n.annotations)),n}(e);t.current={tokens:r.tokens},c({tokens:r.tokens,text_fields:r.text_fields,meta_fields:r.meta_fields}),j(r.annotations),n&&n(r.tokens)}),[e,n,t,i]),[l,b,j]},jt=function(e){var t=e.variable,n=e.setVariable,i=e.variables,a=e.variableNames,o=e.minHeight;return Object(r.useEffect)((function(){return i?1===i.length?(n(i[0].name),null):void(a.includes(t)||n(a[0])):null}),[i,n,a,t]),Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(O.a.Group,{attached:"bottom",fluid:!0,style:{minHeight:"".concat(o/2,"px")},children:a.map((function(e){return Object(g.jsx)(O.a,{primary:!0,active:e===t,style:{padding:"0",border:"1px solid",color:e===t?"black":"white"},onClick:function(){return n(e)},children:e},e)}))})})},vt=function(e){var t=e.variables,n=e.variable,i=e.setVariable,a=e.minHeight,o=e.editAll,l=Object(r.useMemo)((function(){var e=[];return null!=t&&(null===t||void 0===t?void 0:t.length)>0&&(e=t.map((function(e){return e.name})),o&&e.push("EDIT ALL")),e}),[t,o]),c=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=l.findIndex((function(e){return e===n}))+t;r>l.length-1&&(r=0),r<0&&(r=l.length-1),i(l[r])};Object(r.useEffect)((function(){return window.addEventListener("keydown",c),function(){window.removeEventListener("keydown",c)}})),Object(r.useEffect)((function(){if(null===n&&i(l[0]),!t||0===t.length)return i(null),null}),[n,t,i,l]);var s=null;if(t){var u=t.find((function(e){return e.name===n}));s=null===u||void 0===u?void 0:u.instruction}return"EDIT ALL"===n&&(s="Show and edit all variables"),Object(g.jsxs)("div",{style:{background:"#1277c469",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",borderTop:"2px solid #2185d0",textAlign:"center"},children:[Object(g.jsx)(jt,{variable:n,setVariable:i,variables:t,variableNames:l,minHeight:a}),Object(g.jsx)("p",{style:{margin:"0",padding:"2px",minHeight:"24px"},children:s})]})},ht=(n(198),function(e){var t=e.unit,n=e.variables,i=e.settings,a=e.onChangeAnnotations,o=e.returnTokens,l=e.returnVariableMap,c=e.setReady,d=e.blockEvents,f=e.fullScreenNode,b=Object(r.useRef)(null),j=Object(r.useState)(null),v=Object(s.a)(j,2),h=v[0],p=v[1],x=Object(r.useState)({}),O=Object(s.a)(x,2),m=O[0],y=O[1],k=Object(r.useState)(0),w=Object(s.a)(k,2),S=w[0],C=w[1],_=bt(t,b,o,y),E=Object(s.a)(_,3),A=E[0],R=E[1],L=E[2],T=at(A.tokens,n,h,R,L,m,y,f),N=Object(s.a)(T,5),I=N[0],M=N[1],H=N[2],P=N[3],z=N[4];return Object(r.useEffect)((function(){R&&a&&b.current.tokens===A.tokens&&a(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===Object.keys(e).length?[]:Object.keys(e).reduce((function(r,i){for(var a=e[i],o=0,l=Object.keys(a);o<l.length;o++){var c=l[o];if("unit"===i||a[c].index===a[c].span[0]){var s={variable:a[c].variable,value:a[c].value,field:a[c].field,offset:a[c].offset,length:a[c].length};n&&function(){var e=a[c].span,n=t.slice(e[0],e[1]+1).map((function(t,n){var r=t.text;return n>0&&(r=t.pre+r),n<e[1]-e[0]&&(r+=t.post),r})).join("");s.text=n,s.token_span=e}(),r.push(s)}}return r}),[])}(R,A.tokens,!0))}),[A.tokens,R,a]),Object(r.useEffect)((function(){l&&l(H)}),[H,l]),Object(r.useEffect)((function(){c&&c((function(e){return e+1})),L((function(e){return Object(u.a)({},e)}))}),[S,L,c]),A.tokens?Object(g.jsxs)("div",{style:{display:"flex",height:"100%",maxHeight:"100%",flexDirection:"column"},children:[Object(g.jsx)(ze,{tokens:A.tokens,text_fields:A.text_fields,meta_fields:A.meta_fields,setReady:C,maxHeight:n&&n.length>1?"calc(100% - 60px)":"calc(100% - 30px)",editMode:z}),Object(g.jsx)(vt,{variables:n,variable:h,setVariable:p,editAll:null===i||void 0===i?void 0:i.editAll,minHeight:n&&n.length>1?60:30}),Object(g.jsx)(Ee,{tokens:A.tokens,variableMap:H,annotations:R,disableAnnotations:!a||!H,editMode:z||"EDIT ALL"===h,triggerCodeSelector:M,eventsBlocked:P||d,fullScreenNode:f}),I||null]}):null}),pt=i.a.memo(ht),xt=n(146),Ot=n(243),gt=n(237),mt=n(251),yt={centerVertical:!0},kt=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,l=Object(r.useState)([]),c=Object(s.a)(l,2),d=c[0],f=c[1],b=Object(r.useState)(0),j=Object(s.a)(b,2),v=j[0],h=j[1],p=Object(r.useState)(null),x=Object(s.a)(p,2),O=x[0],m=x[1],y={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},k=Object(r.useState)(0),w=Object(s.a)(k,2),S=w[0],C=w[1],_=Object(mt.a)(["questionTaskSettings"]),E=Object(s.a)(_,2),A=E[0],R=E[1],L=Object(r.useState)(A.questionTaskSettings||{splitHeight:60,textSize:1}),T=Object(s.a)(L,2),N=T[0],I=T[1],M=Object(r.useRef)(null);Object(r.useEffect)((function(){R("questionTaskSettings",JSON.stringify(N),{path:"/"})}),[N,R]),Object(r.useEffect)((function(){null!==n&&void 0!==n&&n.questions&&m(St(n))}),[n]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.backgroundColor="white",y.text.current.style.transition="",y.box.current.style.transition="",y.box.current.style.opacity=0,y.text.current.style.transform="translateX(0%) translateY(0%)"}),[y.text,y.box,t,v]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.transition="opacity 200ms ease-out",y.box.current.style.opacity=1}),[S,y.text,y.box,v]);var H=Object(r.useState)(null),P=Object(s.a)(H,2),z=P[0],D=P[1],B=Object(xt.useSwipeable)(Et(null===O||void 0===O?void 0:O[v],y,D,!1)),F=Object(xt.useSwipeable)(Et(null===O||void 0===O?void 0:O[v],y,D,!0));return t?Object(g.jsxs)("div",{ref:M,style:{height:"100%"},children:[Object(g.jsxs)("div",Object(u.a)(Object(u.a)({},B),{},{style:{position:"relative",border:"1px solid",height:"".concat(N.splitHeight,"%")},children:[Object(g.jsxs)("div",{ref:y.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(g.jsx)("div",{ref:y.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(g.jsx)("div",{ref:y.text,style:{border:"1px solid",height:"100%",width:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(N.textSize,"em")},children:Object(g.jsx)(pt,{unit:t,settings:yt,setReady:C,returnTokens:f,fullScreenNode:o})})]}),Object(g.jsx)(wt,{settings:N,setSettings:I,fullScreenNode:o})]})),Object(g.jsx)("div",Object(u.a)(Object(u.a)({},F),{},{style:{height:"".concat(100-N.splitHeight,"%")},children:Object(g.jsx)($,{unit:t,tokens:d,questions:O,questionIndex:v,setQuestionIndex:h,setUnitIndex:i,swipe:z,blockEvents:a})}))]}):null},wt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(g.jsx)(xe.a,{on:"click",mountNode:r||void 0,trigger:Object(g.jsx)(v.a,{size:"large",name:"setting",style:{position:"absolute",cursor:"pointer",top:"1px",left:"-1px",color:"#1b1c1d",padding:"5px 0px",height:"30px"}}),children:Object(g.jsx)(Ot.a,{children:Object(g.jsxs)(Ot.a.Group,{grouped:!0,children:[Object(g.jsxs)(Ot.a.Field,{children:[Object(g.jsxs)("label",{children:["text window size ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(g.jsx)(gt.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(g.jsxs)(Ot.a.Field,{children:[Object(g.jsxs)("label",{children:["text size scaling ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(g.jsx)(gt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{textSize:t.value})}))}})]})]})})})},St=function(e){return e.questions.map((function(e){var t=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return Qe(e,n,r,[],t),r.map((function(e,t){return Object(u.a)(Object(u.a)({},e),{},{i:t})}))}(Ge(e.codes));t=Ct(Object(E.a)(t));var n=_t(t),r=Object(s.a)(n,2),i=r[0],a=r[1];return Object(u.a)(Object(u.a)({},e),{},{options:i,swipeOptions:a})}))},Ct=function(e){var t,n=e.reduce((function(e,t){if(!t.required_for)return e;if("object"!==typeof t.required_for)e.add(t.required_for);else{var n,r=Object(p.a)(t.required_for);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.add(i)}}catch(a){r.e(a)}finally{r.f()}}return e}),new Set),r=Object(p.a)(e);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=Object(p.a)(n);try{for(o.s();!(i=o.n()).done;){var l=i.value;a.required_for&&(a.required_for===l||a.required_for.includes(l))||a.makes_irrelevant.includes(l)||(a.makes_irrelevant=[].concat(Object(E.a)(a.makes_irrelevant),[l]))}}catch(c){o.e(c)}finally{o.f()}}}catch(c){r.e(c)}finally{r.f()}return e},_t=function(e){var t,n=[],r={},i=Object(p.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.active&&a.activeParent){var o=a.tree.join(" - "),l={code:a.code,tree:o,makes_irrelevant:a.makes_irrelevant,color:a.color};a.swipe&&(r[a.swipe]=l),n.push(l)}}}catch(c){i.e(c)}finally{i.f()}return[n,r]},Et=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var a=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},l=function(e){var n=e.deltaX,i=e.deltaY;if(Math.abs(n)>Math.abs(i)+10&&(i=0),Math.abs(n)<Math.abs(i)+10&&(n=0),!r){var a=t.text.current.getElementsByClassName("TokensContainer")[0];a.scrollHeight-Math.ceil(a.scrollTop)===a.clientHeight||(i=0)}return[n,i]};return Object(u.a)({onSwiping:function(n){var r,i,a=l(n),o=Object(s.a)(a,2),c=o[0],u=o[1];if((!(c>0)||e.swipeOptions.right)&&(!(c<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(c,"px) translateY(").concat(u,"px)");var d,f,b,j,v=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,h=null===(i=e.swipeOptions.up)||void 0===i?void 0:i.code,p="0%",x="center";if(c>0)v=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.color,h=null===(f=e.swipeOptions.right)||void 0===f?void 0:f.code,p="40%",x="left";if(c<0)v=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.color,h=null===(j=e.swipeOptions.left)||void 0===j?void 0:j.code,p="40%",x="right";t.box.current.style.backgroundColor=v,t.code.current.innerText=h,t.code.current.style.bottom=p,t.code.current.style.textAlign=x}},onSwiped:function(r){var o=l(r),c=Object(s.a)(o,2),u=c[0],d=c[1];if((!(u>0)||e.swipeOptions.right)&&(!(u<0)||e.swipeOptions.left)&&(!(d<0)||e.swipeOptions.up)&&!(0!==d&&d>0))if(t.text.current.style.transition="transform ".concat(a,"ms ease-out, opacity ").concat(a,"ms ease-out"),Math.abs(u)<i&&Math.abs(d)<i)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(u>0?100:u<0?-100:0,"%) translateY(").concat(d>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(a,"ms ease-out"),t.box.current.style.opacity=0;n(u>0?"right":"left"),n(null)}}},o)},At=i.a.memo(kt),Rt=n(246),Lt=n(238),Tt=n(144),Nt=[4,4,2,2],It=function(e,t,n){var r,i=[],a=0,o=function(t){if(t){var n=null===e||void 0===e?void 0:e[t[0]];null!==n&&void 0!==n&&n.triggerCodePopup&&n.triggerCodePopup(t)}},l=Object(p.a)(n);try{for(l.s();!(r=l.n()).done;){var c=r.value,s=c.text||"",u=Object(g.jsx)(Mt,{variable:c.variable,variableMap:t,annotation:c,onClick:o,text:s},a);null!==u&&i.push(u),a++}}catch(d){l.e(d)}finally{l.f()}return i},Mt=function(e){var t,n,r=e.variable,i=e.variableMap,a=e.annotation,o=e.onClick,l=e.text;if(null===i||void 0===i||null===(t=i[a.variable])||void 0===t||!t.codeMap)return null;var c=i[r].codeMap;if(null===c||void 0===c||!c[a.value]||!c[a.value].active)return null;var s=Oe(a.value,c),u=null!==(n=c[a.value])&&void 0!==n&&n.foldToParent?"".concat(c[a.value].foldToParent," - ").concat(a.value):a.value,d="".concat(a.offset,"-").concat(a.offset+a.length);return Object(g.jsxs)(Ae.a.Row,{className:"annotations-tr",onClick:function(){return o(a.token_span)},style:{cursor:"pointer"},children:[Object(g.jsx)(Ae.a.Cell,{width:Nt[0],children:Object(g.jsx)("span",{title:r,children:r})}),Object(g.jsx)(Ae.a.Cell,{title:u,width:Nt[1],style:s?{background:s}:null,children:Object(g.jsx)("span",{title:u,children:u})}),Object(g.jsx)(Ae.a.Cell,{title:a.field,width:Nt[2],children:a.field}),Object(g.jsx)(Ae.a.Cell,{title:d,width:Nt[3],children:d}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("span",{title:l,children:l})})]})},Ht=function(e){var t=e.tokens,n=e.variableMap,r=e.annotations;return n&&0!==Object.keys(n).length?Object(g.jsxs)(Ae.a,{style:{fontSize:"10px",maxHeight:"100%",borderRadius:"0px"},fixed:!0,role:"grid","arioa-labelledby":"header",unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(g.jsx)(Ae.a.Header,{className:"annotations-thead",style:{height:"40px"},children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.HeaderCell,{title:"Variable",width:Nt[0],children:"Variable"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Vale",width:Nt[1],children:"Value"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Field",width:Nt[2],children:"Field"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Position",width:Nt[3],children:"Position"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Text",children:"Text"})]})}),Object(g.jsx)(Ae.a.Body,{className:"annotations-tbody",style:{overflow:"auto",height:"calc(100% - 40px)"},children:It(t,n,r)})]}):null},Pt=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,l=zt(t),c=Object(s.a)(l,2),u=c[0],d=c[1],f=Object(r.useState)(null),b=Object(s.a)(f,2),v=b[0],h=b[1],p=Object(mt.a)(["annotateTaskSettings"]),x=Object(s.a)(p,2),m=x[0],y=x[1],k=Object(r.useState)(m.annotateTaskSettings||{textSize:1}),w=Object(s.a)(k,2),S=w[0],C=w[1],_=Object(r.useState)(null),E=Object(s.a)(_,2),A=E[0],R=E[1];return Object(r.useEffect)((function(){y("annotateTaskSettings",JSON.stringify(S),{path:"/"})}),[S,y]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(g.jsxs)(j.a,{centered:!0,stackable:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(g.jsxs)(j.a.Column,{width:10,style:{paddingRight:"0em",paddingTop:"0",height:"100%"},children:[Object(g.jsxs)(O.a.Group,{fluid:!0,style:{padding:"0",height:"40px"},children:[Object(g.jsx)(qt,{settings:S,setSettings:C,fullScreenNode:o}),Object(g.jsx)(Ut,{fullScreenNode:o}),Object(g.jsx)(Ft,{unit:t,annotations:u,setUnitIndex:i})]}),Object(g.jsx)("div",{style:{height:"calc(100% - 20px",fontSize:"".concat(S.textSize,"em")},children:Object(g.jsx)(pt,{unit:t,settings:null===n||void 0===n?void 0:n.settings,variables:null===n||void 0===n?void 0:n.variables,onChangeAnnotations:d,returnTokens:R,returnVariableMap:h,blockEvents:a,fullScreenNode:o})})]}),Object(g.jsx)(j.a.Column,{width:6,style:{paddingRight:"0em",padding:"0",height:"100%",paddingLeft:"10px"},children:Object(g.jsx)("div",{style:{borderBottom:"1px solid",height:"calc(100%)",overflow:"auto"},children:Object(g.jsx)(Ht,{tokens:A,variableMap:v,annotations:u})})})]}):null},zt=function(e){var t=Object(r.useState)([]),n=Object(s.a)(t,2),a=n[0],o=n[1],l=Object(r.useRef)(null);return Object(r.useEffect)((function(){e?(l.current=e.unitId,o(e.annotations||[])):o([])}),[e,o]),[a,i.a.useCallback((function(t){if(e.unitId===l.current){o(t);var n=Bt(t);if(Dt(e.annotations,n)){var r="DONE"===(null===e||void 0===e?void 0:e.status)?"DONE":"IN_PROGRESS";e.jobServer.postAnnotations(e.unitId,n,r)}}}),[e])]},Dt=function(e,t){if(e.length!==t.length)return!0;for(var n=["variable","value","field","offset","length"],r=0;r<e.length;r++){var i,a=Object(p.a)(n);try{for(a.s();!(i=a.n()).done;){var o,l,c=i.value;if((null===(o=e[r])||void 0===o?void 0:o[c])!==(null===(l=t[r])||void 0===l?void 0:l[c]))return!0}}catch(s){a.e(s)}finally{a.f()}}return!1},Bt=function(e){return e.map((function(e){return{variable:e.variable,value:e.value,field:e.field,offset:e.offset,length:e.length,text:e.text}}))},Ft=function(e){var t=e.unit,n=e.annotations,i=e.setUnitIndex,a=Object(r.useState)(!1),o=Object(s.a)(a,2),l=o[0],c=o[1],u=function(){l||(t.jobServer.postAnnotations(t.unitId,Bt(n),"DONE"),c(!0),i((function(e){return e+1})),setTimeout((function(){c(!1)}),1e3))},d=function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),u())};return Object(r.useEffect)((function(){return window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}})),Object(g.jsx)(O.a,{disabled:l,loading:l,primary:!0,size:"tiny",onClick:u,children:"Next Unit"})},Ut=function(e){var t=e.fullScreenNode,n=Object(r.useState)(!1),i=Object(s.a)(n,2),a=i[0],o=i[1];return Object(g.jsxs)(Rt.a,{mountNode:t||void 0,flowing:!0,open:a,onClose:function(){return o(!1)},position:"bottom left",trigger:Object(g.jsx)(O.a,{secondary:!0,size:"tiny",onClick:function(){return o(!a)},children:"Controls"}),children:[Object(g.jsx)(Rt.a.Header,{children:"Controls"}),Object(g.jsx)(Rt.a.Content,{children:Object(g.jsx)(Lt.a,{style:{overflow:"auto",paddingTop:"2em",width:"100%",maxWidth:"700px"},children:Object(g.jsxs)(Ae.a,{structured:!0,compact:!0,basic:"very",unstackable:!0,children:[Object(g.jsx)(Ae.a.Header,{children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.HeaderCell,{width:3}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Keyboard"}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Mouse"}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Touchpad"})]})}),Object(g.jsxs)(Ae.a.Body,{children:[Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Navigate"})}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("i",{children:"Arrow keys"})}),Object(g.jsx)(Ae.a.Cell,{}),Object(g.jsx)(Ae.a.Cell,{})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Select words"})}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"spacebar"}),Object(g.jsx)("br",{}),"Hold to select mutiple"]}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"Left-click"}),Object(g.jsx)("br",{}),"Hold to select multiple"]}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"tab"})," twice to begin, then once to close"]})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Edit/remove code"})}),Object(g.jsx)(Ae.a.Cell,{colSpan:"3",children:"Select annotated words to overwrite or delete the code"})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsxs)("strong",{children:["Select variable",Object(g.jsx)("br",{}),"(if multiple)"]})}),Object(g.jsxs)(Ae.a.Cell,{children:["Next with ",Object(g.jsx)("i",{children:"tab"}),", previous with ",Object(g.jsx)("i",{children:"shift+tab"})]}),Object(g.jsx)(Ae.a.Cell,{colSpan:"2",children:"Use the buttons"})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Next unit"})}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("i",{children:"ctrl+Enter"})}),Object(g.jsx)(Ae.a.Cell,{colSpan:"2",children:"Use the next unit button"})]})]}),Object(g.jsx)(Ae.a.Footer,{children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsxs)(Ae.a.HeaderCell,{children:[Object(g.jsx)("strong",{children:"Quick keys"})," ",Object(g.jsx)("br",{}),"in popup"]}),Object(g.jsx)(Ae.a.HeaderCell,{colSpan:"3",children:Object(g.jsxs)(pe.a,{as:"ul",children:[Object(g.jsxs)(Tt.a,{as:"li",children:[Object(g.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(g.jsxs)(Tt.a,{as:"li",children:["navigate buttons with ",Object(g.jsx)("i",{children:"arrow keys"}),", select with ",Object(g.jsx)("i",{children:"spacebar"})]}),Object(g.jsxs)(Tt.a,{as:"li",children:["use ",Object(g.jsx)("i",{children:"escape"})," to close popup and ",Object(g.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})})}),Object(g.jsx)(Rt.a.Actions,{children:Object(g.jsx)(O.a,{content:"Close",onClick:function(){return o(!1)},positive:!0})})]})},qt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(g.jsx)(xe.a,{on:"click",mountNode:r||void 0,trigger:Object(g.jsx)(O.a,{secondary:!0,width:1,size:"large",icon:"setting",style:{color:"white",maxWidth:"50px"}}),children:Object(g.jsx)(Ot.a,{children:Object(g.jsx)(Ot.a.Group,{grouped:!0,children:Object(g.jsxs)(Ot.a.Field,{children:[Object(g.jsxs)("label",{children:["text size scaling ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(g.jsx)(gt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{textSize:t.value})}))}})]})})})})},Wt=i.a.memo(Pt),Vt=function(e){var t,n=e.unit,r=e.setUnitIndex,i=e.fullScreenNode,a=null===n||void 0===n||null===(t=n.jobServer)||void 0===t?void 0:t.codebook;if(console.log(a),!a||!n)return null;return null!==a&&void 0!==a&&a.type?function(e){switch(e){case"questions":return Object(g.jsx)(At,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});case"annotate":return Object(g.jsx)(Wt,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});default:return null}}(a.type):null},Yt=n(150),Gt=function(e){var t=e.children,n=Object(r.useState)(null),i=Object(s.a)(n,2),a=i[0],o=i[1];return Object(g.jsx)("div",{className:"dom-node-provider",ref:o,children:t(a)})},Qt=function(e){var t=e.handle,n=Object(r.useState)(!0),i=Object(s.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){o(!0)}),[o,t]),Object(g.jsxs)(Rt.a,{open:a,children:[Object(g.jsx)(Rt.a.Header,{children:"Fullscreen mode"}),Object(g.jsxs)(Rt.a.Content,{children:[Object(g.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-right corner. For some devices fullscreen might not work."}),Object(g.jsxs)("div",{style:{display:"flex",height:"30%"},children:[Object(g.jsx)(O.a,{primary:!0,size:"massive",onClick:function(){t.active||t.enter(),o(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(g.jsx)(O.a,{secondary:!0,size:"massive",onClick:function(){t.active&&t.exit(),o(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},Kt=function(e){var t=e.handle;return Object(g.jsx)(v.a.Group,{size:"big",style:{paddingRight:"10px",position:"absolute",top:"0px",right:0},children:Object(g.jsx)(v.a,{link:!0,name:t.active?"compress":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},Xt=function(e){var t=e.children,n=Object(Yt.b)(),r=Object(g.jsx)(Kt,{handle:n});return Object(g.jsx)(Yt.a,{handle:n,children:Object(g.jsx)(Gt,{style:{height:"100%"},children:function(e){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(Qt,{handle:n}),t(e,r)]})}})})},Jt=(n(199),function(){var e=Object(d.a)(b.a.mark((function e(t,n,r,i){var a,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.getUnit(n);case 5:a=e.sent,r(Object(u.a)(Object(u.a)({jobServer:t,unitId:a.id},a.unit),{},{annotations:a.annotation,status:a.status})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),404===(null===(o=e.t0.response)||void 0===o?void 0:o.status)&&i(null),r(null),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),Zt=function(e){var t;switch(null===e||void 0===e||null===(t=e.codebook)||void 0===t?void 0:t.type){case"questions":return["800px","1000px"];case"annotate":return["2000px","2000px"];default:return["100%","100%"]}},$t=function(e){var t=e.jobServer;return t?t.getAllAnnotations?Object(g.jsx)(j.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(g.jsxs)(j.a.Row,{style:{marginTop:"40%"},children:[Object(g.jsx)(j.a.Column,{width:4,children:Object(g.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(g.jsxs)(j.a.Column,{width:8,children:[Object(g.jsx)(h.a,{children:"You finished the codingjob!"}),Object(g.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(g.jsx)(k,{jobServer:t})]})]})}):Object(g.jsx)(j.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(g.jsx)(j.a.Row,{style:{marginTop:"40%"},children:Object(g.jsx)("div",{children:Object(g.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):null},en=function(e){var t=e.jobServer,n=Object(r.useState)(-1),i=Object(s.a)(n,2),a=i[0],o=i[1],l=Object(r.useState)(null),c=Object(s.a)(l,2),u=c[0],d=c[1];Object(r.useEffect)((function(){o(t.progress.n_coded)}),[t,o]),Object(r.useEffect)((function(){t&&null!==a&&Jt(t,a,d,o)}),[a,t,o,d]);var f=function(e){return a<0?null:null===a?Object(g.jsx)($t,{jobServer:t}):Object(g.jsx)(Vt,{unit:u,setUnitIndex:o,fullScreenNode:e})},b=Zt(t),j=Object(s.a)(b,2),v=j[0],h=j[1];return Object(g.jsx)(Xt,{children:function(e,n){return Object(g.jsxs)("div",{style:{maxWidth:h,maxHeight:v,background:"white",margin:"0 auto",padding:"0",height:"100%",border:"1px solid white"},children:[Object(g.jsxs)("div",{style:{height:"45px",padding:"0",position:"relative"},children:[Object(g.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(g.jsx)(_,{n:null===t||void 0===t?void 0:t.progress.n_total,index:a,setIndex:o,canGoBack:null===t||void 0===t?void 0:t.progress.seek_backwards,canGoForward:null===t||void 0===t?void 0:t.progress.seek_forwards})}),Object(g.jsx)("div",{children:n})]}),Object(g.jsx)("div",{style:{height:"calc(100% - 45px)",padding:"0"},children:f(e)})]})}})},tn=n(22),nn=n(18),rn=n(147),an=n.n(rn);function on(e,t,n){return ln.apply(this,arguments)}function ln(){return(ln=Object(d.a)(b.a.mark((function e(t,n,r){var i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,an.a.get("".concat(t,"/token"),{auth:{username:n,password:r}});case 2:return i=e.sent,e.abrupt("return",i.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var cn=function(){function e(t,n){Object(tn.a)(this,e),this.host=t,this.token=n,this.api=an.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(n),crossdomain:!0}})}return Object(nn.a)(e,[{key:"init",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLogin();case 2:t=e.sent,this.email=t.email,this.is_admin=t.is_admin,this.jobs=t.jobs;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLogin",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/login");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/token");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodebook",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/codebook"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProgress",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/progress"));case 2:return n=e.sent,console.log(n.data),e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/codingjob/".concat(t,"/unit"),null!==n&&(r+="?index=".concat(n)),e.next=4,this.api.get(r);case 4:return i=e.sent,e.abrupt("return",i.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}},{key:"postAnnotation",value:function(e,t,n,r){var i={annotation:n,status:r};this.api.post("/codingjob/".concat(e,"/unit/").concat(t,"/annotation"),i)}}]),e}(),sn=cn,un=function(){var e=Object(d.a)(b.a.mark((function e(t,n,r,i,a){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new sn(t,n),e.prev=1,e.next=4,o.init();case 4:a(o),i("login",Object(u.a)(Object(u.a)({},r.login),{},Object(De.a)({host:t},t+"__token__",n))),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0.response),a(null),i("login",Object(u.a)(Object(u.a)({},r.login),{},Object(De.a)({host:t},t+"__token__","__INVALID__")));case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),dn=function(){var e,t,n,r=Object(mt.a)(["login"]),i=Object(s.a)(r,2),a=i[0],o=i[1],l=(null===a||void 0===a||null===(e=a.login)||void 0===e?void 0:e.host)||null;return!(null===a||void 0===a||null===(t=a.login)||void 0===t||!t[l+"__token__"])&&"__INVALID__"!==(null===a||void 0===a||null===(n=a.login)||void 0===n?void 0:n[l+"__token__"])?Object(g.jsx)(fn,{setLogout:function(){o("login",Object(u.a)(Object(u.a)({},a.login),{},Object(De.a)({host:l},l+"__token__","__INVALID__")))}}):Object(g.jsx)(bn,{recHost:l,setLogin:function(e,t){o("login",Object(u.a)(Object(u.a)({},a.login),{},Object(De.a)({host:e},e+"__token__",t)))}})},fn=function(e){var t=e.setLogout;return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(j.a,{textAlign:"center",children:Object(g.jsx)(j.a.Column,{children:Object(g.jsx)(O.a,{secondary:!0,onClick:t,children:"Sign out"})})})})},bn=function(e){var t=e.recHost,n=e.setLogin,i=Object(r.useState)(""),a=Object(s.a)(i,2),o=a[0],l=a[1],c=Object(r.useState)(""),u=Object(s.a)(c,2),f=u[0],v=u[1],p=Object(r.useState)(""),x=Object(s.a)(p,2),m=x[0],y=x[1],k=Object(r.useState)(!1),S=Object(s.a)(k,2),C=S[0],_=S[1],E=Object(r.useState)(!1),A=Object(s.a)(E,2),R=A[0],L=A[1],T=function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!!f.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)){e.next=4;break}return _(!0),e.abrupt("return");case 4:return y(""),e.prev=5,e.next=8,on(o,f,m);case 8:t=e.sent,n(o,t),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),L(!0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t&&l(t)}),[t]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(h.a,{icon:"user",content:"Register or sign in"}),Object(g.jsx)(w.a,{placeholder:!0,attached:"bottom",children:Object(g.jsx)(j.a,{stackable:!0,textAlign:"center",children:Object(g.jsx)(j.a.Row,{children:Object(g.jsx)(j.a.Column,{children:Object(g.jsxs)(Ot.a,{children:[Object(g.jsx)(Ot.a.Input,{placeholder:"Host",name:"host",label:"Host",value:o,onChange:function(e,t){t.value.length<100&&l(t.value)},icon:"home",iconPosition:"left",autoFocus:!0}),Object(g.jsx)(Ot.a.Input,{placeholder:"email adress",error:!!C&&"Please enter a valid email adress",name:"email",label:"Email",icon:"mail",iconPosition:"left",value:f,onChange:function(e,t){t.value.length<100&&(_(!1),v(t.value))}}),Object(g.jsx)(Ot.a.Input,{placeholder:"password",name:"password",error:!!R&&"Invalid password for this host & email",label:"Password",type:"password",icon:"lock",iconPosition:"left",value:m,onChange:function(e,t){L(!1),y(t.value)}}),Object(g.jsx)(O.a,{disabled:0===m.length,primary:!0,fluid:!0,onClick:T,children:"Sign in"})]})})})})})]})},jn=function(e,t,n){var i=Object(mt.a)(["login"]),a=Object(s.a)(i,2),o=a[0],l=a[1],c=Object(r.useState)(null),u=Object(s.a)(c,2),d=u[0],f=u[1],b=Object(r.useRef)({host:null,token:null});return Object(r.useEffect)((function(){var n,r,i,a=(null===o||void 0===o||null===(n=o.login)||void 0===n?void 0:n.host)||null,c=(null===o||void 0===o||null===(r=o.login)||void 0===r?void 0:r[a+"__token__"])||null,s=e&&e!==b.current.host,u=t&&t!==b.current.token;if(b.current={host:e,token:t},s||u)return a=e||a,c=(null===o||void 0===o||null===(i=o.login)||void 0===i?void 0:i[a+"__token__"])||null,void un(a,c=t||c,o,l,f);if(d){var j=d.host===a,v=d.token===c;if(j&&v)return;f(null)}a&&"__INVALID__"!==c&&un(a,c,o,l,f)}),[e,t,o,d,l,f]),[d,Object(g.jsx)(dn,{})]},vn=function(){function e(t,n){Object(tn.a)(this,e),this.backend=t,this.job_id=n,this.where="remote"}return Object(nn.a)(e,[{key:"init",value:function(){var e=Object(d.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.backend.getCodebook(this.job_id);case 3:return this.codebook=e.sent,e.next=6,this.backend.getProgress(this.job_id);case 6:this.progress=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),this.success=!1,e.abrupt("return");case 14:this.success=!0;case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t>=this.progress.n_coded&&!this.progress.seek_forwards,this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,this.backend.getUnit(this.job_id,n?null:t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t,n){this.backend.postAnnotation(this.job_id,e,t,n)}}]),e}(),hn=vn,pn=[{name:"title"},{name:"progress",f:function(e){return"".concat(e.n_coded||0," / ").concat(e.n_total)}},{name:"modified"}],xn=function(e){var t=e.fullData,n=e.columns,i=e.onClick,a=Object(r.useState)([]),o=Object(s.a)(a,2),l=o[0],c=o[1],u=Object(r.useState)(1),d=Object(s.a)(u,2),f=d[0],b=d[1];if(Object(r.useEffect)((function(){if(!t)return c([]),null;var e=t.length;b(Math.ceil(e/10));var n=[];e>0&&(n=t.slice(0,10)),c(n)}),[t]),l)return Object(g.jsx)(On,{data:l,pages:f,columns:n,pageChange:function(e){var n=10*(e-1),r=t.slice(n,n+10);c(r)},onClick:i})},On=function(e){var t=e.data,n=e.columns,r=e.pages,i=e.pageChange,a=e.onClick,o=function(e){return n.map((function(t,n){return t.hide?null:((r=t.f?t.f(e):e?e[t.name]:null)instanceof Date&&(r=r.toISOString().slice(0,19).replace(/T/g," ")),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("span",{title:r,children:r})},n));var r}))};return t.length<1?null:Object(g.jsx)(Lt.a,{children:Object(g.jsxs)(Ae.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(g.jsx)(Ae.a.Header,{children:Object(g.jsx)(Ae.a.Row,{children:function(e,t){return t.map((function(e,t){return Object(g.jsx)(Ae.a.HeaderCell,{width:e.width||null,children:Object(g.jsx)("span",{title:e.name,children:e.name})},t)}))}(0,n)})}),Object(g.jsx)(Ae.a.Body,{children:function(e){return e.map((function(e,t){return Object(g.jsx)(Ae.a.Row,{style:{cursor:"pointer"},onClick:function(){return a(e)},children:o(e)},t)}))}(t)}),Object(g.jsx)(Ae.a.Footer,{children:Object(g.jsx)(Ae.a.Row,{children:Object(g.jsx)(Ae.a.HeaderCell,{colSpan:n.length,children:r>1?Object(g.jsx)(C.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(g.jsx)(v.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(g.jsx)(v.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(g.jsx)(v.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(g.jsx)(v.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(g.jsx)(v.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:r,onPageChange:function(e,t){return i(t.activePage)}}):null})})})]})})},gn=function(e){var t=e.backend,n=Object(l.b)(),r=Object(s.a)(n,2)[1],i=null===t||void 0===t?void 0:t.jobs,a=i?i.filter((function(e){return"NEW"!==e.modified})):[],o=i?i.filter((function(e){return"NEW"===e.modified})):[];return Object(g.jsx)(xn,{fullData:[].concat(Object(E.a)(a),Object(E.a)(o)),columns:pn,onClick:function(e){r({host:t.host,job_id:e.id})}})},mn=function(e){var t=e.backend,n=e.loginForm;return Object(g.jsx)(j.a,{inverted:!0,textAlign:"center",style:{height:"100vh",maxHeight:"800px",width:"100vw"},verticalAlign:"middle",children:Object(g.jsxs)(j.a.Column,{width:"16",style:{maxWidth:"500px"},children:[Object(g.jsxs)(j.a.Row,{children:[Object(g.jsxs)(h.a,{children:[Object(g.jsx)(v.a,{name:"home"}),t.host]}),n]}),Object(g.jsx)("br",{}),Object(g.jsx)(j.a.Row,{children:Object(g.jsx)(gn,{backend:t})})]})})},yn=function(e,t){var n=Object(r.useState)(null),i=Object(s.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){if(console.log(e,t),e&&null!=t&&null!==t){o(null);var n=new hn(e,t);n.init().then((function(){return o(n)}))}else o(null)}),[e,t]),a},kn=function(){var e=Object(l.b)(),t=Object(s.a)(e,1)[0],n=t.get("host"),r=t.get("token"),i=t.get("job_id"),a=t.get("local");a&&(n="http://localhost:".concat(a),r="null",i=0);var o=jn(n,r),c=Object(s.a)(o,2),u=c[0],d=c[1],f=yn(u,i);if(!u)return a?Object(g.jsx)(j.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(g.jsxs)(j.a.Column,{style:{maxWidth:"500px"},children:[Object(g.jsx)(v.a,{name:"emergency",size:"huge"}),Object(g.jsx)(h.a,{children:"Cannot connect to port ".concat(a,". Are you sure it's running?")})]})}):Object(g.jsx)(j.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(g.jsx)(j.a.Column,{style:{maxWidth:"500px"},children:d})});if(!f){if(!u)return;return Object(g.jsx)(mn,{backend:u,loginForm:d})}return f.job_id!==i||n&&u.host!==n?null:Object(g.jsx)(en,{jobServer:f})},wn=function(){return Object(g.jsx)(l.a,{basename:"/ccs-annotator-client",children:Object(g.jsx)("div",{style:{height:"100vh",width:"100vw"},children:Object(g.jsx)(c.c,{children:Object(g.jsx)(c.a,{path:"/",exact:!0,element:Object(g.jsx)(kn,{})})})})})},Sn=n(239);o.a.render(Object(g.jsx)(i.a.StrictMode,{children:Object(g.jsx)(Sn.a,{children:Object(g.jsx)(wn,{})})}),document.querySelector("#root"))}},[[219,1,2]]]);