(this["webpackJsonpccs-annotator-client"]=this["webpackJsonpccs-annotator-client"]||[]).push([[0],{198:function(e,t,n){},200:function(e,t,n){},220:function(e,t,n){"use strict";n.r(t);n(185);var r=n(0),a=n.n(r),i=n(70),o=n.n(i),c=n(88),l=n(13),s=n(5),u=n(8),d=n(17),f=n(12),b=n.n(f),j=n(253),v=n(51),h=n(252),p=n(11),O=n(169),x=n(221),g=n(1),m=function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,a,i,o,c,l,s,d,f,j,v,h;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),a=t.getAllAnnotations(),i=[],o=Object(p.a)(a);try{for(o.s();!(c=o.n()).done;){l=c.value,s=l.annotations,d=r[l.unit_id],f=Object(p.a)(s);try{for(f.s();!(j=f.n()).done;)v=j.value,h=Object(u.a)(Object(u.a)({document_id:d.document_id,unit_id:d.unit_id},d.provenance),v),i.push(h)}catch(b){f.e(b)}finally{f.f()}}}catch(b){o.e(b)}finally{o.f()}n(i);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,a,i,o,c,l,s,d,f,j,v,h,O,x,g,m;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),i=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),o=t.getAllAnnotations(),c=Object(p.a)(o);try{for(c.s();!(l=c.n()).done;){if(s=l.value,d=s.annotations,f=i[s.unit_id],j=Object(u.a)(Object(u.a)({document_id:f.document_id,unit_id:f.unit_id},f.provenance),{},{offset:d[0].offset,length:d[0].length,field:d[0].field},d[0].meta),f.meta)for(v=0,h=Object.keys(f.meta);v<h.length;v++)O=h[v],j["meta_"+O]=f.meta[O];x=Object(p.a)(a);try{for(m=function(){var e=g.value,t=d.find((function(t){return t.variable===e}));j[e]=null==t?null:t.value},x.s();!(g=x.n()).done;)m()}catch(b){x.e(b)}finally{x.f()}r.push(j)}}catch(b){c.e(b)}finally{c.f()}n(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(e){var t=e.jobServer,n=Object(r.useState)(null),a=Object(s.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":m(t,o);break;case"questions":y(t,o);break;default:return null}}),[t]),Object(g.jsx)(O.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:i,style:{cursor:"pointer"},children:Object(g.jsx)(x.a,{loading:null===i,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},w=n(250),C=n(238),S=n(256),E=function(e){var t=e.n,n=e.index,a=e.setIndex,i=e.canGoForward,o=void 0===i||i,c=e.canGoBack,l=void 0===c||c,u=Object(r.useRef)(0),d=Object(r.useRef)(!1),f=Object(r.useState)(!1),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(1),p=Object(s.a)(h,2),O=p[0],x=p[1],m=Object(r.useState)(1),y=Object(s.a)(m,2),k=y[0],E=y[1];if(Object(r.useEffect)((function(){n<0||(null!==n&&x(Math.min(n+1,t+1)),null===n&&x(t+1))}),[n,t,x]),Object(r.useEffect)((function(){u.current=0,d.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;x(1),d.current=!0}),[t,x]),Object(r.useEffect)((function(){if(!t)return null;u.current=Math.max(O,u.current),a(O-1===t?null:O-1),E(O)}),[t,a,O]),Object(r.useEffect)((function(){if(!t)return null;if(O===k)return v(!1),null;v(!0);var e=setTimeout((function(){x(k),v(!1)}),500);return function(){return clearTimeout(e)}}),[O,k,t,v]),!t)return null;var _=100*Math.max(0,u.current-1)/t;return Object(g.jsxs)(w.a,{style:{display:"flex",border:"none",boxShadow:"none",padding:"0",marginTop:"5px",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(g.jsx)(C.a,{active:j,content:""}),Object(g.jsx)(S.a,{secondary:!0,activePage:k,pageItem:k<=t?"".concat(k," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:l?"back":"   ",nextItem:o||O<u.current?"next":"   ",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||O<u.current)&&Number(t.activePage)>O&&x(Number(t.activePage)),l&&Number(t.activePage)<O&&x(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),Object(g.jsx)("input",{style:{flex:"1 1 auto",background:"linear-gradient(to right, #7dd48d ".concat(_,"%, #fff ").concat(_,"% 100%, #fff 100%)")},min:1,max:t+1,onChange:function(e){Number(e.target.value)>k&&E(o?Number(e.target.value):Math.min(u.current,Number(e.target.value))),l&&Number(e.target.value)<k&&E(Number(e.target.value))},type:"range",value:k})]})},_=n(18),A=n(222),R=n(244),L=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=I(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),i=null,o=0,c=t-1;c>=0;c--){if(null==e[c].ref||null===e[c].ref.current)return c+1;var l=I(e[c].ref);if(null===l)return;if(null===i){if(T(a,l))continue;i=l}else if(!T(i,l))return c+1;var s=N(a,l);if(o>0&&s<o)return c+1;if(a.left>l.right)return c;o=s}return 0},M=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=I(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),i=null,o=0,c=t+1;c<e.length;c++){if(null==e[c].ref||null===e[c].ref.current)return c-1;var l=I(e[c].ref);if(null===l)return;if(null===i){if(T(a,l))continue;i=l}else if(!T(i,l))return c-1;var s=N(a,l);if(o>0&&s<o)return c-1;if(a.right<l.left)return c;o=s}return e.length-1},T=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},N=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),a=(r-n)/e.width,i=(r-n)/t.width;return Math.max(a,i)},I=function(e,t){if(null===e||void 0===e||!e.current)return null;var n=e.current.getBoundingClientRect();if(null!=t){var r=t.current.getBoundingClientRect();n.x=r.x,n.width=r.width}return n},H=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],P=a.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,i=Object(r.useRef)();return Object(g.jsx)(A.a,{innerRef:i,children:Object(g.jsx)(R.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!a},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(g.jsxs)(g.Fragment,{children:[e.code,Object(g.jsx)("br",{}),Object(g.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),U=a.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,o=Object(r.useState)(0),c=Object(s.a)(o,2),l=c[0],u=c[1],d=a.a.useCallback((function(e){var r=t.length;if(H.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&l<r-1&&u(l+1),"ArrowDown"===e.key&&u(M(t,l)),"ArrowLeft"===e.key&&l>0&&u(l-1),void("ArrowUp"===e.key&&u(L(t,l)));46===e.keyCode&&(n(null),u(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),l===t.length?n(null):n(t[l]),u(0))}),[l,n,t]);Object(r.useEffect)((function(){return i?window.removeEventListener("keydown",d):window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}}),[d,i]);return Object(g.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(A.a,{innerRef:e.ref,children:Object(g.jsx)(x.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===l?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return u(t)},onClick:function(e,t){n(t.value),u(0)},children:e.code},e.code)})})}))})})),z=a.a.memo((function(e){var t,n,i,o,c,l,s,u,d,f=e.swipeOptions,b=e.callback,j=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){j&&("right"===j&&b(f.right),"up"===j&&b(f.up),"left"===j&&b(f.left))}),[j,b,f]);var p=a.a.useCallback((function(e){H.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(f.right),"ArrowUp"===e.key&&b(f.up),"ArrowLeft"===e.key&&b(f.left))}),[b,f]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(g.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==f.up?null:Object(g.jsx)(x.a,{fluid:!0,disabled:null==f.up,onClick:function(e,t){return b(f.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=f.up)||void 0===t?void 0:t.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)(v.a,{name:null!==(n=f.up)&&void 0!==n&&n.code?"arrow up":null}),Object(g.jsx)("span",{children:(null===(i=f.up)||void 0===i?void 0:i.code)||""})]})}),Object(g.jsx)("div",{style:{flex:"1 1 auto"},children:Object(g.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(g.jsx)(x.a,{disabled:null==f.left,onClick:function(e,t){return b(f.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=f.left)||void 0===o?void 0:o.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)(v.a,{name:null!==(c=f.left)&&void 0!==c&&c.code?"arrow left":null}),Object(g.jsx)("span",{children:(null===(l=f.left)||void 0===l?void 0:l.code)||""})]})}),Object(g.jsx)(x.a,{disabled:null==f.right,onClick:function(e,t){return b(f.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(s=f.right)||void 0===s?void 0:s.color)||"white"},children:Object(g.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(g.jsx)("span",{children:(null===(u=f.right)||void 0===u?void 0:u.code)||""}),Object(g.jsx)(v.a,{name:null!==(d=f.right)&&void 0!==d&&d.code?"arrow right":null})]})})]})})]})})),F="lightgreen",D=function(e){var t,n=e.unit,a=e.tokens,i=e.questions,o=e.questionIndex,c=e.setQuestionIndex,l=e.setUnitIndex,u=e.swipe,d=e.blockEvents,f=Object(r.useState)(),b=Object(s.a)(f,2),j=b[0],v=b[1],p=Object(r.useRef)(!1),O=Object(r.useState)(null),x=Object(s.a)(O,2),m=x[0],y=x[1];if(Object(r.useEffect)((function(){i&&(q(n,a,i,y),p.current=!1)}),[n,a,y,i]),!i||!n||!m)return null;if(null===i||void 0===i||!i[o])return c(0),null;var k=X(n,i[o]);return Object(g.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(g.jsx)(W,{questions:i,questionIndex:o,annotations:m,setQuestionIndex:c}),Object(g.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",borderBottomLeftRadius:"30px",borderBottomRightRadius:"30px",backgroundColor:"#1B1C1D"},children:[Object(g.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(g.jsx)(h.a,{as:"h3",style:{color:"white"},children:k})}),Object(g.jsx)(V,{answerTransition:j,currentAnswer:null===m||void 0===m||null===(t=m[o])||void 0===t?void 0:t.value,questions:i,questionIndex:o,onSelect:function(e){if(p.current)return null;p.current=!0,m[o].value=e.code,m[o].makes_irrelevant=e.makes_irrelevant,n.annotations=Q(m[o],n.annotations),B(n,i,m,o);for(var t=null,r=o+1;r<i.length;r++)if("IRRELEVANT"!==m[r].value){t=r;break}var a=null===t?"DONE":"IN_PROGRESS";n.jobServer.postAnnotations(n.unitId,n.annotations,a),v(e),setTimeout((function(){v(null),null===t?(l((function(e){return e+1})),c(0)):c(t),p.current=!1}),250)},swipe:u,blockEvents:d})]})]})},B=function(e,t,n,r){var a=new Set;for(var i in Object.keys(e.annotations)){var o=e.annotations[i].makes_irrelevant;if(null!=o&&null!==o){var c,l=Object(p.a)(o);try{var s=function(){var e=c.value;if("REMAINING"===e)for(var i=r+1;i<n.length;i++)a.add(i);var o=t.findIndex((function(t){return t.name===e}));o>=0&&a.add(o)};for(l.s();!(c=l.n()).done;)s()}catch(d){l.e(d)}finally{l.f()}}}for(var u=0;u<n.length;u++)a.has(u)?(n[u].value="IRRELEVANT",e.annotations=Q(n[u],e.annotations)):"IRRELEVANT"===n[u].value&&(delete n[u].value,e.annotations=Q(n[u],e.annotations))},q=function(e,t,n,r){if(0===t.length)return null;var a=[];e.annotations||(e.annotations=[]);for(var i=0;i<n.length;i++){var o=Y(t,n[i],i);o.value=J(e.annotations,o),a.push(o)}r(a)},W=function(e){var t=e.questions,n=e.questionIndex,a=e.annotations,i=e.setQuestionIndex,o=Object(r.useState)(),c=Object(s.a)(o,2),l=c[0],u=c[1];Object(r.useEffect)((function(){var e=a.map((function(e){return null!==e.value}));e[0]=!0,u(e)}),[a,u]),Object(r.useEffect)((function(){u((function(e){var t=Object(_.a)(e);return t[n]=!0,t}))}),[n,u]);return Object(g.jsx)("div",{children:Object(g.jsx)(x.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return a[e]?"IRRELEVANT"===a[e].value?["black","red"]:l&&e>n&&!l[e]?["white","grey"]:a[e].value?["black",F]:0===e||l&&l[e]?[F,"#1B1C1D"]:[F,"grey"]:["black","red"]}(r),c=Object(s.a)(o,2),u=c[0],d=c[1];return Object(g.jsx)(x.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:d,textOverflow:"clip",overflow:"hidden",color:u},onClick:function(){l[r]&&i(r)},children:Object(g.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},V=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,a=e.questionIndex,i=e.onSelect,o=e.swipe,c=e.blockEvents;return t?Object(g.jsx)(w.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(g.jsx)(h.a,{as:"h1",children:t.code})}):Object(g.jsxs)(g.Fragment,{children:[K(n||t),Object(g.jsxs)(w.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",margin:"0"},children:["search code"===r[a].type?Object(g.jsx)(P,{options:r[a].options,callback:i,blockEvents:c}):null,"select code"===r[a].type?Object(g.jsx)(U,{options:r[a].options,callback:i,blockEvents:c}):null,"annotinder"===r[a].type?Object(g.jsx)(z,{swipeOptions:r[a].swipeOptions,currentAnswer:n,callback:i,swipe:o,blockEvents:c}):null]})]})},Y=function(e,t,n){if(0===e.length)return null;var r,a={},i=e[e.length-1],o=[0,i.offset+i.length],c=[0,e.length-1],l=!1,s=!1,u=0,d=Object(p.a)(e);try{for(d.s();!(r=d.n()).done;){var f=r.value;f.codingUnit&&!a[f.field]&&(a[f.field]=1),!l&&f.codingUnit&&(l=!0,o[0]=f.offset,c[0]=u),s||f.codingUnit||!l||(s=!0,o[1]=e[u-1].offset+e[u-1].length,c[1]=u-1),u++}}catch(j){d.e(j)}finally{d.f()}var b={length_tokens:1+c[1]-c[0],length_paragraphs:1+e[c[1]].paragraph-e[c[0]].paragraph,length_sentences:1+e[c[1]].sentence-e[c[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,field:Object.keys(a).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},G=function(e,t){return e.variable===t.variable&&e.field===t.field&&e.offset===t.offset&&e.length===t.length},J=function(e,t){if(!e)return null;var n,r=Object(p.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(G(a,t))return a.value}}catch(i){r.e(i)}finally{r.f()}return null},Q=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(G(t[n],e))return t[n]=e,t;return t.push(e),t},K=function(e){return null==e?null:Object(g.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(g.jsx)(w.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:F,textAlign:"center"},children:Object(g.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(g.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},X=function(e,t){var n=t.question;if(e.variables){for(var r=0,a=Object.keys(e.variables);r<a.length;r++){var i=a[r];if(n.search("\\[".concat(i,"\\]"))>=0){var o=e.variables[i],c="{{lightyellow###".concat(o,"}}");n=n.replace("[".concat(i,"]"),c)}}return Z(n)}},Z=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(g.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),a=Object(s.a)(r,2),i=a[0],o=a[1];e.push(Object(g.jsx)("mark",{style:{backgroundColor:i},children:o},n+t))}return e}),[])})},$=a.a.memo(D),ee=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),a=n.top,i=n.height,o=r.top,c=o-a<50;o>a+.9*i&&(e.scrollTop=e.scrollTop+o-(.9*i+a)),c&&(e.scrollTop=e.scrollTop+o-(.1*i+a))},te=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],ne=function(e){var t=e.tokens,n=e.annotations,a=e.currentToken,i=e.setCurrentToken,o=e.tokenSelection,c=e.setTokenSelection,l=e.triggerCodePopup,u=e.editMode,d=e.eventsBlocked,f=Object(r.useState)(null),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(!1),O=Object(s.a)(h,2),x=O[0],m=O[1],y=Object(r.useState)(null),k=Object(s.a)(y,2),w=k[0],C=k[1];return Object(r.useEffect)((function(){d&&(C(!1),m(!1))}),[C,m,d,c]),Object(r.useEffect)((function(){if(t){var e,n=Object(p.a)(t);try{var r=function(){var t=e.value;t.triggerCodePopup=function(e){var n,r;e||(e=[t.index,t.index]),null!==t&&void 0!==t&&null!==(n=t.containerRef)&&void 0!==n&&n.current&&null!==t&&void 0!==t&&null!==(r=t.ref)&&void 0!==r&&r.current&&(t.containerRef.current.style.scrollBehavior="smooth",ee(t.containerRef.current,t.ref.current)),i({i:t.index}),c(e)}};for(n.s();!(e=n.n()).done;)r()}catch(a){n.e(a)}finally{n.f()}}}),[t,i,c]),Object(r.useEffect)((function(){var e,r;if(j&&w&&null!==t&&void 0!==t&&null!==(e=t[0])&&void 0!==e&&null!==(r=e.containerRef)&&void 0!==r&&r.current){var a,o=oe(t,n,w,j,x,u,i,c);1===j.counter?(t[0].containerRef.current.style.scrollBehavior="smooth",a=150):(t[0].containerRef.current.style.scrollBehavior="auto",a=Math.max(5,100/Math.ceil(j.counter/5))),setTimeout((function(){v({position:o,startposition:j.startposition,ntokens:j.ntokens,counter:j.counter+1})}),a)}}),[t,j,w,x,i,u,n,c]),t&&0!==t.length?d?null:Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(re,{tokenSelection:o,currentToken:a,tokens:t,HoldSpace:x,setMover:v,setHoldSpace:m,setHoldArrow:C,triggerCodePopup:l,editMode:u}),Object(g.jsx)(ae,{tokenSelection:o,tokens:t,setCurrentToken:i,setTokenSelection:c,triggerCodePopup:l,editMode:u})]}):null},re=function(e){var t=e.tokenSelection,n=e.currentToken,a=e.tokens,i=e.HoldSpace,o=e.setMover,c=e.setHoldSpace,l=e.setHoldArrow,s=e.triggerCodePopup;e.editMode;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&i)return c(!1),void(t.length>0&&ie(a,t,s));te.includes(e.key)&&(l(!1),o(null))},d=function(e){if(32!==e.keyCode){if(te.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n.i,startposition:n.i,ntokens:a.length,counter:1}),l(e.key)}}else{if(e.preventDefault(),e.repeat)return;c(!0)}};return Object(g.jsx)(g.Fragment,{})},ae=function(e){var t=e.tokenSelection,n=e.tokens,a=e.setCurrentToken,i=e.setTokenSelection,o=e.triggerCodePopup,c=e.editMode,l=Object(r.useRef)(!1),s=Object(r.useRef)(null),u=Object(r.useRef)(null),d=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",j),window.addEventListener("mousemove",v),window.addEventListener("mouseup",h),window.addEventListener("touchstart",f),window.addEventListener("touchend",b),window.addEventListener("contextmenu",p),function(){window.removeEventListener("mousedown",j),window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",h),window.removeEventListener("touchstart",f),window.removeEventListener("touchend",b),window.removeEventListener("contextmenu",p)}}));var f=function(e){u.current={time:new Date,token:ue(n,e)}},b=function(e){var r;if(null!==(r=u.current)&&void 0!==r&&r.time&&!(new Date-u.current.time>150)){var l=u.current.token;if(null===(null===l||void 0===l?void 0:l.index))return fe(n,s.current),s.current=null,void i((function(e){return 0===e.length?e:[]}));if(c)ie(n,[l.index,l.index],o);else{if(t.length>0&&t[0]===s.current){var d=O(l);return i((function(e){return he(e,n,d,!0)})),null!==l&&void 0!==l&&l.annotated&&d===t[0]?ie(n,[d,d],o):ie(n,[t[0],d],o),fe(n,s.current),s.current=null,void a({i:null})}s.current!==l.index?(fe(n,s.current),de(n,l.index),s.current=l.index,a({i:l.index}),i((function(e){return 0===e.length?e:[]}))):(fe(s.current),i((function(e){return he(e,n,l.index,!0)})))}}},j=function(e){d.current||1===e.which&&(l.current=!0,i((function(e){return 0===e.length?e:[]})))},v=function(e){if(!d.current)if(!c&&l.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),O(ue(n,e))}else{var t=ue(n,e);null!==t.index?(a((function(e){return e.i===t.index?e:{i:t.index}})),i((function(e){return he(e,n,t.index,!1)}))):a((function(e){return e.i===t.index||null===t.index?e:{i:t.index}}))}},h=function(e){if(!d.current){if(1!==e.which&&0!==e.which)return null;e.preventDefault(),e.stopPropagation();var r=O(ue(n,e));window.getSelection().empty(),l.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?ie(n,t,o):null!==r&&ie(n,[r,r],o)}},p=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},O=function(e){return a((function(t){return t.i===e.index?t:{i:e.index}})),i((function(t){return he(t,n,e.index,!0)})),e.index};return Object(g.jsx)(g.Fragment,{})},ie=function(e,t,n){var r=Object(s.a)(t,2),a=r[0],i=r[1];if(a>i){var o=[i,a];a=o[0],i=o[1]}n(e[i].index,[e[a].index,e[i].index])},oe=function(e,t,n,r,a,i,o,c){var l;if(l=i?le(e,t,n,r):ce(e,n,a,r),r.position!==l){o((function(e){return{i:e===l?e:l}})),c((function(t){return he(t,e,l,!i&&a)}));var s=e[l].containerRef.current,u=e[l].ref.current;ee(s,u)}return l},ce=function(e,t,n,r){var a,i=r.position;if("ArrowRight"===t&&i++,"ArrowLeft"===t&&i--,"ArrowUp"===t&&(i=se(e,r,"up")),"ArrowDown"===t&&(i=se(e,r,"down")),i>r.ntokens&&(i=r.ntokens),i<0&&(i=0),null==(null===(a=e[i])||void 0===a?void 0:a.ref)){if("ArrowLeft"===t||"ArrowUp"===t){var o=e.findIndex((function(e){return e.codingUnit}));if(o<0)return r.position;i=o}if("ArrowRight"===t||"ArrowDown"===t){var c=e.map((function(e){return e.codingUnit})).lastIndexOf(!0);if(c<0)return r.position;i=c-1}}if(n&&e[r.position].field!==e[i].field)if(i>r.position){for(var l=i;l>=r.position;l--)if(e[l].field===e[r.position].field){i=l;break}}else for(var s=i;s<=r.position;s++)if(e[s].field===e[r.position].field){i=s;break}return i},le=function(e,t,n,r){var a=r.position;if("ArrowRight"===n||"ArrowDown"===n){var i=e.findIndex((function(e,t){var n,r,i;return t>a&&(null===e||void 0===e||null===(n=e.ref)||void 0===n?void 0:n.current.classList.contains("annotated"))&&((null===e||void 0===e||null===(r=e.ref)||void 0===r?void 0:r.current.classList.contains("allLeft"))||(null===e||void 0===e||null===(i=e.ref)||void 0===i?void 0:i.current.classList.contains("anyLeft")))}));if(i<0)return r.position;a=i}if("ArrowLeft"===n||"ArrowUp"===n){for(var o=-1,c=a-1;c>=-1;c--){var l,s,u,d,f,b;if(null===(l=e[c])||void 0===l||null===(s=l.ref)||void 0===s?void 0:s.current.classList.contains("annotated")){var j=null===(u=e[c])||void 0===u||null===(d=u.ref)||void 0===d?void 0:d.current.classList.contains("allLeft"),v=null===(f=e[c])||void 0===f||null===(b=f.ref)||void 0===b?void 0:b.current.classList.contains("anyLeft");if(j||v){o=c;break}}}if(o<0)return r.position;a=o}return a},se=function(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var i=e.findIndex((function(e){return e.codingUnit}));return i<0?0:i}return"up"===a?L(e,t.position,t.startposition):"down"===a?M(e,t.position,t.startposition):void 0},ue=function(e,t){var n=be(t),r=Object(s.a)(n,2),a=r[0],i=r[1];return null===a?{index:null,annotated:!1}:{index:je(e,a),annotated:i}},de=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.add("tapped")},fe=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.remove("tapped")},be=function(e){try{var t,n,r;if("mousemove"===e.type||"mouseup"===e.type){var a=(null===e||void 0===e?void 0:e.path)||e.composedPath();r=e.originalTarget||a[0]}if("touchmove"===e.type||"touchstart"===e.type){var i=e.touches[0];r=document.elementFromPoint(i.clientX,i.clientY)}if("item"===(null===(t=r)||void 0===t||null===(n=t.parentNode)||void 0===n?void 0:n.className))return[null,!1];if(r){if(r.className.includes("token"))return[r,!1];if(r.parentNode&&r.parentNode.className.includes("token"))return[r.parentNode,!0]}return[null,!1]}catch(e){return[null,!1]}},je=function(e,t){return parseInt(t.getAttribute("tokenindex"))},ve=function(e,t){return t.length>0&&e[0]===t[0]&&e[1]===t[1]?e:t},he=function(e,t,n,r){if(null===n)return e;var a=Object(_.a)(e);if(!r||0===a.length)return ve(e,[n,n]);if(null===n)return ve(e,[a[0],null]);if(t[a[0]].field===t[n].field)a=[a[0],n];else if(n>a[0])for(var i=n;i>=a[0];i--)t[a[0]].field===t[i].field&&(a=[a[0],i]);else for(var o=n;o<=a[0];o++)t[a[0]].field===t[o].field&&(a=[a[0],o]);return ve(e,a)},pe=n(257),Oe=n(243),xe=function(e,t){if(t[e]){var n,r=t[e].foldToParent;return r&&t[r]&&(n=t[r].color),n=t[e].color,me(n)+"50"}return"EMPTY"===e?"lightgrey":"#ffffff50"},ge=function(e){if(0===e.length)return"white";if(1===e.length)return e[0];var t=Math.floor(100/e.length),n=e.reduce((function(n,r,a){return 0===a&&n.push(r+" ".concat(t,"%")),a===e.length-1&&n.push(r+" ".concat(100-t,"%")),a>0&&a<e.length-1&&(n.push(r+" ".concat(t*a,"%")),n.push(r+" ".concat(t*(a+1),"%"))),n}),[]);return"linear-gradient(to bottom, ".concat(n.join(", "),")")},me=function(e){if(!e)return"#FFFFFF";var t=document.createElement("canvas").getContext("2d");return t.fillStyle=e.trim(),t.fillStyle},ye=function(e,t,n,r){for(var a=0;a<e.length;a++){var i,o=e[a];if(null!==(i=o.ref)&&void 0!==i&&i.current){var c=ke(null===t||void 0===t?void 0:t[o.index],n);c&&0!==Object.keys(c).length?(we(o,c,n),r&&(o.ref.current.style.cursor="pointer")):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),o.ref.current.style.cursor="default",Ce(o,null,null,null))}}},ke=function(e,t){if(!e)return null;if(e&&t){e=Object(u.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var a=r[n],i=e[a].variable;if(t[i]){var o=t[i].codeMap,c=e[a].value;o[c]&&o[c].active&&o[c].activeParent||"EMPTY"===!c&&delete e[a]}else delete e[a]}}return e},we=function(e,t,n){for(var r=0,a=0,i={pre:[],text:[],post:[]},o=Object.keys(t).length,c=0,l=Object.keys(t);c<l.length;c++){var s=t[l[c]],u=n[s.variable].codeMap,d=xe(s.value,u);i.text.push(d),s.span[0]===s.index?r++:i.pre.push(d),s.span[1]===s.index?a++:i.post.push(d)}var f=r===o,b=a===o,j=r>0,v=a>0,h=e.ref.current.classList;h.add("annotated"),f?h.add("allLeft"):h.remove("allLeft"),j&!f?h.add("anyLeft"):h.remove("anyLeft"),b?h.add("allRight"):h.remove("allRight"),v&!b?h.add("anyRight"):h.remove("anyRight");var p=ge(i.text),O=f?"white":ge(i.pre),x=b?"white":ge(i.post);Ce(e,O,p,x)},Ce=function(e,t,n,r){var a=e.ref.current.children;a[0].style.background=t,a[1].style.background=n,a[2].style.background=r},Se=function(e,t){var n,r=Object(p.a)(e);try{for(r.s();!(n=r.n()).done;){var a,i=n.value;if(null!==(a=i.ref)&&void 0!==a&&a.current)if(i.ref.current.classList.remove("tapped"),0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(s.a)(t,2),c=o[0],l=o[1];if(c>l){var u=[c,l];l=u[0],c=u[1]}var d=i.arrayIndex>=c&&i.arrayIndex<=l,f=i.ref.current.classList;if(d&&i.codingUnit){var b=c===i.arrayIndex,j=l===i.arrayIndex;f.add("selected"),b?f.add("start"):f.remove("start"),j?f.add("end"):f.remove("end")}else f.remove("selected")}else i.ref.current.classList.remove("selected")}}catch(v){r.e(v)}finally{r.f()}},Ee=a.a.memo((function(e){var t,n=e.tokens,a=e.currentToken,i=e.setCurrentToken,o=e.annotations,c=e.variableMap,l=e.fullScreenNode,u=e.onlyFirst,d=Object(r.useState)(null),f=Object(s.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)(0),h=Object(s.a)(v,2),p=h[0],O=h[1];return Object(r.useEffect)((function(){var e;if(null===n||void 0===n||null===(e=n[a.i])||void 0===e||!e.ref||null===o||void 0===o||!o[n[a.i].index]||!c)return j(null),O(0),null;var t=o[n[a.i].index],r=Object.keys(t).reduce((function(e,n,r){var o=t[n].variable,l=t[n].value;if(u&&a.i!==t[n].span[0])return e;if(!c[o])return e;var s=c[o].codeMap;return s[l]?(e.push(Object(g.jsxs)(pe.a.Item,{style:{backgroundColor:xe(l,s),padding:"0.3em"},onMouseOver:function(){return i({i:null})},children:[Object(g.jsx)("b",{children:o}),": "+l]},r)),e):e}),[]);j(Object(g.jsx)(pe.a,{children:r})),O(0)}),[n,a,i,o,u,c,O]),Object(r.useEffect)((function(){if(b){var e=setTimeout((function(){O(p+1)}),200);return function(){return clearTimeout(e)}}}),[p,b]),Object(g.jsx)(Oe.a,{mountNode:l||void 0,context:null===n||void 0===n||null===(t=n[a.i])||void 0===t?void 0:t.ref,basic:!0,hoverable:!1,position:"top left",open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:b})})),_e=function(e){var t=e.tokens,n=e.variableMap,a=e.annotations,i=e.disableAnnotations,o=e.editMode,c=e.triggerCodeSelector,l=e.eventsBlocked,u=e.fullScreenNode,d=Object(r.useState)({i:null}),f=Object(s.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)([]),h=Object(s.a)(v,2),p=h[0],O=h[1];return Object(r.useEffect)((function(){if(!n)return null;ye(t,a,n,o)}),[t,a,n,o]),Object(r.useEffect)((function(){Se(t,p)}),[t,p]),Object(r.useEffect)((function(){j({i:null}),O([])}),[t]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(Ee,{tokens:t,currentToken:b,setCurrentToken:j,annotations:a,variableMap:n,fullScreenNode:u,onlyFirst:!1}),i?null:Object(g.jsx)(ne,{tokens:t,annotations:a,currentToken:b,setCurrentToken:j,tokenSelection:p,setTokenSelection:O,triggerCodePopup:c,editMode:o,eventsBlocked:l})]})},Ae=n(247),Re=function(e){var t=e.meta_fields,n=function(e){var t={borderTop:"none"};return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),t};return 0===t.length?null:Object(g.jsx)(Ae.a,{basic:"very",compact:!0,style:{lineHeight:"0.8",padding:"10px",paddingLeft:"10px",background:"#ffffff",color:"black"},children:t.map((function(e){return Object(g.jsxs)(Ae.a.Row,{style:{fontSize:"".concat(null!=e.size?e.size:1,"em")},children:[Object(g.jsx)(Ae.a.Cell,{width:1,style:{borderTop:"none"},children:Object(g.jsx)("b",{children:e.label||e.name})}),Object(g.jsx)(Ae.a.Cell,{style:n(e),children:e.value})]})}))})},Le=function(e){var t=e.tokens,n=e.text_fields,a=e.meta_fields,i=e.setReady,o=e.maxHeight,c=Object(r.useState)({}),l=Object(s.a)(c,2),u=l[0],d=l[1],f=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));t.some((function(e){return!e.codingUnit}))?null!==n&&void 0!==n&&null!==(e=n.ref)&&void 0!==e&&e.current&&f.current&&function(e,t,n){var r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),i=r.top,o=r.height,c=a.top,l=o/(1/n);e.scrollTop=e.scrollTop+c-(l+i)}(f.current,n.ref.current,1/3):f.current.scrollTop=0})),Object(r.useEffect)((function(){if(!t)return null;d(Me(t,n,f)),i&&i((function(e){return e+1}))}),[t,n,i]),null===t?null:Object(g.jsx)(A.a,{innerRef:f,children:Object(g.jsx)("div",{style:{flex:"1",display:"flex",alignItems:null,overflow:"auto",maxHeight:o},children:Object(g.jsxs)("div",{className:"TokensContainer",style:{flex:"1 97%",width:"100%"},children:[Object(g.jsx)("div",{style:{width:"100%",textAlign:"right",padding:"10px 30px"},children:Object(g.jsx)(Re,{meta_fields:a})},"meta"),Object(g.jsx)("div",{style:{padding:"20px"},children:u.text},"text"),Object(g.jsx)("div",{style:{height:"25px"}},"empty_space")]})},"tokens")})},Me=function(e,t,n){var r={text:[]};if(0===e.length)return r;for(var i=[],o=[],c=[],l=e[0].codingUnit,s=e[0].field,u=e[0].paragraph,d=e[0].sentence,f=function(e){return t.find((function(t){return t.name===e}))},b=f(s),j=0;j<e.length;j++)e[j].arrayIndex=j,e[j].sentence!==d&&(c.length>0&&o.push(Ie(j,d,c)),c=[]),e[j].paragraph!==u&&(o.length>0&&i.push(Ne(f(s),u,o,e[j].paragraph!==u)),o=[]),e[j].field!==s&&(i.length>0&&r.text.push(Te(f(s),j+"_"+s,i,s)),i=[]),u=e[j].paragraph,d=e[j].sentence,s=e[j].field,l=e[j].codingUnit,e[j].containerRef=n,l&&(e[j].ref=a.a.createRef()),c.push(He(e[j],l));return b=f(s),c.length>0&&o.push(Ie("last",d,c)),o.length>0&&i.push(Ne(b,u,o,!1)),i.length>0&&r.text.push(Te(b,"last_"+s,i,s)),r},Te=function(e,t,n,r){return Object(g.jsx)("span",{className:"field",children:function(n){return e?Object(g.jsxs)(g.Fragment,{children:[e.label?Object(g.jsx)("span",{style:{color:"grey",fontWeight:"bold",textAlign:"center"},children:e.label},r+t+"label"):null,Object(g.jsx)("span",{className:"noselect",style:{fontSize:"".concat(null!=e.size?e.size:1,"em"),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:null==e.justify||e.justify?"justify":"left"},children:n},r+t)]}):n}(n)},"field"+r)},Ne=function(e,t,n,r){return null==(null===e||void 0===e?void 0:e.paragraphs)||null!==e&&void 0!==e&&e.paragraphs?Object(g.jsx)("div",{style:{display:"flex"},children:Object(g.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)},"pardiv"+t):Object(g.jsx)("span",{children:Object(g.jsx)("span",{children:n})},"par"+t)},Ie=function(e,t,n){return Object(g.jsx)("span",{className:"sentence",children:n},e+"_"+t)},He=function(e,t){return Object(g.jsxs)("span",{ref:e.ref,className:t?"token codingUnit":"token",tokenindex:e.arrayIndex,children:[Object(g.jsx)("span",{className:"pre",children:e.pre},"pre"+e.index),Object(g.jsx)("span",{className:"text",children:e.text},"text"+e.index),Object(g.jsx)("span",{className:"post",children:e.post},"post"+e.index)]},"token"+e.index)},Pe=a.a.memo(Le),Ue=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],ze=function(e){var t=e.id,n=e.active,i=e.options,o=e.onSelect,c=Object(r.useState)(0),l=Object(s.a)(c,2),u=l[0],d=l[1],f=Object(r.useState)([]),b=Object(s.a)(f,2),j=b[0],h=b[1],O=Object(r.useRef)({});Object(r.useEffect)((function(){var e,t=[].concat(Object(_.a)(i),[{cancel:!0,label:"CLOSE",color:"grey",value:"CANCEL",textColor:"white"}]),n=Object(p.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.ref=a.a.createRef()}}catch(r){n.e(r)}finally{n.f()}h(t)}),[i,h]);var m=a.a.useCallback((function(e){var t=j.length;if(Ue.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(M(j,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(L(j,u)));if(32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=j[u].value;o(n,e.ctrlKey)}}),[u,j,o]);Object(r.useEffect)((function(){return n?window.addEventListener("keydown",m):window.removeEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[n,m]);var y=function(e,t){var n=e.value.delete?"#682c2c":"black",r=e.value.delete?e.value:"white",a=e.color.slice(0,7),i=e.value.delete?"darkred":"black",c=e.color;return Object(g.jsx)(A.a,{innerRef:e.ref,children:Object(g.jsxs)(x.a,{style:{flex:"1 1 auto",padding:"4px 2px",background:c,color:n,border:"3px solid",borderColor:t===u?i:"white",margin:"1px"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){return o(t.value,e.ctrlKey)},children:[e.tag?Object(g.jsx)("span",{style:{display:"inline-block",float:"left",background:r,color:"black",borderRadius:"0px",border:"2px solid ".concat(a),padding:"2px",margin:"-4px 4px -4px -2px"},children:"".concat(e.tag," ")}):null,Object(g.jsx)("span",{children:e.label})]},e.label+"_"+t)})};return Object(g.jsx)("div",{children:function(){var e,n,r=0,a=[],i=[],o=Object(p.a)(j);try{for(o.s();!(n=o.n()).done;){var c=n.value;O.current[c.value]||("CANCEL"===c.value?e=y(c,r):c.value.delete?i.push(y(c,r)):a.push(y(c,r)),r++)}}catch(l){o.e(l)}finally{o.f()}return Object(g.jsxs)("div",{children:[Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"10px"},children:a},t+"_1"),i.length>0?Object(g.jsxs)("b",{children:[Object(g.jsx)(v.a,{name:"trash alternate"})," Delete codes"]}):null,Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:i},t+"_2"),Object(g.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:e},t+"_3")]},t+"_buttons")}()},t)};function Fe(e){var t=e.variable,n=e.setVariable,a=e.annotations,i=e.span,o=e.setOpen,c=e.variableMap,l=function(){for(var e=Object.keys(c),t={},n=0,r=e;n<r.length;n++){for(var o=r[n],l={},s=i[0];s<=i[1];s++)if(a[s])for(var u=0,d=Object.keys(a[s]);u<d.length;u++){var f,b=d[u],j=a[s][b];j.variable===o&&(l[j.value]=xe(j.value,null===c||void 0===c||null===(f=c[o])||void 0===f?void 0:f.codeMap))}t[o]=ge(Object.values(l))}return e.map((function(e){return{color:t[e],label:e,value:e}}))}();return Object(r.useEffect)((function(){1===l.length&&n(l[0].value)}),[l,n]),t||!i?null:Object(g.jsxs)("div",{children:[Object(g.jsx)(Oe.a.Header,{style:{textAlign:"center"},children:"Select variable"}),Object(g.jsx)(ze,{id:"currentCodePageButtons",active:!0,options:l,setOpen:o,onSelect:function(e,t){"CANCEL"!==e?n(e):o(!1)}})]})}function De(e){var t=e.tokens,n=e.variable,r=e.setVariable,a=e.annotations,i=e.span,o=e.setSpan,c=e.setOpen,l=e.variableMap,s=function(e,t){"CANCEL"!==e?(o(e.span),r(e.variable)):c(!1)};if(n||!i)return null;var d=function(){for(var e={},n=i[0];n<=i[1];n++)if(a[n])for(var r=0,o=Object.keys(a[n]);r<o.length;r++){var c,s=o[r],d=a[n][s],f=null===l||void 0===l||null===(c=l[d.variable])||void 0===c?void 0:c.codeMap;if(l[d.variable]&&(null!==f&&void 0!==f&&f[d.value]||"EMPTY"===d.value)){var b=d.span,j=d.variable+":"+b[0]+"-"+b[1],v='"'+Be(t,b)+'"',h=xe(d.value,f);e[j]?e[j].colors.push(h):e[j]={tag:d.variable,label:v,colors:[h],value:{variable:d.variable,span:d.span}}}}return Object.keys(e).map((function(t){return Object(u.a)(Object(u.a)({},e[t]),{},{color:ge(e[t].colors)})}))}();return 0===d.length&&c(!1),1===d.length&&s(d[0].value),Object(g.jsxs)("div",{children:[Object(g.jsx)(Oe.a.Header,{style:{textAlign:"center"},children:"Select annotation"}),Object(g.jsx)(ze,{id:"currentCodePageButtons",active:!0,options:d,setOpen:c,onSelect:s})]})}var Be=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=e.slice(t[0],t[1]+1).map((function(e){return e.pre+e.text+e.post}));return r.length>n&&(r=[r.slice(0,Math.floor(n/2)).join("")," ... ",r.slice(-Math.floor(n/2)).join("")]),r.join("")},qe=n(47),We=function(e){return e.variable+"|"+e.value},Ve=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(u.a)({},n);var r,a=Ge(e),i={},o=[],c=Object(p.a)(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;Je(l,a,i,o)}}catch(C){c.e(C)}finally{c.f()}for(var s={},d=[],f=0,b=o;f<b.length;f++){var j=b[f];s[j.id]||(s[j.id]=0),s[j.id]++,d.push(j)}for(var v=[],h=0,O=d;h<O.length;h++)for(var x=O[h],g=x.span[0];g<=x.span[1];g++){var m=Object(u.a)({},x);m.index=g,v.push(m)}for(var y=0,k=d;y<k.length;y++){var w=k[y];n=Ye(n,w,!1,!1)}return n},Ye=function(e,t,n,r){for(var a=We(t),i=t.span[0];i<=t.span[1];i++)e[i]&&e[i][a]&&function(){for(var t=e[i][a],n=t.span,o=n[0];o<=n[1];o++)e[o]&&e[o][a]&&(r&&1===Object.values(e[o]).filter((function(e){return e.variable===t.variable})).length&&(e[o][We(Object(u.a)(Object(u.a)({},t),{},{value:"EMPTY"}))]=Object(u.a)(Object(u.a)({},e[o][a]),{},{value:"EMPTY"})),delete e[o][a],0===Object.keys(e[o]).length&&delete e[o])}(),n||(e[i]||(e[i]={}),delete e[i][We(Object(u.a)(Object(u.a)({},t),{},{value:"EMPTY"}))],e[i][a]={index:i,variable:t.variable,span:[t.span[0],t.span[1]],length:t.length,value:t.value,field:t.field,offset:t.offset});return e},Ge=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.field]||(e[t.field]={}),e[t.field][t.offset]||(e[t.field][t.offset]={start:[],end:[]}),e[t.field][t.offset+t.length-1]||(e[t.field][t.offset+t.length-1]={start:[],end:[]}),e[t.field][t.offset].start.push(t),e[t.field][t.offset+t.length-1].end.push(We(t)),e}),{}):{}},Je=function(e,t,n,r){var a=e.offset,i=e.offset+e.length+e.post.length-1;if(t[e.field])for(var o=t[e.field],c=a;c<=i;c++)if(o[c]){var l,s=Object(p.a)(o[c].start);try{for(s.s();!(l=s.n()).done;){var d=l.value,f=We(d);n[f]=Object(u.a)(Object(u.a)({},e),{},{id:f,variable:d.variable,value:d.value,offset:d.offset,length:null,span:[e.index]})}}catch(h){s.e(h)}finally{s.f()}var b,j=Object(p.a)(o[c].end);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v]&&(n[v].span.push(e.index),n[v].length=e.offset+e.length-n[v].offset,r.push(n[v]),delete n[v])}}catch(h){j.e(h)}finally{j.f()}}},Qe=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"];function Ke(e){var t=e.tokens,n=e.variable,i=e.variableMap,o=e.codeHistory,c=e.settings,l=e.annotations,d=e.tokenAnnotations,f=e.setAnnotations,b=e.editMode,j=e.span,v=e.setOpen,h=e.setCodeHistory,O=Object(r.useRef)(null),x=Object(r.useState)(!0),m=Object(s.a)(x,2),y=m[0],k=m[1],w=a.a.useCallback((function(e){var t;return c&&!c.searchBox&&"recent"===!c.buttonMode?null:((null===O||void 0===O||null===(t=O.current)||void 0===t?void 0:t.children[0])===document.activeElement||k(!0),27===e.keyCode&&v(!1),Qe.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(O.current&&O.current.click(),void k(!1)))}),[O,v,c]);Object(r.useEffect)((function(){return window.addEventListener("keydown",w),function(){window.removeEventListener("keydown",w)}}));var C=function(e,r){var a;"CANCEL"!==e?(Ze(t,e,f,h,b),null!==i&&void 0!==i&&null!==(a=i[n])&&void 0!==a&&a.multiple||r||v(!1)):v(!1)};if(null===i||void 0===i||!i[n])return null;var S,E=function(){var e,r=function(e){for(var t={},n=j[0];n<=j[1];n++)if(null!==l&&void 0!==l&&l[n])for(var r=0,a=Object.keys(l[n]);r<a.length;r++){var i=a[r],o=l[n][i];o.variable===e&&(t[o.span[0]+"_"+i]=Object(u.a)({id:i},l[n][i]))}return Object.keys(t).length>0?Object.values(t):[]}(n),a=[],s=[],f=null===i||void 0===i||null===(e=i[n])||void 0===e?void 0:e.codeMap;!function(e,t){var r=Object.keys(e);if(1!==r.length)return null;var a=r[0],i=t.filter((function(e){return"EMPTY"!==e.value}));0===i.length&&(setTimeout((function(){return C({variable:n,span:j,value:a,delete:!1})}),0),v(!1)),b&&1===i.length&&a===i[0].value&&(setTimeout((function(){return C({variable:n,span:j,value:a,delete:!0})}),0),v(!1))}(f,r);for(var h=0,O=Object.keys(f);h<O.length;h++){var x=O[h];if(d[n+"|"+x]){var m=d[n+"|"+x].span;if(m[0]===(null===j||void 0===j?void 0:j[0])&&m[1]===(null===j||void 0===j?void 0:j[1]))continue}c&&"all"===c.buttonMode&&a.push({key:x,label:x,value:{variable:n,value:x,span:j,delete:!1},color:xe(x,f)});var y=f[x].tree.join(" - ");s.push({key:x,value:{variable:n,value:x,span:j,delete:!1},text:x+" test"+y,content:Object(g.jsxs)(g.Fragment,{children:[x,Object(g.jsx)("br",{}),Object(g.jsx)("span",{style:{color:"grey"},children:y})]})})}if(!c||"recent"===c.buttonMode){var k,w=9,S=Object(p.a)(o);try{for(S.s();!(k=S.n()).done;){var E=k.value;if(w<0)break;f[E]&&(a.push({key:E,label:E,value:{variable:n,value:E,span:j,delete:!1},color:xe(E,f)}),w--)}}catch(L){S.e(L)}finally{S.f()}}if(r&&r.length>0){var _,A=Object(p.a)(r);try{var R=function(){var e=_.value;if(!f[e.value])return"continue";r.find((function(t){return t.id!==e.id&&t.value===e.value}))?a.push({tag:e.value,label:'"'+Xe(t,e.span)+'"',color:xe(e.value,f),value:Object(u.a)(Object(u.a)({},e),{},{delete:!0}),textColor:"darkred"}):a.push({label:e.value,color:xe(e.value,f),value:Object(u.a)(Object(u.a)({},e),{},{delete:!0}),textColor:"darkred"})};for(A.s();!(_=A.n()).done;)R()}catch(L){A.e(L)}finally{A.f()}}return[a,s]}(),_=Object(s.a)(E,2),L=_[0],M=_[1];return Object(g.jsxs)(g.Fragment,{children:[(S=M,0===S.length?null:c&&!c.searchBox&&"recent"!==c.buttonMode?Object(g.jsx)("div",{style:{height:"25px"}}):Object(g.jsx)(A.a,{innerRef:O,children:Object(g.jsx)(R.a,{fluid:!0,placeholder:"<type to search>",style:{textAlign:"center",color:"black",width:"100%",height:"20px",marginBottom:"5px",overflow:"visible",position:"relative"},options:S,open:!y,search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return k(!1)},onSearchChange:function(e,t){console.log(t.value),""===t.searchQuery&&k(!0)},onClose:function(e,t){k(!0)},selectOnBlur:!1,onChange:function(e,t){C(t.value,e.ctrlKey)}})})),function(e){return Object(g.jsxs)(g.Fragment,{children:["recent"===c.buttonMode&&o.length>0?Object(g.jsx)("b",{children:"Recent codes"}):null,Object(g.jsx)(ze,{id:"newCodePageButtons",active:y,setAnnotations:f,options:e,setOpen:v,onSelect:C})]})}(L)]})}var Xe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=e.slice(t[0],t[1]+1).map((function(e){return e.pre+e.text+e.post}));return r.length>n&&(r=[r.slice(0,Math.floor(n/2)).join("")," ... ",r.slice(-Math.floor(n/2)).join("")]),r.join("")},Ze=function(e,t,n,r,a){var i=Object(s.a)(t.span,2),o=i[0],c=i[1];t.index=e[o].index,t.length=e[c].length+e[c].offset-e[o].offset,t.span=[e[o].index,e[c].index],t.field=e[o].field,t.offset=e[o].offset,n((function(e){return Ye(Object(u.a)({},e),t,t.delete,a)})),r((function(e){return null!==e&&void 0!==e&&e[t.variable]||(e[t.variable]=[]),Object(u.a)(Object(u.a)({},e),{},Object(qe.a)({},t.variable,[t.value].concat(Object(_.a)(e[t.variable].filter((function(e){return e!==t.value}))))))}))},$e=function(e){var t=e.editMode,n=e.tokens,r=e.variable,a=e.setVariable,i=e.variableMap,o=e.annotations,c=e.span,l=e.setSpan,s=e.setOpen;return t?Object(g.jsx)(De,{tokens:n,variable:r,setVariable:a,variableMap:i,annotations:o,span:c,setSpan:l,setOpen:s}):Object(g.jsx)(Fe,{variable:r,setVariable:a,variableMap:i,annotations:o,span:c,setOpen:s})},et=a.a.memo((function(e){var t=e.children,n=e.fullScreenNode,r=e.open,a=e.setOpen,i=e.tokenRef,o="5px",c="top left",l="100vh";if(null!==i&&void 0!==i&&i.current){var s=i.current.getBoundingClientRect(),u=s.top/window.innerHeight,d=(window.innerHeight-s.bottom)/window.innerHeight;u>d?(c="top",l="calc(".concat(100*u,"vh - ").concat(o,")")):(c="bottom",l="calc(".concat(100*d,"vh - ").concat(o,")"));var f=s.left/window.innerWidth;c=(window.innerWidth-s.right)/window.innerWidth>f?c+" left":c+" right"}var b=!1;return Object(g.jsx)(Oe.a,{mountNode:n||void 0,context:i,basic:!0,wide:"very",position:c,hoverable:!0,open:r,mouseLeaveDelay:1e7,onClose:function(e,t){b&&a(!1),b=!0},style:{margin:o,padding:"0px",background:"#dfeffb",border:"1px solid #136bae",minWidth:"15em",maxHeight:l,overflow:"visible"},children:Object(g.jsx)("div",{style:{margin:"5px",border:"0px"},children:t})})})),tt=function(e,t,n,i,o,c,l,u,d){var f=Object(r.useState)(!1),b=Object(s.a)(f,2),j=b[0],v=b[1],h=Object(r.useState)(null),p=Object(s.a)(h,2),O=p[0],x=p[1],m=Object(r.useState)(null),y=Object(s.a)(m,2),k=y[0],w=y[1],C=Object(r.useState)(null),S=Object(s.a)(C,2),E=S[0],_=S[1],A=Object(r.useState)({}),R=Object(s.a)(A,2),L=R[0],M=R[1],T=a.a.useCallback((function(t,n){e[t].ref&&(_(e[t].ref),M(o[t]||{}),x(n||[t,t]),v(!0))}),[o,e]);if(Object(r.useEffect)((function(){w(null)}),[t]),Object(r.useEffect)((function(){v(!1)}),[e]),Object(r.useEffect)((function(){j||w(null)}),[j]),!i)return[null,null,null,!0];var N=Object(g.jsxs)(et,{fullScreenNode:d,open:j,setOpen:v,tokenRef:E,children:[Object(g.jsx)($e,{editMode:n,tokens:e,variable:k,setVariable:w,variableMap:t,annotations:o,span:O,setSpan:x,setOpen:v}),Object(g.jsx)(Ke,{tokens:e,variable:k,variableMap:t,settings:null===t||void 0===t?void 0:t[k],annotations:o,tokenAnnotations:L,setAnnotations:c,span:O,editMode:n,setOpen:v,codeHistory:l[k]||[],setCodeHistory:u})]});return t&&e||(N=null),[N,T,j]},nt=n(149),rt=n(173);nt.a.extend(rt.a);var at=function(e){var t,n=[],r=null,a=0,i=0,o=0,c=null,l=null,s=!1,u=Object(p.a)(e);try{for(u.s();!(t=u.n()).done;){var d=t.value;null==d.unit_start&&null==d.context_before||(s=!0)}}catch(C){u.e(C)}finally{u.f()}var f,b=!s,j=!1,v=Object(p.a)(e);try{for(v.s();!(f=v.n()).done;){var h=f.value,O=h.name||"text",x=h.offset||0;l=h.value,null!=h.context_before&&(l=h.context_before+l,h.unit_start=h.context_before.length),null!=h.context_after&&(h.unit_end=l.length,l+=h.context_after),c=nt.a.tokenize(l).paragraphs().json({offset:!0});for(var g=0;g<c.length;g++){for(var m=0;m<c[g].sentences.length;m++){for(var y=0;y<c[g].sentences[m].length;y++)for(var k=0;k<c[g].sentences[m][y].terms.length;k++){r=c[g].sentences[m][y].terms[k],null!=h.unit_start&&r.offset.start+x>=h.unit_start&&(b=!0),null!=h.unit_end&&r.offset.start+x>h.unit_end&&(j=!0);var w={field:O,offset:r.offset.start+x,length:r.offset.length,paragraph:a,sentence:i,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:b&!j};n.push(w),o++}i++}a++}}}catch(C){v.e(C)}finally{v.f()}return n},it=function(e){for(var t=0,n=(e=ct(e))[0].paragraph,r=0,a=e[0].sentence,i=0,o=0,c=0;c<e.length;c++){var l;if(null==e[c].text){if(null==e[c].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[c].text=e[c].token}if(null==e[c].offset&&null!=e[c].start&&(e[c].offset=e[c].start),null==e[c].length&&(e[c].length=e[c].text.length),null==e[c].pre&&(e[c].pre=""),null==e[c].post&&null!=e[c].space&&(e[c].post=e[c].space),null==e[c].post&&(null!=e[c].offset&&null!=e[c].length?e[c].post=c<e[c].length-1?" ".repeat(Math.max(0,e[c+1].offset-e[c].offset-e[c].length)):"":e[c].post=" "),o=e[c].length+e[c].post.length,c<e.length-1&&(o+=(null===(l=e[c+1].pre)||void 0===l?void 0:l.length)||0),null==e[c].offset&&(e[c].offset=i,i+=o),c<e.length-1&&(!e[c].field||e[c].field===e[c+1].field)&&(null==e[c+1].offset&&null!=e[c+1].start&&(e[c+1].offset=e[c+1].start),e[c+1].offset&&e[c+1].offset<e[c].offset+o))return alert('Invalid token position data. The length of "'.concat(e[c].pre+e[c].text+e[c].post,'" on position ').concat(e[c].offset," exeeds the offset/start position of the next token")),null;null==e[c].sentence?(e[c].sentence=r,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&r++):(e[c].paragraph===n&&e[c].sentence===a||(a=e[c].sentence,r++),e[c].sentence=r),null==e[c].paragraph?(e[c].paragraph=t,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&t++):(e[c].paragraph!==n&&(n=e[c].paragraph,t++),e[c].paragraph=t),null==e[c].field&&(e[c].field="text"),e[c].index=c}return e},ot=function(e,t){if(0===e.length)return[];for(var n=[],r={},a=e[0].field,i=0;i<e.length;i++)if(e[i].annotations){var o,c={},l=Object(p.a)(e[i].annotations);try{for(l.s();!(o=l.n()).done;){var s=o.value;if(""!==s.value){t[s.name]||(t[s.name]=new Set),t[s.name].add(s.value),c[s.name]=s.value;var u=i>0?e[i-1].post:"";null==r[s.name]&&(r[s.name]={index:i,variable:s.name,value:s.value,offset:e[i].offset,text:e[i].text,field:e[i].field,length:e[i].length}),r[s.name].value===s.value&&(r[s.name].length=e[i].offset+e[i].length-r[s.name].offset,r[s.name].text+=u+e[i].pre+e[i].post)}}}catch(w){l.e(w)}finally{l.f()}for(var d=0,f=Object.keys(r);d<f.length;d++){var b=f[d];null!=c[b]?c[b]!==r[b].value&&(n.push(r[b]),r[b]={index:i,variable:b,value:c[b],offset:e[i].offset,text:e[i].text,field:e[i].field,length:e[i].length}):(n.push(r[b]),delete r[b])}if(i<e.length-1&&e[i+1].field!==a){for(var j=0,v=Object.values(r);j<v.length;j++){var h=v[j];n.push(h)}r={},a=e[i].field}else;}else{for(var O=0,x=Object.values(r);O<x.length;O++){var g=x[O];n.push(g)}r={}}for(var m=0,y=Object.values(r);m<y.length;m++){var k=y[m];n.push(k)}return n},ct=function(e){if(Array.isArray(e))return e;for(var t=Object.keys(e),n=e[t[0]].length,r=[],a=function(n){var a=t.reduce((function(t,r){return t[r]=e[r][n],t}),{});r.push(a)},i=0;i<n;i++)a(i);return r},lt=function(e,t){var n,r={},a=Object(p.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r[i.variable]||(r[i.variable]=new Set),r[i.variable].add(i.value)}}catch(s){a.e(s)}finally{a.f()}for(var o=0,c=Object.keys(r);o<c.length;o++){var l=c[o];r[l]=Object(_.a)(r[l])}console.log(r),t(r)},st=function(e,t,n,a){var i=Object(r.useState)({}),o=Object(s.a)(i,2),c=o[0],l=o[1],d=Object(r.useState)(),f=Object(s.a)(d,2),b=f[0],j=f[1],v=Object(r.useState)({}),h=Object(s.a)(v,2),O=h[0],x=h[1];return Object(r.useEffect)((function(){if((null===e||void 0===e||!e.text)&&!e.text_fields&&!e.tokens)return null;if(e.annotations||(e.annotations=[]),e.importedAnnotations){0===e.annotations.length&&"DONE"!==e.status&&(e.annotations=e.importedAnnotations);var r,i={},o=Object(p.a)(e.importedAnnotations);try{for(o.s();!(r=o.n()).done;){var c=r.value;i[c.variable]||(i[c.variable]={}),i[c.variable][c.value]||(i[c.variable][c.value]=!0)}}catch(d){o.e(d)}finally{o.f()}x(i)}lt(e.annotations,a);var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(u.a)({},e);n.tokens?(n.importedTokens=!0,n.tokens=it(e.tokens)):(n.importedTokens=!1,!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=at(Object(_.a)(n.text_fields))),n.meta_fields=e.meta_fields||[],n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=Ve(Object(_.a)(n.annotations),n.tokens):n.annotations={};var r=ot(n.tokens,t);return r.length>0&&(n.annotations=Ve(r,n.tokens,n.annotations)),n}(e);t.current={tokens:s.tokens},l({tokens:s.tokens,text_fields:s.text_fields,meta_fields:s.meta_fields}),j(s.annotations),n&&n(s.tokens)}),[e,n,t,a,x]),[c,b,j,O]},ut=function(e){var t=e.variable,n=e.setVariable,a=e.variables,i=e.variableNames,o=e.minHeight;return Object(r.useEffect)((function(){return a?1===a.length?(n(a[0].name),null):void(i.includes(t)||n(i[0])):null}),[a,n,i,t]),Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(x.a.Group,{attached:"bottom",fluid:!0,style:{minHeight:"".concat(o/2,"px")},children:i.map((function(e){return Object(g.jsx)(x.a,{primary:!0,active:e===t,style:{padding:"0",border:"1px solid",color:e===t?"black":"white"},onClick:function(){return n(e)},children:e},e)}))})})},dt=function(e){var t=e.variables,n=e.variable,a=e.setVariable,i=e.minHeight,o=e.editAll,c=Object(r.useMemo)((function(){var e=[];return null!=t&&(null===t||void 0===t?void 0:t.length)>0&&(e=t.map((function(e){return e.name})),o&&e.push("EDIT ALL")),e}),[t,o]),l=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=c.findIndex((function(e){return e===n}))+t;r>c.length-1&&(r=0),r<0&&(r=c.length-1),a(c[r])};if(Object(r.useEffect)((function(){return window.addEventListener("keydown",l),function(){window.removeEventListener("keydown",l)}})),Object(r.useEffect)((function(){if(null===n&&a(c[0]),!t||0===t.length)return a(null),null}),[n,t,a,c]),!t)return null;var s=null;if(t){var u=t.find((function(e){return e.name===n}));s=null===u||void 0===u?void 0:u.instruction}return"EDIT ALL"===n&&(s="Show and edit all variables"),Object(g.jsxs)("div",{style:{background:"#1277c469",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",borderTop:"2px solid #2185d0",textAlign:"center"},children:[Object(g.jsx)(ut,{variable:n,setVariable:a,variables:t,variableNames:c,minHeight:i}),Object(g.jsx)("p",{style:{margin:"0",padding:"2px",minHeight:"24px"},children:s})]})},ft=(n(198),n(146)),bt=n.n(ft),jt=function(e){for(var t=function(e){return e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.required_for&&(e.required_for=[]),"object"!==typeof e.required_for&&(e.required_for=[e.required_for]),null==e.color&&(e.color=bt()({seed:e.code,luminosity:"light"})),e}))}(e),n=t.reduce((function(e,t){return e[t.code]=Object(u.a)(Object(u.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),r=0,a=Object.keys(n);r<a.length;r++){var i=a[r];""===n[i].parent||n[n[i].parent]||(n[n[i].parent]={code:n[i].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var o=0,c=Object.keys(n);o<c.length;o++){var l=c[o],d=ht(n,l),f=Object(s.a)(d,3);n[l].tree=f[0],n[l].activeParent=f[1],n[l].foldToParent=f[2],n[l].parent&&n[n[l].parent].children.push(l);var b,j=Object(p.a)(n[l].tree);try{for(j.s();!(b=j.n()).done;){var v=b.value;n[v].totalChildren++,n[l].active&&n[l].activeParent&&n[v].totalActiveChildren++}}catch(h){j.e(h)}finally{j.f()}}return n},vt=function e(t,n,r,a,i){var o,c=Object(p.a)(n);try{for(c.s();!(o=c.n()).done;){var l=o.value,s=Object(_.a)(a);s.push(l),r.push(Object(u.a)(Object(u.a)({},t[l]),{},{code:l,codeTrail:a,level:a.length,color:t[l].color?t[l].color:bt()({seed:l,luminosity:"light"})})),t[l].children&&e(t,t[l].children,r,s,i)}}catch(d){c.e(d)}finally{c.f()}},ht=function(e,t){for(var n=[],r=!0,a="",i=e[t].parent;i;)n.push(i),null!=e[i].folded&&e[i].folded&&(a=i,null==e[i].active||e[i].active||(r=!1)),i=e[i].parent;return[n.reverse(),r,a]};var pt=function(e){var t=e.unit,n=e.variables,a=e.settings,i=e.onChangeAnnotations,o=e.returnTokens,c=e.returnVariableMap,l=e.setReady,d=e.blockEvents,f=e.fullScreenNode,b=Object(r.useRef)(null),j=Object(r.useState)(null),v=Object(s.a)(j,2),h=v[0],O=v[1],x=Object(r.useState)({}),m=Object(s.a)(x,2),y=m[0],k=m[1],w=Object(r.useState)(0),C=Object(s.a)(w,2),S=C[0],E=C[1],_=st(t,b,o,k),A=Object(s.a)(_,4),R=A[0],L=A[1],M=A[2],T=function(e,t,n){var a=Object(r.useState)(!1),i=Object(s.a)(a,2),o=i[0],c=i[1],l=Object(r.useState)(null),d=Object(s.a)(l,2),f=d[0],b=d[1],j=Object(r.useState)(null),v=Object(s.a)(j,2),h=v[0],O=v[1];return Object(r.useEffect)((function(){if(!e||0===e.length)return b(null),null;var t,n={},r=Object(p.a)(e);try{var a=function(){var e=t.value,r=jt(e.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[e.name]=Object(u.a)(Object(u.a)({},e),{},{codeMap:r})};for(r.s();!(t=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}console.log(n),b(n)}),[e,b]),Object(r.useEffect)((function(){var e,r;if(null!==f){var a;a=null===t||"EDIT ALL"===t?f:Object(qe.a)({},t,f[t]),a=Object(u.a)({},a);for(var i=function(){var e,t=l[o];a[t]=Object(u.a)({},a[t]),null!==(e=a[t])&&void 0!==e&&e.onlyImported&&(a[t].codeMap=Object.keys(a[t].codeMap).reduce((function(e,r){var i;return null!==n&&void 0!==n&&null!==(i=n[t])&&void 0!==i&&i[r]&&(e[r]=Object(u.a)({},a[t].codeMap[r])),e}),{}))},o=0,l=Object.keys(a);o<l.length;o++)i();O(a),c((null===(e=a)||void 0===e||null===(r=e[t])||void 0===r?void 0:r.editMode)||"EDIT ALL"===t)}else O(null)}),[n,f,t,O,c]),t?[h,o]:[null,o]}(n,h,A[3]),N=Object(s.a)(T,2),I=N[0],H=N[1],P=tt(R.tokens,I,H,n,L,M,y,k,f),U=Object(s.a)(P,3),z=U[0],F=U[1],D=U[2];return Object(r.useEffect)((function(){L&&i&&b.current.tokens===R.tokens&&i(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===Object.keys(e).length?[]:Object.keys(e).reduce((function(r,a){for(var i=e[a],o=0,c=Object.keys(i);o<c.length;o++){var l=c[o];if("unit"===a||i[l].index===i[l].span[0]){var s={variable:i[l].variable,value:i[l].value,field:i[l].field,offset:i[l].offset,length:i[l].length};n&&function(){var e=i[l].span,n=t.slice(e[0],e[1]+1).map((function(t,n){var r=t.text;return n>0&&(r=t.pre+r),n<e[1]-e[0]&&(r+=t.post),r})).join("");s.text=n,s.token_span=e}(),r.push(s)}}return r}),[])}(L,R.tokens,!0))}),[R.tokens,L,i]),Object(r.useEffect)((function(){c&&c(I)}),[I,c]),Object(r.useEffect)((function(){l&&l((function(e){return e+1})),M((function(e){return Object(u.a)({},e)}))}),[S,M,l]),R.tokens?Object(g.jsxs)("div",{style:{display:"flex",height:"100%",maxHeight:"100%",flexDirection:"column"},children:[Object(g.jsx)(Pe,{tokens:R.tokens,text_fields:R.text_fields,meta_fields:R.meta_fields,setReady:E,maxHeight:n&&n.length>1?"calc(100% - 60px)":"calc(100% - 30px)",editMode:H}),Object(g.jsx)(dt,{variables:n,variable:h,setVariable:O,editAll:null===a||void 0===a?void 0:a.editAll,minHeight:n&&n.length>1?60:30}),Object(g.jsx)(_e,{tokens:R.tokens,variableMap:I,annotations:L,disableAnnotations:!i||!I,editMode:H||"EDIT ALL"===h,triggerCodeSelector:F,eventsBlocked:D||d,fullScreenNode:f}),z||null]}):null},Ot=a.a.memo(pt),xt=n(147),gt=n(245),mt=n(239),yt=n(254),kt={centerVertical:!0},wt=function(e){var t=e.unit,n=e.codebook,a=e.setUnitIndex,i=e.blockEvents,o=e.fullScreenNode,c=Object(r.useState)([]),l=Object(s.a)(c,2),d=l[0],f=l[1],b=Object(r.useState)(0),j=Object(s.a)(b,2),v=j[0],h=j[1],p=Object(r.useState)(null),O=Object(s.a)(p,2),x=O[0],m=O[1],y={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},k=Object(r.useState)(0),w=Object(s.a)(k,2),C=w[0],S=w[1],E=Object(yt.a)(["questionTaskSettings"]),_=Object(s.a)(E,2),A=_[0],R=_[1],L=Object(r.useState)(A.questionTaskSettings||{splitHeight:60,textSize:1}),M=Object(s.a)(L,2),T=M[0],N=M[1],I=Object(r.useRef)(null);Object(r.useEffect)((function(){R("questionTaskSettings",JSON.stringify(T),{path:"/"})}),[T,R]),Object(r.useEffect)((function(){null!==n&&void 0!==n&&n.questions&&m(St(n))}),[n]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.backgroundColor="white",y.text.current.style.transition="",y.box.current.style.transition="",y.box.current.style.opacity=0,y.text.current.style.transform="translateX(0%) translateY(0%)"}),[y.text,y.box,t,v]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.transition="opacity 200ms ease-out",y.box.current.style.opacity=1}),[C,y.text,y.box,v]);var H=Object(r.useState)(null),P=Object(s.a)(H,2),U=P[0],z=P[1],F=Object(xt.useSwipeable)(At(null===x||void 0===x?void 0:x[v],y,z,!1)),D=Object(xt.useSwipeable)(At(null===x||void 0===x?void 0:x[v],y,z,!0));return t?Object(g.jsxs)("div",{ref:I,style:{height:"100%"},children:[Object(g.jsxs)("div",Object(u.a)(Object(u.a)({},F),{},{style:{position:"relative",border:"1px solid",height:"".concat(T.splitHeight,"%")},children:[Object(g.jsxs)("div",{ref:y.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(g.jsx)("div",{ref:y.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(g.jsx)("div",{ref:y.text,style:{border:"1px solid",height:"100%",width:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(T.textSize,"em")},children:Object(g.jsx)(Ot,{unit:t,settings:kt,setReady:S,returnTokens:f,fullScreenNode:o})})]}),Object(g.jsx)(Ct,{settings:T,setSettings:N,fullScreenNode:o})]})),Object(g.jsx)("div",Object(u.a)(Object(u.a)({},D),{},{style:{height:"".concat(100-T.splitHeight,"%")},children:Object(g.jsx)($,{unit:t,tokens:d,questions:x,questionIndex:v,setQuestionIndex:h,setUnitIndex:a,swipe:U,blockEvents:i})}))]}):null},Ct=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(g.jsx)(Oe.a,{on:"click",mountNode:r||void 0,trigger:Object(g.jsx)(v.a,{size:"large",name:"setting",style:{position:"absolute",cursor:"pointer",top:"1px",left:"-1px",color:"#1b1c1d",padding:"5px 0px",height:"30px"}}),children:Object(g.jsx)(gt.a,{children:Object(g.jsxs)(gt.a.Group,{grouped:!0,children:[Object(g.jsxs)(gt.a.Field,{children:[Object(g.jsxs)("label",{children:["text window size ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(g.jsx)(mt.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(g.jsxs)(gt.a.Field,{children:[Object(g.jsxs)("label",{children:["text size scaling ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(g.jsx)(mt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{textSize:t.value})}))}})]})]})})})},St=function(e){return e.questions.map((function(e){var t=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return vt(e,n,r,[],t),r.map((function(e,t){return Object(u.a)(Object(u.a)({},e),{},{i:t})}))}(jt(e.codes));t=Et(Object(_.a)(t));var n=_t(t),r=Object(s.a)(n,2),a=r[0],i=r[1];return Object(u.a)(Object(u.a)({},e),{},{options:a,swipeOptions:i})}))},Et=function(e){var t,n=e.reduce((function(e,t){if(!t.required_for)return e;if("object"!==typeof t.required_for)e.add(t.required_for);else{var n,r=Object(p.a)(t.required_for);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.add(a)}}catch(i){r.e(i)}finally{r.f()}}return e}),new Set),r=Object(p.a)(e);try{for(r.s();!(t=r.n()).done;){var a,i=t.value,o=Object(p.a)(n);try{for(o.s();!(a=o.n()).done;){var c=a.value;i.required_for&&(i.required_for===c||i.required_for.includes(c))||i.makes_irrelevant.includes(c)||(i.makes_irrelevant=[].concat(Object(_.a)(i.makes_irrelevant),[c]))}}catch(l){o.e(l)}finally{o.f()}}}catch(l){r.e(l)}finally{r.f()}return e},_t=function(e){var t,n=[],r={},a=Object(p.a)(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.active&&i.activeParent){var o=i.tree.join(" - "),c={code:i.code,tree:o,makes_irrelevant:i.makes_irrelevant,color:i.color};i.swipe&&(r[i.swipe]=c),n.push(c)}}}catch(l){a.e(l)}finally{a.f()}return[n,r]},At=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var i=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},c=function(e){var n=e.deltaX,a=e.deltaY;if(Math.abs(n)>Math.abs(a)+10&&(a=0),Math.abs(n)<Math.abs(a)+10&&(n=0),!r){var i=t.text.current.getElementsByClassName("TokensContainer")[0];i.scrollHeight-Math.ceil(i.scrollTop)===i.clientHeight||(a=0)}return[n,a]};return Object(u.a)({onSwiping:function(n){var r,a,i=c(n),o=Object(s.a)(i,2),l=o[0],u=o[1];if((!(l>0)||e.swipeOptions.right)&&(!(l<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(l,"px) translateY(").concat(u,"px)");var d,f,b,j,v=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,h=null===(a=e.swipeOptions.up)||void 0===a?void 0:a.code,p="0%",O="center";if(l>0)v=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.color,h=null===(f=e.swipeOptions.right)||void 0===f?void 0:f.code,p="40%",O="left";if(l<0)v=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.color,h=null===(j=e.swipeOptions.left)||void 0===j?void 0:j.code,p="40%",O="right";t.box.current.style.backgroundColor=v,t.code.current.innerText=h,t.code.current.style.bottom=p,t.code.current.style.textAlign=O}},onSwiped:function(r){var o=c(r),l=Object(s.a)(o,2),u=l[0],d=l[1];if((!(u>0)||e.swipeOptions.right)&&(!(u<0)||e.swipeOptions.left)&&(!(d<0)||e.swipeOptions.up)&&!(0!==d&&d>0))if(t.text.current.style.transition="transform ".concat(i,"ms ease-out, opacity ").concat(i,"ms ease-out"),Math.abs(u)<a&&Math.abs(d)<a)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(u>0?100:u<0?-100:0,"%) translateY(").concat(d>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(i,"ms ease-out"),t.box.current.style.opacity=0;n(u>0?"right":"left"),n(null)}}},o)},Rt=a.a.memo(wt),Lt=n(248),Mt=n(241),Tt=n(145),Nt=[4,4,2,2],It=function(e,t,n){var r,a=[],i=0,o=function(t){if(t){var n=null===e||void 0===e?void 0:e[t[0]];null!==n&&void 0!==n&&n.triggerCodePopup&&n.triggerCodePopup(t)}},c=Object(p.a)(n);try{for(c.s();!(r=c.n()).done;){var l=r.value,s=l.text||"",u=Object(g.jsx)(Ht,{variable:l.variable,variableMap:t,annotation:l,onClick:o,text:s},i);null!==u&&a.push(u),i++}}catch(d){c.e(d)}finally{c.f()}return a},Ht=function(e){var t,n,r=e.variable,a=e.variableMap,i=e.annotation,o=e.onClick,c=e.text;if(null===a||void 0===a||null===(t=a[i.variable])||void 0===t||!t.codeMap)return null;var l=a[r].codeMap;if(null===l||void 0===l||!l[i.value]||!l[i.value].active)return null;var s=xe(i.value,l),u=null!==(n=l[i.value])&&void 0!==n&&n.foldToParent?"".concat(l[i.value].foldToParent," - ").concat(i.value):i.value,d="".concat(i.offset,"-").concat(i.offset+i.length);return Object(g.jsxs)(Ae.a.Row,{className:"annotations-tr",onClick:function(){return o(i.token_span)},style:{cursor:"pointer"},children:[Object(g.jsx)(Ae.a.Cell,{width:Nt[0],children:Object(g.jsx)("span",{title:r,children:r})}),Object(g.jsx)(Ae.a.Cell,{title:u,width:Nt[1],style:s?{background:s}:null,children:Object(g.jsx)("span",{title:u,children:u})}),Object(g.jsx)(Ae.a.Cell,{title:i.field,width:Nt[2],children:i.field}),Object(g.jsx)(Ae.a.Cell,{title:d,width:Nt[3],children:d}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("span",{title:c,children:c})})]})},Pt=function(e){var t=e.tokens,n=e.variableMap,r=e.annotations;return n&&0!==Object.keys(n).length?Object(g.jsxs)(Ae.a,{style:{fontSize:"10px",maxHeight:"100%",borderRadius:"0px"},fixed:!0,role:"grid","arioa-labelledby":"header",unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(g.jsx)(Ae.a.Header,{className:"annotations-thead",style:{height:"40px"},children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.HeaderCell,{title:"Variable",width:Nt[0],children:"Variable"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Vale",width:Nt[1],children:"Value"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Field",width:Nt[2],children:"Field"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Position",width:Nt[3],children:"Position"}),Object(g.jsx)(Ae.a.HeaderCell,{title:"Text",children:"Text"})]})}),Object(g.jsx)(Ae.a.Body,{className:"annotations-tbody",style:{overflow:"auto",height:"calc(100% - 40px)"},children:It(t,n,r)})]}):null},Ut=function(e){var t=e.unit,n=e.codebook,a=e.setUnitIndex,i=e.blockEvents,o=e.fullScreenNode,c=zt(t),l=Object(s.a)(c,2),u=l[0],d=l[1],f=Object(r.useState)(null),b=Object(s.a)(f,2),v=b[0],h=b[1],p=Object(yt.a)(["annotateTaskSettings"]),O=Object(s.a)(p,2),m=O[0],y=O[1],k=Object(r.useState)(m.annotateTaskSettings||{textSize:1}),w=Object(s.a)(k,2),C=w[0],S=w[1],E=Object(r.useState)(null),_=Object(s.a)(E,2),A=_[0],R=_[1];return Object(r.useEffect)((function(){y("annotateTaskSettings",JSON.stringify(C),{path:"/"})}),[C,y]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(g.jsxs)(j.a,{centered:!0,stackable:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(g.jsxs)(j.a.Column,{width:10,style:{paddingRight:"0em",paddingTop:"0",height:"100%"},children:[Object(g.jsxs)(x.a.Group,{fluid:!0,style:{padding:"0",height:"40px"},children:[Object(g.jsx)(Wt,{settings:C,setSettings:S,fullScreenNode:o}),Object(g.jsx)(qt,{fullScreenNode:o}),Object(g.jsx)(Bt,{unit:t,annotations:u,setUnitIndex:a})]}),Object(g.jsx)("div",{style:{height:"calc(100% - 20px",fontSize:"".concat(C.textSize,"em")},children:Object(g.jsx)(Ot,{unit:t,settings:null===n||void 0===n?void 0:n.settings,variables:null===n||void 0===n?void 0:n.variables,onChangeAnnotations:d,returnTokens:R,returnVariableMap:h,blockEvents:i,fullScreenNode:o})})]}),Object(g.jsx)(j.a.Column,{width:6,style:{paddingRight:"0em",padding:"0",height:"100%",paddingLeft:"10px"},children:Object(g.jsx)("div",{style:{borderBottom:"1px solid",height:"calc(100%)",overflow:"auto"},children:Object(g.jsx)(Pt,{tokens:A,variableMap:v,annotations:u})})})]}):null},zt=function(e){var t=Object(r.useState)([]),n=Object(s.a)(t,2),i=n[0],o=n[1],c=Object(r.useRef)(null);return Object(r.useEffect)((function(){e?(c.current=e.unitId,o(e.annotations||[])):o([])}),[e,o]),[i,a.a.useCallback((function(t){if(e.unitId===c.current){o(t);var n=Dt(t);if(Ft(e.annotations,n)){var r="DONE"===(null===e||void 0===e?void 0:e.status)?"DONE":"IN_PROGRESS";e.jobServer.postAnnotations(e.unitId,n,r)}}}),[e])]},Ft=function(e,t){if(e.length!==t.length)return!0;for(var n=["variable","value","field","offset","length"],r=0;r<e.length;r++){var a,i=Object(p.a)(n);try{for(i.s();!(a=i.n()).done;){var o,c,l=a.value;if((null===(o=e[r])||void 0===o?void 0:o[l])!==(null===(c=t[r])||void 0===c?void 0:c[l]))return!0}}catch(s){i.e(s)}finally{i.f()}}return!1},Dt=function(e){return e.map((function(e){return{variable:e.variable,value:e.value,field:e.field,offset:e.offset,length:e.length,text:e.text}}))},Bt=function(e){var t=e.unit,n=e.annotations,a=e.setUnitIndex,i=Object(r.useState)("ready"),o=Object(s.a)(i,2),c=o[0],l=o[1],u=function(){"ready"===c&&(l("loading"),t.jobServer.postAnnotations(t.unitId,Dt(n),"DONE").then((function(e){a((function(e){return e+1})),l("cooldown"),setTimeout((function(){l("ready")}),1e3)})).catch((function(e){console.log(e),l("ready")})))},d=function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),u())};return Object(r.useEffect)((function(){return window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}})),Object(g.jsx)(x.a,{disabled:"ready"!==c,loading:"loading"===c,primary:!0,size:"tiny",onClick:u,children:"Next Unit"})},qt=function(e){var t=e.fullScreenNode,n=Object(r.useState)(!1),a=Object(s.a)(n,2),i=a[0],o=a[1];return Object(g.jsxs)(Lt.a,{mountNode:t||void 0,flowing:!0,open:i,onClose:function(){return o(!1)},position:"bottom left",trigger:Object(g.jsx)(x.a,{secondary:!0,size:"tiny",onClick:function(){return o(!i)},children:"Controls"}),children:[Object(g.jsx)(Lt.a.Header,{children:"Controls"}),Object(g.jsx)(Lt.a.Content,{children:Object(g.jsx)(Mt.a,{style:{overflow:"auto",paddingTop:"2em",width:"100%",maxWidth:"700px"},children:Object(g.jsxs)(Ae.a,{structured:!0,compact:!0,basic:"very",unstackable:!0,children:[Object(g.jsx)(Ae.a.Header,{children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.HeaderCell,{width:3}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Keyboard"}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Mouse"}),Object(g.jsx)(Ae.a.HeaderCell,{children:"Touchpad"})]})}),Object(g.jsxs)(Ae.a.Body,{children:[Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Navigate"})}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("i",{children:"Arrow keys"})}),Object(g.jsx)(Ae.a.Cell,{}),Object(g.jsx)(Ae.a.Cell,{})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Select words"})}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"spacebar"}),Object(g.jsx)("br",{}),"Hold to select mutiple"]}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"Left-click"}),Object(g.jsx)("br",{}),"Hold to select multiple"]}),Object(g.jsxs)(Ae.a.Cell,{children:[Object(g.jsx)("i",{children:"tab"})," twice to begin, then once to close"]})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Edit/remove code"})}),Object(g.jsx)(Ae.a.Cell,{colSpan:"3",children:"Select annotated words to overwrite or delete the code"})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsxs)("strong",{children:["Select variable",Object(g.jsx)("br",{}),"(if multiple)"]})}),Object(g.jsxs)(Ae.a.Cell,{children:["Next with ",Object(g.jsx)("i",{children:"tab"}),", previous with ",Object(g.jsx)("i",{children:"shift+tab"})]}),Object(g.jsx)(Ae.a.Cell,{colSpan:"2",children:"Use the buttons"})]}),Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("strong",{children:"Next unit"})}),Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)("i",{children:"ctrl+Enter"})}),Object(g.jsx)(Ae.a.Cell,{colSpan:"2",children:"Use the next unit button"})]})]}),Object(g.jsx)(Ae.a.Footer,{children:Object(g.jsxs)(Ae.a.Row,{children:[Object(g.jsxs)(Ae.a.HeaderCell,{children:[Object(g.jsx)("strong",{children:"Quick keys"})," ",Object(g.jsx)("br",{}),"in popup"]}),Object(g.jsx)(Ae.a.HeaderCell,{colSpan:"3",children:Object(g.jsxs)(pe.a,{as:"ul",children:[Object(g.jsxs)(Tt.a,{as:"li",children:[Object(g.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(g.jsxs)(Tt.a,{as:"li",children:["navigate buttons with ",Object(g.jsx)("i",{children:"arrow keys"}),", select with ",Object(g.jsx)("i",{children:"spacebar"})]}),Object(g.jsxs)(Tt.a,{as:"li",children:["use ",Object(g.jsx)("i",{children:"escape"})," to close popup and ",Object(g.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})})}),Object(g.jsx)(Lt.a.Actions,{children:Object(g.jsx)(x.a,{content:"Close",onClick:function(){return o(!1)},positive:!0})})]})},Wt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(g.jsx)(Oe.a,{on:"click",mountNode:r||void 0,trigger:Object(g.jsx)(x.a,{secondary:!0,width:1,size:"large",icon:"setting",style:{color:"white",maxWidth:"50px"}}),children:Object(g.jsx)(gt.a,{children:Object(g.jsx)(gt.a.Group,{grouped:!0,children:Object(g.jsxs)(gt.a.Field,{children:[Object(g.jsxs)("label",{children:["text size scaling ",Object(g.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(g.jsx)(mt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(u.a)(Object(u.a)({},e),{},{textSize:t.value})}))}})]})})})})},Vt=a.a.memo(Ut),Yt=function(e){var t,n=e.unit,r=e.setUnitIndex,a=e.fullScreenNode,i=null===n||void 0===n||null===(t=n.jobServer)||void 0===t?void 0:t.codebook;if(!i||!n)return null;return null!==i&&void 0!==i&&i.type?function(e){switch(e){case"questions":return Object(g.jsx)(Rt,{unit:n,codebook:i,setUnitIndex:r,fullScreenNode:a});case"annotate":return Object(g.jsx)(Vt,{unit:n,codebook:i,setUnitIndex:r,fullScreenNode:a});default:return null}}(i.type):null},Gt=n(151),Jt=function(e){var t=e.children,n=Object(r.useState)(null),a=Object(s.a)(n,2),i=a[0],o=a[1];return Object(g.jsx)("div",{className:"dom-node-provider",ref:o,children:t(i)})},Qt=function(e){var t=e.handle,n=e.askFullScreenSetting,a=Object(r.useState)(!1),i=Object(s.a)(a,2),o=i[0],c=i[1];return Object(r.useEffect)((function(){n&&c(!0)}),[c,n,t]),Object(g.jsxs)(Lt.a,{open:o,children:[Object(g.jsx)(Lt.a.Header,{children:"Fullscreen mode"}),Object(g.jsxs)(Lt.a.Content,{children:[Object(g.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-right corner. For some devices fullscreen might not work."}),Object(g.jsxs)("div",{style:{display:"flex",height:"30%"},children:[Object(g.jsx)(x.a,{primary:!0,size:"massive",onClick:function(){t.active||t.enter(),c(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(g.jsx)(x.a,{secondary:!0,size:"massive",onClick:function(){t.active&&t.exit(),c(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},Kt=function(e){var t=e.handle;return Object(g.jsx)(v.a.Group,{size:"big",style:{paddingRight:"10px",position:"absolute",top:"0px",right:0},children:Object(g.jsx)(v.a,{link:!0,name:t.active?"compress":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},Xt=function(e){var t=e.children,n=e.askFullScreen,r=Object(Gt.b)(),a=Object(g.jsx)(Kt,{handle:r});return Object(g.jsx)(Gt.a,{handle:r,children:Object(g.jsx)(Jt,{style:{height:"100%"},children:function(e){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(Qt,{handle:r,askFullScreenSetting:n}),t(e,a)]})}})})},Zt=(n(200),function(){var e=Object(d.a)(b.a.mark((function e(t,n,r,a){var i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.getUnit(n);case 5:i=e.sent,r(Object(u.a)(Object(u.a)({jobServer:t,unitId:i.id},i.unit),{},{annotations:i.annotation,status:i.status})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),404===(null===(o=e.t0.response)||void 0===o?void 0:o.status)&&a(null),r(null),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()),$t=function(e){var t;switch(null===e||void 0===e||null===(t=e.codebook)||void 0===t?void 0:t.type){case"questions":return["800px","1000px"];case"annotate":return["2000px","2000px"];default:return["100%","100%"]}},en=function(e){var t=e.jobServer;return t?t.getAllAnnotations?Object(g.jsx)(j.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(g.jsxs)(j.a.Row,{style:{marginTop:"40%"},children:[Object(g.jsx)(j.a.Column,{width:4,children:Object(g.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(g.jsxs)(j.a.Column,{width:8,children:[Object(g.jsx)(h.a,{children:"You finished the codingjob!"}),Object(g.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(g.jsx)(k,{jobServer:t})]})]})}):Object(g.jsx)(j.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(g.jsx)(j.a.Row,{style:{marginTop:"40%"},children:Object(g.jsx)("div",{children:Object(g.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):null},tn=function(e){var t=e.jobServer,n=e.askFullScreen,a=Object(r.useState)(-1),i=Object(s.a)(a,2),o=i[0],c=i[1],l=Object(r.useState)(null),u=Object(s.a)(l,2),d=u[0],f=u[1];Object(r.useEffect)((function(){c(t.progress.n_coded)}),[t,c]),Object(r.useEffect)((function(){t&&null!==o&&Zt(t,o,f,c)}),[o,t,c,f]);var b=function(e){return o<0?null:null===o?Object(g.jsx)(en,{jobServer:t}):Object(g.jsx)(Yt,{unit:d,setUnitIndex:c,fullScreenNode:e})},j=$t(t),v=Object(s.a)(j,2),h=v[0],p=v[1];return Object(g.jsx)(Xt,{askFullScreen:n,children:function(e,n){return Object(g.jsxs)("div",{style:{maxWidth:p,maxHeight:h,background:"white",margin:"0 auto",padding:"0",height:"100%",border:"1px solid white"},children:[Object(g.jsxs)("div",{style:{height:"45px",padding:"0",position:"relative"},children:[Object(g.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(g.jsx)(E,{n:null===t||void 0===t?void 0:t.progress.n_total,index:o,setIndex:c,canGoBack:null===t||void 0===t?void 0:t.progress.seek_backwards,canGoForward:null===t||void 0===t?void 0:t.progress.seek_forwards})}),Object(g.jsx)("div",{children:n})]}),Object(g.jsx)("div",{style:{height:"calc(100% - 45px)",padding:"0"},children:b(e)})]})}})},nn=n(23),rn=n(21),an=n(148),on=n.n(an);function cn(e,t,n){return ln.apply(this,arguments)}function ln(){return(ln=Object(d.a)(b.a.mark((function e(t,n,r){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on.a.get("".concat(t,"/token"),{auth:{username:n,password:r}});case 2:return a=e.sent,e.abrupt("return",a.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sn=function(){function e(t,n){Object(nn.a)(this,e),this.host=t,this.token=n,this.api=on.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(n)}})}return Object(rn.a)(e,[{key:"init",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLogin();case 2:t=e.sent,this.email=t.email,this.is_admin=t.is_admin,this.jobs=t.jobs;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getLogin",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/login");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/token",{params:{user:t}});case 2:return n=e.sent,e.abrupt("return",n.data.token);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUsers",value:function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/users");case 2:return t=e.sent,e.abrupt("return",t.data.users);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodebook",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/codebook"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProgress",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/progress"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(b.a.mark((function e(t,n){var r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/codingjob/".concat(t,"/unit"),null!==n&&(r+="?index=".concat(n)),e.next=4,this.api.get(r);case 4:return a=e.sent,e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}},{key:"postPassword",value:function(e,t){var n={password:t};return e&&(n.user=e),this.api.post("/password",n)}},{key:"postUsers",value:function(e){return this.api.post("/users",e)}},{key:"postAnnotation",value:function(e,t,n,r){var a={annotation:n,status:r};return this.api.post("/codingjob/".concat(e,"/unit/").concat(t,"/annotation"),a)}}]),e}(),un=sn,dn=function(){var e=Object(d.a)(b.a.mark((function e(t,n,r,a,i){var o,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new un(t,n),e.prev=1,e.next=4,o.init();case 4:i(o),a("auth",Object(u.a)(Object(u.a)({},r.auth),{},Object(qe.a)({host:t},t+"__token__",n)),{path:"/"}),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(1),c=Object(u.a)(Object(u.a)({},r.auth),{},Object(qe.a)({host:t},t+"__token__",null)),i((function(e){return null===e?e:null})),a("auth",c,{path:"/"});case 13:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n,r,a,i){return e.apply(this,arguments)}}(),fn=function(e){var t,n=e.urlHost,r=e.backend,a=e.setBackend,i=Object(yt.a)([]),o=Object(s.a)(i,2),c=o[0],l=o[1],d=n||(null===c||void 0===c||null===(t=c.auth)||void 0===t?void 0:t.host)||null;return r?Object(g.jsx)(bn,{setLogout:function(){a(null),l("auth",Object(u.a)(Object(u.a)({},c.auth),{},Object(qe.a)({host:d},d+"__token__",null)),{path:"/"})}}):Object(g.jsx)(jn,{recHost:d,setLogin:function(e,t){dn(e,t,c,l,a)}})},bn=function(e){var t=e.setLogout;return Object(g.jsx)(g.Fragment,{children:Object(g.jsx)(j.a,{textAlign:"center",children:Object(g.jsx)(j.a.Column,{children:Object(g.jsx)(x.a,{secondary:!0,onClick:t,children:"Sign out"})})})})},jn=function(e){var t=e.recHost,n=e.setLogin,a=Object(r.useState)(""),i=Object(s.a)(a,2),o=i[0],c=i[1],l=Object(r.useState)(""),u=Object(s.a)(l,2),f=u[0],v=u[1],p=Object(r.useState)(""),O=Object(s.a)(p,2),m=O[0],y=O[1],k=Object(r.useState)(!1),C=Object(s.a)(k,2),S=C[0],E=C[1],_=Object(r.useState)(!1),A=Object(s.a)(_,2),R=A[0],L=A[1],M=function(){var e=Object(d.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!!f.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)){e.next=4;break}return E(!0),e.abrupt("return");case 4:return y(""),e.prev=5,e.next=8,cn(o,f,m);case 8:t=e.sent,n(o,t),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(5),L(!0),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){t&&c(t)}),[t]),Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(h.a,{icon:"user",content:"Register or sign in"}),Object(g.jsx)(w.a,{placeholder:!0,attached:"bottom",children:Object(g.jsx)(j.a,{stackable:!0,textAlign:"center",children:Object(g.jsx)(j.a.Row,{children:Object(g.jsx)(j.a.Column,{children:Object(g.jsxs)(gt.a,{children:[Object(g.jsx)(gt.a.Input,{placeholder:"Host",name:"host",label:"Host",value:o,onChange:function(e,t){t.value.length<100&&c(t.value)},icon:"home",iconPosition:"left",autoFocus:!0}),Object(g.jsx)(gt.a.Input,{placeholder:"email adress",error:!!S&&"Please enter a valid email adress",name:"email",label:"Email",icon:"mail",iconPosition:"left",value:f,onChange:function(e,t){t.value.length<100&&(E(!1),v(t.value))}}),Object(g.jsx)(gt.a.Input,{placeholder:"password",name:"password",error:!!R&&"Invalid password for this host & email",label:"Password",type:"password",icon:"lock",iconPosition:"left",value:m,onChange:function(e,t){L(!1),y(t.value)}}),Object(g.jsx)(x.a,{disabled:0===m.length,primary:!0,fluid:!0,onClick:M,children:"Sign in"})]})})})})})]})},vn=function(e,t){var n=Object(yt.a)(["auth"]),a=Object(s.a)(n,2),i=a[0],o=a[1],c=Object(r.useState)(null),l=Object(s.a)(c,2),u=l[0],d=l[1],f=Object(r.useRef)();return f.current=i,Object(r.useEffect)((function(){var n,r,a=f.current,i=e||(null===a||void 0===a||null===(n=a.auth)||void 0===n?void 0:n.host)||null,c=t||(null===a||void 0===a||null===(r=a.auth)||void 0===r?void 0:r[i+"__token__"])||null;console.log(i,c),i&&c&&dn(i,c,a,o,d)}),[e,t,f,o,d]),[u,Object(g.jsx)(fn,{urlHost:e,backend:u,cookies:f.current,setCookies:o,setBackend:d})]},hn=function(){function e(t,n,r){Object(nn.a)(this,e),this.backend=t,this.job_id=n,this.where="remote",this.setJobServer=r}return Object(rn.a)(e,[{key:"init",value:function(){var e=Object(d.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.backend.getCodebook(this.job_id);case 3:return this.codebook=e.sent,e.next=6,this.backend.getProgress(this.job_id);case 6:this.progress=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),this.success=!1,e.abrupt("return");case 14:this.success=!0;case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t>=this.progress.n_coded&&!this.progress.seek_forwards,this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,this.backend.getUnit(this.job_id,n?null:t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(){var e=Object(d.a)(b.a.mark((function e(t,n,r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.backend.postAnnotation(this.job_id,t,n,r);case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),this.setJobServer&&this.setJobServer(null);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}()}]),e}(),pn=hn,On=n(251);function xn(e){var t=e.fullData,n=e.columns,a=e.onClick,i=e.buttons,o=e.backend,c=Object(r.useState)([]),l=Object(s.a)(c,2),u=l[0],d=l[1],f=Object(r.useState)(1),b=Object(s.a)(f,2),j=b[0],v=b[1];if(Object(r.useEffect)((function(){if(!t)return d([]),null;var e=t.length;v(Math.ceil(e/10));var n=[];e>0&&(n=t.slice(0,10)),d(n)}),[t]),u)return Object(g.jsx)(gn,{data:u,pages:j,columns:n,pageChange:function(e){var n=10*(e-1),r=t.slice(n,n+10);d(r)},onClick:a,buttons:i,backend:o})}var gn=function(e){var t=e.data,n=e.columns,r=e.pages,i=e.pageChange,o=e.onClick,c=e.buttons,l=e.backend,s=function(e){var t=n.map((function(t,r){return t.hide?null:(n.ref=a.a.createRef(),(i=t.f?t.f(e):e?e[t.name]:null)instanceof Date&&(i=i.toISOString().slice(0,19).replace(/T/g," ")),Object(g.jsx)(Ae.a.Cell,{ref:t.ref,children:Object(g.jsx)("span",{title:t.title?i:null,children:i})},r));var i}));return c&&(t=[Object(g.jsx)(Ae.a.Cell,{children:Object(g.jsx)(x.a.Group,{children:c.map((function(t){return Object(g.jsx)(t,{row:e,backend:l})}))})})].concat(Object(_.a)(t))),t};return t.length<1?null:Object(g.jsx)(Mt.a,{children:Object(g.jsxs)(Ae.a,{unstackable:!0,selectable:!0,fixed:!0,compact:!0,singleLine:!0,size:"small",style:{fontSize:"10px"},children:[Object(g.jsx)(Ae.a.Header,{children:Object(g.jsxs)(Ae.a.Row,{children:[c?Object(g.jsx)(Ae.a.HeaderCell,{},"buttons"):null,function(e,t){return t.map((function(e,t){return Object(g.jsx)(Ae.a.HeaderCell,{width:e.width||null,children:Object(g.jsx)("span",{children:e.name})},t)}))}(0,n)]})}),Object(g.jsx)(Ae.a.Body,{children:function(e){return e.map((function(e,t){return Object(g.jsx)(Ae.a.Row,{style:{cursor:o?"pointer":"default"},onClick:function(){return o?o(e):null},children:s(e)},t)}))}(t)}),Object(g.jsx)(Ae.a.Footer,{children:Object(g.jsx)(Ae.a.Row,{children:Object(g.jsx)(Ae.a.HeaderCell,{colSpan:c?n.length+1:n.length,children:r>1?Object(g.jsx)(S.a,{size:"mini",floated:"right",boundaryRange:1,siblingRange:1,ellipsisItem:{content:Object(g.jsx)(v.a,{name:"ellipsis horizontal"}),icon:!0},firstItem:{content:Object(g.jsx)(v.a,{name:"angle double left"}),icon:!0},lastItem:{content:Object(g.jsx)(v.a,{name:"angle double right"}),icon:!0},prevItem:{content:Object(g.jsx)(v.a,{name:"angle left"}),icon:!0},nextItem:{content:Object(g.jsx)(v.a,{name:"angle right"}),icon:!0},pointing:!0,secondary:!0,defaultActivePage:1,totalPages:r,onPageChange:function(e,t){return i(t.activePage)}}):null})})})]})})},mn=[{name:"title",title:!0},{name:"progress",f:function(e){return"".concat(e.n_coded||0," / ").concat(e.n_total)}},{name:"modified",title:!0}];function yn(e){var t=e.backend,n=Object(c.b)(),r=Object(s.a)(n,2)[1],a=null===t||void 0===t?void 0:t.jobs,i=a?a.filter((function(e){return"NEW"!==e.modified})):[],o=a?a.filter((function(e){return"NEW"===e.modified})):[];return Object(g.jsx)(xn,{fullData:[].concat(Object(_.a)(i),Object(_.a)(o)),columns:mn,onClick:function(e){r({host:t.host,job_id:e.id})}})}var kn=n(240),wn=n(258),Cn=n(249),Sn=[{name:"role",width:2,f:function(e){return e.is_admin?"admin":"coder"}},{name:"email",width:11,title:!0}];function En(e){var t=e.backend,n=e.users,a=e.setUsers;return Object(r.useEffect)((function(){t.getUsers().then(a).catch((function(e){return a([])}))}),[t,a]),Object(g.jsx)(xn,{fullData:n,columns:Sn,buttons:[An],backend:t})}var _n={padding:"5px"},An=function(e){var t=e.row,n=e.backend,a=Object(r.useState)(null),i=Object(s.a)(a,2),o=i[0],c=i[1],l=Object(r.useState)(!1),u=Object(s.a)(l,2),d=u[0],f=u[1];return Object(r.useEffect)((function(){(d||o)&&n.getToken(t.email).then((function(e){c("".concat(window.location.host,"/ccs-annotator-client/?host=").concat(n.host,"&token=").concat(e))})).catch((function(e){console.log(e)}))}),[d,o,n,t]),Object(g.jsxs)(Oe.a,{on:"click",onOpen:function(){return f(!0)},hoverable:!0,trigger:Object(g.jsx)(x.a,{icon:"linkify",style:_n}),children:[Object(g.jsxs)(h.a,{children:["Login link for ",t.email]}),Object(g.jsx)("p",{children:o}),Object(g.jsx)(x.a,{onClick:function(){return navigator.clipboard.writeText(o)},children:"Copy link"})]})};function Rn(e){var t=e.backend,n=e.users,a=e.setUsers,i=Object(r.useState)(""),o=Object(s.a)(i,2),c=o[0],l=o[1],u=Object(r.useState)([]),d=Object(s.a)(u,2),f=d[0],b=d[1];return Object(g.jsxs)(j.a,{textAlign:"center",style:{height:"100%"},children:[Object(g.jsx)(Ln,{backend:t,addUsers:f,setAddUsers:b,setUsers:a}),Object(g.jsxs)(j.a.Column,{width:"4",children:[Object(g.jsx)(h.a,{children:"Create new users"}),Object(g.jsx)(kn.a,{placeholder:"List email addresses, separated by newline, space, comma or semicolon",value:c,rows:"10",style:{width:"100%"},onChange:function(e,t){return l(t.value)}}),Object(g.jsx)(x.a,{fluid:!0,primary:!0,onClick:function(){return function(){var e=c.split(/[\s,;\n]/).reduce((function(e,t){if(""===(t=t.trim()))return e;var r=t.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),a=!!n.find((function(e){return e.email===t}));return e.push({email:t,validEmail:r,exists:a}),e}),[]);b(e)}()},children:"Create users"})]}),Object(g.jsxs)(j.a.Column,{width:"8",children:[Object(g.jsx)(h.a,{children:"Users"}),Object(g.jsx)(En,{backend:t,users:n,setUsers:a})]})]})}var Ln=function(e){var t=e.backend,n=e.addUsers,a=e.setAddUsers,i=e.setUsers,o=Object(r.useState)("idle"),c=Object(s.a)(o,2),l=c[0],u=c[1],f=Object(r.useState)(!1),j=Object(s.a)(f,2),p=j[0],O=j[1],m=function(){var e=Object(d.a)(b.a.mark((function e(r){var o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.reduce((function(e,t){return!t.validEmail||t.exists||e.push({email:t.email,admin:p,password:"test"}),e}),[]),console.log(o),e.prev=2,e.next=5,t.postUsers({users:o});case 5:return e.next=7,t.getUsers().then(i).catch((function(e){return i([])}));case 7:a([]),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),u("error");case 13:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}();return Object(g.jsxs)(Lt.a,{closeIcon:!0,open:n.length>0,onClose:function(){a([])},onOpen:function(){return u("idle")},children:[Object(g.jsx)(h.a,{icon:"users",content:"Create users"}),Object(g.jsxs)(Lt.a.Content,{children:[Object(g.jsx)("p",{children:"Do you want to add the following users?"}),Object(g.jsx)(pe.a,{children:n.map((function(e){var t="";return e.validEmail||(t="Invalid email address: "),e.exists&&(t="User already exists: "),Object(g.jsxs)(pe.a.Item,{children:[Object(g.jsx)(pe.a.Icon,{name:t?"exclamation":"check",style:{color:t?"red":"green"}}),Object(g.jsxs)(pe.a.Content,{children:[Object(g.jsx)("span",{style:{color:"red"},children:t}),e.email]})]},e.email)}))}),Object(g.jsx)(wn.a,{toggle:!0,label:"Add users as admin",checked:p,onClick:function(){return O(!p)}})]}),Object(g.jsxs)(Lt.a.Actions,{children:["error"===l?Object(g.jsx)("div",{children:"Could not add users (for a reason not yet covered in the error handling...)"}):null,"pending"===l?Object(g.jsx)(Cn.a,{active:!0,inverted:!0,children:Object(g.jsx)(C.a,{content:"Creating Users"})}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)(x.a,{color:"red",onClick:function(){a([])},children:[Object(g.jsx)(v.a,{name:"remove"})," No"]}),Object(g.jsxs)(x.a,{color:"green",onClick:m,children:[Object(g.jsx)(v.a,{name:"checkmark"})," Yes"]})]})]})]})};function Mn(e){var t=e.backend,n=e.loginForm,a=Object(r.useState)("coderView"),i=Object(s.a)(a,2),o=i[0],c=i[1],l=Object(r.useState)([]),u=Object(s.a)(l,2),d=u[0],f=u[1];return Object(g.jsxs)(j.a,{container:!0,inverted:!0,textAlign:"center",style:{marginTop:"20px",height:"calc(100vh - 20px)",width:"100vw"},children:[Object(g.jsx)(j.a.Row,{style:{height:"100px"},children:Object(g.jsxs)(j.a.Column,{style:{height:"100%"},children:[Object(g.jsxs)(h.a,{children:[Object(g.jsx)(v.a,{name:"home"}),t.host]}),n]})}),Object(g.jsx)(j.a.Row,{style:{height:"calc(100% - 100px)"},children:Object(g.jsxs)(j.a.Column,{style:{height:"100%"},width:"16",children:[Object(g.jsxs)(On.a,{attached:"top",tabular:!0,children:[Object(g.jsx)(On.a.Item,{name:"Coder view",active:"coderView"===o,onClick:function(){return c("coderView")}}),Object(g.jsx)(On.a.Item,{name:"Manage users",active:"manageUsers"===o,onClick:function(){return c("manageUsers")}})]}),Object(g.jsx)(w.a,{style:{height:"95%",overflow:"auto"},attached:"bottom",children:function(){switch(o){case"coderView":return Object(g.jsx)(Tn,{backend:t});case"manageJobs":default:return null;case"manageUsers":return Object(g.jsx)(Rn,{backend:t,users:d,setUsers:f})}}()})]})})]})}var Tn=function(e){var t=e.backend;return Object(g.jsx)(j.a,{textAlign:"center",style:{height:"100%"},children:Object(g.jsxs)(j.a.Column,{width:"8",children:[Object(g.jsx)(h.a,{children:"Coding jobs"}),Object(g.jsx)(yn,{backend:t})]})})};function Nn(e){var t=e.backend,n=e.loginForm;return Object(g.jsxs)(j.a,{container:!0,inverted:!0,textAlign:"center",style:{marginTop:"20px",minHeight:"50vh",maxHeight:"800px",width:"100vw"},verticalAlign:"middle",children:[Object(g.jsx)(j.a.Row,{children:Object(g.jsxs)(j.a.Column,{children:[Object(g.jsxs)(h.a,{children:[Object(g.jsx)(v.a,{name:"home"}),t.host]}),n]})}),Object(g.jsx)(j.a.Row,{children:Object(g.jsxs)(j.a.Column,{width:"16",style:{maxWidth:"500px"},children:[Object(g.jsx)(h.a,{children:"Coding jobs"}),Object(g.jsx)(yn,{backend:t})]})})]})}var In=function(e,t){var n=Object(r.useState)(null),a=Object(s.a)(n,2),i=a[0],o=a[1];return Object(r.useEffect)((function(){if(e&&null!=t&&null!==t){o(null);var n=new pn(e,t,o);n.init().then((function(){return o(n)}))}else o(null)}),[e,t]),i},Hn=function(){var e=Object(c.b)(),t=Object(s.a)(e,1)[0],n=t.get("host"),r=t.get("token"),a=t.get("job_id"),i=vn(n,r),o=Object(s.a)(i,2),l=o[0],u=o[1],d=In(l,a);if(!l)return Object(g.jsx)(j.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(g.jsx)(j.a.Column,{style:{maxWidth:"500px"},children:u})});if(!d){if(!l)return;return l.is_admin?Object(g.jsx)(Mn,{backend:l,loginForm:u}):Object(g.jsx)(Nn,{backend:l,loginForm:u})}return a&&d.job_id!==a||n&&l.host!==n?null:Object(g.jsx)(tn,{jobServer:d})},Pn=function(){return Object(g.jsx)(c.a,{basename:"/ccs-annotator-client",children:Object(g.jsx)("div",{style:{height:"100vh",width:"100vw"},children:Object(g.jsx)(l.c,{children:Object(g.jsx)(l.a,{path:"/",exact:!0,element:Object(g.jsx)(Hn,{})})})})})},Un=n(242);o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(Un.a,{children:Object(g.jsx)(Pn,{})})}),document.querySelector("#root"))}},[[220,1,2]]]);