(this["webpackJsonpccs-annotator-client"]=this["webpackJsonpccs-annotator-client"]||[]).push([[0],{213:function(e,t){},215:function(e,t){},232:function(e,t,n){},233:function(e,t,n){},257:function(e,t,n){"use strict";n.r(t);n(203);var r=n(0),i=n.n(r),a=n(69),o=n.n(a),c=n(191),l=n(6),s=n(9),u=n(19),d=n(14),f=n.n(d),b=n(289),v=n(49),j=n(288),h=n(12),p=n(183),x=n(258),O=n(1),g=function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i,a,o,c,l,u,d,b,v,j,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),i=t.getAllAnnotations(),a=[],o=Object(h.a)(i);try{for(o.s();!(c=o.n()).done;){l=c.value,u=l.annotations,d=r[l.unit_id],b=Object(h.a)(u);try{for(b.s();!(v=b.n()).done;)j=v.value,p=Object(s.a)(Object(s.a)({document_id:d.document_id,unit_id:d.unit_id},d.provenance),j),a.push(p)}catch(f){b.e(f)}finally{b.f()}}}catch(f){o.e(f)}finally{o.f()}n(a);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i,a,o,c,l,u,d,b,v,j,p,x,O,g,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=t.codebook.questions.map((function(e,t){return"Q".concat(t+1,"_").concat(e.name.replace(" ","_"))})),a=t.units.reduce((function(e,t){return e[t.unit_id]=t,e}),{}),o=t.getAllAnnotations(),c=Object(h.a)(o);try{for(c.s();!(l=c.n()).done;){if(u=l.value,d=u.annotations,b=a[u.unit_id],v=Object(s.a)(Object(s.a)({document_id:b.document_id,unit_id:b.unit_id},b.provenance),{},{offset:d[0].offset,length:d[0].length,section:d[0].section},d[0].meta),b.meta)for(j=0,p=Object.keys(b.meta);j<p.length;j++)x=p[j],v["meta_"+x]=b.meta[x];O=Object(h.a)(i);try{for(m=function(){var e=g.value,t=d.find((function(t){return t.variable===e}));v[e]=null==t?null:t.value},O.s();!(g=O.n()).done;)m()}catch(f){O.e(f)}finally{O.f()}r.push(v)}}catch(f){c.e(f)}finally{c.f()}n(r);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),y=function(e){var t=e.jobServer,n=Object(r.useState)(null),i=Object(l.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){switch(t.codebook.type){case"annotate":g(t,o);break;case"questions":m(t,o);break;default:return null}}),[t]),Object(O.jsx)(p.a,{filename:"CSSannotator_".concat(t.title,"_").concat(t.set,"_").concat(t.coderName,".json"),data:a,style:{cursor:"pointer"},children:Object(O.jsx)(x.a,{loading:null===a,primary:!0,content:"Download results",icon:"download",labelPosition:"left",size:"huge"})})},k=n(287),w=n(274),S=n(281),C=function(e){var t=e.n,n=e.index,i=e.setIndex,a=e.canGoForward,o=void 0===a||a,c=e.canGoBack,s=void 0===c||c,u=Object(r.useRef)(0),d=Object(r.useRef)(!1),f=Object(r.useState)(!1),b=Object(l.a)(f,2),v=b[0],j=b[1],h=Object(r.useState)(1),p=Object(l.a)(h,2),x=p[0],g=p[1],m=Object(r.useState)(1),y=Object(l.a)(m,2),C=y[0],E=y[1];if(Object(r.useEffect)((function(){n<0||(null!==n&&g(Math.min(n+1,t+1)),null===n&&g(t+1))}),[n,t,g]),Object(r.useEffect)((function(){u.current=0,d.current=!1}),[t]),Object(r.useEffect)((function(){if(!t)return null;g(1),d.current=!0}),[t,g]),Object(r.useEffect)((function(){if(!t)return null;u.current=Math.max(x,u.current),i(x-1===t?null:x-1),E(x)}),[t,i,x]),Object(r.useEffect)((function(){if(!t)return null;if(x===C)return j(!1),null;j(!0);var e=setTimeout((function(){g(C),j(!1)}),500);return function(){return clearTimeout(e)}}),[x,C,t,j]),!t)return null;var A=100*Math.max(0,u.current-1)/t;return Object(O.jsxs)(k.a,{style:{display:"flex",border:"none",boxShadow:"none",padding:"0",marginTop:"5px",leftMargin:"0px",width:"100%",maxHeight:"35px",borderRadius:"0"},children:[Object(O.jsx)(w.a,{active:v,content:""}),Object(O.jsx)(S.a,{secondary:!0,activePage:C,pageItem:C<=t?"".concat(C," / ").concat(t):"done / ".concat(t),size:"mini",firstItem:null,lastItem:null,prevItem:s?"back":"   ",nextItem:o||x<u.current?"next":"   ",siblingRange:0,boundaryRange:0,ellipsisItem:null,totalPages:t+1,onClick:function(e,t){return e.stopPropagation()},onPageChange:function(e,t){(o||x<u.current)&&Number(t.activePage)>x&&g(Number(t.activePage)),s&&Number(t.activePage)<x&&g(Number(t.activePage))},style:{fontSize:"9px",border:"none",boxShadow:"none",padding:0,margin:0}}),Object(O.jsx)("input",{style:{flex:"1 1 auto",background:"linear-gradient(to right, #7dd48d ".concat(A,"%, #fff ").concat(A,"% 100%, #fff 100%)")},min:1,max:t+1,onChange:function(e){Number(e.target.value)>C&&E(o?Number(e.target.value):Math.min(u.current,Number(e.target.value))),s&&Number(e.target.value)<C&&E(Number(e.target.value))},type:"range",value:C})]})},E=n(24),A=n(286),R=n(280),L=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,c=t-1;c>=0;c--){if(null==e[c].ref||null===e[c].ref.current)return c+1;var l=M(e[c].ref);if(null===l)return;if(null===a){if(T(i,l))continue;a=l}else if(!T(a,l))return c+1;var s=N(i,l);if(o>0&&s<o)return c+1;if(i.left>l.right)return c;o=s}return 0},_=function(e,t){for(var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=M(e[t].ref,null===e||void 0===e||null===(n=e[r])||void 0===n?void 0:n.ref),a=null,o=0,c=t+1;c<e.length;c++){if(null==e[c].ref||null===e[c].ref.current)return c-1;var l=M(e[c].ref);if(null===l)return;if(null===a){if(T(i,l))continue;a=l}else if(!T(a,l))return c-1;var s=N(i,l);if(o>0&&s<o)return c-1;if(i.right<l.left)return c;o=s}return e.length-1},T=function(e,t){var n=Math.max(e.top,t.top);return Math.min(e.bottom,t.bottom)-n>.5*e.height},N=function(e,t){var n=Math.max(e.left,t.left),r=Math.min(e.right,t.right),i=(r-n)/e.width,a=(r-n)/t.width;return Math.max(i,a)},M=function(e,t){if(null===e||void 0===e||!e.current)return null;var n=e.current.getBoundingClientRect();if(null!=t){var r=t.current.getBoundingClientRect();n.x=r.x,n.width=r.width}return n},I=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],H=i.a.memo((function(e){var t=e.options,n=e.callback,i=e.blockEvents,a=Object(r.useRef)();return Object(O.jsx)(A.a,{innerRef:a,children:Object(O.jsx)(R.a,{fluid:!0,scrolling:!0,upward:!1,placeholder:"<type to search>",searchInput:{autoFocus:!i},style:{minWidth:"12em"},options:t.map((function(e){return{key:e.code,value:e,text:e.code+(e.tree?" ("+e.tree+")":""),content:Object(O.jsxs)(O.Fragment,{children:[e.code,Object(O.jsx)("br",{}),Object(O.jsx)("span",{style:{color:"grey"},children:e.tree})]})}})),search:!0,selection:!0,compact:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onChange:function(e,t){n(t.value)}})})})),P=i.a.memo((function(e){var t=e.options,n=e.callback,a=e.blockEvents,o=Object(r.useState)(0),c=Object(l.a)(o,2),s=c[0],u=c[1],d=i.a.useCallback((function(e){var r=t.length;if(I.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&s<r-1&&u(s+1),"ArrowDown"===e.key&&u(_(t,s)),"ArrowLeft"===e.key&&s>0&&u(s-1),void("ArrowUp"===e.key&&u(L(t,s)));46===e.keyCode&&(n(null),u(0)),32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),e.stopPropagation(),s===t.length?n(null):n(t[s]),u(0))}),[s,n,t]);Object(r.useEffect)((function(){return a?window.removeEventListener("keydown",d):window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}}),[d,a]);return Object(O.jsx)("div",{style:{display:"flex",flexDirection:"row",alignItems:"space-eventy",maxWidth:"100%",height:"100%",flexWrap:"wrap",justifyContent:"space-around"},children:t.map((function(e,t){return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(A.a,{innerRef:e.ref,children:Object(O.jsx)(x.a,{style:{backgroundColor:e.color,padding:"1em",margin:"0.2em",flex:"0.5 1 0",flexBasis:"0",fontWeight:"bold",fontSize:"1em",border:t===s?"3px solid black":"3px solid #ece9e9"},value:e,compact:!0,onMouseOver:function(){return u(t)},onClick:function(e,t){n(t.value),u(0)},children:e.code},e.code)})})}))})})),z=i.a.memo((function(e){var t,n,a,o,c,l,s,u,d,f=e.swipeOptions,b=e.callback,j=e.swipe,h=e.blockEvents;Object(r.useEffect)((function(){j&&("right"===j&&b(f.right),"up"===j&&b(f.up),"left"===j&&b(f.left))}),[j,b,f]);var p=i.a.useCallback((function(e){I.includes(e.key)&&(e.preventDefault(),"ArrowRight"===e.key&&b(f.right),"ArrowUp"===e.key&&b(f.up),"ArrowLeft"===e.key&&b(f.left))}),[b,f]);return Object(r.useEffect)((function(){return h?window.removeEventListener("keydown",p):window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p,h]),Object(O.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignContent:"stretch",height:"100%"},children:[null==f.up?null:Object(O.jsx)(x.a,{fluid:!0,disabled:null==f.up,onClick:function(e,t){return b(f.up)},style:{margin:"0",padding:"0",flex:"1 1 auto",borderRadius:"0",border:"1px solid",background:(null===(t=f.up)||void 0===t?void 0:t.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)(v.a,{name:null!==(n=f.up)&&void 0!==n&&n.code?"arrow up":null}),Object(O.jsx)("span",{children:(null===(a=f.up)||void 0===a?void 0:a.code)||""})]})}),Object(O.jsx)("div",{style:{flex:"1 1 auto"},children:Object(O.jsxs)("div",{style:{padding:"0",margin:"0",display:"flex",height:"100%",flexWrap:"wrap",alignContent:"stretch"},children:[Object(O.jsx)(x.a,{disabled:null==f.left,onClick:function(e,t){return b(f.left)},style:{margin:"0",padding:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(o=f.left)||void 0===o?void 0:o.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)(v.a,{name:null!==(c=f.left)&&void 0!==c&&c.code?"arrow left":null}),Object(O.jsx)("span",{children:(null===(l=f.left)||void 0===l?void 0:l.code)||""})]})}),Object(O.jsx)(x.a,{disabled:null==f.right,onClick:function(e,t){return b(f.right)},style:{padding:"0",margin:"0",flex:"1 1 auto",width:"45%",borderRadius:"0",border:"1px solid",background:(null===(s=f.right)||void 0===s?void 0:s.color)||"white"},children:Object(O.jsxs)("div",{style:{color:"black",fontWeight:"bold",fontSize:"1em"},children:[Object(O.jsx)("span",{children:(null===(u=f.right)||void 0===u?void 0:u.code)||""}),Object(O.jsx)(v.a,{name:null!==(d=f.right)&&void 0!==d&&d.code?"arrow right":null})]})})]})})]})})),U="lightgreen",B=function(e){var t,n=e.unit,i=e.tokens,a=e.questions,o=e.questionIndex,c=e.setQuestionIndex,s=e.setUnitIndex,u=e.swipe,d=e.blockEvents,f=Object(r.useState)(),b=Object(l.a)(f,2),v=b[0],h=b[1],p=Object(r.useRef)(!1),x=Object(r.useState)(null),g=Object(l.a)(x,2),m=g[0],y=g[1];if(Object(r.useEffect)((function(){a&&(q(n,i,a,y),p.current=!1)}),[n,i,y,a]),!a||!n||!m)return null;if(null===a||void 0===a||!a[o])return c(0),null;var k=K(n,a[o]);return Object(O.jsxs)("div",{style:{height:"100%",width:"100%"},children:[Object(O.jsx)(F,{questions:a,questionIndex:o,annotations:m,setQuestionIndex:c}),Object(O.jsxs)("div",{style:{display:"flex",position:"relative",flexFlow:"column",height:"calc(100% - 30px)",width:"100%",maxHeight:"100%",padding:"10px",color:"white",borderBottomLeftRadius:"30px",borderBottomRightRadius:"30px",backgroundColor:"#1B1C1D"},children:[Object(O.jsx)("div",{style:{width:"100%",flex:"1 1 auto",paddingBottom:"10px"},children:Object(O.jsx)(j.a,{as:"h3",style:{color:"white"},children:k})}),Object(O.jsx)(W,{answerTransition:v,currentAnswer:null===m||void 0===m||null===(t=m[o])||void 0===t?void 0:t.value,questions:a,questionIndex:o,onSelect:function(e){if(p.current)return null;p.current=!0,m[o].value=e.code,m[o].makes_irrelevant=e.makes_irrelevant,n.annotations=J(m[o],n.annotations),D(n,a,m,o);for(var t=null,r=o+1;r<a.length;r++)if("IRRELEVANT"!==m[r].value){t=r;break}var i=null===t?"DONE":"IN_PROGRESS";n.jobServer.postAnnotations(n.unitId,n.annotations,i),h(e),setTimeout((function(){h(null),null===t?(s((function(e){return e+1})),c(0)):c(t),p.current=!1}),250)},swipe:u,blockEvents:d})]})]})},D=function(e,t,n,r){var i=new Set;for(var a in Object.keys(e.annotations)){var o=e.annotations[a].makes_irrelevant;if(null!=o&&null!==o){var c,l=Object(h.a)(o);try{var s=function(){var e=c.value;if("REMAINING"===e)for(var a=r+1;a<n.length;a++)i.add(a);var o=t.findIndex((function(t){return t.name===e}));o>=0&&i.add(o)};for(l.s();!(c=l.n()).done;)s()}catch(d){l.e(d)}finally{l.f()}}}for(var u=0;u<n.length;u++)i.has(u)?(n[u].value="IRRELEVANT",e.annotations=J(n[u],e.annotations)):"IRRELEVANT"===n[u].value&&(delete n[u].value,e.annotations=J(n[u],e.annotations))},q=function(e,t,n,r){if(0===t.length)return null;var i=[];e.annotations||(e.annotations=[]);for(var a=0;a<n.length;a++){var o=V(t,n[a],a);o.value=G(e.annotations,o),i.push(o)}r(i)},F=function(e){var t=e.questions,n=e.questionIndex,i=e.annotations,a=e.setQuestionIndex,o=Object(r.useState)(),c=Object(l.a)(o,2),s=c[0],u=c[1];Object(r.useEffect)((function(){var e=i.map((function(e){return null!==e.value}));e[0]=!0,u(e)}),[i,u]),Object(r.useEffect)((function(){u((function(e){var t=Object(E.a)(e);return t[n]=!0,t}))}),[n,u]);return Object(O.jsx)("div",{children:Object(O.jsx)(x.a.Group,{fluid:!0,style:{border:"1px solid",height:"30px"},children:t.map((function(e,r){var o=function(e){return i[e]?"IRRELEVANT"===i[e].value?["black","red"]:s&&e>n&&!s[e]?["white","grey"]:i[e].value?["black",U]:0===e||s&&s[e]?[U,"#1B1C1D"]:[U,"grey"]:["black","red"]}(r),c=Object(l.a)(o,2),u=c[0],d=c[1];return Object(O.jsx)(x.a,{active:r===n,style:{padding:"0em 0.2em 0.2em 0.2em",minWidth:"2em",height:"30px",borderRadius:"0",fontSize:"12px",border:"1px solid darkgrey",background:d,textOverflow:"clip",overflow:"hidden",color:u},onClick:function(){s[r]&&a(r)},children:Object(O.jsx)("span",{title:t[r].name,children:t[r].name})})}))})})},W=function(e){var t=e.answerTransition,n=e.currentAnswer,r=e.questions,i=e.questionIndex,a=e.onSelect,o=e.swipe,c=e.blockEvents;return t?Object(O.jsx)(k.a,{style:{display:"flex",flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",margin:"0",background:t.color,justifyContent:"center",alignItems:"center"},children:Object(O.jsx)(j.a,{as:"h1",children:t.code})}):Object(O.jsxs)(O.Fragment,{children:[Q(n||t),Object(O.jsxs)(k.a,{style:{flex:"1 1 auto",padding:"0",overflowY:"auto",height:"100%",width:"100%",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",margin:"0"},children:["search code"===r[i].type?Object(O.jsx)(H,{options:r[i].options,callback:a,blockEvents:c}):null,"select code"===r[i].type?Object(O.jsx)(P,{options:r[i].options,callback:a,blockEvents:c}):null,"annotinder"===r[i].type?Object(O.jsx)(z,{swipeOptions:r[i].swipeOptions,currentAnswer:n,callback:a,swipe:o,blockEvents:c}):null]})]})},V=function(e,t,n){if(0===e.length)return null;var r,i={},a=e[e.length-1],o=[0,a.offset+a.length],c=[0,e.length-1],l=!1,s=!1,u=0,d=Object(h.a)(e);try{for(d.s();!(r=d.n()).done;){var f=r.value;f.codingUnit&&!i[f.section]&&(i[f.section]=1),!l&&f.codingUnit&&(l=!0,o[0]=f.offset,c[0]=u),s||f.codingUnit||!l||(s=!0,o[1]=e[u-1].offset+e[u-1].length,c[1]=u-1),u++}}catch(v){d.e(v)}finally{d.f()}var b={length_tokens:1+c[1]-c[0],length_paragraphs:1+e[c[1]].paragraph-e[c[0]].paragraph,length_sentences:1+e[c[1]].sentence-e[c[0]].sentence};return{variable:"Q".concat(n+1,"_").concat(t.name.replace(" ","_")),value:null,section:Object.keys(i).join(" + "),offset:o[0],length:o[1]-o[0],meta:b}},Y=function(e,t){return e.variable===t.variable&&e.section===t.section&&e.offset===t.offset&&e.length===t.length},G=function(e,t){if(!e)return null;var n,r=Object(h.a)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(Y(i,t))return i.value}}catch(a){r.e(a)}finally{r.f()}return null},J=function(e,t){t||(t=[]);for(var n=0;n<t.length;n++)if(Y(t[n],e))return t[n]=e,t;return t.push(e),t},Q=function(e){return null==e?null:Object(O.jsx)("div",{style:{backgroundColor:"white",color:"black"},children:Object(O.jsx)(k.a,{style:{padding:"0 0 0.5em 0",margin:"0",borderRadius:"0",background:"#1B1C1D",color:U,textAlign:"center"},children:Object(O.jsxs)("div",{style:{marginTop:"0.3em"},children:["you answered:","  ",Object(O.jsx)("b",{style:{fontSize:"1.5em"},children:"".concat(e)})]})})})},K=function(e,t){var n=t.question;if(e.variables){for(var r=0,i=Object.keys(e.variables);r<i.length;r++){var a=i[r];if(n.search("\\[".concat(a,"\\]"))>=0){var o=e.variables[a],c="{{lightyellow###".concat(o,"}}");n=n.replace("[".concat(a,"]"),c)}}return X(n)}},X=function(e){var t=new RegExp(/{{(.*?)}}/);return e=e.replace(/(\r\n|\n|\r)/gm,""),Object(O.jsx)("div",{children:e.split(t).reduce((function(e,t,n){if(n%2===0)e.push(t);else{var r=t.split("###"),i=Object(l.a)(r,2),a=i[0],o=i[1];e.push(Object(O.jsx)("mark",{style:{backgroundColor:a},children:o},n+t))}return e}),[])})},Z=i.a.memo(B),$=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=n.top,a=n.height,o=r.top,c=o-i<50;o>i+.9*a&&(e.scrollTop=e.scrollTop+o-(.9*a+i)),c&&(e.scrollTop=e.scrollTop+o-(.1*a+i))},ee=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],te=function(e){var t=e.tokens,n=e.annotations,i=e.currentToken,a=e.setCurrentToken,o=e.tokenSelection,c=e.setTokenSelection,s=e.triggerCodePopup,u=e.editMode,d=e.eventsBlocked,f=Object(r.useState)(null),b=Object(l.a)(f,2),v=b[0],j=b[1],p=Object(r.useState)(!1),x=Object(l.a)(p,2),g=x[0],m=x[1],y=Object(r.useState)(null),k=Object(l.a)(y,2),w=k[0],S=k[1];return Object(r.useEffect)((function(){d&&(S(!1),m(!1))}),[S,m,d,c]),Object(r.useEffect)((function(){if(t){var e,n=Object(h.a)(t);try{var r=function(){var t=e.value;t.triggerCodePopup=function(e){var n,r;e||(e=[t.index,t.index]),null!==t&&void 0!==t&&null!==(n=t.containerRef)&&void 0!==n&&n.current&&null!==t&&void 0!==t&&null!==(r=t.ref)&&void 0!==r&&r.current&&(t.containerRef.current.style.scrollBehavior="smooth",$(t.containerRef.current,t.ref.current)),a({i:t.index}),c(e)}};for(n.s();!(e=n.n()).done;)r()}catch(i){n.e(i)}finally{n.f()}}}),[t,a,c]),Object(r.useEffect)((function(){var e,r;if(v&&w&&null!==t&&void 0!==t&&null!==(e=t[0])&&void 0!==e&&null!==(r=e.containerRef)&&void 0!==r&&r.current){var i,o=ae(t,n,w,v,g,u,a,c);1===v.counter?(t[0].containerRef.current.style.scrollBehavior="smooth",i=150):(t[0].containerRef.current.style.scrollBehavior="auto",i=Math.max(5,100/Math.ceil(v.counter/5))),setTimeout((function(){j({position:o,startposition:v.startposition,ntokens:v.ntokens,counter:v.counter+1})}),i)}}),[t,v,w,g,a,u,n,c]),t&&0!==t.length?d?null:Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(ne,{tokenSelection:o,currentToken:i,tokens:t,HoldSpace:g,setMover:j,setHoldSpace:m,setHoldArrow:S,triggerCodePopup:s,editMode:u}),Object(O.jsx)(re,{tokenSelection:o,tokens:t,setCurrentToken:a,setTokenSelection:c,triggerCodePopup:s,editMode:u})]}):null},ne=function(e){var t=e.tokenSelection,n=e.currentToken,i=e.tokens,a=e.HoldSpace,o=e.setMover,c=e.setHoldSpace,l=e.setHoldArrow,s=e.triggerCodePopup;e.editMode;Object(r.useEffect)((function(){return window.addEventListener("keydown",d),window.addEventListener("keyup",u),function(){window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}}));var u=function(e){if(32===e.keyCode&&a)return c(!1),void(t.length>0&&ie(i,t,s));ee.includes(e.key)&&(l(!1),o(null))},d=function(e){if(32!==e.keyCode){if(ee.includes(e.key)){if(e.preventDefault(),e.repeat)return;o({position:n.i,startposition:n.i,ntokens:i.length,counter:1}),l(e.key)}}else{if(e.preventDefault(),e.repeat)return;c(!0)}};return Object(O.jsx)(O.Fragment,{})},re=function(e){var t=e.tokenSelection,n=e.tokens,i=e.setCurrentToken,a=e.setTokenSelection,o=e.triggerCodePopup,c=e.editMode,l=Object(r.useRef)(!1),s=Object(r.useRef)(null),u=Object(r.useRef)(null),d=Object(r.useRef)("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);Object(r.useEffect)((function(){return window.addEventListener("mousedown",v),window.addEventListener("mousemove",j),window.addEventListener("mouseup",h),window.addEventListener("touchstart",f),window.addEventListener("touchend",b),window.addEventListener("contextmenu",p),function(){window.removeEventListener("mousedown",v),window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",h),window.removeEventListener("touchstart",f),window.removeEventListener("touchend",b),window.removeEventListener("contextmenu",p)}}));var f=function(e){u.current={time:new Date,token:se(n,e)}},b=function(e){var r;if(null!==(r=u.current)&&void 0!==r&&r.time&&!(new Date-u.current.time>150)){var l=u.current.token;if(null===(null===l||void 0===l?void 0:l.index))return de(n,s.current),s.current=null,void a((function(e){return 0===e.length?e:[]}));if(c)ie(n,[l.index,l.index],o);else{if(t.length>0&&t[0]===s.current){var d=x(l);return a((function(e){return je(e,n,d,!0)})),null!==l&&void 0!==l&&l.annotated&&d===t[0]?ie(n,[d,d],o):ie(n,[t[0],d],o),de(n,s.current),s.current=null,void i({i:null})}s.current!==l.index?(de(n,s.current),ue(n,l.index),s.current=l.index,i({i:l.index}),a((function(e){return 0===e.length?e:[]}))):(de(s.current),a((function(e){return je(e,n,l.index,!0)})))}}},v=function(e){d.current||1===e.which&&(l.current=!0,a((function(e){return 0===e.length?e:[]})))},j=function(e){if(!d.current)if(!c&&l.current){if(e.preventDefault(),1!==e.which&&0!==e.which)return null;window.getSelection().empty(),x(se(n,e))}else{var t=se(n,e);null!==t.index?(i((function(e){return e.i===t.index?e:{i:t.index}})),a((function(e){return je(e,n,t.index,!1)}))):i((function(e){return e.i===t.index||null===t.index?e:{i:t.index}}))}},h=function(e){if(!d.current){if(1!==e.which&&0!==e.which)return null;e.preventDefault(),e.stopPropagation();var r=x(se(n,e));window.getSelection().empty(),l.current=!1,t.length>0&&null!==t[0]&&null!==t[1]?ie(n,t,o):null!==r&&ie(n,[r,r],o)}},p=function(e){if(2===e.button)return null;e.preventDefault(),e.stopPropagation()},x=function(e){return i((function(t){return t.i===e.index?t:{i:e.index}})),a((function(t){return je(t,n,e.index,!0)})),e.index};return Object(O.jsx)(O.Fragment,{})},ie=function(e,t,n){var r=Object(l.a)(t,2),i=r[0],a=r[1];if(i>a){var o=[a,i];i=o[0],a=o[1]}n(e[a].index,[e[i].index,e[a].index])},ae=function(e,t,n,r,i,a,o,c){var l;if(l=a?ce(e,t,n,r):oe(e,n,i,r),r.position!==l){o((function(e){return{i:e===l?e:l}})),c((function(t){return je(t,e,l,!a&&i)}));var s=e[l].containerRef.current,u=e[l].ref.current;$(s,u)}return l},oe=function(e,t,n,r){var i,a=r.position;if("ArrowRight"===t&&a++,"ArrowLeft"===t&&a--,"ArrowUp"===t&&(a=le(e,r,"up")),"ArrowDown"===t&&(a=le(e,r,"down")),a>r.ntokens&&(a=r.ntokens),a<0&&(a=0),null==(null===(i=e[a])||void 0===i?void 0:i.ref)){if("ArrowLeft"===t||"ArrowUp"===t){var o=e.findIndex((function(e){return e.codingUnit}));if(o<0)return r.position;a=o}if("ArrowRight"===t||"ArrowDown"===t){var c=e.map((function(e){return e.codingUnit})).lastIndexOf(!0);if(c<0)return r.position;a=c-1}}if(n&&e[r.position].section!==e[a].section)if(a>r.position){for(var l=a;l>=r.position;l--)if(e[l].section===e[r.position].section){a=l;break}}else for(var s=a;s<=r.position;s++)if(e[s].section===e[r.position].section){a=s;break}return a},ce=function(e,t,n,r){var i=r.position;if("ArrowRight"===n||"ArrowDown"===n){var a=e.findIndex((function(e,t){var n,r,a;return t>i&&(null===e||void 0===e||null===(n=e.ref)||void 0===n?void 0:n.current.classList.contains("annotated"))&&((null===e||void 0===e||null===(r=e.ref)||void 0===r?void 0:r.current.classList.contains("allLeft"))||(null===e||void 0===e||null===(a=e.ref)||void 0===a?void 0:a.current.classList.contains("anyLeft")))}));if(a<0)return r.position;i=a}if("ArrowLeft"===n||"ArrowUp"===n){for(var o=-1,c=i-1;c>=-1;c--){var l,s,u,d,f,b;if(null===(l=e[c])||void 0===l||null===(s=l.ref)||void 0===s?void 0:s.current.classList.contains("annotated")){var v=null===(u=e[c])||void 0===u||null===(d=u.ref)||void 0===d?void 0:d.current.classList.contains("allLeft"),j=null===(f=e[c])||void 0===f||null===(b=f.ref)||void 0===b?void 0:b.current.classList.contains("anyLeft");if(v||j){o=c;break}}}if(o<0)return r.position;i=o}return i},le=function(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"up";if(null==(null===(n=e[t.position])||void 0===n?void 0:n.ref)||null==(null===(r=e[t.startposition])||void 0===r?void 0:r.ref)){var a=e.findIndex((function(e){return e.codingUnit}));return a<0?0:a}return"up"===i?L(e,t.position,t.startposition):"down"===i?_(e,t.position,t.startposition):void 0},se=function(e,t){var n=fe(e,t),r=Object(l.a)(n,2),i=r[0],a=r[1];return null===i?{index:null,annotated:!1}:{index:be(e,i),annotated:a}},ue=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.add("tapped")},de=function(e,t){var n,r=null===e||void 0===e||null===(n=e[t])||void 0===n?void 0:n.ref;null!==r&&void 0!==r&&r.current&&r.current.classList.remove("tapped")},fe=function(e,t){try{var n,r,i;if("mousemove"!==t.type&&"mouseup"!==t.type||(i=t.originalTarget||t.path[0]),"touchmove"===t.type||"touchstart"===t.type){var a=t.touches[0];i=document.elementFromPoint(a.clientX,a.clientY)}if("item"===(null===(n=i)||void 0===n||null===(r=n.parentNode)||void 0===r?void 0:r.className))return[null,!1];if(i){if(i.className.includes("token"))return[i,!1];if(i.parentNode&&i.parentNode.className.includes("token"))return[i.parentNode,!0]}return[null,!1]}catch(t){return[null,!1]}},be=function(e,t){return parseInt(t.getAttribute("tokenindex"))},ve=function(e,t){return t.length>0&&e[0]===t[0]&&e[1]===t[1]?e:t},je=function(e,t,n,r){if(null===n)return e;var i=Object(E.a)(e);if(!r||0===i.length)return ve(e,[n,n]);if(null===n)return ve(e,[i[0],null]);if(t[i[0]].section===t[n].section)i=[i[0],n];else if(n>i[0])for(var a=n;a>=i[0];a--)t[i[0]].section===t[a].section&&(i=[i[0],a]);else for(var o=n;o<=i[0];o++)t[i[0]].section===t[o].section&&(i=[i[0],o]);return ve(e,i)},he=n(292),pe=n(279),xe=function(e,t){if(t[e]){var n=t[e].foldToParent;return n&&t[n]?t[n].color+"50":t[e].color+"50"}return"EMPTY"===e?"lightgrey":"#ffffff50"},Oe=function(e){if(0===e.length)return"white";if(1===e.length)return e[0];var t=Math.floor(100/e.length),n=e.reduce((function(n,r,i){return 0===i&&n.push(r+" ".concat(t,"%")),i===e.length-1&&n.push(r+" ".concat(100-t,"%")),i>0&&i<e.length-1&&(n.push(r+" ".concat(t*i,"%")),n.push(r+" ".concat(t*(i+1),"%"))),n}),[]);return"linear-gradient(to bottom, ".concat(n.join(", "),")")},ge=function(e,t,n,r){for(var i=0;i<e.length;i++){var a,o=e[i];if(null!==(a=o.ref)&&void 0!==a&&a.current){var c=me(null===t||void 0===t?void 0:t[o.index],n);c&&0!==Object.keys(c).length?(ye(o,c,n),r&&(o.ref.current.style.cursor="pointer")):o.ref.current.classList.contains("annotated")&&(o.ref.current.classList.remove("annotated"),o.ref.current.style.cursor="default",ke(o,null,null,null))}}},me=function(e,t){if(!e)return null;if(e&&t){e=Object(s.a)({},e);for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],a=e[i].variable;if(t[a]){var o=t[a].codeMap,c=e[i].value;o[c]&&o[c].active&&o[c].activeParent||"EMPTY"===!c&&delete e[i]}else delete e[i]}}return e},ye=function(e,t,n){for(var r=0,i=0,a={pre:[],text:[],post:[]},o=Object.keys(t).length,c=0,l=Object.keys(t);c<l.length;c++){var s=t[l[c]],u=n[s.variable].codeMap,d=xe(s.value,u);a.text.push(d),s.span[0]===s.index?r++:a.pre.push(d),s.span[1]===s.index?i++:a.post.push(d)}var f=r===o,b=i===o,v=r>0,j=i>0,h=e.ref.current.classList;h.add("annotated"),f?h.add("allLeft"):h.remove("allLeft"),v&!f?h.add("anyLeft"):h.remove("anyLeft"),b?h.add("allRight"):h.remove("allRight"),j&!b?h.add("anyRight"):h.remove("anyRight");var p=Oe(a.text),x=f?"white":Oe(a.pre),O=b?"white":Oe(a.post);ke(e,x,p,O)},ke=function(e,t,n,r){var i=e.ref.current.children;i[0].style.background=t,i[1].style.background=n,i[2].style.background=r},we=function(e,t){var n,r=Object(h.a)(e);try{for(r.s();!(n=r.n()).done;){var i,a=n.value;if(null!==(i=a.ref)&&void 0!==i&&i.current)if(a.ref.current.classList.remove("tapped"),0!==t.length&&null!==t[0]&&null!==t[1]){var o=Object(l.a)(t,2),c=o[0],s=o[1];if(c>s){var u=[c,s];s=u[0],c=u[1]}var d=a.arrayIndex>=c&&a.arrayIndex<=s,f=a.ref.current.classList;if(d&&a.codingUnit){var b=c===a.arrayIndex,v=s===a.arrayIndex;f.add("selected"),b?f.add("start"):f.remove("start"),v?f.add("end"):f.remove("end")}else f.remove("selected")}else a.ref.current.classList.remove("selected")}}catch(j){r.e(j)}finally{r.f()}},Se=i.a.memo((function(e){var t,n=e.tokens,i=e.currentToken,a=e.setCurrentToken,o=e.annotations,c=e.variableMap,s=e.fullScreenNode,u=e.onlyFirst,d=Object(r.useState)(null),f=Object(l.a)(d,2),b=f[0],v=f[1],j=Object(r.useState)(0),h=Object(l.a)(j,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){var e;if(null===n||void 0===n||null===(e=n[i.i])||void 0===e||!e.ref||null===o||void 0===o||!o[n[i.i].index]||!c)return v(null),x(0),null;var t=o[n[i.i].index],r=Object.keys(t).reduce((function(e,n,r){var o=t[n].variable,l=t[n].value;if(u&&i.i!==t[n].span[0])return e;if(!c[o])return e;var s=c[o].codeMap;return s[l]?(e.push(Object(O.jsxs)(he.a.Item,{style:{backgroundColor:xe(l,s),padding:"0.3em"},onMouseOver:function(){return a({i:null})},children:[Object(O.jsx)("b",{children:o}),": "+l]},r)),e):e}),[]);v(Object(O.jsx)(he.a,{children:r})),x(0)}),[n,i,a,o,u,c,x]),Object(r.useEffect)((function(){if(b){var e=setTimeout((function(){x(p+1)}),200);return function(){return clearTimeout(e)}}}),[p,b]),Object(O.jsx)(pe.a,{mountNode:s||void 0,context:null===n||void 0===n||null===(t=n[i.i])||void 0===t?void 0:t.ref,basic:!0,hoverable:!1,position:"top left",open:!0,style:{margin:"0",padding:"0",border:"1px solid"},children:b})})),Ce=function(e){var t=e.tokens,n=e.variableMap,i=e.annotations,a=e.disableAnnotations,o=e.editMode,c=e.triggerCodeSelector,s=e.eventsBlocked,u=e.fullScreenNode,d=Object(r.useState)({i:null}),f=Object(l.a)(d,2),b=f[0],v=f[1],j=Object(r.useState)([]),h=Object(l.a)(j,2),p=h[0],x=h[1];return Object(r.useEffect)((function(){if(!n)return null;ge(t,i,n,o)}),[t,i,n,o]),Object(r.useEffect)((function(){we(t,p)}),[t,p]),Object(r.useEffect)((function(){v({i:null}),x([])}),[t]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Se,{tokens:t,currentToken:b,setCurrentToken:v,annotations:i,variableMap:n,fullScreenNode:u,onlyFirst:!1}),a?null:Object(O.jsx)(te,{tokens:t,annotations:i,currentToken:b,setCurrentToken:v,tokenSelection:p,setTokenSelection:x,triggerCodePopup:c,editMode:o,eventsBlocked:s})]})},Ee=n(284),Ae=function(e){return Date.parse(e)?e.replace("T"," "):e},Re=function(e){var t=e.meta_fields.filter((function(e){return e.visible})),n=function(e){var t={borderTop:"none"};return e.bold&&(t.fontWeight="bold"),e.italic&&(t.fontStyle="italic"),t};return 0===t.length?null:Object(O.jsx)(Ee.a,{basic:"very",compact:!0,style:{lineHeight:"0.8",padding:"10px",paddingLeft:"10px",border:"1px solid grey",boxShadow:"5px 3px 3px #e0f2ff",background:"#e1f2ff",color:"black"},children:t.map((function(e){return Object(O.jsxs)(Ee.a.Row,{style:{fontSize:"".concat(null!=e.size?e.size:1,"em")},children:[Object(O.jsx)(Ee.a.Cell,{width:1,style:{borderTop:"none"},children:Object(O.jsx)("b",{children:e.label||e.name})}),Object(O.jsx)(Ee.a.Cell,{style:n(e),children:Ae(e.value)})]})}))})},Le=function(e){var t=e.tokens,n=e.text_fields,i=e.meta_fields,a=e.setReady,o=e.maxHeight,c=Object(r.useState)({}),s=Object(l.a)(c,2),u=s[0],d=s[1],f=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e,n=t.find((function(e){return e.codingUnit}));t.some((function(e){return!e.codingUnit}))?null!==n&&void 0!==n&&null!==(e=n.ref)&&void 0!==e&&e.current&&f.current&&function(e,t,n){var r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),a=r.top,o=r.height,c=i.top,l=o/(1/n);e.scrollTop=e.scrollTop+c-(l+a)}(f.current,n.ref.current,1/3):f.current.scrollTop=0})),Object(r.useEffect)((function(){if(!t)return null;d(_e(t,n,f)),a&&a((function(e){return e+1}))}),[t,n,a]),null===t?null:Object(O.jsx)(A.a,{innerRef:f,children:Object(O.jsx)("div",{style:{flex:"1",display:"flex",alignItems:null,overflow:"auto",maxHeight:o},children:Object(O.jsxs)("div",{className:"TokensContainer",style:{flex:"1 97%",width:"100%"},children:[Object(O.jsx)("div",{style:{width:"100%",textAlign:"right",padding:"10px 30px"},children:Object(O.jsx)(Re,{meta_fields:i})}),Object(O.jsx)("div",{style:{padding:"20px"},children:u.text}),Object(O.jsx)("div",{style:{height:"25px"}})]})},"tokens")})},_e=function(e,t,n){var r={text:[]};if(0===e.length)return r;for(var a=[],o=[],c=[],l=e[0].codingUnit,s=e[0].section,u=e[0].paragraph,d=e[0].sentence,f=function(e){return t.find((function(t){return t.name===e}))},b=f(s),v=0;v<e.length;v++)e[v].arrayIndex=v,e[v].sentence!==d&&(c.length>0&&o.push(Me(v,d,c)),c=[]),e[v].paragraph!==u&&(o.length>0&&a.push(Ne(f(s),u,o,e[v].paragraph!==u)),o=[]),e[v].section!==s&&(a.length>0&&r.text.push(Te(f(s),v+"_"+s,a,s)),a=[]),u=e[v].paragraph,d=e[v].sentence,s=e[v].section,l=e[v].codingUnit,e[v].containerRef=n,l&&(e[v].ref=i.a.createRef()),c.push(Ie(e[v],l));return b=f(s),c.length>0&&o.push(Me("last",d,c)),o.length>0&&a.push(Ne(b,u,o,!1)),a.length>0&&r.text.push(Te(b,"last_"+s,a,s)),r},Te=function(e,t,n,r){return Object(O.jsx)("span",{className:"section",children:function(n){return e?Object(O.jsxs)(O.Fragment,{children:[e.label?Object(O.jsx)("span",{style:{color:"grey",fontWeight:"bold",textAlign:"center"},children:e.label},r+t+"label"):null,Object(O.jsx)("span",{className:"noselect",style:{fontSize:"".concat(null!=e.size?e.size:1,"em"),fontWeight:e.bold?"bold":"normal",fontStyle:e.italic?"italic":"normal",textAlign:e.justify?"justify":"left"},children:n},r+t)]}):n}(n)},"section"+r)},Ne=function(e,t,n,r){return null!==e&&void 0!==e&&e.paragraphs?Object(O.jsx)("div",{style:{display:"flex"},children:Object(O.jsx)("span",{className:"paragraph",style:{flex:"1 98%",paddingBottom:r?"1.5em":"0em",display:"table",paddingLeft:"0.3em"},children:n},"par"+t)}):Object(O.jsx)("span",{children:Object(O.jsx)("span",{children:n})},"par"+t)},Me=function(e,t,n){return Object(O.jsx)("span",{className:"sentence",children:n},"sent"+t)},Ie=function(e,t){return Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("span",{ref:e.ref,className:t?"token codingUnit":"token",tokenindex:e.arrayIndex,children:[Object(O.jsx)("span",{className:"pre",children:e.pre}),Object(O.jsx)("span",{className:"text",children:e.text}),Object(O.jsx)("span",{className:"post",children:e.post})]},"token"+e.index)})},He=i.a.memo(Le),Pe=n(103),ze=function(e){return e.variable+"|"+e.value},Ue=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length)return Object(s.a)({},n);var r,i=De(e),a={},o=[],c=Object(h.a)(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;qe(l,i,a,o)}}catch(S){c.e(S)}finally{c.f()}for(var u={},d=[],f=0,b=o;f<b.length;f++){var v=b[f];u[v.id]||(u[v.id]=0),u[v.id]++,d.push(v)}for(var j=[],p=0,x=d;p<x.length;p++)for(var O=x[p],g=O.span[0];g<=O.span[1];g++){var m=Object(s.a)({},O);m.index=g,j.push(m)}for(var y=0,k=d;y<k.length;y++){var w=k[y];n=Be(n,w,!1,!1)}return n},Be=function(e,t,n,r){for(var i=ze(t),a=t.span[0];a<=t.span[1];a++)e[a]&&e[a][i]&&function(){for(var t=e[a][i],n=t.span,o=n[0];o<=n[1];o++)e[o]&&e[o][i]&&(r&&1===Object.values(e[o]).filter((function(e){return e.variable===t.variable})).length&&(e[o][ze(Object(s.a)(Object(s.a)({},t),{},{value:"EMPTY"}))]=Object(s.a)(Object(s.a)({},e[o][i]),{},{value:"EMPTY"})),delete e[o][i],0===Object.keys(e[o]).length&&delete e[o])}(),n||(e[a]||(e[a]={}),delete e[a][ze(Object(s.a)(Object(s.a)({},t),{},{value:"EMPTY"}))],e[a][i]={index:a,variable:t.variable,span:[t.span[0],t.span[1]],length:t.length,value:t.value,section:t.section,offset:t.offset});return e},De=function(e){return e&&""!==e?e.reduce((function(e,t){return e[t.section]||(e[t.section]={}),e[t.section][t.offset]||(e[t.section][t.offset]={start:[],end:[]}),e[t.section][t.offset+t.length-1]||(e[t.section][t.offset+t.length-1]={start:[],end:[]}),e[t.section][t.offset].start.push(t),e[t.section][t.offset+t.length-1].end.push(ze(t)),e}),{}):{}},qe=function(e,t,n,r){var i=e.offset,a=e.offset+e.length-1;if(t[e.section])for(var o=t[e.section],c=i;c<=a;c++)if(o[c]){var l,u=Object(h.a)(o[c].start);try{for(u.s();!(l=u.n()).done;){var d=l.value,f=ze(d);n[f]=Object(s.a)(Object(s.a)({},e),{},{id:f,variable:d.variable,value:d.value,offset:d.offset,length:null,span:[e.index]})}}catch(p){u.e(p)}finally{u.f()}var b,v=Object(h.a)(o[c].end);try{for(v.s();!(b=v.n()).done;){var j=b.value;n[j]&&(n[j].span.push(e.index),n[j].length=e.offset+e.length-n[j].offset,r.push(n[j]),delete n[j])}}catch(p){v.e(p)}finally{v.f()}}},Fe=n(154),We=n.n(Fe),Ve=function(e){for(var t=function(e){return e.map((function(e,t){return"object"!==typeof e&&(e={code:e}),null==e.active&&(e.active=!0),null==e.tree&&(e.tree=[]),null==e.parent&&(e.parent=""),null==e.makes_irrelevant&&(e.makes_irrelevant=[]),"object"!==typeof e.makes_irrelevant&&(e.makes_irrelevant=[e.makes_irrelevant]),null==e.required_for&&(e.required_for=[]),"object"!==typeof e.required_for&&(e.required_for=[e.required_for]),null==e.color&&(e.color=We()({seed:e.code,luminosity:"light"})),e}))}(e),n=t.reduce((function(e,t){return e[t.code]=Object(s.a)(Object(s.a)({},t),{},{children:[],totalChildren:0,totalActiveChildren:0}),e}),{}),r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];""===n[a].parent||n[n[a].parent]||(n[n[a].parent]={code:n[a].parent,parent:"",children:[],active:!1,totalChildren:0,totalActiveChildren:0})}for(var o=0,c=Object.keys(n);o<c.length;o++){var u=c[o],d=Ge(n,u),f=Object(l.a)(d,3);n[u].tree=f[0],n[u].activeParent=f[1],n[u].foldToParent=f[2],n[u].parent&&n[n[u].parent].children.push(u);var b,v=Object(h.a)(n[u].tree);try{for(v.s();!(b=v.n()).done;){var j=b.value;n[j].totalChildren++,n[u].active&&n[u].activeParent&&n[j].totalActiveChildren++}}catch(p){v.e(p)}finally{v.f()}}return n},Ye=function e(t,n,r,i,a){var o,c=Object(h.a)(n);try{for(c.s();!(o=c.n()).done;){var l=o.value,u=Object(E.a)(i);u.push(l),r.push(Object(s.a)(Object(s.a)({},t[l]),{},{code:l,codeTrail:i,level:i.length,color:t[l].color?t[l].color:We()({seed:l,luminosity:"light"})})),t[l].children&&e(t,t[l].children,r,u,a)}}catch(d){c.e(d)}finally{c.f()}},Ge=function(e,t){for(var n=[],r=!0,i="",a=e[t].parent;a;)n.push(a),null!=e[a].folded&&e[a].folded&&(i=a,null==e[a].active||e[a].active||(r=!1)),a=e[a].parent;return[n.reverse(),r,i]},Je=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Qe=function(e){var t=e.id,n=e.active,a=e.options,o=e.onSelect,c=Object(r.useState)(0),s=Object(l.a)(c,2),u=s[0],d=s[1],f=Object(r.useState)([]),b=Object(l.a)(f,2),j=b[0],p=b[1],g=Object(r.useRef)({});Object(r.useEffect)((function(){var e,t=[].concat(Object(E.a)(a),[{cancel:!0,label:"CLOSE",color:"grey",value:"CANCEL",textColor:"white"}]),n=Object(h.a)(t);try{for(n.s();!(e=n.n()).done;){e.value.ref=i.a.createRef()}}catch(r){n.e(r)}finally{n.f()}p(t)}),[a,p]);var m=i.a.useCallback((function(e){var t=j.length;if(Je.includes(e.key))return e.preventDefault(),"ArrowRight"===e.key&&u<t-1&&d(u+1),"ArrowDown"===e.key&&d(_(j,u)),"ArrowLeft"===e.key&&u>0&&d(u-1),void("ArrowUp"===e.key&&d(L(j,u)));if(32===e.keyCode||13===e.keyCode){e.preventDefault(),e.stopPropagation();var n=j[u].value;o(n,e.ctrlKey)}}),[u,j,o]);Object(r.useEffect)((function(){return n?window.addEventListener("keydown",m):window.removeEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[n,m]);var y=function(e,t){var n=e.value.delete?"#682c2c":"black",r=e.value.delete?e.value:"white",i=e.color.slice(0,7),a=e.value.delete?"darkred":"black",c=e.color;return Object(O.jsx)(A.a,{innerRef:e.ref,children:Object(O.jsxs)(x.a,{style:{flex:"1 1 auto",padding:"4px 2px",background:c,color:n,border:"3px solid",borderColor:t===u?a:"white",margin:"1px"},value:e.value,compact:!0,size:"mini",onMouseOver:function(){return d(t)},onClick:function(e,t){return o(t.value,e.ctrlKey)},children:[e.tag?Object(O.jsx)("span",{style:{display:"inline-block",float:"left",background:r,color:"black",borderRadius:"0px",border:"2px solid ".concat(i),padding:"2px",margin:"-4px 4px -4px -2px"},children:"".concat(e.tag," ")}):null,Object(O.jsx)("span",{children:e.label})]},e.label+"_"+t)})};return Object(O.jsx)("div",{children:function(){var e,n,r=0,i=[],a=[],o=Object(h.a)(j);try{for(o.s();!(n=o.n()).done;){var c=n.value;g.current[c.value]||("CANCEL"===c.value?e=y(c,r):c.value.delete?a.push(y(c,r)):i.push(y(c,r)),r++)}}catch(l){o.e(l)}finally{o.f()}return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap",marginBottom:"10px"},children:i},t+"_1"),a.length>0?Object(O.jsxs)("b",{children:[Object(O.jsx)(v.a,{name:"trash alternate"})," Delete codes"]}):null,Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:a},t+"_2"),Object(O.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:e},t+"_3")]})}()},t)},Ke=["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"],Xe=i.a.memo((function(e){e.variable;var t=e.children,n=e.fullScreenNode,r=e.open,i=e.setOpen,a=e.tokenRef,o="5px",c="top left",l="100vh";if(null!==a&&void 0!==a&&a.current){var s=a.current.getBoundingClientRect(),u=s.top/window.innerHeight,d=(window.innerHeight-s.bottom)/window.innerHeight;u>d?(c="top",l="calc(".concat(100*u,"vh - ").concat(o,")")):(c="bottom",l="calc(".concat(100*d,"vh - ").concat(o,")"));var f=s.left/window.innerWidth;c=(window.innerWidth-s.right)/window.innerWidth>f?c+" left":c+" right"}var b=!1;return Object(O.jsx)(pe.a,{mountNode:n||void 0,context:a,basic:!0,wide:!0,position:c,hoverable:!0,open:r,mouseLeaveDelay:1e7,onClose:function(e,t){b&&i(!1),b=!0},style:{margin:o,padding:"0px",background:"#dfeffb",border:"1px solid #136bae",minWidth:"15em",maxHeight:l,overflow:"auto"},children:Object(O.jsx)("div",{style:{margin:"5px",border:"0px"},children:t})})})),Ze=function(e){var t=e.variable,n=e.setVariable,r=e.annotations,i=e.span,a=e.setOpen,o=e.variableMap;if(t||!i)return null;var c=function(){for(var e=Object.keys(o),t={},n=0,a=e;n<a.length;n++){for(var c=a[n],l={},s=i[0];s<=i[1];s++)if(r[s])for(var u=0,d=Object.keys(r[s]);u<d.length;u++){var f,b=d[u],v=r[s][b];v.variable===c&&(l[v.value]=xe(v.value,null===o||void 0===o||null===(f=o[c])||void 0===f?void 0:f.codeMap))}t[c]=Oe(Object.values(l))}return e.map((function(e){return{color:t[e],label:e,value:e}}))}();return 1===c.length&&n(c[0].value),Object(O.jsxs)("div",{children:[Object(O.jsx)(pe.a.Header,{style:{textAlign:"center"},children:"Select variable"}),Object(O.jsx)(Qe,{id:"currentCodePageButtons",active:!0,options:c,setOpen:a,onSelect:function(e,t){"CANCEL"!==e?n(e):a(!1)}})]})},$e=function(e){var t=e.tokens,n=e.variable,r=e.setVariable,i=e.annotations,a=e.span,o=e.setSpan,c=e.setOpen,l=e.variableMap,u=function(e,t){"CANCEL"!==e?(o(e.span),r(e.variable)):c(!1)};if(n||!a)return null;var d=function(){for(var e={},n=a[0];n<=a[1];n++)if(i[n])for(var r=0,o=Object.keys(i[n]);r<o.length;r++){var c,u=o[r],d=i[n][u],f=null===l||void 0===l||null===(c=l[d.variable])||void 0===c?void 0:c.codeMap;if(l[d.variable]&&(null!==f&&void 0!==f&&f[d.value]||"EMPTY"===d.value)){var b=d.span,v=d.variable+":"+b[0]+"-"+b[1],j='"'+tt(t,b)+'"',h=xe(d.value,f);e[v]?e[v].colors.push(h):e[v]={tag:d.variable,label:j,colors:[h],value:{variable:d.variable,span:d.span}}}}return Object.keys(e).map((function(t){return Object(s.a)(Object(s.a)({},e[t]),{},{color:Oe(e[t].colors)})}))}();return 0===d.length&&c(!1),1===d.length&&u(d[0].value),Object(O.jsxs)("div",{children:[Object(O.jsx)(pe.a.Header,{style:{textAlign:"center"},children:"Select annotation"}),Object(O.jsx)(Qe,{id:"currentCodePageButtons",active:!0,options:d,setOpen:c,onSelect:u})]})},et=function(e){var t=e.tokens,n=e.variable,a=e.variableMap,o=e.codeHistory,c=e.settings,u=e.annotations,d=e.tokenAnnotations,f=e.setAnnotations,b=e.editMode,v=e.span,j=e.setOpen,p=e.setCodeHistory,x=Object(r.useRef)(null),g=Object(r.useState)(!0),m=Object(l.a)(g,2),y=m[0],k=m[1],w=i.a.useCallback((function(e){var t;return c&&!c.searchBox&&"recent"===!c.buttonMode?null:((null===x||void 0===x||null===(t=x.current)||void 0===t?void 0:t.children[0])===document.activeElement||k(!0),27===e.keyCode&&j(!1),Ke.includes(e.key)||e.keyCode<=46||e.keyCode>=106?null:(x.current&&x.current.click(),void k(!1)))}),[x,j,c]);Object(r.useEffect)((function(){return window.addEventListener("keydown",w),function(){window.removeEventListener("keydown",w)}}));var S=function(e,r){var i;"CANCEL"!==e?(nt(t,e,f,o,p,b),null!==a&&void 0!==a&&null!==(i=a[n])&&void 0!==i&&i.multiple||r||j(!1)):j(!1)};if(!n)return null;var C,E=function(){var e,r=function(e){for(var t={},n=v[0];n<=v[1];n++)if(null!==u&&void 0!==u&&u[n])for(var r=0,i=Object.keys(u[n]);r<i.length;r++){var a=i[r],o=u[n][a];o.variable===e&&(t[o.span[0]+"_"+a]=Object(s.a)({id:a},u[n][a]))}return Object.keys(t).length>0?Object.values(t):[]}(n),i=[],l=[],f=null===a||void 0===a||null===(e=a[n])||void 0===e?void 0:e.codeMap;!function(e,t){var r=Object.keys(e);if(1!==r.length)return null;var i=r[0],a=t.filter((function(e){return"EMPTY"!==e.value}));0===a.length&&(setTimeout((function(){return S({variable:n,span:v,value:i,delete:!1})}),0),j(!1)),b&&1===a.length&&i===a[0].value&&(setTimeout((function(){return S({variable:n,span:v,value:i,delete:!0})}),0),j(!1))}(f,r);for(var p=0,x=Object.keys(f);p<x.length;p++){var g=x[p];if(!(null===v||v[0]===v[1])||!d[g]){c&&"all"===c.buttonMode&&i.push({key:g,label:g,value:{variable:n,value:g,span:v,delete:!1},color:xe(g,f)});var m=f[g].tree.join(" - ");l.push({key:g,value:{variable:n,value:g,span:v,delete:!1},text:g+" test"+m,content:Object(O.jsxs)(O.Fragment,{children:[g,Object(O.jsx)("br",{}),Object(O.jsx)("span",{style:{color:"grey"},children:m})]})})}}if(!c||"recent"===c.buttonMode){var y,k=9,w=Object(h.a)(o);try{for(w.s();!(y=w.n()).done;){var C=y.value;if(k<0)break;f[C]&&(i.push({key:C,label:C,value:{variable:n,value:C,span:v,delete:!1},color:xe(C,f)}),k--)}}catch(L){w.e(L)}finally{w.f()}}if(r&&r.length>0){var E,A=Object(h.a)(r);try{for(A.s();!(E=A.n()).done;){var R=E.value;f[R.value]&&i.push({tag:R.value,label:'"'+tt(t,R.span)+'"',color:xe(R.value,f),value:Object(s.a)(Object(s.a)({},R),{},{delete:!0}),textColor:"darkred"})}}catch(L){A.e(L)}finally{A.f()}}return[i,l]}(),L=Object(l.a)(E,2),_=L[0],T=L[1];return Object(O.jsxs)(O.Fragment,{children:[(C=T,0===C.length?null:c&&!c.searchBox&&"recent"!==c.buttonMode?Object(O.jsx)("div",{style:{height:"25px"}}):Object(O.jsx)(A.a,{innerRef:x,children:Object(O.jsx)(R.a,{fluid:!0,placeholder:"<type to search>",style:{textAlign:"center",color:"black",width:"100%",height:"20px",marginBottom:"5px",overflow:"visible",position:"relative"},options:C,open:!y,search:!0,selectOnNavigation:!1,minCharacters:0,autoComplete:"on",onClick:function(){return k(!1)},onSearchChange:function(e,t){""===t.searchQuery&&k(!0)},onClose:function(){return k(!0)},onChange:function(e,t){S(t.value,e.ctrlKey)}})})),function(e){return Object(O.jsxs)(O.Fragment,{children:["recent"===c.buttonMode&&o.length>0?Object(O.jsx)("b",{children:"Recent codes"}):null,Object(O.jsx)(Qe,{id:"newCodePageButtons",active:y,setAnnotations:f,options:e,setOpen:j,onSelect:S})]})}(_)]})},tt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=e.slice(t[0],t[1]+1).map((function(e){return e.pre+e.text+e.post}));return r.length>n&&(r=[r.slice(0,Math.floor(n/2)).join("")," ... ",r.slice(-Math.floor(n/2)).join("")]),r.join("")},nt=function(e,t,n,r,i,a){var o=Object(l.a)(t.span,2),c=o[0],u=o[1];t.index=e[c].index,t.length=e[u].length+e[u].offset-e[c].offset,t.span=[e[c].index,e[u].index],t.section=e[c].section,t.offset=e[c].offset,n((function(e){return Be(Object(s.a)({},e),t,t.delete,a)})),i((function(e){return Object(s.a)(Object(s.a)({},e),{},Object(Pe.a)({},t.variable,[t.value].concat(Object(E.a)(r.filter((function(e){return e!==t.value}))))))}))},rt=function(e,t,n,a,o,c,u,d){var f=Object(r.useState)(!1),b=Object(l.a)(f,2),v=b[0],j=b[1],p=Object(r.useState)(null),x=Object(l.a)(p,2),g=x[0],m=x[1],y=Object(r.useState)(null),k=Object(l.a)(y,2),w=k[0],S=k[1],C=Object(r.useState)(null),E=Object(l.a)(C,2),A=E[0],R=E[1],L=Object(r.useState)({}),_=Object(l.a)(L,2),T=_[0],N=_[1],M=Object(r.useState)(!1),I=Object(l.a)(M,2),H=I[0],P=I[1],z=Object(r.useState)(c),U=Object(l.a)(z,2),B=U[0],D=U[1],q=Object(r.useState)(null),F=Object(l.a)(q,2),W=F[0],V=F[1],Y=Object(r.useState)(null),G=Object(l.a)(Y,2),J=G[0],Q=G[1];Object(r.useEffect)((function(){if(!t||0===t.length)return V(null),null;var e,n={},r=Object(h.a)(t);try{var i=function(){var t=e.value,r=Ve(t.codes);r=Object.keys(r).reduce((function(e,t){return r[t].active&&r[t].activeParent?(e[t]=r[t],e):e}),{}),n[t.name]=Object(s.a)(Object(s.a)({},t),{},{codeMap:r})};for(r.s();!(e=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}V(n)}),[t,V]),Object(r.useEffect)((function(){var e,t,r;null!==W?(S(null),r=null===n||"EDIT ALL"===n?W:Object(Pe.a)({},n,W[n]),Q(r),P((null===(e=r)||void 0===e||null===(t=e[n])||void 0===t?void 0:t.editMode)||"EDIT ALL"===n)):Q(null)}),[W,n,S,Q,P]),Object(r.useEffect)((function(){v||u(B)}),[B,v,u]);var K,X=i.a.useCallback((function(t,n){e[t].ref&&(R(e[t].ref),N(a[t]||{}),m(n||[t,t]),j(!0))}),[a,e]);if(Object(r.useEffect)((function(){j(!1)}),[e]),Object(r.useEffect)((function(){v||S(null)}),[v]),!t)return[null,null,null,!0];K=H?Object(O.jsx)($e,{tokens:e,variable:w,setVariable:S,variableMap:J,annotations:a,span:g,setSpan:m,setOpen:j}):Object(O.jsx)(Ze,{variable:w,setVariable:S,variableMap:J,annotations:a,span:g,setOpen:j});var Z=Object(O.jsx)(et,{tokens:e,variable:w,variableMap:J,settings:null===J||void 0===J?void 0:J[w],codeHistory:c[w]||[],annotations:a,tokenAnnotations:T,setAnnotations:o,span:g,editMode:H,setOpen:j,setCodeHistory:D}),$=Object(O.jsxs)(Xe,{variable:w,fullScreenNode:d,open:v,setOpen:j,tokenRef:A,children:[K,Z]});return J&&e||($=null),[$,X,J,v,H]},it=n(158),at=n(188);it.a.extend(at.a);var ot=function(e){var t,n=[],r=null,i=0,a=0,o=0,c=null,l=null,s=!1,u=Object(h.a)(e);try{for(u.s();!(t=u.n()).done;){null!=t.value.unit_start&&(s=!0)}}catch(w){u.e(w)}finally{u.f()}var d,f=!s,b=!1,v=Object(h.a)(e);try{for(v.s();!(d=v.n()).done;){var j=d.value,p=j.name||"text",x=j.offset||0;l=j.value,c=it.a.tokenize(l).paragraphs().json({offset:!0});for(var O=0;O<c.length;O++){for(var g=0;g<c[O].sentences.length;g++){for(var m=0;m<c[O].sentences[g].length;m++)for(var y=0;y<c[O].sentences[g][m].terms.length;y++){r=c[O].sentences[g][m].terms[y],null!=j.unit_start&&r.offset.start+x>=j.unit_start&&(f=!0),null!=j.unit_end&&r.offset.start+x>j.unit_end&&(b=!0);var k={section:p,offset:r.offset.start+x,length:r.offset.length,paragraph:i,sentence:a,index:o,text:r.text,pre:r.pre,post:r.post,codingUnit:f&!b};n.push(k),o++}a++}i++}}}catch(w){v.e(w)}finally{v.f()}return n},ct=function(e){for(var t=0,n=(e=st(e))[0].paragraph,r=0,i=e[0].sentence,a=0,o=0,c=0;c<e.length;c++){var l;if(null==e[c].text){if(null==e[c].token)return alert("Invalid token data:\n\nimported tokens must have 'text' or 'token' field"),null;e[c].text=e[c].token}if(null==e[c].offset&&null!=e[c].start&&(e[c].offset=e[c].start),null==e[c].length&&(e[c].length=e[c].text.length),null==e[c].pre&&(e[c].pre=""),null==e[c].post&&null!=e[c].space&&(e[c].post=e[c].space),null==e[c].post&&(null!=e[c].offset&&null!=e[c].length?e[c].post=c<e[c].length-1?" ".repeat(Math.max(0,e[c+1].offset-e[c].offset-e[c].length)):"":e[c].post=" "),o=e[c].length+e[c].post.length,c<e.length-1&&(o+=(null===(l=e[c+1].pre)||void 0===l?void 0:l.length)||0),null==e[c].offset&&(e[c].offset=a,a+=o),c<e.length-1&&(!e[c].section||e[c].section===e[c+1].section)&&(null==e[c+1].offset&&null!=e[c+1].start&&(e[c+1].offset=e[c+1].start),e[c+1].offset&&e[c+1].offset<e[c].offset+o))return alert('Invalid token position data. The length of "'.concat(e[c].pre+e[c].text+e[c].post,'" on position ').concat(e[c].offset," exeeds the offset/start position of the next token")),null;null==e[c].sentence?(e[c].sentence=r,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&r++):(e[c].paragraph===n&&e[c].sentence===i||(i=e[c].sentence,r++),e[c].sentence=r),null==e[c].paragraph?(e[c].paragraph=t,(e[c].text.includes("\n")||e[c].post.includes("\n"))&&t++):(e[c].paragraph!==n&&(n=e[c].paragraph,t++),e[c].paragraph=t),null==e[c].section&&(e[c].section="text"),e[c].index=c}return e},lt=function(e,t){if(0===e.length)return[];for(var n=[],r={},i=e[0].section,a=0;a<e.length;a++)if(e[a].annotations){var o,c={},l=Object(h.a)(e[a].annotations);try{for(l.s();!(o=l.n()).done;){var s=o.value;if(""!==s.value){t[s.name]||(t[s.name]=new Set),t[s.name].add(s.value),c[s.name]=s.value;var u=a>0?e[a-1].post:"";null==r[s.name]&&(r[s.name]={index:a,variable:s.name,value:s.value,offset:e[a].offset,text:e[a].text,section:e[a].section,length:e[a].length}),r[s.name].value===s.value&&(r[s.name].length=e[a].offset+e[a].length-r[s.name].offset,r[s.name].text+=u+e[a].pre+e[a].post)}}}catch(w){l.e(w)}finally{l.f()}for(var d=0,f=Object.keys(r);d<f.length;d++){var b=f[d];null!=c[b]?c[b]!==r[b].value&&(n.push(r[b]),r[b]={index:a,variable:b,value:c[b],offset:e[a].offset,text:e[a].text,section:e[a].section,length:e[a].length}):(n.push(r[b]),delete r[b])}if(a<e.length-1&&e[a+1].section!==i){for(var v=0,j=Object.values(r);v<j.length;v++){var p=j[v];n.push(p)}r={},i=e[a].section}else;}else{for(var x=0,O=Object.values(r);x<O.length;x++){var g=O[x];n.push(g)}r={}}for(var m=0,y=Object.values(r);m<y.length;m++){var k=y[m];n.push(k)}return n},st=function(e){if(Array.isArray(e))return e;for(var t=Object.keys(e),n=e[t[0]].length,r=[],i=function(n){var i=t.reduce((function(t,r){return t[r]=e[r][n],t}),{});r.push(i)},a=0;a<n;a++)i(a);return r},ut=function(e,t){var n,r={},i=Object(h.a)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.variable]||(r[a.variable]=new Set),r[a.variable].add(a.value)}}catch(s){i.e(s)}finally{i.f()}for(var o=0,c=Object.keys(r);o<c.length;o++){var l=c[o];r[l]=Object(E.a)(r[l])}t(r)},dt=function(e,t,n,i){var a=Object(r.useState)({}),o=Object(l.a)(a,2),c=o[0],u=o[1],d=Object(r.useState)(),f=Object(l.a)(d,2),b=f[0],v=f[1];return Object(r.useEffect)((function(){if((null===e||void 0===e||!e.text)&&!e.text_fields&&!e.tokens)return null;e.annotations||(e.annotations=[]),e.importedAnnotations&&!e.status&&(e.annotations=e.annotations.concat(e.importedAnnotations)),ut(e.annotations,i);var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(s.a)({},e);n.tokens?(n.importedTokens=!0,n.tokens=ct(e.tokens)):(n.importedTokens=!1,!n.text_fields&&n.text&&(n.text_fields=[{name:"text",value:n.text}]),n.tokens=ot(Object(E.a)(n.text_fields))),n.meta_fields=e.meta_fields||[],n.tokens.length>0?(n.n_paragraphs=n.tokens[n.tokens.length-1].paragraph,n.n_sentences=n.tokens[n.tokens.length-1].sentence):(n.n_paragraphs=0,n.n_sentences=0),n.annotations?n.annotations=Ue(Object(E.a)(n.annotations),n.tokens):n.annotations={};var r=lt(n.tokens,t);return r.length>0&&(n.annotations=Ue(r,n.tokens,n.annotations)),n}(e);t.current={tokens:r.tokens},u({tokens:r.tokens,text_fields:r.text_fields,meta_fields:r.meta_fields}),v(r.annotations),n&&n(r.tokens)}),[e,n,t,i]),[c,b,v]},ft=function(e){var t=e.variable,n=e.setVariable,r=e.variables,i=e.variableNames,a=e.minHeight;if(!r)return null;if(1===r.length)return n(r[0].name),null;return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(x.a.Group,{attached:"bottom",fluid:!0,style:{minHeight:"".concat(a/2,"px")},children:(i.includes(t)||n(i[0]),i.map((function(e){return Object(O.jsx)(x.a,{primary:!0,active:e===t,style:{padding:"0",border:"1px solid",color:e===t?"black":"white"},onClick:function(){return n(e)},children:e})})))})})},bt=function(e){var t=e.variables,n=e.variable,i=e.setVariable,a=e.minHeight,o=e.editAll,c=Object(r.useMemo)((function(){var e=[];return null!=t&&(null===t||void 0===t?void 0:t.length)>0&&(e=t.map((function(e){return e.name})),o&&e.push("EDIT ALL")),e}),[t,o]),l=function(e){var t=0;9===e.keyCode&&(e.preventDefault(),e.shiftKey?e.repeat||(t=-1):e.repeat||(t=1));var r=c.findIndex((function(e){return e===n}))+t;r>c.length-1&&(r=0),r<0&&(r=c.length-1),i(c[r])};Object(r.useEffect)((function(){return window.addEventListener("keydown",l),function(){window.removeEventListener("keydown",l)}})),Object(r.useEffect)((function(){if(null===n&&i(c[0]),!t||0===t.length)return i(null),null}),[n,t,i,c]);var s=null;if(t){var u=t.find((function(e){return e.name===n}));s=null===u||void 0===u?void 0:u.instruction}return"EDIT ALL"===n&&(s="Show and edit all variables"),Object(O.jsxs)("div",{style:{background:"#1277c469",borderBottomLeftRadius:"10px",borderBottomRightRadius:"10px",borderTop:"2px solid #2185d0",textAlign:"center"},children:[Object(O.jsx)(ft,{variable:n,setVariable:i,variables:t,variableNames:c,minHeight:a}),Object(O.jsx)("p",{style:{margin:"0",padding:"2px",minHeight:"24px"},children:s})]})},vt=(n(232),function(e){var t=e.unit,n=e.variables,i=e.settings,a=e.onChangeAnnotations,o=e.returnTokens,c=e.returnVariableMap,u=e.setReady,d=e.blockEvents,f=e.fullScreenNode,b=Object(r.useRef)(null),v=Object(r.useState)(null),j=Object(l.a)(v,2),h=j[0],p=j[1],x=Object(r.useState)({}),g=Object(l.a)(x,2),m=g[0],y=g[1],k=Object(r.useState)(0),w=Object(l.a)(k,2),S=w[0],C=w[1],E=dt(t,b,o,y),A=Object(l.a)(E,3),R=A[0],L=A[1],_=A[2],T=rt(R.tokens,n,h,L,_,m,y,f),N=Object(l.a)(T,5),M=N[0],I=N[1],H=N[2],P=N[3],z=N[4];return Object(r.useEffect)((function(){L&&a&&b.current.tokens===R.tokens&&a(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 0===Object.keys(e).length?[]:Object.keys(e).reduce((function(r,i){for(var a=e[i],o=0,c=Object.keys(a);o<c.length;o++){var l=c[o];if("unit"===i||a[l].index===a[l].span[0]){var s={variable:a[l].variable,value:a[l].value,section:a[l].section,offset:a[l].offset,length:a[l].length};n&&function(){var e=a[l].span,n=t.slice(e[0],e[1]+1).map((function(t,n){var r=t.text;return n>0&&(r=t.pre+r),n<e[1]-e[0]&&(r+=t.post),r})).join("");s.text=n,s.token_span=e}(),r.push(s)}}return r}),[])}(L,R.tokens,!0))}),[R.tokens,L,a]),Object(r.useEffect)((function(){c&&c(H)}),[H,c]),Object(r.useEffect)((function(){u&&u((function(e){return e+1})),_((function(e){return Object(s.a)({},e)}))}),[S,_,u]),R.tokens?(console.log(R),Object(O.jsxs)("div",{style:{display:"flex",height:"100%",maxHeight:"100%",flexDirection:"column"},children:[Object(O.jsx)(He,{tokens:R.tokens,text_fields:R.text_fields,meta_fields:R.meta_fields,setReady:C,maxHeight:n&&n.length>1?"calc(100% - 60px)":"calc(100% - 30px)",editMode:z}),Object(O.jsx)(bt,{variables:n,variable:h,setVariable:p,editAll:null===i||void 0===i?void 0:i.editAll,minHeight:n&&n.length>1?60:30}),Object(O.jsx)(Ce,{tokens:R.tokens,variableMap:H,annotations:L,disableAnnotations:!a||!H,editMode:z||"EDIT ALL"===h,triggerCodeSelector:I,eventsBlocked:P||d,fullScreenNode:f}),M||null]})):null}),jt=i.a.memo(vt),ht=n(155),pt=n(282),xt=n(275),Ot=n(290),gt={centerVertical:!0},mt=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,c=Object(r.useState)([]),u=Object(l.a)(c,2),d=u[0],f=u[1],b=Object(r.useState)(0),v=Object(l.a)(b,2),j=v[0],h=v[1],p=Object(r.useState)(null),x=Object(l.a)(p,2),g=x[0],m=x[1],y={text:Object(r.useRef)(),box:Object(r.useRef)(),code:Object(r.useRef)()},k=Object(r.useState)(0),w=Object(l.a)(k,2),S=w[0],C=w[1],E=Object(Ot.a)(["questionTaskSettings"]),A=Object(l.a)(E,2),R=A[0],L=A[1],_=Object(r.useState)(R.questionTaskSettings||{splitHeight:60,textSize:1}),T=Object(l.a)(_,2),N=T[0],M=T[1],I=Object(r.useRef)(null);Object(r.useEffect)((function(){L("questionTaskSettings",JSON.stringify(N),{path:"/"})}),[N,L]),Object(r.useEffect)((function(){null!==n&&void 0!==n&&n.questions&&m(kt(n))}),[n]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.backgroundColor="white",y.text.current.style.transition="",y.box.current.style.transition="",y.box.current.style.opacity=0,y.text.current.style.transform="translateX(0%) translateY(0%)"}),[y.text,y.box,t,j]),Object(r.useEffect)((function(){if(null===y||void 0===y||!y.text.current)return null;y.box.current.style.transition="opacity 200ms ease-out",y.box.current.style.opacity=1}),[S,y.text,y.box,j]);var H=Object(r.useState)(null),P=Object(l.a)(H,2),z=P[0],U=P[1],B=Object(ht.useSwipeable)(Ct(null===g||void 0===g?void 0:g[j],y,U,!1)),D=Object(ht.useSwipeable)(Ct(null===g||void 0===g?void 0:g[j],y,U,!0));return t?Object(O.jsxs)("div",{ref:I,style:{height:"100%"},children:[Object(O.jsxs)("div",Object(s.a)(Object(s.a)({},B),{},{style:{position:"relative",border:"1px solid",height:"".concat(N.splitHeight,"%")},children:[Object(O.jsxs)("div",{ref:y.box,style:{height:"100%",width:"100%",overflow:"hidden",position:"absolute"},children:[Object(O.jsx)("div",{ref:y.code,style:{padding:"0.6em 0.3em",width:"100%",fontSize:"3em",position:"absolute"}}),Object(O.jsx)("div",{ref:y.text,style:{border:"1px solid",height:"100%",width:"100%",position:"absolute",top:"0",backgroundColor:"white",overflow:"hidden",fontSize:"".concat(N.textSize,"em")},children:Object(O.jsx)(jt,{unit:t,settings:gt,setReady:C,returnTokens:f,fullScreenNode:o})})]}),Object(O.jsx)(yt,{settings:N,setSettings:M,fullScreenNode:o})]})),Object(O.jsx)("div",Object(s.a)(Object(s.a)({},D),{},{style:{height:"".concat(100-N.splitHeight,"%")},children:Object(O.jsx)(Z,{unit:t,tokens:d,questions:g,questionIndex:j,setQuestionIndex:h,setUnitIndex:i,swipe:z,blockEvents:a})}))]}):null},yt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(O.jsx)(pe.a,{on:"click",mountNode:r||void 0,trigger:Object(O.jsx)(v.a,{size:"large",name:"setting",style:{position:"absolute",cursor:"pointer",top:"1px",left:"-1px",color:"#1b1c1d",padding:"5px 0px",height:"30px"}}),children:Object(O.jsx)(pt.a,{children:Object(O.jsxs)(pt.a.Group,{grouped:!0,children:[Object(O.jsxs)(pt.a.Field,{children:[Object(O.jsxs)("label",{children:["text window size ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.splitHeight,"%")})]}),Object(O.jsx)(xt.a,{size:"mini",step:2,min:20,max:80,type:"range",value:t.splitHeight,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{splitHeight:t.value})}))}})]}),Object(O.jsxs)(pt.a.Field,{children:[Object(O.jsxs)("label",{children:["text size scaling ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(O.jsx)(xt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{textSize:t.value})}))}})]})]})})})},kt=function(e){return e.questions.map((function(e){var t=function(e,t){var n=Object.keys(e).filter((function(t){return!e[t].parent||""===e[t].parent})),r=[];return Ye(e,n,r,[],t),r.map((function(e,t){return Object(s.a)(Object(s.a)({},e),{},{i:t})}))}(Ve(e.codes));t=wt(Object(E.a)(t));var n=St(t),r=Object(l.a)(n,2),i=r[0],a=r[1];return Object(s.a)(Object(s.a)({},e),{},{options:i,swipeOptions:a})}))},wt=function(e){var t,n=e.reduce((function(e,t){if(!t.required_for)return e;if("object"!==typeof t.required_for)e.add(t.required_for);else{var n,r=Object(h.a)(t.required_for);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.add(i)}}catch(a){r.e(a)}finally{r.f()}}return e}),new Set),r=Object(h.a)(e);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=Object(h.a)(n);try{for(o.s();!(i=o.n()).done;){var c=i.value;a.required_for&&(a.required_for===c||a.required_for.includes(c))||a.makes_irrelevant.includes(c)||(a.makes_irrelevant=[].concat(Object(E.a)(a.makes_irrelevant),[c]))}}catch(l){o.e(l)}finally{o.f()}}}catch(l){r.e(l)}finally{r.f()}return e},St=function(e){var t,n=[],r={},i=Object(h.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.active&&a.activeParent){var o=a.tree.join(" - "),c={code:a.code,tree:o,makes_irrelevant:a.makes_irrelevant,color:a.color};a.swipe&&(r[a.swipe]=c),n.push(c)}}}catch(l){i.e(l)}finally{i.f()}return[n,r]},Ct=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150;if(!e)return{};if("annotinder"!==e.type)return{};var a=200,o={delta:10,preventDefaultTouchmoveEvent:!1,trackTouch:!0,trackMouse:!1,rotationAngle:0},c=function(e){var n=e.deltaX,i=e.deltaY;if(Math.abs(n)>Math.abs(i)+10&&(i=0),Math.abs(n)<Math.abs(i)+10&&(n=0),!r){var a=t.text.current.getElementsByClassName("TokensContainer")[0];a.scrollHeight-Math.ceil(a.scrollTop)===a.clientHeight||(i=0)}return[n,i]};return Object(s.a)({onSwiping:function(n){var r,i,a=c(n),o=Object(l.a)(a,2),s=o[0],u=o[1];if((!(s>0)||e.swipeOptions.right)&&(!(s<0)||e.swipeOptions.left)&&(!(u<0)||e.swipeOptions.up)&&!(0!==u&&u>0)){t.text.current.style.transition="",t.text.current.style.transform="translateX(".concat(s,"px) translateY(").concat(u,"px)");var d,f,b,v,j=null===(r=e.swipeOptions.up)||void 0===r?void 0:r.color,h=null===(i=e.swipeOptions.up)||void 0===i?void 0:i.code,p="0%",x="center";if(s>0)j=null===(d=e.swipeOptions.right)||void 0===d?void 0:d.color,h=null===(f=e.swipeOptions.right)||void 0===f?void 0:f.code,p="40%",x="left";if(s<0)j=null===(b=e.swipeOptions.left)||void 0===b?void 0:b.color,h=null===(v=e.swipeOptions.left)||void 0===v?void 0:v.code,p="40%",x="right";t.box.current.style.backgroundColor=j,t.code.current.innerText=h,t.code.current.style.bottom=p,t.code.current.style.textAlign=x}},onSwiped:function(r){var o=c(r),s=Object(l.a)(o,2),u=s[0],d=s[1];if((!(u>0)||e.swipeOptions.right)&&(!(u<0)||e.swipeOptions.left)&&(!(d<0)||e.swipeOptions.up)&&!(0!==d&&d>0))if(t.text.current.style.transition="transform ".concat(a,"ms ease-out, opacity ").concat(a,"ms ease-out"),Math.abs(u)<i&&Math.abs(d)<i)t.text.current.style.transform="translateX(0%) translateY(0%)";else{t.text.current.style.transform="translateX(".concat(u>0?100:u<0?-100:0,"%) translateY(").concat(d>0?100:-100,"%)"),t.box.current.style.transition="opacity ".concat(a,"ms ease-out"),t.box.current.style.opacity=0;n(u>0?"right":"left"),n(null)}}},o)},Et=i.a.memo(mt),At=n(285),Rt=n(276),Lt=n(153),_t=[4,4,2,2],Tt=function(e,t,n){var r,i=[],a=0,o=function(t){if(t){var n=null===e||void 0===e?void 0:e[t[0]];null!==n&&void 0!==n&&n.triggerCodePopup&&n.triggerCodePopup(t)}},c=Object(h.a)(n);try{for(c.s();!(r=c.n()).done;){var l=r.value,s=l.text||"",u=Object(O.jsx)(Nt,{variable:l.variable,variableMap:t,annotation:l,onClick:o,text:s},a);null!==u&&i.push(u),a++}}catch(d){c.e(d)}finally{c.f()}return i},Nt=function(e){var t,n,r=e.variable,i=e.variableMap,a=e.annotation,o=e.onClick,c=e.text;if(null===i||void 0===i||null===(t=i[a.variable])||void 0===t||!t.codeMap)return null;var l=i[r].codeMap;if(null===l||void 0===l||!l[a.value]||!l[a.value].active)return null;var s=xe(a.value,l),u=null!==(n=l[a.value])&&void 0!==n&&n.foldToParent?"".concat(l[a.value].foldToParent," - ").concat(a.value):a.value,d="".concat(a.offset,"-").concat(a.offset+a.length);return Object(O.jsxs)(Ee.a.Row,{className:"annotations-tr",onClick:function(){return o(a.token_span)},style:{cursor:"pointer"},children:[Object(O.jsx)(Ee.a.Cell,{width:_t[0],children:Object(O.jsx)("span",{title:r,children:r})}),Object(O.jsx)(Ee.a.Cell,{title:u,width:_t[1],style:s?{background:s}:null,children:Object(O.jsx)("span",{title:u,children:u})}),Object(O.jsx)(Ee.a.Cell,{title:a.section,width:_t[2],children:a.section}),Object(O.jsx)(Ee.a.Cell,{title:d,width:_t[3],children:d}),Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("span",{title:c,children:c})})]})},Mt=function(e){var t=e.tokens,n=e.variableMap,r=e.annotations;return n&&0!==Object.keys(n).length?Object(O.jsxs)(Ee.a,{style:{fontSize:"10px",maxHeight:"100%",borderRadius:"0px"},fixed:!0,role:"grid","arioa-labelledby":"header",unstackable:!0,singleLine:!0,compact:"very",size:"small",children:[Object(O.jsx)(Ee.a.Header,{className:"annotations-thead",style:{height:"40px"},children:Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.HeaderCell,{title:"Variable",width:_t[0],children:"Variable"}),Object(O.jsx)(Ee.a.HeaderCell,{title:"Vale",width:_t[1],children:"Value"}),Object(O.jsx)(Ee.a.HeaderCell,{title:"Section",width:_t[2],children:"Section"}),Object(O.jsx)(Ee.a.HeaderCell,{title:"Position",width:_t[3],children:"Position"}),Object(O.jsx)(Ee.a.HeaderCell,{title:"Text",children:"Text"})]})}),Object(O.jsx)(Ee.a.Body,{className:"annotations-tbody",style:{overflow:"auto",height:"calc(100% - 40px)"},children:Tt(t,n,r)})]}):null},It=function(e){var t=e.unit,n=e.codebook,i=e.setUnitIndex,a=e.blockEvents,o=e.fullScreenNode,c=Ht(t),s=Object(l.a)(c,2),u=s[0],d=s[1],f=Object(r.useState)(null),v=Object(l.a)(f,2),j=v[0],h=v[1],p=Object(Ot.a)(["annotateTaskSettings"]),g=Object(l.a)(p,2),m=g[0],y=g[1],k=Object(r.useState)(m.annotateTaskSettings||{textSize:1}),w=Object(l.a)(k,2),S=w[0],C=w[1],E=Object(r.useState)(null),A=Object(l.a)(E,2),R=A[0],L=A[1];return Object(r.useEffect)((function(){y("annotateTaskSettings",JSON.stringify(S),{path:"/"})}),[S,y]),t&&null!==(null===n||void 0===n?void 0:n.variables)?Object(O.jsxs)(b.a,{centered:!0,stackable:!0,style:{height:"100%",width:"100%",paddingTop:"0"},verticalAlign:"top",columns:2,children:[Object(O.jsxs)(b.a.Column,{width:10,style:{paddingRight:"0em",paddingTop:"0",height:"100%"},children:[Object(O.jsxs)(x.a.Group,{fluid:!0,style:{padding:"0",height:"40px"},children:[Object(O.jsx)(Dt,{settings:S,setSettings:C,fullScreenNode:o}),Object(O.jsx)(Bt,{fullScreenNode:o}),Object(O.jsx)(Ut,{unit:t,annotations:u,setUnitIndex:i})]}),Object(O.jsx)("div",{style:{height:"calc(100% - 20px",fontSize:"".concat(S.textSize,"em")},children:Object(O.jsx)(jt,{unit:t,settings:null===n||void 0===n?void 0:n.settings,variables:null===n||void 0===n?void 0:n.variables,onChangeAnnotations:d,returnTokens:L,returnVariableMap:h,blockEvents:a,fullScreenNode:o})})]}),Object(O.jsx)(b.a.Column,{width:6,style:{paddingRight:"0em",padding:"0",height:"100%",paddingLeft:"10px"},children:Object(O.jsx)("div",{style:{borderBottom:"1px solid",height:"calc(100%)",overflow:"auto"},children:Object(O.jsx)(Mt,{tokens:R,variableMap:j,annotations:u})})})]}):null},Ht=function(e){var t=Object(r.useState)([]),n=Object(l.a)(t,2),a=n[0],o=n[1],c=Object(r.useRef)(null);return Object(r.useEffect)((function(){e?(c.current=e.unitId,o(e.annotations||[])):o([])}),[e,o]),[a,i.a.useCallback((function(t){if(e.unitId===c.current){o(t);var n=zt(t);Pt(e.annotations,n)&&e.jobServer.postAnnotations(e.unitId,n,"IN_PROGRESS")}}),[e])]},Pt=function(e,t){if(e.length!==t.length)return!0;for(var n=["variable","value","section","offset","length"],r=0;r<e.length;r++){var i,a=Object(h.a)(n);try{for(a.s();!(i=a.n()).done;){var o,c,l=i.value;if((null===(o=e[r])||void 0===o?void 0:o[l])!==(null===(c=t[r])||void 0===c?void 0:c[l]))return!0}}catch(s){a.e(s)}finally{a.f()}}return!1},zt=function(e){return e.map((function(e){return{variable:e.variable,value:e.value,section:e.section,offset:e.offset,length:e.length}}))},Ut=function(e){var t=e.unit,n=e.annotations,i=e.setUnitIndex,a=Object(r.useState)(!1),o=Object(l.a)(a,2),c=o[0],s=o[1],u=function(){c||(t.jobServer.postAnnotations(t.unitId,zt(n),"DONE"),s(!0),i((function(e){return e+1})),setTimeout((function(){s(!1)}),1e3))},d=function(e){e.ctrlKey&&13===e.keyCode&&(e.preventDefault(),u())};return Object(r.useEffect)((function(){return window.addEventListener("keydown",d),function(){window.removeEventListener("keydown",d)}})),Object(O.jsx)(x.a,{disabled:c,loading:c,primary:!0,size:"tiny",onClick:u,children:"Next Unit"})},Bt=function(e){var t=e.fullScreenNode,n=Object(r.useState)(!1),i=Object(l.a)(n,2),a=i[0],o=i[1];return Object(O.jsxs)(At.a,{mountNode:t||void 0,flowing:!0,open:a,onClose:function(){return o(!1)},position:"bottom left",trigger:Object(O.jsx)(x.a,{secondary:!0,size:"tiny",onClick:function(){return o(!a)},children:"Controls"}),children:[Object(O.jsx)(At.a.Header,{children:"Controls"}),Object(O.jsx)(At.a.Content,{children:Object(O.jsx)(Rt.a,{style:{overflow:"auto",paddingTop:"2em",width:"100%",maxWidth:"700px"},children:Object(O.jsxs)(Ee.a,{structured:!0,compact:!0,basic:"very",unstackable:!0,children:[Object(O.jsx)(Ee.a.Header,{children:Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.HeaderCell,{width:3}),Object(O.jsx)(Ee.a.HeaderCell,{children:"Keyboard"}),Object(O.jsx)(Ee.a.HeaderCell,{children:"Mouse"}),Object(O.jsx)(Ee.a.HeaderCell,{children:"Touchpad"})]})}),Object(O.jsxs)(Ee.a.Body,{children:[Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("strong",{children:"Navigate"})}),Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("i",{children:"Arrow keys"})}),Object(O.jsx)(Ee.a.Cell,{}),Object(O.jsx)(Ee.a.Cell,{})]}),Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("strong",{children:"Select words"})}),Object(O.jsxs)(Ee.a.Cell,{children:[Object(O.jsx)("i",{children:"spacebar"}),Object(O.jsx)("br",{}),"Hold to select mutiple"]}),Object(O.jsxs)(Ee.a.Cell,{children:[Object(O.jsx)("i",{children:"Left-click"}),Object(O.jsx)("br",{}),"Hold to select multiple"]}),Object(O.jsxs)(Ee.a.Cell,{children:[Object(O.jsx)("i",{children:"tab"})," twice to begin, then once to close"]})]}),Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("strong",{children:"Edit/remove code"})}),Object(O.jsx)(Ee.a.Cell,{colSpan:"3",children:"Select annotated words to overwrite or delete the code"})]}),Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsxs)("strong",{children:["Select variable",Object(O.jsx)("br",{}),"(if multiple)"]})}),Object(O.jsxs)(Ee.a.Cell,{children:["Next with ",Object(O.jsx)("i",{children:"tab"}),", previous with ",Object(O.jsx)("i",{children:"shift+tab"})]}),Object(O.jsx)(Ee.a.Cell,{colSpan:"2",children:"Use the buttons"})]}),Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("strong",{children:"Next unit"})}),Object(O.jsx)(Ee.a.Cell,{children:Object(O.jsx)("i",{children:"ctrl+Enter"})}),Object(O.jsx)(Ee.a.Cell,{colSpan:"2",children:"Use the next unit button"})]})]}),Object(O.jsx)(Ee.a.Footer,{children:Object(O.jsxs)(Ee.a.Row,{children:[Object(O.jsxs)(Ee.a.HeaderCell,{children:[Object(O.jsx)("strong",{children:"Quick keys"})," ",Object(O.jsx)("br",{}),"in popup"]}),Object(O.jsx)(Ee.a.HeaderCell,{colSpan:"3",children:Object(O.jsxs)(he.a,{as:"ul",children:[Object(O.jsxs)(Lt.a,{as:"li",children:[Object(O.jsx)("i",{children:"text input"})," automatically opens dropdown"," "]}),Object(O.jsxs)(Lt.a,{as:"li",children:["navigate buttons with ",Object(O.jsx)("i",{children:"arrow keys"}),", select with ",Object(O.jsx)("i",{children:"spacebar"})]}),Object(O.jsxs)(Lt.a,{as:"li",children:["use ",Object(O.jsx)("i",{children:"escape"})," to close popup and ",Object(O.jsx)("i",{children:"delete"})," to remove code"]})]})})]})})]})})}),Object(O.jsx)(At.a.Actions,{children:Object(O.jsx)(x.a,{content:"Close",onClick:function(){return o(!1)},positive:!0})})]})},Dt=function(e){var t=e.settings,n=e.setSettings,r=e.fullScreenNode;return Object(O.jsx)(pe.a,{on:"click",mountNode:r||void 0,trigger:Object(O.jsx)(x.a,{secondary:!0,width:1,size:"large",icon:"setting",style:{color:"white",maxWidth:"50px"}}),children:Object(O.jsx)(pt.a,{children:Object(O.jsx)(pt.a.Group,{grouped:!0,children:Object(O.jsxs)(pt.a.Field,{children:[Object(O.jsxs)("label",{children:["text size scaling ",Object(O.jsx)("font",{style:{color:"blue"},children:"".concat(t.textSize)})]}),Object(O.jsx)(xt.a,{size:"mini",step:.025,min:.4,max:1.6,type:"range",value:t.textSize,onChange:function(e,t){return n((function(e){return Object(s.a)(Object(s.a)({},e),{},{textSize:t.value})}))}})]})})})})},qt=i.a.memo(It),Ft=function(e){var t,n=e.unit,r=e.setUnitIndex,i=e.fullScreenNode,a=null===n||void 0===n||null===(t=n.jobServer)||void 0===t?void 0:t.codebook;if(!a||!n)return null;return null!==a&&void 0!==a&&a.type?function(e){switch(e){case"questions":return Object(O.jsx)(Et,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});case"annotate":return Object(O.jsx)(qt,{unit:n,codebook:a,setUnitIndex:r,fullScreenNode:i});default:return null}}(a.type):null},Wt=n(160),Vt=function(e){var t=e.children,n=Object(r.useState)(null),i=Object(l.a)(n,2),a=i[0],o=i[1];return Object(O.jsx)("div",{className:"dom-node-provider",ref:o,children:t(a)})},Yt=function(e){var t=e.handle,n=Object(r.useState)(!0),i=Object(l.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){o(!0)}),[o]),Object(O.jsxs)(At.a,{open:a,children:[Object(O.jsx)(At.a.Header,{children:"Fullscreen mode"}),Object(O.jsxs)(At.a.Content,{children:[Object(O.jsx)("p",{children:"We recommend working in fullscreen, especially on mobile devices. You can always change this with the button in the top-right corner. For some devices fullscreen might not work."}),Object(O.jsxs)("div",{style:{display:"flex",height:"30%"},children:[Object(O.jsx)(x.a,{primary:!0,size:"massive",onClick:function(){t.active||t.enter(),o(!1)},style:{flex:"1 1 auto"},children:"Fullscreen"}),Object(O.jsx)(x.a,{secondary:!0,size:"massive",onClick:function(){t.active&&t.exit(),o(!1)},style:{flex:"1 1 auto"},children:"Windowed"})]})]})]})},Gt=function(e){var t=e.handle;return Object(O.jsx)(v.a.Group,{size:"big",style:{paddingRight:"10px",position:"absolute",top:"0px",right:0},children:Object(O.jsx)(v.a,{link:!0,name:t.active?"window close":"expand",onClick:function(){t.active?t.exit():t.enter()}})})},Jt=function(e){var t=e.children,n=Object(Wt.b)(),r=Object(O.jsx)(Gt,{handle:n});return Object(O.jsx)(Wt.a,{handle:n,children:Object(O.jsx)(Vt,{style:{height:"100%"},children:function(e){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(Yt,{handle:n}),t(e,r)]})}})})},Qt=(n(233),function(){var e=Object(u.a)(f.a.mark((function e(t,n,r,i){var a,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<0)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t.getUnit(n);case 5:a=e.sent,r(Object(s.a)(Object(s.a)({jobServer:t,unitId:a.id},a.unit),{},{annotations:a.annotation,status:a.status})),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),404===(null===(o=e.t0.response)||void 0===o?void 0:o.status)&&i(null),r(null),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),Kt=function(e){var t;switch(null===e||void 0===e||null===(t=e.codebook)||void 0===t?void 0:t.type){case"questions":return["800px","1000px"];case"annotate":return["2000px","2000px"];default:return["100%","100%"]}},Xt=function(e){var t=e.jobServer;return t?t.getAllAnnotations?Object(O.jsx)(b.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(O.jsxs)(b.a.Row,{style:{marginTop:"40%"},children:[Object(O.jsx)(b.a.Column,{width:4,children:Object(O.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(1)"}})}),Object(O.jsxs)(b.a.Column,{width:8,children:[Object(O.jsx)(j.a,{children:"You finished the codingjob!"}),Object(O.jsx)("p",{children:"Please download your results and send them to whoever gave you this job. "}),Object(O.jsx)(y,{jobServer:t})]})]})}):Object(O.jsx)(b.a,{container:!0,centered:!0,verticalAlign:"middle",style:{margin:"0",padding:"0"},children:Object(O.jsx)(b.a.Row,{style:{marginTop:"40%"},children:Object(O.jsx)("div",{children:Object(O.jsx)(v.a,{name:"flag checkered",size:"huge",style:{transform:"scale(5)"}})})})}):null},Zt=function(e){var t=e.jobServer,n=Object(r.useState)(-1),i=Object(l.a)(n,2),a=i[0],o=i[1],c=Object(r.useState)(null),s=Object(l.a)(c,2),u=s[0],d=s[1];Object(r.useEffect)((function(){o(t.progress.n_coded)}),[t,o]),Object(r.useEffect)((function(){t&&Qt(t,a,d,o)}),[a,t,o,d]);var f=function(e){return a<0?null:null===a?Object(O.jsx)(Xt,{jobServer:t}):Object(O.jsx)(Ft,{unit:u,setUnitIndex:o,fullScreenNode:e})},b=Kt(t),v=Object(l.a)(b,2),j=v[0],h=v[1];return Object(O.jsx)(Jt,{children:function(e,n){return Object(O.jsxs)("div",{style:{maxWidth:h,maxHeight:j,background:"white",margin:"0 auto",padding:"0",height:"100%",border:"1px solid white"},children:[Object(O.jsxs)("div",{style:{height:"45px",padding:"0",position:"relative"},children:[Object(O.jsx)("div",{style:{width:"85%",paddingLeft:"7.5%"},children:Object(O.jsx)(C,{n:null===t||void 0===t?void 0:t.progress.n_total,index:a,setIndex:o,canGoBack:null===t||void 0===t?void 0:t.progress.seek_backwards,canGoForward:null===t||void 0===t?void 0:t.progress.seek_forwards})}),Object(O.jsx)("div",{children:n})]}),Object(O.jsx)("div",{style:{height:"calc(100% - 45px)",padding:"0"},children:f(e)})]})}})},$t=n(20),en=n(17),tn=n(156),nn=n.n(tn);function rn(e,t,n){return an.apply(this,arguments)}function an(){return(an=Object(u.a)(f.a.mark((function e(t,n,r){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nn.a.get("".concat(t,"/token"),{auth:{username:n,password:r}});case 2:return i=e.sent,e.abrupt("return",i.data.token);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var on=function(){function e(t,n,r){Object($t.a)(this,e),this.host=t,this.email=n,this.token=r,this.api=nn.a.create({baseURL:t,headers:{Authorization:"Bearer ".concat(r)}})}return Object(en.a)(e,[{key:"init",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,rn();case 3:console.log(this.email),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"getJobs",value:function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjobs");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/token");case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCodebook",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/codebook"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getProgress",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t,"/progress"));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(u.a)(f.a.mark((function e(t,n){var r,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="/codingjob/".concat(t,"/unit"),null!==n&&(r+="?index=".concat(n)),e.next=4,this.api.get(r);case 4:return i=e.sent,e.abrupt("return",i.data);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getCodingjob",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.get("/codingjob/".concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postCodingjob",value:function(e,t){return e.title=t,this.api.post("/codingjob",{title:t,units:e.units,codebook:e.codebook,provenance:e.provenance,rules:e.rules})}},{key:"postAnnotation",value:function(e,t,n,r){var i={annotation:n,status:r};this.api.post("/codingjob/".concat(e,"/unit/").concat(t,"/annotation"),i)}}]),e}(),cn=on,ln=n(277),sn=function(){var e=Object(u.a)(f.a.mark((function e(t,n,r){var i,a,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=new cn(null===t||void 0===t||null===(i=t.backend)||void 0===i?void 0:i.host,null===t||void 0===t||null===(a=t.backend)||void 0===a?void 0:a.email,null===t||void 0===t||null===(o=t.backend)||void 0===o?void 0:o.token),e.prev=1,e.next=4,c.init();case 4:r(c),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0),r(null),n("backend",JSON.stringify(Object(s.a)(Object(s.a)({},c),{},{token:null})),{path:"/"});case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),un=function(e){var t=e.host,n=void 0===t?null:t,r=Object(Ot.a)(["backend"]),i=Object(l.a)(r,2),a=i[0],o=i[1],c=a.backend||{host:"http://localhost:5000",email:"test@user.com",token:null};n&&(c.host=n);return c.token?Object(O.jsx)(dn,{backend:c,setLogout:function(){o("backend",JSON.stringify(Object(s.a)(Object(s.a)({},c),{},{token:null})),{path:"/"})}}):Object(O.jsx)(fn,{backend:c,setLogin:function(e){o("backend",JSON.stringify(e),{path:"/"})}})},dn=function(e){var t=e.backend,n=e.setLogout;return Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(b.a,{textAlign:"center",children:Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(x.a,{secondary:!0,onClick:n,children:["Sign out from ",Object(O.jsx)("span",{style:{color:"lightblue"},children:t.email})]})})})})},fn=function(e){var t=e.backend,n=e.setLogin,i=Object(r.useState)(""),a=Object(l.a)(i,2),o=a[0],c=a[1],s=Object(r.useState)(""),d=Object(l.a)(s,2),v=d[0],h=d[1],p=Object(r.useState)(""),g=Object(l.a)(p,2),m=g[0],y=g[1],w=Object(r.useState)(!1),S=Object(l.a)(w,2),C=S[0],E=S[1],A=function(){var e=Object(u.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y(""),e.prev=1,e.next=4,rn(o,v,m);case 4:t=e.sent,n({host:o,email:v,token:t}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),E(!0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),R=!v.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return Object(r.useEffect)((function(){null!==t&&void 0!==t&&t.email&&h(t.email),null!==t&&void 0!==t&&t.host&&c(t.host)}),[t]),Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(j.a,{icon:"user",content:"Register or sign in"}),Object(O.jsxs)(k.a,{placeholder:!0,attached:"bottom",children:[Object(O.jsx)(b.a,{stackable:!0,textAlign:"center",children:Object(O.jsx)(b.a.Row,{children:Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(pt.a,{children:[Object(O.jsx)(pt.a.Input,{placeholder:"Host",name:"host",label:"Host",value:o,onChange:function(e,t){t.value.length<100&&c(t.value)},icon:"home",iconPosition:"left",autoFocus:!0}),Object(O.jsx)(pt.a.Input,{placeholder:"email adress",error:!!R&&"Please enter a valid email adress",name:"email",label:"Email",icon:"mail",iconPosition:"left",value:v,onChange:function(e,t){t.value.length<100&&h(t.value)}})]})})})}),Object(O.jsx)(ln.a,{}),Object(O.jsx)(b.a,{columns:2,textAlign:"center",children:Object(O.jsxs)(b.a.Row,{verticalAlign:"middle",children:[Object(O.jsx)(b.a.Column,{children:Object(O.jsx)(pt.a,{children:Object(O.jsx)(x.a,{circular:!0,primary:!0,fluid:!0,style:{width:"7em",height:"7em"},children:"Login by email (not yet functional)"})})}),Object(O.jsx)(ln.a,{vertical:!0,children:"Or"}),Object(O.jsx)(b.a.Column,{children:Object(O.jsxs)(pt.a,{children:[Object(O.jsx)(pt.a.Input,{placeholder:"password",name:"password",error:!!C&&"Invalid password for this host & email",label:"Password",type:"password",icon:"lock",iconPosition:"left",value:m,onChange:function(e,t){E(!1),y(t.value)}}),Object(O.jsx)(x.a,{disabled:0===m.length,primary:!0,fluid:!0,onClick:A,children:"Sign in"})]})})]})})]})]})},bn=function(e){var t,n=Object(Ot.a)(["backend"]),i=Object(l.a)(n,2),a=i[0],o=i[1],c=Object(r.useState)(null),s=Object(l.a)(c,2),u=s[0],d=s[1];return Object(r.useEffect)((function(){var t,n,r,i=e||(null===a||void 0===a||null===(t=a.backend)||void 0===t?void 0:t.host)||null;i&&i!==(null===u||void 0===u?void 0:u.host)&&d(null),null!==a&&void 0!==a&&null!==(n=a.backend)&&void 0!==n&&n.token?!u&&i&&null!==a&&void 0!==a&&null!==(r=a.backend)&&void 0!==r&&r.token&&sn(a,o,d):d(null)}),[a,u,e,o,d]),[u,Object(O.jsx)(un,{host:e||(null===a||void 0===a||null===(t=a.backend)||void 0===t?void 0:t.host)||null})]},vn=function(){function e(t,n){Object($t.a)(this,e),this.backend=t,this.job_id=n,this.where="remote"}return Object(en.a)(e,[{key:"init",value:function(){var e=Object(u.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.backend.getCodebook(this.job_id);case 3:return this.codebook=e.sent,e.next=6,this.backend.getProgress(this.job_id);case 6:this.progress=e.sent,e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0),this.success=!1,e.abrupt("return");case 14:this.success=!0;case 15:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUnit",value:function(){var e=Object(u.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t>=this.progress.n_coded&&!this.progress.seek_forwards,this.progress.n_coded=Math.max(t,this.progress.n_coded),e.next=4,this.backend.getUnit(this.job_id,n?null:t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"postAnnotations",value:function(e,t,n){this.backend.postAnnotation(this.job_id,e,t,n)}}]),e}(),jn=vn,hn=function(e){var t=e.backend,n=e.loginForm;return t.getJobs().then((function(e){return console.log(e)})),Object(O.jsxs)(b.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:[Object(O.jsx)(b.a.Row,{children:Object(O.jsxs)(b.a.Column,{children:[Object(O.jsx)(j.a,{children:t.host}),n]})}),Object(O.jsx)(b.a.Row,{children:"test"})]})},pn=function(e,t){var n=Object(r.useState)(null),i=Object(l.a)(n,2),a=i[0],o=i[1];return Object(r.useEffect)((function(){if(e&&t){var n=new jn(e,t);n.init().then((function(){return o(n)}))}else o(null)}),[e,t]),a},xn=function(e){var t,n=null===(t=e.split("?"))||void 0===t?void 0:t[1];if(!n)return[null,null];var r=n.split("&").reduce((function(e,t){var n=t.split("="),r=Object(l.a)(n,2),i=r[0],a=r[1];return e[decodeURIComponent(i)]=decodeURIComponent(a),e}),{});if(!r.url)return[null,null];var i=new URL(r.url);return[i.origin,i.pathname.split("/").slice(-1)[0]]},On=function(){var e=xn(window.location.href),t=Object(l.a)(e,2),n=t[0],r=t[1],i=bn(n),a=Object(l.a)(i,2),o=a[0],c=a[1],s=pn(o,r);return o?s?Object(O.jsx)(Zt,{jobServer:s}):Object(O.jsx)(hn,{backend:o,loginForm:c}):Object(O.jsx)(b.a,{inverted:!0,textAlign:"center",style:{height:"100vh"},verticalAlign:"middle",children:Object(O.jsx)(b.a.Column,{style:{maxWidth:"500px"},children:c})})},gn=function(){return Object(O.jsx)(c.a,{basename:"/",children:Object(O.jsx)("div",{style:{height:"100vh",width:"100vw"},children:Object(O.jsx)(On,{})})})},mn=n(278);o.a.render(Object(O.jsx)(i.a.StrictMode,{children:Object(O.jsx)(mn.a,{children:Object(O.jsx)(gn,{})})}),document.querySelector("#root"))}},[[257,1,2]]]);
//# sourceMappingURL=main.e1fff777.chunk.js.map